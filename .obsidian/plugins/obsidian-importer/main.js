/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var Rh=Object.create;var hi=Object.defineProperty;var Ih=Object.getOwnPropertyDescriptor;var Dh=Object.getOwnPropertyNames;var Oh=Object.getPrototypeOf,Fh=Object.prototype.hasOwnProperty;var G=(n,t)=>()=>(t||n((t={exports:{}}).exports,t),t.exports),je=(n,t)=>{for(var e in t)hi(n,e,{get:t[e],enumerable:!0})},Fl=(n,t,e,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let i of Dh(t))!Fh.call(n,i)&&i!==e&&hi(n,i,{get:()=>t[i],enumerable:!(r=Ih(t,i))||r.enumerable});return n};var gi=(n,t,e)=>(e=n!=null?Rh(Oh(n)):{},Fl(t||!n||!n.__esModule?hi(e,"default",{value:n,enumerable:!0}):e,n)),Lh=n=>Fl(hi({},"__esModule",{value:!0}),n);var Qa=G((R_,hp)=>{"use strict";hp.exports=S0;function S0(n,t){for(var e=new Array(arguments.length-1),r=0,i=2,o=!0;i<arguments.length;)e[r++]=arguments[i++];return new Promise(function(l,s){e[r]=function(p){if(o)if(o=!1,p)s(p);else{for(var u=new Array(arguments.length-1),f=0;f<u.length;)u[f++]=arguments[f];l.apply(null,u)}};try{n.apply(t||null,e)}catch(c){o&&(o=!1,s(c))}})}});var vp=G(bp=>{"use strict";var qi=bp;qi.length=function(t){var e=t.length;if(!e)return 0;for(var r=0;--e%4>1&&t.charAt(e)==="=";)++r;return Math.ceil(t.length*3)/4-r};var Zn=new Array(64),yp=new Array(123);for(at=0;at<64;)yp[Zn[at]=at<26?at+65:at<52?at+71:at<62?at-4:at-59|43]=at++;var at;qi.encode=function(t,e,r){for(var i=null,o=[],a=0,l=0,s;e<r;){var c=t[e++];switch(l){case 0:o[a++]=Zn[c>>2],s=(c&3)<<4,l=1;break;case 1:o[a++]=Zn[s|c>>4],s=(c&15)<<2,l=2;break;case 2:o[a++]=Zn[s|c>>6],o[a++]=Zn[c&63],l=0;break}a>8191&&((i||(i=[])).push(String.fromCharCode.apply(String,o)),a=0)}return l&&(o[a++]=Zn[s],o[a++]=61,l===1&&(o[a++]=61)),i?(a&&i.push(String.fromCharCode.apply(String,o.slice(0,a))),i.join("")):String.fromCharCode.apply(String,o.slice(0,a))};var gp="invalid encoding";qi.decode=function(t,e,r){for(var i=r,o=0,a,l=0;l<t.length;){var s=t.charCodeAt(l++);if(s===61&&o>1)break;if((s=yp[s])===void 0)throw Error(gp);switch(o){case 0:a=s,o=1;break;case 1:e[r++]=a<<2|(s&48)>>4,a=s,o=2;break;case 2:e[r++]=(a&15)<<4|(s&60)>>2,a=s,o=3;break;case 3:e[r++]=(a&3)<<6|s,o=0;break}}if(o===1)throw Error(gp);return r-i};qi.test=function(t){return/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(t)}});var xp=G((D_,wp)=>{"use strict";wp.exports=Hi;function Hi(){this._listeners={}}Hi.prototype.on=function(t,e,r){return(this._listeners[t]||(this._listeners[t]=[])).push({fn:e,ctx:r||this}),this};Hi.prototype.off=function(t,e){if(t===void 0)this._listeners={};else if(e===void 0)this._listeners[t]=[];else for(var r=this._listeners[t],i=0;i<r.length;)r[i].fn===e?r.splice(i,1):++i;return this};Hi.prototype.emit=function(t){var e=this._listeners[t];if(e){for(var r=[],i=1;i<arguments.length;)r.push(arguments[i++]);for(i=0;i<e.length;)e[i].fn.apply(e[i++].ctx,r)}return this}});var Cp=G((O_,Pp)=>{"use strict";Pp.exports=Tp(Tp);function Tp(n){return typeof Float32Array!="undefined"?function(){var t=new Float32Array([-0]),e=new Uint8Array(t.buffer),r=e[3]===128;function i(s,c,p){t[0]=s,c[p]=e[0],c[p+1]=e[1],c[p+2]=e[2],c[p+3]=e[3]}function o(s,c,p){t[0]=s,c[p]=e[3],c[p+1]=e[2],c[p+2]=e[1],c[p+3]=e[0]}n.writeFloatLE=r?i:o,n.writeFloatBE=r?o:i;function a(s,c){return e[0]=s[c],e[1]=s[c+1],e[2]=s[c+2],e[3]=s[c+3],t[0]}function l(s,c){return e[3]=s[c],e[2]=s[c+1],e[1]=s[c+2],e[0]=s[c+3],t[0]}n.readFloatLE=r?a:l,n.readFloatBE=r?l:a}():function(){function t(r,i,o,a){var l=i<0?1:0;if(l&&(i=-i),i===0)r(1/i>0?0:2147483648,o,a);else if(isNaN(i))r(2143289344,o,a);else if(i>34028234663852886e22)r((l<<31|2139095040)>>>0,o,a);else if(i<11754943508222875e-54)r((l<<31|Math.round(i/1401298464324817e-60))>>>0,o,a);else{var s=Math.floor(Math.log(i)/Math.LN2),c=Math.round(i*Math.pow(2,-s)*8388608)&8388607;r((l<<31|s+127<<23|c)>>>0,o,a)}}n.writeFloatLE=t.bind(null,_p),n.writeFloatBE=t.bind(null,Ep);function e(r,i,o){var a=r(i,o),l=(a>>31)*2+1,s=a>>>23&255,c=a&8388607;return s===255?c?NaN:l*(1/0):s===0?l*1401298464324817e-60*c:l*Math.pow(2,s-150)*(c+8388608)}n.readFloatLE=e.bind(null,kp),n.readFloatBE=e.bind(null,Ap)}(),typeof Float64Array!="undefined"?function(){var t=new Float64Array([-0]),e=new Uint8Array(t.buffer),r=e[7]===128;function i(s,c,p){t[0]=s,c[p]=e[0],c[p+1]=e[1],c[p+2]=e[2],c[p+3]=e[3],c[p+4]=e[4],c[p+5]=e[5],c[p+6]=e[6],c[p+7]=e[7]}function o(s,c,p){t[0]=s,c[p]=e[7],c[p+1]=e[6],c[p+2]=e[5],c[p+3]=e[4],c[p+4]=e[3],c[p+5]=e[2],c[p+6]=e[1],c[p+7]=e[0]}n.writeDoubleLE=r?i:o,n.writeDoubleBE=r?o:i;function a(s,c){return e[0]=s[c],e[1]=s[c+1],e[2]=s[c+2],e[3]=s[c+3],e[4]=s[c+4],e[5]=s[c+5],e[6]=s[c+6],e[7]=s[c+7],t[0]}function l(s,c){return e[7]=s[c],e[6]=s[c+1],e[5]=s[c+2],e[4]=s[c+3],e[3]=s[c+4],e[2]=s[c+5],e[1]=s[c+6],e[0]=s[c+7],t[0]}n.readDoubleLE=r?a:l,n.readDoubleBE=r?l:a}():function(){function t(r,i,o,a,l,s){var c=a<0?1:0;if(c&&(a=-a),a===0)r(0,l,s+i),r(1/a>0?0:2147483648,l,s+o);else if(isNaN(a))r(0,l,s+i),r(2146959360,l,s+o);else if(a>17976931348623157e292)r(0,l,s+i),r((c<<31|2146435072)>>>0,l,s+o);else{var p;if(a<22250738585072014e-324)p=a/5e-324,r(p>>>0,l,s+i),r((c<<31|p/4294967296)>>>0,l,s+o);else{var u=Math.floor(Math.log(a)/Math.LN2);u===1024&&(u=1023),p=a*Math.pow(2,-u),r(p*4503599627370496>>>0,l,s+i),r((c<<31|u+1023<<20|p*1048576&1048575)>>>0,l,s+o)}}}n.writeDoubleLE=t.bind(null,_p,0,4),n.writeDoubleBE=t.bind(null,Ep,4,0);function e(r,i,o,a,l){var s=r(a,l+i),c=r(a,l+o),p=(c>>31)*2+1,u=c>>>20&2047,f=4294967296*(c&1048575)+s;return u===2047?f?NaN:p*(1/0):u===0?p*5e-324*f:p*Math.pow(2,u-1075)*(f+4503599627370496)}n.readDoubleLE=e.bind(null,kp,0,4),n.readDoubleBE=e.bind(null,Ap,4,0)}(),n}function _p(n,t,e){t[e]=n&255,t[e+1]=n>>>8&255,t[e+2]=n>>>16&255,t[e+3]=n>>>24}function Ep(n,t,e){t[e]=n>>>24,t[e+1]=n>>>16&255,t[e+2]=n>>>8&255,t[e+3]=n&255}function kp(n,t){return(n[t]|n[t+1]<<8|n[t+2]<<16|n[t+3]<<24)>>>0}function Ap(n,t){return(n[t]<<24|n[t+1]<<16|n[t+2]<<8|n[t+3])>>>0}});var es=G((exports,module)=>{"use strict";module.exports=inquire;function inquire(moduleName){try{var mod=eval("quire".replace(/^/,"re"))(moduleName);if(mod&&(mod.length||Object.keys(mod).length))return mod}catch(n){}return null}});var Sp=G(Np=>{"use strict";var ts=Np;ts.length=function(t){for(var e=0,r=0,i=0;i<t.length;++i)r=t.charCodeAt(i),r<128?e+=1:r<2048?e+=2:(r&64512)===55296&&(t.charCodeAt(i+1)&64512)===56320?(++i,e+=4):e+=3;return e};ts.read=function(t,e,r){var i=r-e;if(i<1)return"";for(var o=null,a=[],l=0,s;e<r;)s=t[e++],s<128?a[l++]=s:s>191&&s<224?a[l++]=(s&31)<<6|t[e++]&63:s>239&&s<365?(s=((s&7)<<18|(t[e++]&63)<<12|(t[e++]&63)<<6|t[e++]&63)-65536,a[l++]=55296+(s>>10),a[l++]=56320+(s&1023)):a[l++]=(s&15)<<12|(t[e++]&63)<<6|t[e++]&63,l>8191&&((o||(o=[])).push(String.fromCharCode.apply(String,a)),l=0);return o?(l&&o.push(String.fromCharCode.apply(String,a.slice(0,l))),o.join("")):String.fromCharCode.apply(String,a.slice(0,l))};ts.write=function(t,e,r){for(var i=r,o,a,l=0;l<t.length;++l)o=t.charCodeAt(l),o<128?e[r++]=o:o<2048?(e[r++]=o>>6|192,e[r++]=o&63|128):(o&64512)===55296&&((a=t.charCodeAt(l+1))&64512)===56320?(o=65536+((o&1023)<<10)+(a&1023),++l,e[r++]=o>>18|240,e[r++]=o>>12&63|128,e[r++]=o>>6&63|128,e[r++]=o&63|128):(e[r++]=o>>12|224,e[r++]=o>>6&63|128,e[r++]=o&63|128);return r-i}});var Ip=G((L_,Rp)=>{"use strict";Rp.exports=R0;function R0(n,t,e){var r=e||8192,i=r>>>1,o=null,a=r;return function(s){if(s<1||s>i)return n(s);a+s>r&&(o=n(r),a=0);var c=t.call(o,a,a+=s);return a&7&&(a=(a|7)+1),c}}});var Op=G(($_,Dp)=>{"use strict";Dp.exports=ke;var Mr=yt();function ke(n,t){this.lo=n>>>0,this.hi=t>>>0}var kn=ke.zero=new ke(0,0);kn.toNumber=function(){return 0};kn.zzEncode=kn.zzDecode=function(){return this};kn.length=function(){return 1};var I0=ke.zeroHash="\0\0\0\0\0\0\0\0";ke.fromNumber=function(t){if(t===0)return kn;var e=t<0;e&&(t=-t);var r=t>>>0,i=(t-r)/4294967296>>>0;return e&&(i=~i>>>0,r=~r>>>0,++r>4294967295&&(r=0,++i>4294967295&&(i=0))),new ke(r,i)};ke.from=function(t){if(typeof t=="number")return ke.fromNumber(t);if(Mr.isString(t))if(Mr.Long)t=Mr.Long.fromString(t);else return ke.fromNumber(parseInt(t,10));return t.low||t.high?new ke(t.low>>>0,t.high>>>0):kn};ke.prototype.toNumber=function(t){if(!t&&this.hi>>>31){var e=~this.lo+1>>>0,r=~this.hi>>>0;return e||(r=r+1>>>0),-(e+r*4294967296)}return this.lo+this.hi*4294967296};ke.prototype.toLong=function(t){return Mr.Long?new Mr.Long(this.lo|0,this.hi|0,!!t):{low:this.lo|0,high:this.hi|0,unsigned:!!t}};var Xt=String.prototype.charCodeAt;ke.fromHash=function(t){return t===I0?kn:new ke((Xt.call(t,0)|Xt.call(t,1)<<8|Xt.call(t,2)<<16|Xt.call(t,3)<<24)>>>0,(Xt.call(t,4)|Xt.call(t,5)<<8|Xt.call(t,6)<<16|Xt.call(t,7)<<24)>>>0)};ke.prototype.toHash=function(){return String.fromCharCode(this.lo&255,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,this.hi&255,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)};ke.prototype.zzEncode=function(){var t=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^t)>>>0,this.lo=(this.lo<<1^t)>>>0,this};ke.prototype.zzDecode=function(){var t=-(this.lo&1);return this.lo=((this.lo>>>1|this.hi<<31)^t)>>>0,this.hi=(this.hi>>>1^t)>>>0,this};ke.prototype.length=function(){var t=this.lo,e=(this.lo>>>28|this.hi<<4)>>>0,r=this.hi>>>24;return r===0?e===0?t<16384?t<128?1:2:t<2097152?3:4:e<16384?e<128?5:6:e<2097152?7:8:r<128?9:10}});var yt=G(ns=>{"use strict";var Y=ns;Y.asPromise=Qa();Y.base64=vp();Y.EventEmitter=xp();Y.float=Cp();Y.inquire=es();Y.utf8=Sp();Y.pool=Ip();Y.LongBits=Op();Y.isNode=!!(typeof global!="undefined"&&global&&global.process&&global.process.versions&&global.process.versions.node);Y.global=Y.isNode&&global||typeof window!="undefined"&&window||typeof self!="undefined"&&self||ns;Y.emptyArray=Object.freeze?Object.freeze([]):[];Y.emptyObject=Object.freeze?Object.freeze({}):{};Y.isInteger=Number.isInteger||function(t){return typeof t=="number"&&isFinite(t)&&Math.floor(t)===t};Y.isString=function(t){return typeof t=="string"||t instanceof String};Y.isObject=function(t){return t&&typeof t=="object"};Y.isset=Y.isSet=function(t,e){var r=t[e];return r!=null&&t.hasOwnProperty(e)?typeof r!="object"||(Array.isArray(r)?r.length:Object.keys(r).length)>0:!1};Y.Buffer=function(){try{var n=Y.inquire("buffer").Buffer;return n.prototype.utf8Write?n:null}catch(t){return null}}();Y._Buffer_from=null;Y._Buffer_allocUnsafe=null;Y.newBuffer=function(t){return typeof t=="number"?Y.Buffer?Y._Buffer_allocUnsafe(t):new Y.Array(t):Y.Buffer?Y._Buffer_from(t):typeof Uint8Array=="undefined"?t:new Uint8Array(t)};Y.Array=typeof Uint8Array!="undefined"?Uint8Array:Array;Y.Long=Y.global.dcodeIO&&Y.global.dcodeIO.Long||Y.global.Long||Y.inquire("long");Y.key2Re=/^true|false|0|1$/;Y.key32Re=/^-?(?:0|[1-9][0-9]*)$/;Y.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/;Y.longToHash=function(t){return t?Y.LongBits.from(t).toHash():Y.LongBits.zeroHash};Y.longFromHash=function(t,e){var r=Y.LongBits.fromHash(t);return Y.Long?Y.Long.fromBits(r.lo,r.hi,e):r.toNumber(!!e)};function Fp(n,t,e){for(var r=Object.keys(t),i=0;i<r.length;++i)(n[r[i]]===void 0||!e)&&(n[r[i]]=t[r[i]]);return n}Y.merge=Fp;Y.lcFirst=function(t){return t.charAt(0).toLowerCase()+t.substring(1)};function Lp(n){function t(e,r){if(!(this instanceof t))return new t(e,r);Object.defineProperty(this,"message",{get:function(){return e}}),Error.captureStackTrace?Error.captureStackTrace(this,t):Object.defineProperty(this,"stack",{value:new Error().stack||""}),r&&Fp(this,r)}return t.prototype=Object.create(Error.prototype,{constructor:{value:t,writable:!0,enumerable:!1,configurable:!0},name:{get:function(){return n},set:void 0,enumerable:!1,configurable:!0},toString:{value:function(){return this.name+": "+this.message},writable:!0,enumerable:!1,configurable:!0}}),t}Y.newError=Lp;Y.ProtocolError=Lp("ProtocolError");Y.oneOfGetter=function(t){for(var e={},r=0;r<t.length;++r)e[t[r]]=1;return function(){for(var i=Object.keys(this),o=i.length-1;o>-1;--o)if(e[i[o]]===1&&this[i[o]]!==void 0&&this[i[o]]!==null)return i[o]}};Y.oneOfSetter=function(t){return function(e){for(var r=0;r<t.length;++r)t[r]!==e&&delete this[t[r]]}};Y.toJSONOptions={longs:String,enums:String,bytes:String,json:!0};Y._configure=function(){var n=Y.Buffer;if(!n){Y._Buffer_from=Y._Buffer_allocUnsafe=null;return}Y._Buffer_from=n.from!==Uint8Array.from&&n.from||function(e,r){return new n(e,r)},Y._Buffer_allocUnsafe=n.allocUnsafe||function(e){return new n(e)}}});var zi=G((B_,jp)=>{"use strict";jp.exports=re;var Xe=yt(),rs,Wi=Xe.LongBits,$p=Xe.base64,Mp=Xe.utf8;function Br(n,t,e){this.fn=n,this.len=t,this.next=void 0,this.val=e}function os(){}function D0(n){this.head=n.head,this.tail=n.tail,this.len=n.len,this.next=n.states}function re(){this.len=0,this.head=new Br(os,0,0),this.tail=this.head,this.states=null}var Bp=function(){return Xe.Buffer?function(){return(re.create=function(){return new rs})()}:function(){return new re}};re.create=Bp();re.alloc=function(t){return new Xe.Array(t)};Xe.Array!==Array&&(re.alloc=Xe.pool(re.alloc,Xe.Array.prototype.subarray));re.prototype._push=function(t,e,r){return this.tail=this.tail.next=new Br(t,e,r),this.len+=e,this};function as(n,t,e){t[e]=n&255}function O0(n,t,e){for(;n>127;)t[e++]=n&127|128,n>>>=7;t[e]=n}function ss(n,t){this.len=n,this.next=void 0,this.val=t}ss.prototype=Object.create(Br.prototype);ss.prototype.fn=O0;re.prototype.uint32=function(t){return this.len+=(this.tail=this.tail.next=new ss((t=t>>>0)<128?1:t<16384?2:t<2097152?3:t<268435456?4:5,t)).len,this};re.prototype.int32=function(t){return t<0?this._push(ls,10,Wi.fromNumber(t)):this.uint32(t)};re.prototype.sint32=function(t){return this.uint32((t<<1^t>>31)>>>0)};function ls(n,t,e){for(;n.hi;)t[e++]=n.lo&127|128,n.lo=(n.lo>>>7|n.hi<<25)>>>0,n.hi>>>=7;for(;n.lo>127;)t[e++]=n.lo&127|128,n.lo=n.lo>>>7;t[e++]=n.lo}re.prototype.uint64=function(t){var e=Wi.from(t);return this._push(ls,e.length(),e)};re.prototype.int64=re.prototype.uint64;re.prototype.sint64=function(t){var e=Wi.from(t).zzEncode();return this._push(ls,e.length(),e)};re.prototype.bool=function(t){return this._push(as,1,t?1:0)};function is(n,t,e){t[e]=n&255,t[e+1]=n>>>8&255,t[e+2]=n>>>16&255,t[e+3]=n>>>24}re.prototype.fixed32=function(t){return this._push(is,4,t>>>0)};re.prototype.sfixed32=re.prototype.fixed32;re.prototype.fixed64=function(t){var e=Wi.from(t);return this._push(is,4,e.lo)._push(is,4,e.hi)};re.prototype.sfixed64=re.prototype.fixed64;re.prototype.float=function(t){return this._push(Xe.float.writeFloatLE,4,t)};re.prototype.double=function(t){return this._push(Xe.float.writeDoubleLE,8,t)};var F0=Xe.Array.prototype.set?function(t,e,r){e.set(t,r)}:function(t,e,r){for(var i=0;i<t.length;++i)e[r+i]=t[i]};re.prototype.bytes=function(t){var e=t.length>>>0;if(!e)return this._push(as,1,0);if(Xe.isString(t)){var r=re.alloc(e=$p.length(t));$p.decode(t,r,0),t=r}return this.uint32(e)._push(F0,e,t)};re.prototype.string=function(t){var e=Mp.length(t);return e?this.uint32(e)._push(Mp.write,e,t):this._push(as,1,0)};re.prototype.fork=function(){return this.states=new D0(this),this.head=this.tail=new Br(os,0,0),this.len=0,this};re.prototype.reset=function(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new Br(os,0,0),this.len=0),this};re.prototype.ldelim=function(){var t=this.head,e=this.tail,r=this.len;return this.reset().uint32(r),r&&(this.tail.next=t.next,this.tail=e,this.len+=r),this};re.prototype.finish=function(){for(var t=this.head.next,e=this.constructor.alloc(this.len),r=0;t;)t.fn(t.val,e,r),r+=t.len,t=t.next;return e};re._configure=function(n){rs=n,re.create=Bp(),rs._configure()}});var Hp=G((j_,qp)=>{"use strict";qp.exports=bt;var Up=zi();(bt.prototype=Object.create(Up.prototype)).constructor=bt;var Jt=yt();function bt(){Up.call(this)}bt._configure=function(){bt.alloc=Jt._Buffer_allocUnsafe,bt.writeBytesBuffer=Jt.Buffer&&Jt.Buffer.prototype instanceof Uint8Array&&Jt.Buffer.prototype.set.name==="set"?function(t,e,r){e.set(t,r)}:function(t,e,r){if(t.copy)t.copy(e,r,0,t.length);else for(var i=0;i<t.length;)e[r++]=t[i++]}};bt.prototype.bytes=function(t){Jt.isString(t)&&(t=Jt._Buffer_from(t,"base64"));var e=t.length>>>0;return this.uint32(e),e&&this._push(bt.writeBytesBuffer,e,t),this};function L0(n,t,e){n.length<40?Jt.utf8.write(n,t,e):t.utf8Write?t.utf8Write(n,e):t.write(n,e)}bt.prototype.string=function(t){var e=Jt.Buffer.byteLength(t);return this.uint32(e),e&&this._push(L0,e,t),this};bt._configure()});var Vi=G((U_,Gp)=>{"use strict";Gp.exports=ge;var st=yt(),ps,Yp=st.LongBits,$0=st.utf8;function lt(n,t){return RangeError("index out of range: "+n.pos+" + "+(t||1)+" > "+n.len)}function ge(n){this.buf=n,this.pos=0,this.len=n.length}var Wp=typeof Uint8Array!="undefined"?function(t){if(t instanceof Uint8Array||Array.isArray(t))return new ge(t);throw Error("illegal buffer")}:function(t){if(Array.isArray(t))return new ge(t);throw Error("illegal buffer")},Vp=function(){return st.Buffer?function(e){return(ge.create=function(i){return st.Buffer.isBuffer(i)?new ps(i):Wp(i)})(e)}:Wp};ge.create=Vp();ge.prototype._slice=st.Array.prototype.subarray||st.Array.prototype.slice;ge.prototype.uint32=function(){var t=4294967295;return function(){if(t=(this.buf[this.pos]&127)>>>0,this.buf[this.pos++]<128||(t=(t|(this.buf[this.pos]&127)<<7)>>>0,this.buf[this.pos++]<128)||(t=(t|(this.buf[this.pos]&127)<<14)>>>0,this.buf[this.pos++]<128)||(t=(t|(this.buf[this.pos]&127)<<21)>>>0,this.buf[this.pos++]<128)||(t=(t|(this.buf[this.pos]&15)<<28)>>>0,this.buf[this.pos++]<128))return t;if((this.pos+=5)>this.len)throw this.pos=this.len,lt(this,10);return t}}();ge.prototype.int32=function(){return this.uint32()|0};ge.prototype.sint32=function(){var t=this.uint32();return t>>>1^-(t&1)|0};function cs(){var n=new Yp(0,0),t=0;if(this.len-this.pos>4){for(;t<4;++t)if(n.lo=(n.lo|(this.buf[this.pos]&127)<<t*7)>>>0,this.buf[this.pos++]<128)return n;if(n.lo=(n.lo|(this.buf[this.pos]&127)<<28)>>>0,n.hi=(n.hi|(this.buf[this.pos]&127)>>4)>>>0,this.buf[this.pos++]<128)return n;t=0}else{for(;t<3;++t){if(this.pos>=this.len)throw lt(this);if(n.lo=(n.lo|(this.buf[this.pos]&127)<<t*7)>>>0,this.buf[this.pos++]<128)return n}return n.lo=(n.lo|(this.buf[this.pos++]&127)<<t*7)>>>0,n}if(this.len-this.pos>4){for(;t<5;++t)if(n.hi=(n.hi|(this.buf[this.pos]&127)<<t*7+3)>>>0,this.buf[this.pos++]<128)return n}else for(;t<5;++t){if(this.pos>=this.len)throw lt(this);if(n.hi=(n.hi|(this.buf[this.pos]&127)<<t*7+3)>>>0,this.buf[this.pos++]<128)return n}throw Error("invalid varint encoding")}ge.prototype.bool=function(){return this.uint32()!==0};function Yi(n,t){return(n[t-4]|n[t-3]<<8|n[t-2]<<16|n[t-1]<<24)>>>0}ge.prototype.fixed32=function(){if(this.pos+4>this.len)throw lt(this,4);return Yi(this.buf,this.pos+=4)};ge.prototype.sfixed32=function(){if(this.pos+4>this.len)throw lt(this,4);return Yi(this.buf,this.pos+=4)|0};function zp(){if(this.pos+8>this.len)throw lt(this,8);return new Yp(Yi(this.buf,this.pos+=4),Yi(this.buf,this.pos+=4))}ge.prototype.float=function(){if(this.pos+4>this.len)throw lt(this,4);var t=st.float.readFloatLE(this.buf,this.pos);return this.pos+=4,t};ge.prototype.double=function(){if(this.pos+8>this.len)throw lt(this,4);var t=st.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,t};ge.prototype.bytes=function(){var t=this.uint32(),e=this.pos,r=this.pos+t;if(r>this.len)throw lt(this,t);if(this.pos+=t,Array.isArray(this.buf))return this.buf.slice(e,r);if(e===r){var i=st.Buffer;return i?i.alloc(0):new this.buf.constructor(0)}return this._slice.call(this.buf,e,r)};ge.prototype.string=function(){var t=this.bytes();return $0.read(t,0,t.length)};ge.prototype.skip=function(t){if(typeof t=="number"){if(this.pos+t>this.len)throw lt(this,t);this.pos+=t}else do if(this.pos>=this.len)throw lt(this);while(this.buf[this.pos++]&128);return this};ge.prototype.skipType=function(n){switch(n){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;(n=this.uint32()&7)!==4;)this.skipType(n);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+n+" at offset "+this.pos)}return this};ge._configure=function(n){ps=n,ge.create=Vp(),ps._configure();var t=st.Long?"toLong":"toNumber";st.merge(ge.prototype,{int64:function(){return cs.call(this)[t](!1)},uint64:function(){return cs.call(this)[t](!0)},sint64:function(){return cs.call(this).zzDecode()[t](!1)},fixed64:function(){return zp.call(this)[t](!0)},sfixed64:function(){return zp.call(this)[t](!1)}})}});var Jp=G((q_,Xp)=>{"use strict";Xp.exports=An;var Kp=Vi();(An.prototype=Object.create(Kp.prototype)).constructor=An;var Zp=yt();function An(n){Kp.call(this,n)}An._configure=function(){Zp.Buffer&&(An.prototype._slice=Zp.Buffer.prototype.slice)};An.prototype.string=function(){var t=this.uint32();return this.buf.utf8Slice?this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+t,this.len)):this.buf.toString("utf-8",this.pos,this.pos=Math.min(this.pos+t,this.len))};An._configure()});var eu=G((H_,Qp)=>{"use strict";Qp.exports=jr;var us=yt();(jr.prototype=Object.create(us.EventEmitter.prototype)).constructor=jr;function jr(n,t,e){if(typeof n!="function")throw TypeError("rpcImpl must be a function");us.EventEmitter.call(this),this.rpcImpl=n,this.requestDelimited=!!t,this.responseDelimited=!!e}jr.prototype.rpcCall=function n(t,e,r,i,o){if(!i)throw TypeError("request must be specified");var a=this;if(!o)return us.asPromise(n,a,t,e,r,i);if(!a.rpcImpl){setTimeout(function(){o(Error("already ended"))},0);return}try{return a.rpcImpl(t,e[a.requestDelimited?"encodeDelimited":"encode"](i).finish(),function(s,c){if(s)return a.emit("error",s,t),o(s);if(c===null){a.end(!0);return}if(!(c instanceof r))try{c=r[a.responseDelimited?"decodeDelimited":"decode"](c)}catch(p){return a.emit("error",p,t),o(p)}return a.emit("data",c,t),o(null,c)})}catch(l){a.emit("error",l,t),setTimeout(function(){o(l)},0);return}};jr.prototype.end=function(t){return this.rpcImpl&&(t||this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit("end").off()),this}});var ds=G(tu=>{"use strict";var M0=tu;M0.Service=eu()});var fs=G((z_,nu)=>{"use strict";nu.exports={}});var ou=G(iu=>{"use strict";var qe=iu;qe.build="minimal";qe.Writer=zi();qe.BufferWriter=Hp();qe.Reader=Vi();qe.BufferReader=Jp();qe.util=yt();qe.rpc=ds();qe.roots=fs();qe.configure=ru;function ru(){qe.util._configure(),qe.Writer._configure(qe.BufferWriter),qe.Reader._configure(qe.BufferReader)}ru()});var su=G((V_,au)=>{"use strict";au.exports=ms;function ms(n,t){typeof n=="string"&&(t=n,n=void 0);var e=[];function r(o){if(typeof o!="string"){var a=i();if(ms.verbose&&console.log("codegen: "+a),a="return "+a,o){for(var l=Object.keys(o),s=new Array(l.length+1),c=new Array(l.length),p=0;p<l.length;)s[p]=l[p],c[p]=o[l[p++]];return s[p]=a,Function.apply(null,s).apply(null,c)}return Function(a)()}for(var u=new Array(arguments.length-1),f=0;f<u.length;)u[f]=arguments[++f];if(f=0,o=o.replace(/%([%dfijs])/g,function(b,d){var m=u[f++];switch(d){case"d":case"f":return String(Number(m));case"i":return String(Math.floor(m));case"j":return JSON.stringify(m);case"s":return String(m)}return"%"}),f!==u.length)throw Error("parameter count mismatch");return e.push(o),r}function i(o){return"function "+(o||t||"")+"("+(n&&n.join(",")||"")+`){
  `+e.join(`
  `)+`
}`}return r.toString=i,r}ms.verbose=!1});var cu=G((G_,lu)=>{"use strict";lu.exports=Ur;var B0=Qa(),j0=es(),hs=j0("fs");function Ur(n,t,e){return typeof t=="function"?(e=t,t={}):t||(t={}),e?!t.xhr&&hs&&hs.readFile?hs.readFile(n,function(i,o){return i&&typeof XMLHttpRequest!="undefined"?Ur.xhr(n,t,e):i?e(i):e(null,t.binary?o:o.toString("utf8"))}):Ur.xhr(n,t,e):B0(Ur,this,n,t)}Ur.xhr=function(t,e,r){var i=new XMLHttpRequest;i.onreadystatechange=function(){if(i.readyState===4){if(i.status!==0&&i.status!==200)return r(Error("status "+i.status));if(e.binary){var a=i.response;if(!a){a=[];for(var l=0;l<i.responseText.length;++l)a.push(i.responseText.charCodeAt(l)&255)}return r(null,typeof Uint8Array!="undefined"?new Uint8Array(a):a)}return r(null,i.responseText)}},e.binary&&("overrideMimeType"in i&&i.overrideMimeType("text/plain; charset=x-user-defined"),i.responseType="arraybuffer"),i.open("GET",t),i.send()}});var du=G(uu=>{"use strict";var ys=uu,pu=ys.isAbsolute=function(t){return/^(?:\/|\w+:)/.test(t)},gs=ys.normalize=function(t){t=t.replace(/\\/g,"/").replace(/\/{2,}/g,"/");var e=t.split("/"),r=pu(t),i="";r&&(i=e.shift()+"/");for(var o=0;o<e.length;)e[o]===".."?o>0&&e[o-1]!==".."?e.splice(--o,2):r?e.splice(o,1):++o:e[o]==="."?e.splice(o,1):++o;return i+e.join("/")};ys.resolve=function(t,e,r){return r||(e=gs(e)),pu(e)?e:(r||(t=gs(t)),(t=t.replace(/(?:\/|^)[^/]+$/,"")).length?gs(t+"/"+e):e)}});var Pn=G(fu=>{"use strict";var qr=fu,U0=Ae(),q0=["double","float","int32","uint32","sint32","fixed32","sfixed32","int64","uint64","sint64","fixed64","sfixed64","bool","string","bytes"];function Hr(n,t){var e=0,r={};for(t|=0;e<n.length;)r[q0[e+t]]=n[e++];return r}qr.basic=Hr([1,5,0,0,0,5,5,0,0,0,1,1,0,2,2]);qr.defaults=Hr([0,0,0,0,0,0,0,0,0,0,0,0,!1,"",U0.emptyArray,null]);qr.long=Hr([0,0,0,1,1],7);qr.mapKey=Hr([0,0,0,5,5,0,0,0,1,1,0,2],2);qr.packed=Hr([1,5,0,0,0,5,5,0,0,0,1,1,0])});var Qt=G((X_,gu)=>{"use strict";gu.exports=Je;var Gi=Cn();((Je.prototype=Object.create(Gi.prototype)).constructor=Je).className="Field";var mu=ct(),hu=Pn(),ve=Ae(),bs,H0=/^required|optional|repeated$/;Je.fromJSON=function(t,e){return new Je(t,e.id,e.type,e.rule,e.extend,e.options,e.comment)};function Je(n,t,e,r,i,o,a){if(ve.isObject(r)?(a=i,o=r,r=i=void 0):ve.isObject(i)&&(a=o,o=i,i=void 0),Gi.call(this,n,o),!ve.isInteger(t)||t<0)throw TypeError("id must be a non-negative integer");if(!ve.isString(e))throw TypeError("type must be a string");if(r!==void 0&&!H0.test(r=r.toString().toLowerCase()))throw TypeError("rule must be a string rule");if(i!==void 0&&!ve.isString(i))throw TypeError("extend must be a string");r==="proto3_optional"&&(r="optional"),this.rule=r&&r!=="optional"?r:void 0,this.type=e,this.id=t,this.extend=i||void 0,this.required=r==="required",this.optional=!this.required,this.repeated=r==="repeated",this.map=!1,this.message=null,this.partOf=null,this.typeDefault=null,this.defaultValue=null,this.long=ve.Long?hu.long[e]!==void 0:!1,this.bytes=e==="bytes",this.resolvedType=null,this.extensionField=null,this.declaringField=null,this._packed=null,this.comment=a}Object.defineProperty(Je.prototype,"packed",{get:function(){return this._packed===null&&(this._packed=this.getOption("packed")!==!1),this._packed}});Je.prototype.setOption=function(t,e,r){return t==="packed"&&(this._packed=null),Gi.prototype.setOption.call(this,t,e,r)};Je.prototype.toJSON=function(t){var e=t?!!t.keepComments:!1;return ve.toObject(["rule",this.rule!=="optional"&&this.rule||void 0,"type",this.type,"id",this.id,"extend",this.extend,"options",this.options,"comment",e?this.comment:void 0])};Je.prototype.resolve=function(){if(this.resolved)return this;if((this.typeDefault=hu.defaults[this.type])===void 0?(this.resolvedType=(this.declaringField?this.declaringField.parent:this.parent).lookupTypeOrEnum(this.type),this.resolvedType instanceof bs?this.typeDefault=null:this.typeDefault=this.resolvedType.values[Object.keys(this.resolvedType.values)[0]]):this.options&&this.options.proto3_optional&&(this.typeDefault=null),this.options&&this.options.default!=null&&(this.typeDefault=this.options.default,this.resolvedType instanceof mu&&typeof this.typeDefault=="string"&&(this.typeDefault=this.resolvedType.values[this.typeDefault])),this.options&&((this.options.packed===!0||this.options.packed!==void 0&&this.resolvedType&&!(this.resolvedType instanceof mu))&&delete this.options.packed,Object.keys(this.options).length||(this.options=void 0)),this.long)this.typeDefault=ve.Long.fromNumber(this.typeDefault,this.type.charAt(0)==="u"),Object.freeze&&Object.freeze(this.typeDefault);else if(this.bytes&&typeof this.typeDefault=="string"){var t;ve.base64.test(this.typeDefault)?ve.base64.decode(this.typeDefault,t=ve.newBuffer(ve.base64.length(this.typeDefault)),0):ve.utf8.write(this.typeDefault,t=ve.newBuffer(ve.utf8.length(this.typeDefault)),0),this.typeDefault=t}return this.map?this.defaultValue=ve.emptyObject:this.repeated?this.defaultValue=ve.emptyArray:this.defaultValue=this.typeDefault,this.parent instanceof bs&&(this.parent.ctor.prototype[this.name]=this.defaultValue),Gi.prototype.resolve.call(this)};Je.d=function(t,e,r,i){return typeof e=="function"?e=ve.decorateType(e).name:e&&typeof e=="object"&&(e=ve.decorateEnum(e).name),function(a,l){ve.decorateType(a.constructor).add(new Je(l,t,e,r,{default:i}))}};Je._configure=function(t){bs=t}});var Kn=G((J_,vu)=>{"use strict";vu.exports=Qe;var Ki=Cn();((Qe.prototype=Object.create(Ki.prototype)).constructor=Qe).className="OneOf";var yu=Qt(),Zi=Ae();function Qe(n,t,e,r){if(Array.isArray(t)||(e=t,t=void 0),Ki.call(this,n,e),!(t===void 0||Array.isArray(t)))throw TypeError("fieldNames must be an Array");this.oneof=t||[],this.fieldsArray=[],this.comment=r}Qe.fromJSON=function(t,e){return new Qe(t,e.oneof,e.options,e.comment)};Qe.prototype.toJSON=function(t){var e=t?!!t.keepComments:!1;return Zi.toObject(["options",this.options,"oneof",this.oneof,"comment",e?this.comment:void 0])};function bu(n){if(n.parent)for(var t=0;t<n.fieldsArray.length;++t)n.fieldsArray[t].parent||n.parent.add(n.fieldsArray[t])}Qe.prototype.add=function(t){if(!(t instanceof yu))throw TypeError("field must be a Field");return t.parent&&t.parent!==this.parent&&t.parent.remove(t),this.oneof.push(t.name),this.fieldsArray.push(t),t.partOf=this,bu(this),this};Qe.prototype.remove=function(t){if(!(t instanceof yu))throw TypeError("field must be a Field");var e=this.fieldsArray.indexOf(t);if(e<0)throw Error(t+" is not a member of "+this);return this.fieldsArray.splice(e,1),e=this.oneof.indexOf(t.name),e>-1&&this.oneof.splice(e,1),t.partOf=null,this};Qe.prototype.onAdd=function(t){Ki.prototype.onAdd.call(this,t);for(var e=this,r=0;r<this.oneof.length;++r){var i=t.get(this.oneof[r]);i&&!i.partOf&&(i.partOf=e,e.fieldsArray.push(i))}bu(this)};Qe.prototype.onRemove=function(t){for(var e=0,r;e<this.fieldsArray.length;++e)(r=this.fieldsArray[e]).parent&&r.parent.remove(r);Ki.prototype.onRemove.call(this,t)};Qe.d=function(){for(var t=new Array(arguments.length),e=0;e<arguments.length;)t[e]=arguments[e++];return function(i,o){Zi.decorateType(i.constructor).add(new Qe(o,t)),Object.defineProperty(i,o,{get:Zi.oneOfGetter(t),set:Zi.oneOfSetter(t)})}}});var Qn=G((Q_,_u)=>{"use strict";_u.exports=ie;var vs=Cn();((ie.prototype=Object.create(vs.prototype)).constructor=ie).className="Namespace";var wu=Qt(),Xi=Ae(),W0=Kn(),Xn,Wr,Jn;ie.fromJSON=function(t,e){return new ie(t,e.options).addJSON(e.nested)};function xu(n,t){if(n&&n.length){for(var e={},r=0;r<n.length;++r)e[n[r].name]=n[r].toJSON(t);return e}}ie.arrayToJSON=xu;ie.isReservedId=function(t,e){if(t){for(var r=0;r<t.length;++r)if(typeof t[r]!="string"&&t[r][0]<=e&&t[r][1]>e)return!0}return!1};ie.isReservedName=function(t,e){if(t){for(var r=0;r<t.length;++r)if(t[r]===e)return!0}return!1};function ie(n,t){vs.call(this,n,t),this.nested=void 0,this._nestedArray=null}function Tu(n){return n._nestedArray=null,n}Object.defineProperty(ie.prototype,"nestedArray",{get:function(){return this._nestedArray||(this._nestedArray=Xi.toArray(this.nested))}});ie.prototype.toJSON=function(t){return Xi.toObject(["options",this.options,"nested",xu(this.nestedArray,t)])};ie.prototype.addJSON=function(t){var e=this;if(t)for(var r=Object.keys(t),i=0,o;i<r.length;++i)o=t[r[i]],e.add((o.fields!==void 0?Xn.fromJSON:o.values!==void 0?Jn.fromJSON:o.methods!==void 0?Wr.fromJSON:o.id!==void 0?wu.fromJSON:ie.fromJSON)(r[i],o));return this};ie.prototype.get=function(t){return this.nested&&this.nested[t]||null};ie.prototype.getEnum=function(t){if(this.nested&&this.nested[t]instanceof Jn)return this.nested[t].values;throw Error("no such enum: "+t)};ie.prototype.add=function(t){if(!(t instanceof wu&&t.extend!==void 0||t instanceof Xn||t instanceof W0||t instanceof Jn||t instanceof Wr||t instanceof ie))throw TypeError("object must be a valid nested object");if(!this.nested)this.nested={};else{var e=this.get(t.name);if(e)if(e instanceof ie&&t instanceof ie&&!(e instanceof Xn||e instanceof Wr)){for(var r=e.nestedArray,i=0;i<r.length;++i)t.add(r[i]);this.remove(e),this.nested||(this.nested={}),t.setOptions(e.options,!0)}else throw Error("duplicate name '"+t.name+"' in "+this)}return this.nested[t.name]=t,t.onAdd(this),Tu(this)};ie.prototype.remove=function(t){if(!(t instanceof vs))throw TypeError("object must be a ReflectionObject");if(t.parent!==this)throw Error(t+" is not a member of "+this);return delete this.nested[t.name],Object.keys(this.nested).length||(this.nested=void 0),t.onRemove(this),Tu(this)};ie.prototype.define=function(t,e){if(Xi.isString(t))t=t.split(".");else if(!Array.isArray(t))throw TypeError("illegal path");if(t&&t.length&&t[0]==="")throw Error("path must be relative");for(var r=this;t.length>0;){var i=t.shift();if(r.nested&&r.nested[i]){if(r=r.nested[i],!(r instanceof ie))throw Error("path conflicts with non-namespace objects")}else r.add(r=new ie(i))}return e&&r.addJSON(e),r};ie.prototype.resolveAll=function(){for(var t=this.nestedArray,e=0;e<t.length;)t[e]instanceof ie?t[e++].resolveAll():t[e++].resolve();return this.resolve()};ie.prototype.lookup=function(t,e,r){if(typeof e=="boolean"?(r=e,e=void 0):e&&!Array.isArray(e)&&(e=[e]),Xi.isString(t)&&t.length){if(t===".")return this.root;t=t.split(".")}else if(!t.length)return this;if(t[0]==="")return this.root.lookup(t.slice(1),e);var i=this.get(t[0]);if(i){if(t.length===1){if(!e||e.indexOf(i.constructor)>-1)return i}else if(i instanceof ie&&(i=i.lookup(t.slice(1),e,!0)))return i}else for(var o=0;o<this.nestedArray.length;++o)if(this._nestedArray[o]instanceof ie&&(i=this._nestedArray[o].lookup(t,e,!0)))return i;return this.parent===null||r?null:this.parent.lookup(t,e)};ie.prototype.lookupType=function(t){var e=this.lookup(t,[Xn]);if(!e)throw Error("no such type: "+t);return e};ie.prototype.lookupEnum=function(t){var e=this.lookup(t,[Jn]);if(!e)throw Error("no such Enum '"+t+"' in "+this);return e};ie.prototype.lookupTypeOrEnum=function(t){var e=this.lookup(t,[Xn,Jn]);if(!e)throw Error("no such Type or Enum '"+t+"' in "+this);return e};ie.prototype.lookupService=function(t){var e=this.lookup(t,[Wr]);if(!e)throw Error("no such Service '"+t+"' in "+this);return e};ie._configure=function(n,t,e){Xn=n,Wr=t,Jn=e}});var Ji=G((eE,Eu)=>{"use strict";Eu.exports=Rt;var ws=Qt();((Rt.prototype=Object.create(ws.prototype)).constructor=Rt).className="MapField";var z0=Pn(),zr=Ae();function Rt(n,t,e,r,i,o){if(ws.call(this,n,t,r,void 0,void 0,i,o),!zr.isString(e))throw TypeError("keyType must be a string");this.keyType=e,this.resolvedKeyType=null,this.map=!0}Rt.fromJSON=function(t,e){return new Rt(t,e.id,e.keyType,e.type,e.options,e.comment)};Rt.prototype.toJSON=function(t){var e=t?!!t.keepComments:!1;return zr.toObject(["keyType",this.keyType,"type",this.type,"id",this.id,"extend",this.extend,"options",this.options,"comment",e?this.comment:void 0])};Rt.prototype.resolve=function(){if(this.resolved)return this;if(z0.mapKey[this.keyType]===void 0)throw Error("invalid key type: "+this.keyType);return ws.prototype.resolve.call(this)};Rt.d=function(t,e,r){return typeof r=="function"?r=zr.decorateType(r).name:r&&typeof r=="object"&&(r=zr.decorateEnum(r).name),function(o,a){zr.decorateType(o.constructor).add(new Rt(a,t,e,r))}}});var Qi=G((tE,ku)=>{"use strict";ku.exports=Nn;var xs=Cn();((Nn.prototype=Object.create(xs.prototype)).constructor=Nn).className="Method";var er=Ae();function Nn(n,t,e,r,i,o,a,l,s){if(er.isObject(i)?(a=i,i=o=void 0):er.isObject(o)&&(a=o,o=void 0),!(t===void 0||er.isString(t)))throw TypeError("type must be a string");if(!er.isString(e))throw TypeError("requestType must be a string");if(!er.isString(r))throw TypeError("responseType must be a string");xs.call(this,n,a),this.type=t||"rpc",this.requestType=e,this.requestStream=i?!0:void 0,this.responseType=r,this.responseStream=o?!0:void 0,this.resolvedRequestType=null,this.resolvedResponseType=null,this.comment=l,this.parsedOptions=s}Nn.fromJSON=function(t,e){return new Nn(t,e.type,e.requestType,e.responseType,e.requestStream,e.responseStream,e.options,e.comment,e.parsedOptions)};Nn.prototype.toJSON=function(t){var e=t?!!t.keepComments:!1;return er.toObject(["type",this.type!=="rpc"&&this.type||void 0,"requestType",this.requestType,"requestStream",this.requestStream,"responseType",this.responseType,"responseStream",this.responseStream,"options",this.options,"comment",e?this.comment:void 0,"parsedOptions",this.parsedOptions])};Nn.prototype.resolve=function(){return this.resolved?this:(this.resolvedRequestType=this.parent.lookupType(this.requestType),this.resolvedResponseType=this.parent.lookupType(this.responseType),xs.prototype.resolve.call(this))}});var eo=G((nE,Pu)=>{"use strict";Pu.exports=et;var en=Qn();((et.prototype=Object.create(en.prototype)).constructor=et).className="Service";var Ts=Qi(),Yr=Ae(),Y0=ds();function et(n,t){en.call(this,n,t),this.methods={},this._methodsArray=null}et.fromJSON=function(t,e){var r=new et(t,e.options);if(e.methods)for(var i=Object.keys(e.methods),o=0;o<i.length;++o)r.add(Ts.fromJSON(i[o],e.methods[i[o]]));return e.nested&&r.addJSON(e.nested),r.comment=e.comment,r};et.prototype.toJSON=function(t){var e=en.prototype.toJSON.call(this,t),r=t?!!t.keepComments:!1;return Yr.toObject(["options",e&&e.options||void 0,"methods",en.arrayToJSON(this.methodsArray,t)||{},"nested",e&&e.nested||void 0,"comment",r?this.comment:void 0])};Object.defineProperty(et.prototype,"methodsArray",{get:function(){return this._methodsArray||(this._methodsArray=Yr.toArray(this.methods))}});function Au(n){return n._methodsArray=null,n}et.prototype.get=function(t){return this.methods[t]||en.prototype.get.call(this,t)};et.prototype.resolveAll=function(){for(var t=this.methodsArray,e=0;e<t.length;++e)t[e].resolve();return en.prototype.resolve.call(this)};et.prototype.add=function(t){if(this.get(t.name))throw Error("duplicate name '"+t.name+"' in "+this);return t instanceof Ts?(this.methods[t.name]=t,t.parent=this,Au(this)):en.prototype.add.call(this,t)};et.prototype.remove=function(t){if(t instanceof Ts){if(this.methods[t.name]!==t)throw Error(t+" is not a member of "+this);return delete this.methods[t.name],t.parent=null,Au(this)}return en.prototype.remove.call(this,t)};et.prototype.create=function(t,e,r){for(var i=new Y0.Service(t,e,r),o=0,a;o<this.methodsArray.length;++o){var l=Yr.lcFirst((a=this._methodsArray[o]).resolve().name).replace(/[^$\w_]/g,"");i[l]=Yr.codegen(["r","c"],Yr.isReserved(l)?l+"_":l)("return this.rpcCall(m,q,s,r,c)")({m:a,q:a.resolvedRequestType.ctor,s:a.resolvedResponseType.ctor})}return i}});var to=G((rE,Cu)=>{"use strict";Cu.exports=vt;var V0=yt();function vt(n){if(n)for(var t=Object.keys(n),e=0;e<t.length;++e)this[t[e]]=n[t[e]]}vt.create=function(t){return this.$type.create(t)};vt.encode=function(t,e){return this.$type.encode(t,e)};vt.encodeDelimited=function(t,e){return this.$type.encodeDelimited(t,e)};vt.decode=function(t){return this.$type.decode(t)};vt.decodeDelimited=function(t){return this.$type.decodeDelimited(t)};vt.verify=function(t){return this.$type.verify(t)};vt.fromObject=function(t){return this.$type.fromObject(t)};vt.toObject=function(t,e){return this.$type.toObject(t,e)};vt.prototype.toJSON=function(){return this.$type.toObject(this,V0.toJSONOptions)}});var _s=G((iE,Su)=>{"use strict";Su.exports=K0;var G0=ct(),It=Pn(),Nu=Ae();function Z0(n){return"missing required '"+n.name+"'"}function K0(n){var t=Nu.codegen(["r","l"],n.name+"$decode")("if(!(r instanceof Reader))")("r=Reader.create(r)")("var c=l===undefined?r.len:r.pos+l,m=new this.ctor"+(n.fieldsArray.filter(function(l){return l.map}).length?",k,value":""))("while(r.pos<c){")("var t=r.uint32()");n.group&&t("if((t&7)===4)")("break"),t("switch(t>>>3){");for(var e=0;e<n.fieldsArray.length;++e){var r=n._fieldsArray[e].resolve(),i=r.resolvedType instanceof G0?"int32":r.type,o="m"+Nu.safeProp(r.name);t("case %i: {",r.id),r.map?(t("if(%s===util.emptyObject)",o)("%s={}",o)("var c2 = r.uint32()+r.pos"),It.defaults[r.keyType]!==void 0?t("k=%j",It.defaults[r.keyType]):t("k=null"),It.defaults[i]!==void 0?t("value=%j",It.defaults[i]):t("value=null"),t("while(r.pos<c2){")("var tag2=r.uint32()")("switch(tag2>>>3){")("case 1: k=r.%s(); break",r.keyType)("case 2:"),It.basic[i]===void 0?t("value=types[%i].decode(r,r.uint32())",e):t("value=r.%s()",i),t("break")("default:")("r.skipType(tag2&7)")("break")("}")("}"),It.long[r.keyType]!==void 0?t('%s[typeof k==="object"?util.longToHash(k):k]=value',o):t("%s[k]=value",o)):r.repeated?(t("if(!(%s&&%s.length))",o,o)("%s=[]",o),It.packed[i]!==void 0&&t("if((t&7)===2){")("var c2=r.uint32()+r.pos")("while(r.pos<c2)")("%s.push(r.%s())",o,i)("}else"),It.basic[i]===void 0?t(r.resolvedType.group?"%s.push(types[%i].decode(r))":"%s.push(types[%i].decode(r,r.uint32()))",o,e):t("%s.push(r.%s())",o,i)):It.basic[i]===void 0?t(r.resolvedType.group?"%s=types[%i].decode(r)":"%s=types[%i].decode(r,r.uint32())",o,e):t("%s=r.%s()",o,i),t("break")("}")}for(t("default:")("r.skipType(t&7)")("break")("}")("}"),e=0;e<n._fieldsArray.length;++e){var a=n._fieldsArray[e];a.required&&t("if(!m.hasOwnProperty(%j))",a.name)("throw util.ProtocolError(%j,{instance:m})",Z0(a))}return t("return m")}});var As=G((oE,Ru)=>{"use strict";Ru.exports=Q0;var X0=ct(),Es=Ae();function tt(n,t){return n.name+": "+t+(n.repeated&&t!=="array"?"[]":n.map&&t!=="object"?"{k:"+n.keyType+"}":"")+" expected"}function ks(n,t,e,r){if(t.resolvedType)if(t.resolvedType instanceof X0){n("switch(%s){",r)("default:")("return%j",tt(t,"enum value"));for(var i=Object.keys(t.resolvedType.values),o=0;o<i.length;++o)n("case %i:",t.resolvedType.values[i[o]]);n("break")("}")}else n("{")("var e=types[%i].verify(%s);",e,r)("if(e)")("return%j+e",t.name+".")("}");else switch(t.type){case"int32":case"uint32":case"sint32":case"fixed32":case"sfixed32":n("if(!util.isInteger(%s))",r)("return%j",tt(t,"integer"));break;case"int64":case"uint64":case"sint64":case"fixed64":case"sfixed64":n("if(!util.isInteger(%s)&&!(%s&&util.isInteger(%s.low)&&util.isInteger(%s.high)))",r,r,r,r)("return%j",tt(t,"integer|Long"));break;case"float":case"double":n('if(typeof %s!=="number")',r)("return%j",tt(t,"number"));break;case"bool":n('if(typeof %s!=="boolean")',r)("return%j",tt(t,"boolean"));break;case"string":n("if(!util.isString(%s))",r)("return%j",tt(t,"string"));break;case"bytes":n('if(!(%s&&typeof %s.length==="number"||util.isString(%s)))',r,r,r)("return%j",tt(t,"buffer"));break}return n}function J0(n,t,e){switch(t.keyType){case"int32":case"uint32":case"sint32":case"fixed32":case"sfixed32":n("if(!util.key32Re.test(%s))",e)("return%j",tt(t,"integer key"));break;case"int64":case"uint64":case"sint64":case"fixed64":case"sfixed64":n("if(!util.key64Re.test(%s))",e)("return%j",tt(t,"integer|Long key"));break;case"bool":n("if(!util.key2Re.test(%s))",e)("return%j",tt(t,"boolean key"));break}return n}function Q0(n){var t=Es.codegen(["m"],n.name+"$verify")('if(typeof m!=="object"||m===null)')("return%j","object expected"),e=n.oneofsArray,r={};e.length&&t("var p={}");for(var i=0;i<n.fieldsArray.length;++i){var o=n._fieldsArray[i].resolve(),a="m"+Es.safeProp(o.name);if(o.optional&&t("if(%s!=null&&m.hasOwnProperty(%j)){",a,o.name),o.map)t("if(!util.isObject(%s))",a)("return%j",tt(o,"object"))("var k=Object.keys(%s)",a)("for(var i=0;i<k.length;++i){"),J0(t,o,"k[i]"),ks(t,o,i,a+"[k[i]]")("}");else if(o.repeated)t("if(!Array.isArray(%s))",a)("return%j",tt(o,"array"))("for(var i=0;i<%s.length;++i){",a),ks(t,o,i,a+"[i]")("}");else{if(o.partOf){var l=Es.safeProp(o.partOf.name);r[o.partOf.name]===1&&t("if(p%s===1)",l)("return%j",o.partOf.name+": multiple values"),r[o.partOf.name]=1,t("p%s=1",l)}ks(t,o,i,a)}o.optional&&t("}")}return t("return null")}});var Ns=G(Du=>{"use strict";var Iu=Du,Vr=ct(),wt=Ae();function Ps(n,t,e,r){var i=!1;if(t.resolvedType)if(t.resolvedType instanceof Vr){n("switch(d%s){",r);for(var o=t.resolvedType.values,a=Object.keys(o),l=0;l<a.length;++l)o[a[l]]===t.typeDefault&&!i&&(n("default:")('if(typeof(d%s)==="number"){m%s=d%s;break}',r,r,r),t.repeated||n("break"),i=!0),n("case%j:",a[l])("case %i:",o[a[l]])("m%s=%j",r,o[a[l]])("break");n("}")}else n('if(typeof d%s!=="object")',r)("throw TypeError(%j)",t.fullName+": object expected")("m%s=types[%i].fromObject(d%s)",r,e,r);else{var s=!1;switch(t.type){case"double":case"float":n("m%s=Number(d%s)",r,r);break;case"uint32":case"fixed32":n("m%s=d%s>>>0",r,r);break;case"int32":case"sint32":case"sfixed32":n("m%s=d%s|0",r,r);break;case"uint64":s=!0;case"int64":case"sint64":case"fixed64":case"sfixed64":n("if(util.Long)")("(m%s=util.Long.fromValue(d%s)).unsigned=%j",r,r,s)('else if(typeof d%s==="string")',r)("m%s=parseInt(d%s,10)",r,r)('else if(typeof d%s==="number")',r)("m%s=d%s",r,r)('else if(typeof d%s==="object")',r)("m%s=new util.LongBits(d%s.low>>>0,d%s.high>>>0).toNumber(%s)",r,r,r,s?"true":"");break;case"bytes":n('if(typeof d%s==="string")',r)("util.base64.decode(d%s,m%s=util.newBuffer(util.base64.length(d%s)),0)",r,r,r)("else if(d%s.length >= 0)",r)("m%s=d%s",r,r);break;case"string":n("m%s=String(d%s)",r,r);break;case"bool":n("m%s=Boolean(d%s)",r,r);break}}return n}Iu.fromObject=function(t){var e=t.fieldsArray,r=wt.codegen(["d"],t.name+"$fromObject")("if(d instanceof this.ctor)")("return d");if(!e.length)return r("return new this.ctor");r("var m=new this.ctor");for(var i=0;i<e.length;++i){var o=e[i].resolve(),a=wt.safeProp(o.name);o.map?(r("if(d%s){",a)('if(typeof d%s!=="object")',a)("throw TypeError(%j)",o.fullName+": object expected")("m%s={}",a)("for(var ks=Object.keys(d%s),i=0;i<ks.length;++i){",a),Ps(r,o,i,a+"[ks[i]]")("}")("}")):o.repeated?(r("if(d%s){",a)("if(!Array.isArray(d%s))",a)("throw TypeError(%j)",o.fullName+": array expected")("m%s=[]",a)("for(var i=0;i<d%s.length;++i){",a),Ps(r,o,i,a+"[i]")("}")("}")):(o.resolvedType instanceof Vr||r("if(d%s!=null){",a),Ps(r,o,i,a),o.resolvedType instanceof Vr||r("}"))}return r("return m")};function Cs(n,t,e,r){if(t.resolvedType)t.resolvedType instanceof Vr?n("d%s=o.enums===String?(types[%i].values[m%s]===undefined?m%s:types[%i].values[m%s]):m%s",r,e,r,r,e,r,r):n("d%s=types[%i].toObject(m%s,o)",r,e,r);else{var i=!1;switch(t.type){case"double":case"float":n("d%s=o.json&&!isFinite(m%s)?String(m%s):m%s",r,r,r,r);break;case"uint64":i=!0;case"int64":case"sint64":case"fixed64":case"sfixed64":n('if(typeof m%s==="number")',r)("d%s=o.longs===String?String(m%s):m%s",r,r,r)("else")("d%s=o.longs===String?util.Long.prototype.toString.call(m%s):o.longs===Number?new util.LongBits(m%s.low>>>0,m%s.high>>>0).toNumber(%s):m%s",r,r,r,r,i?"true":"",r);break;case"bytes":n("d%s=o.bytes===String?util.base64.encode(m%s,0,m%s.length):o.bytes===Array?Array.prototype.slice.call(m%s):m%s",r,r,r,r,r);break;default:n("d%s=m%s",r,r);break}}return n}Iu.toObject=function(t){var e=t.fieldsArray.slice().sort(wt.compareFieldsById);if(!e.length)return wt.codegen()("return {}");for(var r=wt.codegen(["m","o"],t.name+"$toObject")("if(!o)")("o={}")("var d={}"),i=[],o=[],a=[],l=0;l<e.length;++l)e[l].partOf||(e[l].resolve().repeated?i:e[l].map?o:a).push(e[l]);if(i.length){for(r("if(o.arrays||o.defaults){"),l=0;l<i.length;++l)r("d%s=[]",wt.safeProp(i[l].name));r("}")}if(o.length){for(r("if(o.objects||o.defaults){"),l=0;l<o.length;++l)r("d%s={}",wt.safeProp(o[l].name));r("}")}if(a.length){for(r("if(o.defaults){"),l=0;l<a.length;++l){var s=a[l],c=wt.safeProp(s.name);if(s.resolvedType instanceof Vr)r("d%s=o.enums===String?%j:%j",c,s.resolvedType.valuesById[s.typeDefault],s.typeDefault);else if(s.long)r("if(util.Long){")("var n=new util.Long(%i,%i,%j)",s.typeDefault.low,s.typeDefault.high,s.typeDefault.unsigned)("d%s=o.longs===String?n.toString():o.longs===Number?n.toNumber():n",c)("}else")("d%s=o.longs===String?%j:%i",c,s.typeDefault.toString(),s.typeDefault.toNumber());else if(s.bytes){var p="["+Array.prototype.slice.call(s.typeDefault).join(",")+"]";r("if(o.bytes===String)d%s=%j",c,String.fromCharCode.apply(String,s.typeDefault))("else{")("d%s=%s",c,p)("if(o.bytes!==Array)d%s=util.newBuffer(d%s)",c,c)("}")}else r("d%s=%j",c,s.typeDefault)}r("}")}var u=!1;for(l=0;l<e.length;++l){var s=e[l],f=t._fieldsArray.indexOf(s),c=wt.safeProp(s.name);s.map?(u||(u=!0,r("var ks2")),r("if(m%s&&(ks2=Object.keys(m%s)).length){",c,c)("d%s={}",c)("for(var j=0;j<ks2.length;++j){"),Cs(r,s,f,c+"[ks2[j]]")("}")):s.repeated?(r("if(m%s&&m%s.length){",c,c)("d%s=[]",c)("for(var j=0;j<m%s.length;++j){",c),Cs(r,s,f,c+"[j]")("}")):(r("if(m%s!=null&&m.hasOwnProperty(%j)){",c,s.name),Cs(r,s,f,c),s.partOf&&r("if(o.oneofs)")("d%s=%j",wt.safeProp(s.partOf.name),s.name)),r("}")}return r("return d")}});var Ss=G(Ou=>{"use strict";var ey=Ou,ty=to();ey[".google.protobuf.Any"]={fromObject:function(n){if(n&&n["@type"]){var t=n["@type"].substring(n["@type"].lastIndexOf("/")+1),e=this.lookup(t);if(e){var r=n["@type"].charAt(0)==="."?n["@type"].slice(1):n["@type"];return r.indexOf("/")===-1&&(r="/"+r),this.create({type_url:r,value:e.encode(e.fromObject(n)).finish()})}}return this.fromObject(n)},toObject:function(n,t){var e="type.googleapis.com/",r="",i="";if(t&&t.json&&n.type_url&&n.value){i=n.type_url.substring(n.type_url.lastIndexOf("/")+1),r=n.type_url.substring(0,n.type_url.lastIndexOf("/")+1);var o=this.lookup(i);o&&(n=o.decode(n.value))}if(!(n instanceof this.ctor)&&n instanceof ty){var a=n.$type.toObject(n,t),l=n.$type.fullName[0]==="."?n.$type.fullName.slice(1):n.$type.fullName;return r===""&&(r=e),i=r+l,a["@type"]=i,a}return this.toObject(n,t)}}});var io=G((lE,Lu)=>{"use strict";Lu.exports=pe;var pt=Qn();((pe.prototype=Object.create(pt.prototype)).constructor=pe).className="Type";var ny=ct(),Ds=Kn(),no=Qt(),ry=Ji(),iy=eo(),Rs=to(),Is=Vi(),oy=zi(),Se=Ae(),ay=Os(),sy=_s(),ly=As(),Fu=Ns(),cy=Ss();function pe(n,t){pt.call(this,n,t),this.fields={},this.oneofs=void 0,this.extensions=void 0,this.reserved=void 0,this.group=void 0,this._fieldsById=null,this._fieldsArray=null,this._oneofsArray=null,this._ctor=null}Object.defineProperties(pe.prototype,{fieldsById:{get:function(){if(this._fieldsById)return this._fieldsById;this._fieldsById={};for(var n=Object.keys(this.fields),t=0;t<n.length;++t){var e=this.fields[n[t]],r=e.id;if(this._fieldsById[r])throw Error("duplicate id "+r+" in "+this);this._fieldsById[r]=e}return this._fieldsById}},fieldsArray:{get:function(){return this._fieldsArray||(this._fieldsArray=Se.toArray(this.fields))}},oneofsArray:{get:function(){return this._oneofsArray||(this._oneofsArray=Se.toArray(this.oneofs))}},ctor:{get:function(){return this._ctor||(this.ctor=pe.generateConstructor(this)())},set:function(n){var t=n.prototype;t instanceof Rs||((n.prototype=new Rs).constructor=n,Se.merge(n.prototype,t)),n.$type=n.prototype.$type=this,Se.merge(n,Rs,!0),this._ctor=n;for(var e=0;e<this.fieldsArray.length;++e)this._fieldsArray[e].resolve();var r={};for(e=0;e<this.oneofsArray.length;++e)r[this._oneofsArray[e].resolve().name]={get:Se.oneOfGetter(this._oneofsArray[e].oneof),set:Se.oneOfSetter(this._oneofsArray[e].oneof)};e&&Object.defineProperties(n.prototype,r)}}});pe.generateConstructor=function(t){for(var e=Se.codegen(["p"],t.name),r=0,i;r<t.fieldsArray.length;++r)(i=t._fieldsArray[r]).map?e("this%s={}",Se.safeProp(i.name)):i.repeated&&e("this%s=[]",Se.safeProp(i.name));return e("if(p)for(var ks=Object.keys(p),i=0;i<ks.length;++i)if(p[ks[i]]!=null)")("this[ks[i]]=p[ks[i]]")};function ro(n){return n._fieldsById=n._fieldsArray=n._oneofsArray=null,delete n.encode,delete n.decode,delete n.verify,n}pe.fromJSON=function(t,e){var r=new pe(t,e.options);r.extensions=e.extensions,r.reserved=e.reserved;for(var i=Object.keys(e.fields),o=0;o<i.length;++o)r.add((typeof e.fields[i[o]].keyType!="undefined"?ry.fromJSON:no.fromJSON)(i[o],e.fields[i[o]]));if(e.oneofs)for(i=Object.keys(e.oneofs),o=0;o<i.length;++o)r.add(Ds.fromJSON(i[o],e.oneofs[i[o]]));if(e.nested)for(i=Object.keys(e.nested),o=0;o<i.length;++o){var a=e.nested[i[o]];r.add((a.id!==void 0?no.fromJSON:a.fields!==void 0?pe.fromJSON:a.values!==void 0?ny.fromJSON:a.methods!==void 0?iy.fromJSON:pt.fromJSON)(i[o],a))}return e.extensions&&e.extensions.length&&(r.extensions=e.extensions),e.reserved&&e.reserved.length&&(r.reserved=e.reserved),e.group&&(r.group=!0),e.comment&&(r.comment=e.comment),r};pe.prototype.toJSON=function(t){var e=pt.prototype.toJSON.call(this,t),r=t?!!t.keepComments:!1;return Se.toObject(["options",e&&e.options||void 0,"oneofs",pt.arrayToJSON(this.oneofsArray,t),"fields",pt.arrayToJSON(this.fieldsArray.filter(function(i){return!i.declaringField}),t)||{},"extensions",this.extensions&&this.extensions.length?this.extensions:void 0,"reserved",this.reserved&&this.reserved.length?this.reserved:void 0,"group",this.group||void 0,"nested",e&&e.nested||void 0,"comment",r?this.comment:void 0])};pe.prototype.resolveAll=function(){for(var t=this.fieldsArray,e=0;e<t.length;)t[e++].resolve();var r=this.oneofsArray;for(e=0;e<r.length;)r[e++].resolve();return pt.prototype.resolveAll.call(this)};pe.prototype.get=function(t){return this.fields[t]||this.oneofs&&this.oneofs[t]||this.nested&&this.nested[t]||null};pe.prototype.add=function(t){if(this.get(t.name))throw Error("duplicate name '"+t.name+"' in "+this);if(t instanceof no&&t.extend===void 0){if(this._fieldsById?this._fieldsById[t.id]:this.fieldsById[t.id])throw Error("duplicate id "+t.id+" in "+this);if(this.isReservedId(t.id))throw Error("id "+t.id+" is reserved in "+this);if(this.isReservedName(t.name))throw Error("name '"+t.name+"' is reserved in "+this);return t.parent&&t.parent.remove(t),this.fields[t.name]=t,t.message=this,t.onAdd(this),ro(this)}return t instanceof Ds?(this.oneofs||(this.oneofs={}),this.oneofs[t.name]=t,t.onAdd(this),ro(this)):pt.prototype.add.call(this,t)};pe.prototype.remove=function(t){if(t instanceof no&&t.extend===void 0){if(!this.fields||this.fields[t.name]!==t)throw Error(t+" is not a member of "+this);return delete this.fields[t.name],t.parent=null,t.onRemove(this),ro(this)}if(t instanceof Ds){if(!this.oneofs||this.oneofs[t.name]!==t)throw Error(t+" is not a member of "+this);return delete this.oneofs[t.name],t.parent=null,t.onRemove(this),ro(this)}return pt.prototype.remove.call(this,t)};pe.prototype.isReservedId=function(t){return pt.isReservedId(this.reserved,t)};pe.prototype.isReservedName=function(t){return pt.isReservedName(this.reserved,t)};pe.prototype.create=function(t){return new this.ctor(t)};pe.prototype.setup=function(){for(var t=this.fullName,e=[],r=0;r<this.fieldsArray.length;++r)e.push(this._fieldsArray[r].resolve().resolvedType);this.encode=ay(this)({Writer:oy,types:e,util:Se}),this.decode=sy(this)({Reader:Is,types:e,util:Se}),this.verify=ly(this)({types:e,util:Se}),this.fromObject=Fu.fromObject(this)({types:e,util:Se}),this.toObject=Fu.toObject(this)({types:e,util:Se});var i=cy[t];if(i){var o=Object.create(this);o.fromObject=this.fromObject,this.fromObject=i.fromObject.bind(o),o.toObject=this.toObject,this.toObject=i.toObject.bind(o)}return this};pe.prototype.encode=function(t,e){return this.setup().encode(t,e)};pe.prototype.encodeDelimited=function(t,e){return this.encode(t,e&&e.len?e.fork():e).ldelim()};pe.prototype.decode=function(t,e){return this.setup().decode(t,e)};pe.prototype.decodeDelimited=function(t){return t instanceof Is||(t=Is.create(t)),this.decode(t,t.uint32())};pe.prototype.verify=function(t){return this.setup().verify(t)};pe.prototype.fromObject=function(t){return this.setup().fromObject(t)};pe.prototype.toObject=function(t,e){return this.setup().toObject(t,e)};pe.d=function(t){return function(r){Se.decorateType(r,t)}}});var so=G((cE,Uu)=>{"use strict";Uu.exports=Ye;var ao=Qn();((Ye.prototype=Object.create(ao.prototype)).constructor=Ye).className="Root";var Ls=Qt(),Mu=ct(),py=Kn(),tn=Ae(),Bu,Fs,Gr;function Ye(n){ao.call(this,"",n),this.deferred=[],this.files=[]}Ye.fromJSON=function(t,e){return e||(e=new Ye),t.options&&e.setOptions(t.options),e.addJSON(t.nested)};Ye.prototype.resolvePath=tn.path.resolve;Ye.prototype.fetch=tn.fetch;function ju(){}Ye.prototype.load=function n(t,e,r){typeof e=="function"&&(r=e,e=void 0);var i=this;if(!r)return tn.asPromise(n,i,t,e);var o=r===ju;function a(h,b){if(r){var d=r;if(r=null,o)throw h;d(h,b)}}function l(h){var b=h.lastIndexOf("google/protobuf/");if(b>-1){var d=h.substring(b);if(d in Gr)return d}return null}function s(h,b){try{if(tn.isString(b)&&b.charAt(0)==="{"&&(b=JSON.parse(b)),!tn.isString(b))i.setOptions(b.options).addJSON(b.nested);else{Fs.filename=h;var d=Fs(b,i,e),m,y=0;if(d.imports)for(;y<d.imports.length;++y)(m=l(d.imports[y])||i.resolvePath(h,d.imports[y]))&&c(m);if(d.weakImports)for(y=0;y<d.weakImports.length;++y)(m=l(d.weakImports[y])||i.resolvePath(h,d.weakImports[y]))&&c(m,!0)}}catch(T){a(T)}!o&&!p&&a(null,i)}function c(h,b){if(h=l(h)||h,!(i.files.indexOf(h)>-1)){if(i.files.push(h),h in Gr){o?s(h,Gr[h]):(++p,setTimeout(function(){--p,s(h,Gr[h])}));return}if(o){var d;try{d=tn.fs.readFileSync(h).toString("utf8")}catch(m){b||a(m);return}s(h,d)}else++p,i.fetch(h,function(m,y){if(--p,!!r){if(m){b?p||a(null,i):a(m);return}s(h,y)}})}}var p=0;tn.isString(t)&&(t=[t]);for(var u=0,f;u<t.length;++u)(f=i.resolvePath("",t[u]))&&c(f);if(o)return i;p||a(null,i)};Ye.prototype.loadSync=function(t,e){if(!tn.isNode)throw Error("not supported");return this.load(t,e,ju)};Ye.prototype.resolveAll=function(){if(this.deferred.length)throw Error("unresolvable extensions: "+this.deferred.map(function(t){return"'extend "+t.extend+"' in "+t.parent.fullName}).join(", "));return ao.prototype.resolveAll.call(this)};var oo=/^[A-Z]/;function $u(n,t){var e=t.parent.lookup(t.extend);if(e){var r=new Ls(t.fullName,t.id,t.type,t.rule,void 0,t.options);return e.get(r.name)||(r.declaringField=t,t.extensionField=r,e.add(r)),!0}return!1}Ye.prototype._handleAdd=function(t){if(t instanceof Ls)t.extend!==void 0&&!t.extensionField&&($u(this,t)||this.deferred.push(t));else if(t instanceof Mu)oo.test(t.name)&&(t.parent[t.name]=t.values);else if(!(t instanceof py)){if(t instanceof Bu)for(var e=0;e<this.deferred.length;)$u(this,this.deferred[e])?this.deferred.splice(e,1):++e;for(var r=0;r<t.nestedArray.length;++r)this._handleAdd(t._nestedArray[r]);oo.test(t.name)&&(t.parent[t.name]=t)}};Ye.prototype._handleRemove=function(t){if(t instanceof Ls){if(t.extend!==void 0)if(t.extensionField)t.extensionField.parent.remove(t.extensionField),t.extensionField=null;else{var e=this.deferred.indexOf(t);e>-1&&this.deferred.splice(e,1)}}else if(t instanceof Mu)oo.test(t.name)&&delete t.parent[t.name];else if(t instanceof ao){for(var r=0;r<t.nestedArray.length;++r)this._handleRemove(t._nestedArray[r]);oo.test(t.name)&&delete t.parent[t.name]}};Ye._configure=function(n,t,e){Bu=n,Fs=t,Gr=e}});var Ae=G((pE,Hu)=>{"use strict";var ye=Hu.exports=yt(),qu=fs(),$s,Ms;ye.codegen=su();ye.fetch=cu();ye.path=du();ye.fs=ye.inquire("fs");ye.toArray=function(t){if(t){for(var e=Object.keys(t),r=new Array(e.length),i=0;i<e.length;)r[i]=t[e[i++]];return r}return[]};ye.toObject=function(t){for(var e={},r=0;r<t.length;){var i=t[r++],o=t[r++];o!==void 0&&(e[i]=o)}return e};var uy=/\\/g,dy=/"/g;ye.isReserved=function(t){return/^(?:do|if|in|for|let|new|try|var|case|else|enum|eval|false|null|this|true|void|with|break|catch|class|const|super|throw|while|yield|delete|export|import|public|return|static|switch|typeof|default|extends|finally|package|private|continue|debugger|function|arguments|interface|protected|implements|instanceof)$/.test(t)};ye.safeProp=function(t){return!/^[$\w_]+$/.test(t)||ye.isReserved(t)?'["'+t.replace(uy,"\\\\").replace(dy,'\\"')+'"]':"."+t};ye.ucFirst=function(t){return t.charAt(0).toUpperCase()+t.substring(1)};var fy=/_([a-z])/g;ye.camelCase=function(t){return t.substring(0,1)+t.substring(1).replace(fy,function(e,r){return r.toUpperCase()})};ye.compareFieldsById=function(t,e){return t.id-e.id};ye.decorateType=function(t,e){if(t.$type)return e&&t.$type.name!==e&&(ye.decorateRoot.remove(t.$type),t.$type.name=e,ye.decorateRoot.add(t.$type)),t.$type;$s||($s=io());var r=new $s(e||t.name);return ye.decorateRoot.add(r),r.ctor=t,Object.defineProperty(t,"$type",{value:r,enumerable:!1}),Object.defineProperty(t.prototype,"$type",{value:r,enumerable:!1}),r};var my=0;ye.decorateEnum=function(t){if(t.$type)return t.$type;Ms||(Ms=ct());var e=new Ms("Enum"+my++,t);return ye.decorateRoot.add(e),Object.defineProperty(t,"$type",{value:e,enumerable:!1}),e};ye.setProperty=function(t,e,r){function i(o,a,l){var s=a.shift();if(s==="__proto__"||s==="prototype")return o;if(a.length>0)o[s]=i(o[s]||{},a,l);else{var c=o[s];c&&(l=[].concat(c).concat(l)),o[s]=l}return o}if(typeof t!="object")throw TypeError("dst must be an object");if(!e)throw TypeError("path must be specified");return e=e.split("."),i(t,e,r)};Object.defineProperty(ye,"decorateRoot",{get:function(){return qu.decorated||(qu.decorated=new(so()))}})});var Cn=G((uE,Wu)=>{"use strict";Wu.exports=Ve;Ve.className="ReflectionObject";var lo=Ae(),co;function Ve(n,t){if(!lo.isString(n))throw TypeError("name must be a string");if(t&&!lo.isObject(t))throw TypeError("options must be an object");this.options=t,this.parsedOptions=null,this.name=n,this.parent=null,this.resolved=!1,this.comment=null,this.filename=null}Object.defineProperties(Ve.prototype,{root:{get:function(){for(var n=this;n.parent!==null;)n=n.parent;return n}},fullName:{get:function(){for(var n=[this.name],t=this.parent;t;)n.unshift(t.name),t=t.parent;return n.join(".")}}});Ve.prototype.toJSON=function(){throw Error()};Ve.prototype.onAdd=function(t){this.parent&&this.parent!==t&&this.parent.remove(this),this.parent=t,this.resolved=!1;var e=t.root;e instanceof co&&e._handleAdd(this)};Ve.prototype.onRemove=function(t){var e=t.root;e instanceof co&&e._handleRemove(this),this.parent=null,this.resolved=!1};Ve.prototype.resolve=function(){return this.resolved?this:(this.root instanceof co&&(this.resolved=!0),this)};Ve.prototype.getOption=function(t){if(this.options)return this.options[t]};Ve.prototype.setOption=function(t,e,r){return(!r||!this.options||this.options[t]===void 0)&&((this.options||(this.options={}))[t]=e),this};Ve.prototype.setParsedOption=function(t,e,r){this.parsedOptions||(this.parsedOptions=[]);var i=this.parsedOptions;if(r){var o=i.find(function(s){return Object.prototype.hasOwnProperty.call(s,t)});if(o){var a=o[t];lo.setProperty(a,r,e)}else o={},o[t]=lo.setProperty({},r,e),i.push(o)}else{var l={};l[t]=e,i.push(l)}return this};Ve.prototype.setOptions=function(t,e){if(t)for(var r=Object.keys(t),i=0;i<r.length;++i)this.setOption(r[i],t[r[i]],e);return this};Ve.prototype.toString=function(){var t=this.constructor.className,e=this.fullName;return e.length?t+" "+e:t};Ve._configure=function(n){co=n}});var ct=G((dE,Vu)=>{"use strict";Vu.exports=xt;var zu=Cn();((xt.prototype=Object.create(zu.prototype)).constructor=xt).className="Enum";var Yu=Qn(),po=Ae();function xt(n,t,e,r,i,o){if(zu.call(this,n,e),t&&typeof t!="object")throw TypeError("values must be an object");if(this.valuesById={},this.values=Object.create(this.valuesById),this.comment=r,this.comments=i||{},this.valuesOptions=o,this.reserved=void 0,t)for(var a=Object.keys(t),l=0;l<a.length;++l)typeof t[a[l]]=="number"&&(this.valuesById[this.values[a[l]]=t[a[l]]]=a[l])}xt.fromJSON=function(t,e){var r=new xt(t,e.values,e.options,e.comment,e.comments);return r.reserved=e.reserved,r};xt.prototype.toJSON=function(t){var e=t?!!t.keepComments:!1;return po.toObject(["options",this.options,"valuesOptions",this.valuesOptions,"values",this.values,"reserved",this.reserved&&this.reserved.length?this.reserved:void 0,"comment",e?this.comment:void 0,"comments",e?this.comments:void 0])};xt.prototype.add=function(t,e,r,i){if(!po.isString(t))throw TypeError("name must be a string");if(!po.isInteger(e))throw TypeError("id must be an integer");if(this.values[t]!==void 0)throw Error("duplicate name '"+t+"' in "+this);if(this.isReservedId(e))throw Error("id "+e+" is reserved in "+this);if(this.isReservedName(t))throw Error("name '"+t+"' is reserved in "+this);if(this.valuesById[e]!==void 0){if(!(this.options&&this.options.allow_alias))throw Error("duplicate id "+e+" in "+this);this.values[t]=e}else this.valuesById[this.values[t]=e]=t;return i&&(this.valuesOptions===void 0&&(this.valuesOptions={}),this.valuesOptions[t]=i||null),this.comments[t]=r||null,this};xt.prototype.remove=function(t){if(!po.isString(t))throw TypeError("name must be a string");var e=this.values[t];if(e==null)throw Error("name '"+t+"' does not exist in "+this);return delete this.valuesById[e],delete this.values[t],delete this.comments[t],this.valuesOptions&&delete this.valuesOptions[t],this};xt.prototype.isReservedId=function(t){return Yu.isReservedId(this.reserved,t)};xt.prototype.isReservedName=function(t){return Yu.isReservedName(this.reserved,t)}});var Os=G((fE,Zu)=>{"use strict";Zu.exports=gy;var hy=ct(),Bs=Pn(),js=Ae();function Gu(n,t,e,r){return t.resolvedType.group?n("types[%i].encode(%s,w.uint32(%i)).uint32(%i)",e,r,(t.id<<3|3)>>>0,(t.id<<3|4)>>>0):n("types[%i].encode(%s,w.uint32(%i).fork()).ldelim()",e,r,(t.id<<3|2)>>>0)}function gy(n){for(var t=js.codegen(["m","w"],n.name+"$encode")("if(!w)")("w=Writer.create()"),e,r,i=n.fieldsArray.slice().sort(js.compareFieldsById),e=0;e<i.length;++e){var o=i[e].resolve(),a=n._fieldsArray.indexOf(o),l=o.resolvedType instanceof hy?"int32":o.type,s=Bs.basic[l];r="m"+js.safeProp(o.name),o.map?(t("if(%s!=null&&Object.hasOwnProperty.call(m,%j)){",r,o.name)("for(var ks=Object.keys(%s),i=0;i<ks.length;++i){",r)("w.uint32(%i).fork().uint32(%i).%s(ks[i])",(o.id<<3|2)>>>0,8|Bs.mapKey[o.keyType],o.keyType),s===void 0?t("types[%i].encode(%s[ks[i]],w.uint32(18).fork()).ldelim().ldelim()",a,r):t(".uint32(%i).%s(%s[ks[i]]).ldelim()",16|s,l,r),t("}")("}")):o.repeated?(t("if(%s!=null&&%s.length){",r,r),o.packed&&Bs.packed[l]!==void 0?t("w.uint32(%i).fork()",(o.id<<3|2)>>>0)("for(var i=0;i<%s.length;++i)",r)("w.%s(%s[i])",l,r)("w.ldelim()"):(t("for(var i=0;i<%s.length;++i)",r),s===void 0?Gu(t,o,a,r+"[i]"):t("w.uint32(%i).%s(%s[i])",(o.id<<3|s)>>>0,l,r)),t("}")):(o.optional&&t("if(%s!=null&&Object.hasOwnProperty.call(m,%j))",r,o.name),s===void 0?Gu(t,o,a,r):t("w.uint32(%i).%s(%s)",(o.id<<3|s)>>>0,l,r))}return t("return w")}});var Xu=G((mE,Ku)=>{"use strict";var te=Ku.exports=ou();te.build="light";function yy(n,t,e){return typeof t=="function"?(e=t,t=new te.Root):t||(t=new te.Root),t.load(n,e)}te.load=yy;function by(n,t){return t||(t=new te.Root),t.loadSync(n)}te.loadSync=by;te.encoder=Os();te.decoder=_s();te.verifier=As();te.converter=Ns();te.ReflectionObject=Cn();te.Namespace=Qn();te.Root=so();te.Enum=ct();te.Type=io();te.Field=Qt();te.OneOf=Kn();te.MapField=Ji();te.Service=eo();te.Method=Qi();te.Message=to();te.wrappers=Ss();te.types=Pn();te.util=Ae();te.ReflectionObject._configure(te.Root);te.Namespace._configure(te.Type,te.Service,te.Enum);te.Root._configure(te.Type);te.Field._configure(te.Type)});var qs=G((hE,ed)=>{"use strict";ed.exports=Qu;var Us=/[\s{}=;:[\],'"()<>]/g,vy=/(?:"([^"\\]*(?:\\.[^"\\]*)*)")/g,wy=/(?:'([^'\\]*(?:\\.[^'\\]*)*)')/g,xy=/^ *[*/]+ */,Ty=/^\s*\*?\/*/,_y=/\n/g,Ey=/\s/,ky=/\\(.?)/g,Ay={0:"\0",r:"\r",n:`
`,t:"	"};function Ju(n){return n.replace(ky,function(t,e){switch(e){case"\\":case"":return e;default:return Ay[e]||""}})}Qu.unescape=Ju;function Qu(n,t){n=n.toString();var e=0,r=n.length,i=1,o=0,a={},l=[],s=null;function c(_){return Error("illegal "+_+" (line "+i+")")}function p(){var _=s==="'"?wy:vy;_.lastIndex=e-1;var A=_.exec(n);if(!A)throw c("string");return e=_.lastIndex,m(s),s=null,Ju(A[1])}function u(_){return n.charAt(_)}function f(_,A,E){var P={type:n.charAt(_++),lineEmpty:!1,leading:E},v;t?v=2:v=3;var D=_-v,N;do if(--D<0||(N=n.charAt(D))===`
`){P.lineEmpty=!0;break}while(N===" "||N==="	");for(var C=n.substring(_,A).split(_y),F=0;F<C.length;++F)C[F]=C[F].replace(t?Ty:xy,"").trim();P.text=C.join(`
`).trim(),a[i]=P,o=i}function h(_){var A=b(_),E=n.substring(_,A),P=/^\s*\/\//.test(E);return P}function b(_){for(var A=_;A<r&&u(A)!==`
`;)A++;return A}function d(){if(l.length>0)return l.shift();if(s)return p();var _,A,E,P,v,D=e===0;do{if(e===r)return null;for(_=!1;Ey.test(E=u(e));)if(E===`
`&&(D=!0,++i),++e===r)return null;if(u(e)==="/"){if(++e===r)throw c("comment");if(u(e)==="/")if(t){if(P=e,v=!1,h(e-1)){v=!0;do if(e=b(e),e===r||(e++,!D))break;while(h(e))}else e=Math.min(r,b(e)+1);v&&(f(P,e,D),D=!0),i++,_=!0}else{for(v=u(P=e+1)==="/";u(++e)!==`
`;)if(e===r)return null;++e,v&&(f(P,e-1,D),D=!0),++i,_=!0}else if((E=u(e))==="*"){P=e+1,v=t||u(P)==="*";do{if(E===`
`&&++i,++e===r)throw c("comment");A=E,E=u(e)}while(A!=="*"||E!=="/");++e,v&&(f(P,e-2,D),D=!0),_=!0}else return"/"}}while(_);var N=e;Us.lastIndex=0;var C=Us.test(u(N++));if(!C)for(;N<r&&!Us.test(u(N));)++N;var F=n.substring(e,e=N);return(F==='"'||F==="'")&&(s=F),F}function m(_){l.push(_)}function y(){if(!l.length){var _=d();if(_===null)return null;m(_)}return l[0]}function T(_,A){var E=y(),P=E===_;if(P)return d(),!0;if(!A)throw c("token '"+E+"', '"+_+"' expected");return!1}function k(_){var A=null,E;return _===void 0?(E=a[i-1],delete a[i-1],E&&(t||E.type==="*"||E.lineEmpty)&&(A=E.leading?E.text:null)):(o<_&&y(),E=a[_],delete a[_],E&&!E.lineEmpty&&(t||E.type==="/")&&(A=E.leading?null:E.text)),A}return Object.defineProperty({next:d,peek:y,push:m,skip:T,cmnt:k},"line",{get:function(){return i}})}});var ad=G((gE,od)=>{"use strict";od.exports=Dt;Dt.filename=null;Dt.defaults={keepCase:!1};var Py=qs(),td=so(),nd=io(),rd=Qt(),Cy=Ji(),id=Kn(),Ny=ct(),Sy=eo(),Ry=Qi(),Hs=Pn(),Ws=Ae(),Iy=/^[1-9][0-9]*$/,Dy=/^-?[1-9][0-9]*$/,Oy=/^0[x][0-9a-fA-F]+$/,Fy=/^-?0[x][0-9a-fA-F]+$/,Ly=/^0[0-7]+$/,$y=/^-?0[0-7]+$/,My=/^(?![eE])[0-9]*(?:\.[0-9]*)?(?:[eE][+-]?[0-9]+)?$/,Tt=/^[a-zA-Z_][a-zA-Z_0-9]*$/,_t=/^(?:\.?[a-zA-Z_][a-zA-Z_0-9]*)(?:\.[a-zA-Z_][a-zA-Z_0-9]*)*$/,By=/^(?:\.[a-zA-Z_][a-zA-Z_0-9]*)+$/;function Dt(n,t,e){t instanceof td||(e=t,t=new td),e||(e=Dt.defaults);var r=e.preferTrailingComment||!1,i=Py(n,e.alternateCommentMode||!1),o=i.next,a=i.push,l=i.peek,s=i.skip,c=i.cmnt,p=!0,u,f,h,b,d=!1,m=t,y=e.keepCase?function(x){return x}:Ws.camelCase;function T(x,R,O){var $=Dt.filename;return O||(Dt.filename=null),Error("illegal "+(R||"token")+" '"+x+"' ("+($?$+", ":"")+"line "+i.line+")")}function k(){var x=[],R;do{if((R=o())!=='"'&&R!=="'")throw T(R);x.push(o()),s(R),R=l()}while(R==='"'||R==="'");return x.join("")}function _(x){var R=o();switch(R){case"'":case'"':return a(R),k();case"true":case"TRUE":return!0;case"false":case"FALSE":return!1}try{return E(R,!0)}catch(O){if(x&&_t.test(R))return R;throw T(R,"value")}}function A(x,R){var O,$;do R&&((O=l())==='"'||O==="'")?x.push(k()):x.push([$=P(o()),s("to",!0)?P(o()):$]);while(s(",",!0));s(";")}function E(x,R){var O=1;switch(x.charAt(0)==="-"&&(O=-1,x=x.substring(1)),x){case"inf":case"INF":case"Inf":return O*(1/0);case"nan":case"NAN":case"Nan":case"NaN":return NaN;case"0":return 0}if(Iy.test(x))return O*parseInt(x,10);if(Oy.test(x))return O*parseInt(x,16);if(Ly.test(x))return O*parseInt(x,8);if(My.test(x))return O*parseFloat(x);throw T(x,"number",R)}function P(x,R){switch(x){case"max":case"MAX":case"Max":return 536870911;case"0":return 0}if(!R&&x.charAt(0)==="-")throw T(x,"id");if(Dy.test(x))return parseInt(x,10);if(Fy.test(x))return parseInt(x,16);if($y.test(x))return parseInt(x,8);throw T(x,"id")}function v(){if(u!==void 0)throw T("package");if(u=o(),!_t.test(u))throw T(u,"name");m=m.define(u),s(";")}function D(){var x=l(),R;switch(x){case"weak":R=h||(h=[]),o();break;case"public":o();default:R=f||(f=[]);break}x=k(),s(";"),R.push(x)}function N(){if(s("="),b=k(),d=b==="proto3",!d&&b!=="proto2")throw T(b,"syntax");s(";")}function C(x,R){switch(R){case"option":return q(x,R),s(";"),!0;case"message":return L(x,R),!0;case"enum":return J(x,R),!0;case"service":return mn(x,R),!0;case"extend":return g(x,R),!0}return!1}function F(x,R,O){var $=i.line;if(x&&(typeof x.comment!="string"&&(x.comment=c()),x.filename=Dt.filename),s("{",!0)){for(var B;(B=o())!=="}";)R(B);s(";",!0)}else O&&O(),s(";"),x&&(typeof x.comment!="string"||r)&&(x.comment=c($)||x.comment)}function L(x,R){if(!Tt.test(R=o()))throw T(R,"type name");var O=new nd(R);F(O,function(B){if(!C(O,B))switch(B){case"map":M(O,B);break;case"required":case"repeated":z(O,B);break;case"optional":d?z(O,"proto3_optional"):z(O,"optional");break;case"oneof":le(O,B);break;case"extensions":A(O.extensions||(O.extensions=[]));break;case"reserved":A(O.reserved||(O.reserved=[]),!0);break;default:if(!d||!_t.test(B))throw T(B);a(B),z(O,"optional");break}}),x.add(O)}function z(x,R,O){var $=o();if($==="group"){K(x,R);return}for(;$.endsWith(".")||l().startsWith(".");)$+=o();if(!_t.test($))throw T($,"type");var B=o();if(!Tt.test(B))throw T(B,"name");B=y(B),s("=");var V=new rd(B,P(o()),$,R,O);if(F(V,function(ue){if(ue==="option")q(V,ue),s(";");else throw T(ue)},function(){mt(V)}),R==="proto3_optional"){var se=new id("_"+B);V.setOption("proto3_optional",!0),se.add(V),x.add(se)}else x.add(V);!d&&V.repeated&&(Hs.packed[$]!==void 0||Hs.basic[$]===void 0)&&V.setOption("packed",!1,!0)}function K(x,R){var O=o();if(!Tt.test(O))throw T(O,"name");var $=Ws.lcFirst(O);O===$&&(O=Ws.ucFirst(O)),s("=");var B=P(o()),V=new nd(O);V.group=!0;var se=new rd($,B,O,R);se.filename=Dt.filename,F(V,function(ue){switch(ue){case"option":q(V,ue),s(";");break;case"required":case"repeated":z(V,ue);break;case"optional":d?z(V,"proto3_optional"):z(V,"optional");break;case"message":L(V,ue);break;case"enum":J(V,ue);break;default:throw T(ue)}}),x.add(V).add(se)}function M(x){s("<");var R=o();if(Hs.mapKey[R]===void 0)throw T(R,"type");s(",");var O=o();if(!_t.test(O))throw T(O,"type");s(">");var $=o();if(!Tt.test($))throw T($,"name");s("=");var B=new Cy(y($),P(o()),R,O);F(B,function(se){if(se==="option")q(B,se),s(";");else throw T(se)},function(){mt(B)}),x.add(B)}function le(x,R){if(!Tt.test(R=o()))throw T(R,"name");var O=new id(y(R));F(O,function(B){B==="option"?(q(O,B),s(";")):(a(B),z(O,"optional"))}),x.add(O)}function J(x,R){if(!Tt.test(R=o()))throw T(R,"name");var O=new Ny(R);F(O,function(B){switch(B){case"option":q(O,B),s(";");break;case"reserved":A(O.reserved||(O.reserved=[]),!0);break;default:be(O,B)}}),x.add(O)}function be(x,R){if(!Tt.test(R))throw T(R,"name");s("=");var O=P(o(),!0),$={options:void 0};$.setOption=function(B,V){this.options===void 0&&(this.options={}),this.options[B]=V},F($,function(V){if(V==="option")q($,V),s(";");else throw T(V)},function(){mt($)}),x.add(R,O,$.comment,$.options)}function q(x,R){var O=s("(",!0);if(!_t.test(R=o()))throw T(R,"name");var $=R,B=$,V;O&&(s(")"),$="("+$+")",B=$,R=l(),By.test(R)&&(V=R.slice(1),$+=R,o())),s("=");var se=Be(x,$);oe(x,B,se,V)}function Be(x,R){if(s("{",!0)){for(var O={};!s("}",!0);){if(!Tt.test(S=o()))throw T(S,"name");if(S===null)throw T(S,"end of input");var $,B=S;if(s(":",!0),l()==="{")$=Be(x,R+"."+S);else if(l()==="["){$=[];var V;if(s("[",!0)){do V=_(!0),$.push(V);while(s(",",!0));s("]"),typeof V!="undefined"&&Q(x,R+"."+S,V)}}else $=_(!0),Q(x,R+"."+S,$);var se=O[B];se&&($=[].concat(se).concat($)),O[B]=$,s(",",!0),s(";",!0)}return O}var ae=_(!0);return Q(x,R,ae),ae}function Q(x,R,O){x.setOption&&x.setOption(R,O)}function oe(x,R,O,$){x.setParsedOption&&x.setParsedOption(R,O,$)}function mt(x){if(s("[",!0)){do q(x,"option");while(s(",",!0));s("]")}return x}function mn(x,R){if(!Tt.test(R=o()))throw T(R,"service name");var O=new Sy(R);F(O,function(B){if(!C(O,B))if(B==="rpc")w(O,B);else throw T(B)}),x.add(O)}function w(x,R){var O=c(),$=R;if(!Tt.test(R=o()))throw T(R,"name");var B=R,V,se,ae,ue;if(s("("),s("stream",!0)&&(se=!0),!_t.test(R=o())||(V=R,s(")"),s("returns"),s("("),s("stream",!0)&&(ue=!0),!_t.test(R=o())))throw T(R);ae=R,s(")");var Bn=new Ry(B,$,V,ae,se,ue);Bn.comment=O,F(Bn,function(hn){if(hn==="option")q(Bn,hn),s(";");else throw T(hn)}),x.add(Bn)}function g(x,R){if(!_t.test(R=o()))throw T(R,"reference");var O=R;F(null,function(B){switch(B){case"required":case"repeated":z(x,B,O);break;case"optional":d?z(x,"proto3_optional",O):z(x,"optional",O);break;default:if(!d||!_t.test(B))throw T(B);a(B),z(x,"optional",O);break}})}for(var S;(S=o())!==null;)switch(S){case"package":if(!p)throw T(S);v();break;case"import":if(!p)throw T(S);D();break;case"syntax":if(!p)throw T(S);N();break;case"option":q(m,S),s(";");break;default:if(C(m,S)){p=!1;continue}throw T(S)}return Dt.filename=null,{package:u,imports:f,weakImports:h,syntax:b,root:t}}});var cd=G((yE,ld)=>{"use strict";ld.exports=ut;var jy=/\/|\./;function ut(n,t){jy.test(n)||(n="google/protobuf/"+n+".proto",t={nested:{google:{nested:{protobuf:{nested:t}}}}}),ut[n]=t}ut("any",{Any:{fields:{type_url:{type:"string",id:1},value:{type:"bytes",id:2}}}});var sd;ut("duration",{Duration:sd={fields:{seconds:{type:"int64",id:1},nanos:{type:"int32",id:2}}}});ut("timestamp",{Timestamp:sd});ut("empty",{Empty:{fields:{}}});ut("struct",{Struct:{fields:{fields:{keyType:"string",type:"Value",id:1}}},Value:{oneofs:{kind:{oneof:["nullValue","numberValue","stringValue","boolValue","structValue","listValue"]}},fields:{nullValue:{type:"NullValue",id:1},numberValue:{type:"double",id:2},stringValue:{type:"string",id:3},boolValue:{type:"bool",id:4},structValue:{type:"Struct",id:5},listValue:{type:"ListValue",id:6}}},NullValue:{values:{NULL_VALUE:0}},ListValue:{fields:{values:{rule:"repeated",type:"Value",id:1}}}});ut("wrappers",{DoubleValue:{fields:{value:{type:"double",id:1}}},FloatValue:{fields:{value:{type:"float",id:1}}},Int64Value:{fields:{value:{type:"int64",id:1}}},UInt64Value:{fields:{value:{type:"uint64",id:1}}},Int32Value:{fields:{value:{type:"int32",id:1}}},UInt32Value:{fields:{value:{type:"uint32",id:1}}},BoolValue:{fields:{value:{type:"bool",id:1}}},StringValue:{fields:{value:{type:"string",id:1}}},BytesValue:{fields:{value:{type:"bytes",id:1}}}});ut("field_mask",{FieldMask:{fields:{paths:{rule:"repeated",type:"string",id:1}}}});ut.get=function(t){return ut[t]||null}});var ud=G((bE,pd)=>{"use strict";var nn=pd.exports=Xu();nn.build="full";nn.tokenize=qs();nn.parse=ad();nn.common=cd();nn.Root._configure(nn.Type,nn.parse,nn.common)});var fd=G((vE,dd)=>{"use strict";dd.exports=ud()});var qd=G(Sn=>{"use strict";Object.defineProperty(Sn,"__esModule",{value:!0});var Cd=/highlight-(?:text|source)-([a-z0-9]+)/;function Sd(n){n.addRule("highlightedCodeBlock",{filter:function(t){var e=t.firstChild;return t.nodeName==="DIV"&&Cd.test(t.className)&&e&&e.nodeName==="PRE"},replacement:function(t,e,r){var i=e.className||"",o=(i.match(Cd)||[null,""])[1];return`

`+r.fence+o+`
`+e.firstChild.textContent+`
`+r.fence+`

`}})}function Rd(n){n.addRule("strikethrough",{filter:["del","s","strike"],replacement:function(t){return"~~"+t+"~~"}})}var nb=Array.prototype.indexOf,rb=Array.prototype.every,on={},ib={left:":---",right:"---:",center:":---:"},Js=null,Id=null,Nd=new WeakMap;function ob(n){return n?(n.getAttribute("align")||n.style.textAlign||"").toLowerCase():""}function Dd(n){return n?ib[n]:"---"}function Od(n,t){for(var e={left:0,right:0,center:0,"":0},r="",i=0;i<n.rows.length;++i){var o=n.rows[i];if(t<o.childNodes.length){var a=ob(o.childNodes[t]);++e[a],e[a]>e[r]&&(r=a)}}return r}on.tableCell={filter:["th","td"],replacement:function(n,t){return el(Md(t))?n:Fd(n,t)}};on.tableRow={filter:"tr",replacement:function(n,t){let e=Md(t);if(el(e))return n;var r="";if(ab(t)){let a=Bd(e);for(var i=0;i<a;i++){let l=i<t.childNodes.length?t.childNodes[i]:null;var o=Dd(Od(e,i));r+=Fd(o,l,i)}}return`
`+n+(r?`
`+r:"")}};on.table={filter:function(n,t){return n.nodeName==="TABLE"},replacement:function(n,t){if($d(t,Id)){let l=t.outerHTML,s=cb(t);return s===null||!s.classList.contains("joplin-table-wrapper")?`

<div class="joplin-table-wrapper">${l}</div>

`:l}else{if(el(t))return n;n=n.replace(/\n+/g,`
`);var e=n.trim().split(`
`);e.length>=2&&(e=e[1]);var r=/\| :?---/.test(e),i=Bd(t),o="";if(i&&!r){o="|"+"     |".repeat(i)+`
|`;for(var a=0;a<i;++a)o+=" "+Dd(Od(t,a))+" |"}let l=t.caption&&t.caption.textContent||"",s=l?`${l}

`:"",c=`${o}${n}`.trimStart();return`

${s}${c}

`}}};on.tableCaption={filter:["caption"],replacement:()=>""};on.tableColgroup={filter:["colgroup","col"],replacement:()=>""};on.tableSection={filter:["thead","tbody","tfoot"],replacement:function(n){return n}};function ab(n){var t=n.parentNode;return t.nodeName==="THEAD"||t.firstChild===n&&(t.nodeName==="TABLE"||sb(t))&&rb.call(n.childNodes,function(e){return e.nodeName==="TH"})}function sb(n){var t=n.previousSibling;return n.nodeName==="TBODY"&&(!t||t.nodeName==="THEAD"&&/^\s*$/i.test(t.textContent))}function Fd(n,t=null,e=null){e===null&&(e=nb.call(t.parentNode.childNodes,t));var r=" ";e===0&&(r="| ");let i=n.trim().replace(/\n\r/g,"<br>").replace(/\n/g,"<br>");for(i=i.replace(/\|+/g,"\\|");i.length<3;)i+=" ";return t&&(i=pb(i,t," ")),r+i+" |"}function Ld(n){if(!n.childNodes)return!1;for(let t=0;t<n.childNodes.length;t++){let e=n.childNodes[t];if(e.nodeName==="TABLE"||Ld(e))return!0}return!1}var Qs=(n,t)=>{if(!n.childNodes)return!1;for(let e=0;e<n.childNodes.length;e++){let r=n.childNodes[e];if(t==="code"&&Js&&Js(r)||t.includes(r.nodeName)||Qs(r,t))return!0}return!1},$d=(n,t)=>{let e=["UL","OL","H1","H2","H3","H4","H5","H6","HR","BLOCKQUOTE"];return t.preserveNestedTables&&e.push("TABLE"),Qs(n,"code")||Qs(n,e)};function el(n){let t=Nd.get(n);if(t!==void 0)return t;let e=lb(n);return Nd.set(n,e),e}function lb(n){return!!(!n||!n.rows||n.rows.length===1&&n.rows[0].childNodes.length<=1||Ld(n))}function cb(n){let t=n.parentNode;for(;t.nodeName!=="DIV";)if(t=t.parentNode,!t)return null;return t}function Md(n){let t=n.parentNode;for(;t.nodeName!=="TABLE";)if(t=t.parentNode,!t)return null;return t}function pb(n,t,e){let r=t.getAttribute("colspan")||1;for(let i=1;i<r;i++)n+=" | "+e.repeat(3);return n}function Bd(n){let t=0;for(let e=0;e<n.rows.length;e++){let i=n.rows[e].childNodes.length;i>t&&(t=i)}return t}function jd(n){Js=n.isCodeBlock,Id=n.options,n.keep(function(e){return!!(e.nodeName==="TABLE"&&$d(e,n.options))});for(var t in on)n.addRule(t,on[t])}function Ud(n){n.addRule("taskListItems",{filter:function(t){return t.type==="checkbox"&&t.parentNode.nodeName==="LI"},replacement:function(t,e){return(e.checked?"[x]":"[ ]")+" "}})}function ub(n){n.use([Sd,Rd,jd,Ud])}Sn.gfm=ub;Sn.highlightedCodeBlock=Sd;Sn.strikethrough=Rd;Sn.tables=jd;Sn.taskListItems=Ud});var Tm=G(Ao=>{(function(n){n.parser=function(w,g){return new e(w,g)},n.SAXParser=e,n.SAXStream=c,n.createStream=s,n.MAX_BUFFER_LENGTH=64*1024;var t=["comment","sgmlDecl","textNode","tagName","doctype","procInstName","procInstBody","entity","attribName","attribValue","cdata","script"];n.EVENTS=["text","processinginstruction","sgmldeclaration","doctype","comment","opentagstart","attribute","opentag","closetag","opencdata","cdata","closecdata","error","end","ready","script","opennamespace","closenamespace"];function e(w,g){if(!(this instanceof e))return new e(w,g);var S=this;i(S),S.q=S.c="",S.bufferCheckPosition=n.MAX_BUFFER_LENGTH,S.opt=g||{},S.opt.lowercase=S.opt.lowercase||S.opt.lowercasetags,S.looseCase=S.opt.lowercase?"toLowerCase":"toUpperCase",S.tags=[],S.closed=S.closedRoot=S.sawRoot=!1,S.tag=S.error=null,S.strict=!!w,S.noscript=!!(w||S.opt.noscript),S.state=v.BEGIN,S.strictEntities=S.opt.strictEntities,S.ENTITIES=S.strictEntities?Object.create(n.XML_ENTITIES):Object.create(n.ENTITIES),S.attribList=[],S.opt.xmlns&&(S.ns=Object.create(b)),S.opt.unquotedAttributeValues===void 0&&(S.opt.unquotedAttributeValues=!w),S.trackPosition=S.opt.position!==!1,S.trackPosition&&(S.position=S.line=S.column=0),N(S,"onready")}Object.create||(Object.create=function(w){function g(){}g.prototype=w;var S=new g;return S}),Object.keys||(Object.keys=function(w){var g=[];for(var S in w)w.hasOwnProperty(S)&&g.push(S);return g});function r(w){for(var g=Math.max(n.MAX_BUFFER_LENGTH,10),S=0,x=0,R=t.length;x<R;x++){var O=w[t[x]].length;if(O>g)switch(t[x]){case"textNode":F(w);break;case"cdata":C(w,"oncdata",w.cdata),w.cdata="";break;case"script":C(w,"onscript",w.script),w.script="";break;default:z(w,"Max buffer length exceeded: "+t[x])}S=Math.max(S,O)}var $=n.MAX_BUFFER_LENGTH-S;w.bufferCheckPosition=$+w.position}function i(w){for(var g=0,S=t.length;g<S;g++)w[t[g]]=""}function o(w){F(w),w.cdata!==""&&(C(w,"oncdata",w.cdata),w.cdata=""),w.script!==""&&(C(w,"onscript",w.script),w.script="")}e.prototype={end:function(){K(this)},write:mn,resume:function(){return this.error=null,this},close:function(){return this.write(null)},flush:function(){o(this)}};var a;try{a=require("stream").Stream}catch(w){a=function(){}}a||(a=function(){});var l=n.EVENTS.filter(function(w){return w!=="error"&&w!=="end"});function s(w,g){return new c(w,g)}function c(w,g){if(!(this instanceof c))return new c(w,g);a.apply(this),this._parser=new e(w,g),this.writable=!0,this.readable=!0;var S=this;this._parser.onend=function(){S.emit("end")},this._parser.onerror=function(x){S.emit("error",x),S._parser.error=null},this._decoder=null,l.forEach(function(x){Object.defineProperty(S,"on"+x,{get:function(){return S._parser["on"+x]},set:function(R){if(!R)return S.removeAllListeners(x),S._parser["on"+x]=R,R;S.on(x,R)},enumerable:!0,configurable:!1})})}c.prototype=Object.create(a.prototype,{constructor:{value:c}}),c.prototype.write=function(w){if(typeof Buffer=="function"&&typeof Buffer.isBuffer=="function"&&Buffer.isBuffer(w)){if(!this._decoder){var g=require("string_decoder").StringDecoder;this._decoder=new g("utf8")}w=this._decoder.write(w)}return this._parser.write(w.toString()),this.emit("data",w),!0},c.prototype.end=function(w){return w&&w.length&&this.write(w),this._parser.end(),!0},c.prototype.on=function(w,g){var S=this;return!S._parser["on"+w]&&l.indexOf(w)!==-1&&(S._parser["on"+w]=function(){var x=arguments.length===1?[arguments[0]]:Array.apply(null,arguments);x.splice(0,0,w),S.emit.apply(S,x)}),a.prototype.on.call(S,w,g)};var p="[CDATA[",u="DOCTYPE",f="http://www.w3.org/XML/1998/namespace",h="http://www.w3.org/2000/xmlns/",b={xml:f,xmlns:h},d=/[:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/,m=/[:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\u00B7\u0300-\u036F\u203F-\u2040.\d-]/,y=/[#:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/,T=/[#:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\u00B7\u0300-\u036F\u203F-\u2040.\d-]/;function k(w){return w===" "||w===`
`||w==="\r"||w==="	"}function _(w){return w==='"'||w==="'"}function A(w){return w===">"||k(w)}function E(w,g){return w.test(g)}function P(w,g){return!E(w,g)}var v=0;n.STATE={BEGIN:v++,BEGIN_WHITESPACE:v++,TEXT:v++,TEXT_ENTITY:v++,OPEN_WAKA:v++,SGML_DECL:v++,SGML_DECL_QUOTED:v++,DOCTYPE:v++,DOCTYPE_QUOTED:v++,DOCTYPE_DTD:v++,DOCTYPE_DTD_QUOTED:v++,COMMENT_STARTING:v++,COMMENT:v++,COMMENT_ENDING:v++,COMMENT_ENDED:v++,CDATA:v++,CDATA_ENDING:v++,CDATA_ENDING_2:v++,PROC_INST:v++,PROC_INST_BODY:v++,PROC_INST_ENDING:v++,OPEN_TAG:v++,OPEN_TAG_SLASH:v++,ATTRIB:v++,ATTRIB_NAME:v++,ATTRIB_NAME_SAW_WHITE:v++,ATTRIB_VALUE:v++,ATTRIB_VALUE_QUOTED:v++,ATTRIB_VALUE_CLOSED:v++,ATTRIB_VALUE_UNQUOTED:v++,ATTRIB_VALUE_ENTITY_Q:v++,ATTRIB_VALUE_ENTITY_U:v++,CLOSE_TAG:v++,CLOSE_TAG_SAW_WHITE:v++,SCRIPT:v++,SCRIPT_ENDING:v++},n.XML_ENTITIES={amp:"&",gt:">",lt:"<",quot:'"',apos:"'"},n.ENTITIES={amp:"&",gt:">",lt:"<",quot:'"',apos:"'",AElig:198,Aacute:193,Acirc:194,Agrave:192,Aring:197,Atilde:195,Auml:196,Ccedil:199,ETH:208,Eacute:201,Ecirc:202,Egrave:200,Euml:203,Iacute:205,Icirc:206,Igrave:204,Iuml:207,Ntilde:209,Oacute:211,Ocirc:212,Ograve:210,Oslash:216,Otilde:213,Ouml:214,THORN:222,Uacute:218,Ucirc:219,Ugrave:217,Uuml:220,Yacute:221,aacute:225,acirc:226,aelig:230,agrave:224,aring:229,atilde:227,auml:228,ccedil:231,eacute:233,ecirc:234,egrave:232,eth:240,euml:235,iacute:237,icirc:238,igrave:236,iuml:239,ntilde:241,oacute:243,ocirc:244,ograve:242,oslash:248,otilde:245,ouml:246,szlig:223,thorn:254,uacute:250,ucirc:251,ugrave:249,uuml:252,yacute:253,yuml:255,copy:169,reg:174,nbsp:160,iexcl:161,cent:162,pound:163,curren:164,yen:165,brvbar:166,sect:167,uml:168,ordf:170,laquo:171,not:172,shy:173,macr:175,deg:176,plusmn:177,sup1:185,sup2:178,sup3:179,acute:180,micro:181,para:182,middot:183,cedil:184,ordm:186,raquo:187,frac14:188,frac12:189,frac34:190,iquest:191,times:215,divide:247,OElig:338,oelig:339,Scaron:352,scaron:353,Yuml:376,fnof:402,circ:710,tilde:732,Alpha:913,Beta:914,Gamma:915,Delta:916,Epsilon:917,Zeta:918,Eta:919,Theta:920,Iota:921,Kappa:922,Lambda:923,Mu:924,Nu:925,Xi:926,Omicron:927,Pi:928,Rho:929,Sigma:931,Tau:932,Upsilon:933,Phi:934,Chi:935,Psi:936,Omega:937,alpha:945,beta:946,gamma:947,delta:948,epsilon:949,zeta:950,eta:951,theta:952,iota:953,kappa:954,lambda:955,mu:956,nu:957,xi:958,omicron:959,pi:960,rho:961,sigmaf:962,sigma:963,tau:964,upsilon:965,phi:966,chi:967,psi:968,omega:969,thetasym:977,upsih:978,piv:982,ensp:8194,emsp:8195,thinsp:8201,zwnj:8204,zwj:8205,lrm:8206,rlm:8207,ndash:8211,mdash:8212,lsquo:8216,rsquo:8217,sbquo:8218,ldquo:8220,rdquo:8221,bdquo:8222,dagger:8224,Dagger:8225,bull:8226,hellip:8230,permil:8240,prime:8242,Prime:8243,lsaquo:8249,rsaquo:8250,oline:8254,frasl:8260,euro:8364,image:8465,weierp:8472,real:8476,trade:8482,alefsym:8501,larr:8592,uarr:8593,rarr:8594,darr:8595,harr:8596,crarr:8629,lArr:8656,uArr:8657,rArr:8658,dArr:8659,hArr:8660,forall:8704,part:8706,exist:8707,empty:8709,nabla:8711,isin:8712,notin:8713,ni:8715,prod:8719,sum:8721,minus:8722,lowast:8727,radic:8730,prop:8733,infin:8734,ang:8736,and:8743,or:8744,cap:8745,cup:8746,int:8747,there4:8756,sim:8764,cong:8773,asymp:8776,ne:8800,equiv:8801,le:8804,ge:8805,sub:8834,sup:8835,nsub:8836,sube:8838,supe:8839,oplus:8853,otimes:8855,perp:8869,sdot:8901,lceil:8968,rceil:8969,lfloor:8970,rfloor:8971,lang:9001,rang:9002,loz:9674,spades:9824,clubs:9827,hearts:9829,diams:9830},Object.keys(n.ENTITIES).forEach(function(w){var g=n.ENTITIES[w],S=typeof g=="number"?String.fromCharCode(g):g;n.ENTITIES[w]=S});for(var D in n.STATE)n.STATE[n.STATE[D]]=D;v=n.STATE;function N(w,g,S){w[g]&&w[g](S)}function C(w,g,S){w.textNode&&F(w),N(w,g,S)}function F(w){w.textNode=L(w.opt,w.textNode),w.textNode&&N(w,"ontext",w.textNode),w.textNode=""}function L(w,g){return w.trim&&(g=g.trim()),w.normalize&&(g=g.replace(/\s+/g," ")),g}function z(w,g){return F(w),w.trackPosition&&(g+=`
Line: `+w.line+`
Column: `+w.column+`
Char: `+w.c),g=new Error(g),w.error=g,N(w,"onerror",g),w}function K(w){return w.sawRoot&&!w.closedRoot&&M(w,"Unclosed root tag"),w.state!==v.BEGIN&&w.state!==v.BEGIN_WHITESPACE&&w.state!==v.TEXT&&z(w,"Unexpected end"),F(w),w.c="",w.closed=!0,N(w,"onend"),e.call(w,w.strict,w.opt),w}function M(w,g){if(typeof w!="object"||!(w instanceof e))throw new Error("bad call to strictFail");w.strict&&z(w,g)}function le(w){w.strict||(w.tagName=w.tagName[w.looseCase]());var g=w.tags[w.tags.length-1]||w,S=w.tag={name:w.tagName,attributes:{}};w.opt.xmlns&&(S.ns=g.ns),w.attribList.length=0,C(w,"onopentagstart",S)}function J(w,g){var S=w.indexOf(":"),x=S<0?["",w]:w.split(":"),R=x[0],O=x[1];return g&&w==="xmlns"&&(R="xmlns",O=""),{prefix:R,local:O}}function be(w){if(w.strict||(w.attribName=w.attribName[w.looseCase]()),w.attribList.indexOf(w.attribName)!==-1||w.tag.attributes.hasOwnProperty(w.attribName)){w.attribName=w.attribValue="";return}if(w.opt.xmlns){var g=J(w.attribName,!0),S=g.prefix,x=g.local;if(S==="xmlns")if(x==="xml"&&w.attribValue!==f)M(w,"xml: prefix must be bound to "+f+`
Actual: `+w.attribValue);else if(x==="xmlns"&&w.attribValue!==h)M(w,"xmlns: prefix must be bound to "+h+`
Actual: `+w.attribValue);else{var R=w.tag,O=w.tags[w.tags.length-1]||w;R.ns===O.ns&&(R.ns=Object.create(O.ns)),R.ns[x]=w.attribValue}w.attribList.push([w.attribName,w.attribValue])}else w.tag.attributes[w.attribName]=w.attribValue,C(w,"onattribute",{name:w.attribName,value:w.attribValue});w.attribName=w.attribValue=""}function q(w,g){if(w.opt.xmlns){var S=w.tag,x=J(w.tagName);S.prefix=x.prefix,S.local=x.local,S.uri=S.ns[x.prefix]||"",S.prefix&&!S.uri&&(M(w,"Unbound namespace prefix: "+JSON.stringify(w.tagName)),S.uri=x.prefix);var R=w.tags[w.tags.length-1]||w;S.ns&&R.ns!==S.ns&&Object.keys(S.ns).forEach(function(Ol){C(w,"onopennamespace",{prefix:Ol,uri:S.ns[Ol]})});for(var O=0,$=w.attribList.length;O<$;O++){var B=w.attribList[O],V=B[0],se=B[1],ae=J(V,!0),ue=ae.prefix,Bn=ae.local,ya=ue===""?"":S.ns[ue]||"",hn={name:V,value:se,prefix:ue,local:Bn,uri:ya};ue&&ue!=="xmlns"&&!ya&&(M(w,"Unbound namespace prefix: "+JSON.stringify(ue)),hn.uri=ue),w.tag.attributes[V]=hn,C(w,"onattribute",hn)}w.attribList.length=0}w.tag.isSelfClosing=!!g,w.sawRoot=!0,w.tags.push(w.tag),C(w,"onopentag",w.tag),g||(!w.noscript&&w.tagName.toLowerCase()==="script"?w.state=v.SCRIPT:w.state=v.TEXT,w.tag=null,w.tagName=""),w.attribName=w.attribValue="",w.attribList.length=0}function Be(w){if(!w.tagName){M(w,"Weird empty close tag."),w.textNode+="</>",w.state=v.TEXT;return}if(w.script){if(w.tagName!=="script"){w.script+="</"+w.tagName+">",w.tagName="",w.state=v.SCRIPT;return}C(w,"onscript",w.script),w.script=""}var g=w.tags.length,S=w.tagName;w.strict||(S=S[w.looseCase]());for(var x=S;g--;){var R=w.tags[g];if(R.name!==x)M(w,"Unexpected close tag");else break}if(g<0){M(w,"Unmatched closing tag: "+w.tagName),w.textNode+="</"+w.tagName+">",w.state=v.TEXT;return}w.tagName=S;for(var O=w.tags.length;O-- >g;){var $=w.tag=w.tags.pop();w.tagName=w.tag.name,C(w,"onclosetag",w.tagName);var B={};for(var V in $.ns)B[V]=$.ns[V];var se=w.tags[w.tags.length-1]||w;w.opt.xmlns&&$.ns!==se.ns&&Object.keys($.ns).forEach(function(ae){var ue=$.ns[ae];C(w,"onclosenamespace",{prefix:ae,uri:ue})})}g===0&&(w.closedRoot=!0),w.tagName=w.attribValue=w.attribName="",w.attribList.length=0,w.state=v.TEXT}function Q(w){var g=w.entity,S=g.toLowerCase(),x,R="";return w.ENTITIES[g]?w.ENTITIES[g]:w.ENTITIES[S]?w.ENTITIES[S]:(g=S,g.charAt(0)==="#"&&(g.charAt(1)==="x"?(g=g.slice(2),x=parseInt(g,16),R=x.toString(16)):(g=g.slice(1),x=parseInt(g,10),R=x.toString(10))),g=g.replace(/^0+/,""),isNaN(x)||R.toLowerCase()!==g||x<0||x>1114111?(M(w,"Invalid character entity"),"&"+w.entity+";"):String.fromCodePoint(x))}function oe(w,g){g==="<"?(w.state=v.OPEN_WAKA,w.startTagPosition=w.position):k(g)||(M(w,"Non-whitespace before first tag."),w.textNode=g,w.state=v.TEXT)}function mt(w,g){var S="";return g<w.length&&(S=w.charAt(g)),S}function mn(w){var g=this;if(this.error)throw this.error;if(g.closed)return z(g,"Cannot write after close. Assign an onready handler.");if(w===null)return K(g);typeof w=="object"&&(w=w.toString());for(var S=0,x="";x=mt(w,S++),g.c=x,!!x;)switch(g.trackPosition&&(g.position++,x===`
`?(g.line++,g.column=0):g.column++),g.state){case v.BEGIN:if(g.state=v.BEGIN_WHITESPACE,x==="\uFEFF")continue;oe(g,x);continue;case v.BEGIN_WHITESPACE:oe(g,x);continue;case v.TEXT:if(g.sawRoot&&!g.closedRoot){for(var O=S-1;x&&x!=="<"&&x!=="&";)x=mt(w,S++),x&&g.trackPosition&&(g.position++,x===`
`?(g.line++,g.column=0):g.column++);g.textNode+=w.substring(O,S-1)}x==="<"&&!(g.sawRoot&&g.closedRoot&&!g.strict)?(g.state=v.OPEN_WAKA,g.startTagPosition=g.position):(!k(x)&&(!g.sawRoot||g.closedRoot)&&M(g,"Text data outside of root node."),x==="&"?g.state=v.TEXT_ENTITY:g.textNode+=x);continue;case v.SCRIPT:x==="<"?g.state=v.SCRIPT_ENDING:g.script+=x;continue;case v.SCRIPT_ENDING:x==="/"?g.state=v.CLOSE_TAG:(g.script+="<"+x,g.state=v.SCRIPT);continue;case v.OPEN_WAKA:if(x==="!")g.state=v.SGML_DECL,g.sgmlDecl="";else if(!k(x))if(E(d,x))g.state=v.OPEN_TAG,g.tagName=x;else if(x==="/")g.state=v.CLOSE_TAG,g.tagName="";else if(x==="?")g.state=v.PROC_INST,g.procInstName=g.procInstBody="";else{if(M(g,"Unencoded <"),g.startTagPosition+1<g.position){var R=g.position-g.startTagPosition;x=new Array(R).join(" ")+x}g.textNode+="<"+x,g.state=v.TEXT}continue;case v.SGML_DECL:if(g.sgmlDecl+x==="--"){g.state=v.COMMENT,g.comment="",g.sgmlDecl="";continue}g.doctype&&g.doctype!==!0&&g.sgmlDecl?(g.state=v.DOCTYPE_DTD,g.doctype+="<!"+g.sgmlDecl+x,g.sgmlDecl=""):(g.sgmlDecl+x).toUpperCase()===p?(C(g,"onopencdata"),g.state=v.CDATA,g.sgmlDecl="",g.cdata=""):(g.sgmlDecl+x).toUpperCase()===u?(g.state=v.DOCTYPE,(g.doctype||g.sawRoot)&&M(g,"Inappropriately located doctype declaration"),g.doctype="",g.sgmlDecl=""):x===">"?(C(g,"onsgmldeclaration",g.sgmlDecl),g.sgmlDecl="",g.state=v.TEXT):(_(x)&&(g.state=v.SGML_DECL_QUOTED),g.sgmlDecl+=x);continue;case v.SGML_DECL_QUOTED:x===g.q&&(g.state=v.SGML_DECL,g.q=""),g.sgmlDecl+=x;continue;case v.DOCTYPE:x===">"?(g.state=v.TEXT,C(g,"ondoctype",g.doctype),g.doctype=!0):(g.doctype+=x,x==="["?g.state=v.DOCTYPE_DTD:_(x)&&(g.state=v.DOCTYPE_QUOTED,g.q=x));continue;case v.DOCTYPE_QUOTED:g.doctype+=x,x===g.q&&(g.q="",g.state=v.DOCTYPE);continue;case v.DOCTYPE_DTD:x==="]"?(g.doctype+=x,g.state=v.DOCTYPE):x==="<"?(g.state=v.OPEN_WAKA,g.startTagPosition=g.position):_(x)?(g.doctype+=x,g.state=v.DOCTYPE_DTD_QUOTED,g.q=x):g.doctype+=x;continue;case v.DOCTYPE_DTD_QUOTED:g.doctype+=x,x===g.q&&(g.state=v.DOCTYPE_DTD,g.q="");continue;case v.COMMENT:x==="-"?g.state=v.COMMENT_ENDING:g.comment+=x;continue;case v.COMMENT_ENDING:x==="-"?(g.state=v.COMMENT_ENDED,g.comment=L(g.opt,g.comment),g.comment&&C(g,"oncomment",g.comment),g.comment=""):(g.comment+="-"+x,g.state=v.COMMENT);continue;case v.COMMENT_ENDED:x!==">"?(M(g,"Malformed comment"),g.comment+="--"+x,g.state=v.COMMENT):g.doctype&&g.doctype!==!0?g.state=v.DOCTYPE_DTD:g.state=v.TEXT;continue;case v.CDATA:for(var O=S-1;x&&x!=="]";)x=mt(w,S++),x&&g.trackPosition&&(g.position++,x===`
`?(g.line++,g.column=0):g.column++);g.cdata+=w.substring(O,S-1),x==="]"&&(g.state=v.CDATA_ENDING);continue;case v.CDATA_ENDING:x==="]"?g.state=v.CDATA_ENDING_2:(g.cdata+="]"+x,g.state=v.CDATA);continue;case v.CDATA_ENDING_2:x===">"?(g.cdata&&C(g,"oncdata",g.cdata),C(g,"onclosecdata"),g.cdata="",g.state=v.TEXT):x==="]"?g.cdata+="]":(g.cdata+="]]"+x,g.state=v.CDATA);continue;case v.PROC_INST:x==="?"?g.state=v.PROC_INST_ENDING:k(x)?g.state=v.PROC_INST_BODY:g.procInstName+=x;continue;case v.PROC_INST_BODY:if(!g.procInstBody&&k(x))continue;x==="?"?g.state=v.PROC_INST_ENDING:g.procInstBody+=x;continue;case v.PROC_INST_ENDING:x===">"?(C(g,"onprocessinginstruction",{name:g.procInstName,body:g.procInstBody}),g.procInstName=g.procInstBody="",g.state=v.TEXT):(g.procInstBody+="?"+x,g.state=v.PROC_INST_BODY);continue;case v.OPEN_TAG:E(m,x)?g.tagName+=x:(le(g),x===">"?q(g):x==="/"?g.state=v.OPEN_TAG_SLASH:(k(x)||M(g,"Invalid character in tag name"),g.state=v.ATTRIB));continue;case v.OPEN_TAG_SLASH:x===">"?(q(g,!0),Be(g)):(M(g,"Forward-slash in opening tag not followed by >"),g.state=v.ATTRIB);continue;case v.ATTRIB:if(k(x))continue;x===">"?q(g):x==="/"?g.state=v.OPEN_TAG_SLASH:E(d,x)?(g.attribName=x,g.attribValue="",g.state=v.ATTRIB_NAME):M(g,"Invalid attribute name");continue;case v.ATTRIB_NAME:x==="="?g.state=v.ATTRIB_VALUE:x===">"?(M(g,"Attribute without value"),g.attribValue=g.attribName,be(g),q(g)):k(x)?g.state=v.ATTRIB_NAME_SAW_WHITE:E(m,x)?g.attribName+=x:M(g,"Invalid attribute name");continue;case v.ATTRIB_NAME_SAW_WHITE:if(x==="=")g.state=v.ATTRIB_VALUE;else{if(k(x))continue;M(g,"Attribute without value"),g.tag.attributes[g.attribName]="",g.attribValue="",C(g,"onattribute",{name:g.attribName,value:""}),g.attribName="",x===">"?q(g):E(d,x)?(g.attribName=x,g.state=v.ATTRIB_NAME):(M(g,"Invalid attribute name"),g.state=v.ATTRIB)}continue;case v.ATTRIB_VALUE:if(k(x))continue;_(x)?(g.q=x,g.state=v.ATTRIB_VALUE_QUOTED):(g.opt.unquotedAttributeValues||z(g,"Unquoted attribute value"),g.state=v.ATTRIB_VALUE_UNQUOTED,g.attribValue=x);continue;case v.ATTRIB_VALUE_QUOTED:if(x!==g.q){x==="&"?g.state=v.ATTRIB_VALUE_ENTITY_Q:g.attribValue+=x;continue}be(g),g.q="",g.state=v.ATTRIB_VALUE_CLOSED;continue;case v.ATTRIB_VALUE_CLOSED:k(x)?g.state=v.ATTRIB:x===">"?q(g):x==="/"?g.state=v.OPEN_TAG_SLASH:E(d,x)?(M(g,"No whitespace between attributes"),g.attribName=x,g.attribValue="",g.state=v.ATTRIB_NAME):M(g,"Invalid attribute name");continue;case v.ATTRIB_VALUE_UNQUOTED:if(!A(x)){x==="&"?g.state=v.ATTRIB_VALUE_ENTITY_U:g.attribValue+=x;continue}be(g),x===">"?q(g):g.state=v.ATTRIB;continue;case v.CLOSE_TAG:if(g.tagName)x===">"?Be(g):E(m,x)?g.tagName+=x:g.script?(g.script+="</"+g.tagName,g.tagName="",g.state=v.SCRIPT):(k(x)||M(g,"Invalid tagname in closing tag"),g.state=v.CLOSE_TAG_SAW_WHITE);else{if(k(x))continue;P(d,x)?g.script?(g.script+="</"+x,g.state=v.SCRIPT):M(g,"Invalid tagname in closing tag."):g.tagName=x}continue;case v.CLOSE_TAG_SAW_WHITE:if(k(x))continue;x===">"?Be(g):M(g,"Invalid characters in closing tag");continue;case v.TEXT_ENTITY:case v.ATTRIB_VALUE_ENTITY_Q:case v.ATTRIB_VALUE_ENTITY_U:var $,B;switch(g.state){case v.TEXT_ENTITY:$=v.TEXT,B="textNode";break;case v.ATTRIB_VALUE_ENTITY_Q:$=v.ATTRIB_VALUE_QUOTED,B="attribValue";break;case v.ATTRIB_VALUE_ENTITY_U:$=v.ATTRIB_VALUE_UNQUOTED,B="attribValue";break}if(x===";"){var V=Q(g);g.opt.unparsedEntities&&!Object.values(n.XML_ENTITIES).includes(V)?(g.entity="",g.state=$,g.write(V)):(g[B]+=V,g.entity="",g.state=$)}else E(g.entity.length?T:y,x)?g.entity+=x:(M(g,"Invalid character in entity name"),g[B]+="&"+g.entity+x,g.entity="",g.state=$);continue;default:throw new Error(g,"Unknown state: "+g.state)}return g.position>=g.bufferCheckPosition&&r(g),g}String.fromCodePoint||function(){var w=String.fromCharCode,g=Math.floor,S=function(){var x=16384,R=[],O,$,B=-1,V=arguments.length;if(!V)return"";for(var se="";++B<V;){var ae=Number(arguments[B]);if(!isFinite(ae)||ae<0||ae>1114111||g(ae)!==ae)throw RangeError("Invalid code point: "+ae);ae<=65535?R.push(ae):(ae-=65536,O=(ae>>10)+55296,$=ae%1024+56320,R.push(O,$)),(B+1===V||R.length>x)&&(se+=w.apply(null,R),R.length=0)}return se};Object.defineProperty?Object.defineProperty(String,"fromCodePoint",{value:S,configurable:!0,writable:!0}):String.fromCodePoint=S}()})(typeof Ao=="undefined"?Ao.sax={}:Ao)});var Am=G((uC,km)=>{var _m=/[&<>"]/g,qv=RegExp(_m.source),Hv={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;"},Wv=n=>{let t=String(n);return t&&qv.test(t)?t.replace(_m,e=>Hv[e]):t},zv=(n,t)=>typeof n=="string"&&typeof t=="string"||n&&n[0].$name===t.$name,Yv=(n,t)=>typeof n=="string"?n+t:n.concat(t),Vv=n=>n.reduce((t,e)=>{let r=t.length-1,i=t[r];return zv(i,e)?t[r]=Yv(i,e):t.push(typeof e=="string"?e:[e]),t},[]),Gv=(n,t,e)=>{let r=null,i={};return Object.keys(n).forEach(o=>{let a=Po(n[o])?n[o]:null;if(a)switch(o){case"$name":!t&&a&&(i.$name=a);break;case"$attrs":r=a;break;case"$markup":i.$markup=Em(a);break;default:a&&(i[o]=e(a))}}),{stripped:i,$attrs:r}},Zv=n=>Array.isArray(n)&&n.length===1?n[0]:n,Kv=(n,t)=>Po(t)?n?Object.keys(t).length===1&&t.$name?Object.assign(t,n):Object.assign(t,{$attrs:n}):t:n,Xv=n=>{if(!n)return;let t=Object.keys(n),[e]=t;return t.length===1&&e!=="$name"&&e!=="id"?n[t[0]]:n},ml=(n,t,e)=>{let r=e?s=>s:Zv,i=r(n);if(!Po(i))return null;if(typeof i!="object"||Array.isArray(i))return i;let{$attrs:o,stripped:a}=Gv(i,t,r),l=Kv(o,a);return Xv(l)},Jv=n=>{let t,e={},r=!0;return n.every(i=>(typeof i=="string"?t="$text":t=i[0].$name,e[t]?(r=!1,!1):(e[t]=!0,!0))),r},hl=(n=[],t=[],e=!1)=>{let r=Array.isArray(n)?n:[n],i=Array.isArray(t)?t:[t],o=r.concat(i);return o.length===1&&!e?o[0]:o},Em=(n,t)=>{let e=[];return n!==null&&typeof n=="object"&&n.constructor===Array?(n.forEach(r=>{e.push(ml(r,t))}),e):ml(n,t)},Qv=(n,t)=>{let e,r={};return Object.keys(n).forEach(i=>{i!=="$markup"&&(r[i]=n[i])}),n.$markup&&n.$markup.forEach(i=>{typeof i=="string"?r.$text=hl(r.$text,i,t):typeof i=="object"&&(i.constructor===Array?e=i[0].$name:e=i.$name,r[e]=hl(r[e],Em(i,!0),t))}),r},Po=n=>n!=null&&(n.length==null||n.length!==0)&&(typeof n!="object"||Object.keys(n).length!==0);km.exports={condenseArray:Vv,escape:Wv,isSomething:Po,moosh:hl,objectifyMarkup:Qv,shouldObjectifyMarkup:Jv,simplifyNode:ml}});var Nm=G((dC,Cm)=>{var{EventEmitter:ew}=require("events"),tw=Tm(),ln=Am(),nw=1,cr=0,cn=-1,Pm={preserveMarkup:cr,simplifyNodes:!0,useArrays:cr,lowercase:!0,trim:!0,normalize:!0,cdataAsText:!1,strict:!1},ri=function(t,e=Pm){let r=new ew,i=[],o=Object.assign({},Pm,e),{preserveMarkup:a,simplifyNodes:l,useArrays:s,lowercase:c,trim:p,normalize:u,cdataAsText:f,strict:h}=o,b=null,d=null,m=tw.createStream(h,{lowercase:c,trim:p,normalize:u,cdataAsText:f});return m.on("opentag",y=>{i.length===0&&!r.listeners(`tag:${y.name}`).length||(b={$name:y.name,$attrs:y.attributes},s>cn&&(b.$markup=[]),i.push(b))}),m.on("text",y=>{b&&(s>cn?b.$markup.push(y):b.$text?b.$text+=y:b.$text=y)}),m.on("opencdata",()=>{b&&(f||(d={$name:"$cdata",text:""},s>cn?b.$markup.push(d):b.$cdata=d))}),m.on("cdata",y=>{b&&(d!==null?d.text+=y:s>cn?b.$markup.push(y):b.$text?b.$text+=y:b.$text=y)}),m.on("closecdata",()=>{d=null}),m.on("script",y=>{b&&(b.$script=y)}),m.on("closetag",y=>{let T,k=null,_=s>cr;i.length!==0&&(s>cn&&(a<=cn?(b.$markup=ln.condenseArray(b.$markup),b=ln.objectifyMarkup(b,_)):a===cr&&(T=ln.condenseArray(b.$markup),ln.shouldObjectifyMarkup(T)&&(b.$markup=T,b=ln.objectifyMarkup(b,_)))),r.listeners(`tag:${y}`).length&&r.emit(`tag:${y}`,l?ln.simplifyNode(b,!1,s>cr):b),i.pop(),i.length>0&&(k=i[i.length-1],s>cn?k.$markup.push(b):k[y]||(k[y]=ln.simplifyNode(b,!0))),b=k)}),m.on("end",()=>{r.emit("end")}),m.on("error",y=>{r.emit("error",y)}),t.pipe(m),r.pause=function(){t.pause()},r.resume=function(){t.resume()},r};ri.ALWAYS=nw;ri.SOMETIMES=cr;ri.NEVER=cn;ri.toXml=function(t,{indent:e="",selfClosing:r=!0,escape:i=ln.escape,nodeName:o}={}){let a=e?`
`:"";function l(s,c,p){let u="",f,h=c,b=p?a+p:"",d=p+e,m="";return s=s||"",s.constructor===Array?(s.forEach(y=>{u+=l(y,h,p)}),u):(!h&&s.$name&&(h=s.$name),h&&(u=`${b}<${h}`,s.$attrs&&typeof s.$attrs=="object"&&(f=Object.keys(s.$attrs),f.forEach(y=>{u+=` ${y}=${JSON.stringify(String(s.$attrs[y]))}`}))),s==null||s===""||(typeof s=="object"?(f=Object.keys(s),f.forEach(y=>{let T=s[y];switch(y){case"$name":case"$attrs":break;case"$text":case"$markup":m+=l(T,null,d);break;case"$script":m+=l(T,"script",d);break;case"$cdata":m+=`${b}<![CDATA[${T}]]>`;break;default:m+=l(T,y,d)}})):m+=b+i(s)),h?m?u+=`>${m}${a}${p}</${h}>`:r?u+="/>":u+=`></${h}>`:u+=m,u)}return l(t,o,"")};Cm.exports=ri});var Oo=G(oi=>{"use strict";Object.defineProperty(oi,"__esModule",{value:!0});oi.assertNever=Hw;oi.pick=Ww;oi.isObject=zw;function Hw(n){throw new Error(`Unexpected value should never occur: ${n}`)}function Ww(n,t){let e=t.map(r=>[r,n==null?void 0:n[r]]);return Object.fromEntries(e)}function zw(n){return typeof n=="object"&&n!==null}});var _l=G(mr=>{"use strict";Object.defineProperty(mr,"__esModule",{value:!0});mr.LogLevel=void 0;mr.makeConsoleLogger=Vw;mr.logLevelSeverity=Gw;var Yw=Oo(),fr;(function(n){n.DEBUG="debug",n.INFO="info",n.WARN="warn",n.ERROR="error"})(fr||(mr.LogLevel=fr={}));function Vw(n){return(t,e,r)=>{console[t](`${n} ${t}:`,e,r)}}function Gw(n){switch(n){case fr.DEBUG:return 20;case fr.INFO:return 40;case fr.WARN:return 60;case fr.ERROR:return 80;default:return(0,Yw.assertNever)(n)}}});var kl=G($e=>{"use strict";Object.defineProperty($e,"__esModule",{value:!0});$e.APIResponseError=$e.UnknownHTTPResponseError=$e.RequestTimeoutError=$e.ClientErrorCode=$e.APIErrorCode=void 0;$e.isNotionClientError=th;$e.isHTTPResponseError=Kw;$e.buildRequestError=Xw;var eh=Oo(),fe;(function(n){n.Unauthorized="unauthorized",n.RestrictedResource="restricted_resource",n.ObjectNotFound="object_not_found",n.RateLimited="rate_limited",n.InvalidJSON="invalid_json",n.InvalidRequestURL="invalid_request_url",n.InvalidRequest="invalid_request",n.ValidationError="validation_error",n.ConflictError="conflict_error",n.InternalServerError="internal_server_error",n.ServiceUnavailable="service_unavailable"})(fe||($e.APIErrorCode=fe={}));var $n;(function(n){n.RequestTimeout="notionhq_client_request_timeout",n.ResponseError="notionhq_client_response_error"})($n||($e.ClientErrorCode=$n={}));var ai=class extends Error{};function th(n){return(0,eh.isObject)(n)&&n instanceof ai}function Mo(n,t){return th(n)&&n.code in t}var El=class n extends ai{constructor(t="Request to Notion API has timed out"){super(t),this.code=$n.RequestTimeout,this.name="RequestTimeoutError"}static isRequestTimeoutError(t){return Mo(t,{[$n.RequestTimeout]:!0})}static rejectAfterTimeout(t,e){return new Promise((r,i)=>{let o=setTimeout(()=>{i(new n)},e);t.then(r).catch(i).then(()=>clearTimeout(o))})}};$e.RequestTimeoutError=El;var Fo=class extends ai{constructor(t){super(t.message),this.name="HTTPResponseError";let{code:e,status:r,headers:i,rawBodyText:o,additional_data:a,request_id:l}=t;this.code=e,this.status=r,this.headers=i,this.body=o,this.additional_data=a,this.request_id=l}},Zw={[$n.ResponseError]:!0,[fe.Unauthorized]:!0,[fe.RestrictedResource]:!0,[fe.ObjectNotFound]:!0,[fe.RateLimited]:!0,[fe.InvalidJSON]:!0,[fe.InvalidRequestURL]:!0,[fe.InvalidRequest]:!0,[fe.ValidationError]:!0,[fe.ConflictError]:!0,[fe.InternalServerError]:!0,[fe.ServiceUnavailable]:!0};function Kw(n){return!!Mo(n,Zw)}var Lo=class extends Fo{constructor(t){var e;super({...t,code:$n.ResponseError,message:(e=t.message)!==null&&e!==void 0?e:`Request to Notion API failed with status: ${t.status}`,additional_data:void 0,request_id:void 0}),this.name="UnknownHTTPResponseError"}static isUnknownHTTPResponseError(t){return Mo(t,{[$n.ResponseError]:!0})}};$e.UnknownHTTPResponseError=Lo;var nh={[fe.Unauthorized]:!0,[fe.RestrictedResource]:!0,[fe.ObjectNotFound]:!0,[fe.RateLimited]:!0,[fe.InvalidJSON]:!0,[fe.InvalidRequestURL]:!0,[fe.InvalidRequest]:!0,[fe.ValidationError]:!0,[fe.ConflictError]:!0,[fe.InternalServerError]:!0,[fe.ServiceUnavailable]:!0},$o=class extends Fo{constructor(){super(...arguments),this.name="APIResponseError"}static isAPIResponseError(t){return Mo(t,nh)}};$e.APIResponseError=$o;function Xw(n,t){let e=Jw(t);return e!==void 0?new $o({code:e.code,message:e.message,headers:n.headers,status:n.status,rawBodyText:t,additional_data:e.additional_data,request_id:e.request_id}):new Lo({message:void 0,headers:n.headers,status:n.status,rawBodyText:t})}function Jw(n){if(typeof n!="string")return;let t;try{t=JSON.parse(n)}catch(i){return}if(!(0,eh.isObject)(t)||typeof t.message!="string"||!Qw(t.code))return;let e=t.additional_data,r=t.request_id;return{...t,code:t.code,message:t.message,additional_data:e,request_id:r}}function Qw(n){return typeof n=="string"&&n in nh}});var rh=G(j=>{"use strict";Object.defineProperty(j,"__esModule",{value:!0});j.listDataSourceTemplates=j.oauthIntrospect=j.oauthRevoke=j.oauthToken=j.getFileUpload=j.completeFileUpload=j.sendFileUpload=j.listFileUploads=j.createFileUpload=j.getComment=j.listComments=j.createComment=j.search=j.createDatabase=j.updateDatabase=j.getDatabase=j.createDataSource=j.queryDataSource=j.updateDataSource=j.getDataSource=j.appendBlockChildren=j.listBlockChildren=j.deleteBlock=j.updateBlock=j.getBlock=j.getPageProperty=j.updatePage=j.getPage=j.createPage=j.listUsers=j.getUser=j.getSelf=void 0;j.getSelf={method:"get",pathParams:[],queryParams:[],bodyParams:[],path:()=>"users/me"};j.getUser={method:"get",pathParams:["user_id"],queryParams:[],bodyParams:[],path:n=>`users/${n.user_id}`};j.listUsers={method:"get",pathParams:[],queryParams:["start_cursor","page_size"],bodyParams:[],path:()=>"users"};j.createPage={method:"post",pathParams:[],queryParams:[],bodyParams:["parent","properties","icon","cover","content","children","template"],path:()=>"pages"};j.getPage={method:"get",pathParams:["page_id"],queryParams:["filter_properties"],bodyParams:[],path:n=>`pages/${n.page_id}`};j.updatePage={method:"patch",pathParams:["page_id"],queryParams:[],bodyParams:["properties","icon","cover","is_locked","template","erase_content","archived","in_trash"],path:n=>`pages/${n.page_id}`};j.getPageProperty={method:"get",pathParams:["page_id","property_id"],queryParams:["start_cursor","page_size"],bodyParams:[],path:n=>`pages/${n.page_id}/properties/${n.property_id}`};j.getBlock={method:"get",pathParams:["block_id"],queryParams:[],bodyParams:[],path:n=>`blocks/${n.block_id}`};j.updateBlock={method:"patch",pathParams:["block_id"],queryParams:[],bodyParams:["embed","type","archived","in_trash","bookmark","image","video","pdf","file","audio","code","equation","divider","breadcrumb","table_of_contents","link_to_page","table_row","heading_1","heading_2","heading_3","paragraph","bulleted_list_item","numbered_list_item","quote","to_do","toggle","template","callout","synced_block","table","column"],path:n=>`blocks/${n.block_id}`};j.deleteBlock={method:"delete",pathParams:["block_id"],queryParams:[],bodyParams:[],path:n=>`blocks/${n.block_id}`};j.listBlockChildren={method:"get",pathParams:["block_id"],queryParams:["start_cursor","page_size"],bodyParams:[],path:n=>`blocks/${n.block_id}/children`};j.appendBlockChildren={method:"patch",pathParams:["block_id"],queryParams:[],bodyParams:["children","after"],path:n=>`blocks/${n.block_id}/children`};j.getDataSource={method:"get",pathParams:["data_source_id"],queryParams:[],bodyParams:[],path:n=>`data_sources/${n.data_source_id}`};j.updateDataSource={method:"patch",pathParams:["data_source_id"],queryParams:[],bodyParams:["title","icon","properties","in_trash","archived","parent"],path:n=>`data_sources/${n.data_source_id}`};j.queryDataSource={method:"post",pathParams:["data_source_id"],queryParams:["filter_properties"],bodyParams:["sorts","filter","start_cursor","page_size","archived","in_trash","result_type"],path:n=>`data_sources/${n.data_source_id}/query`};j.createDataSource={method:"post",pathParams:[],queryParams:[],bodyParams:["parent","properties","title","icon"],path:()=>"data_sources"};j.getDatabase={method:"get",pathParams:["database_id"],queryParams:[],bodyParams:[],path:n=>`databases/${n.database_id}`};j.updateDatabase={method:"patch",pathParams:["database_id"],queryParams:[],bodyParams:["parent","title","description","is_inline","icon","cover","in_trash","is_locked"],path:n=>`databases/${n.database_id}`};j.createDatabase={method:"post",pathParams:[],queryParams:[],bodyParams:["parent","title","description","is_inline","initial_data_source","icon","cover"],path:()=>"databases"};j.search={method:"post",pathParams:[],queryParams:[],bodyParams:["sort","query","start_cursor","page_size","filter"],path:()=>"search"};j.createComment={method:"post",pathParams:[],queryParams:[],bodyParams:["rich_text","attachments","display_name","parent","discussion_id"],path:()=>"comments"};j.listComments={method:"get",pathParams:[],queryParams:["block_id","start_cursor","page_size"],bodyParams:[],path:()=>"comments"};j.getComment={method:"get",pathParams:["comment_id"],queryParams:[],bodyParams:[],path:n=>`comments/${n.comment_id}`};j.createFileUpload={method:"post",pathParams:[],queryParams:[],bodyParams:["mode","filename","content_type","number_of_parts","external_url"],path:()=>"file_uploads"};j.listFileUploads={method:"get",pathParams:[],queryParams:["status","start_cursor","page_size"],bodyParams:[],path:()=>"file_uploads"};j.sendFileUpload={method:"post",pathParams:["file_upload_id"],queryParams:[],bodyParams:[],formDataParams:["file","part_number"],path:n=>`file_uploads/${n.file_upload_id}/send`};j.completeFileUpload={method:"post",pathParams:["file_upload_id"],queryParams:[],bodyParams:[],path:n=>`file_uploads/${n.file_upload_id}/complete`};j.getFileUpload={method:"get",pathParams:["file_upload_id"],queryParams:[],bodyParams:[],path:n=>`file_uploads/${n.file_upload_id}`};j.oauthToken={method:"post",pathParams:[],queryParams:[],bodyParams:["grant_type","code","redirect_uri","external_account","refresh_token"],path:()=>"oauth/token"};j.oauthRevoke={method:"post",pathParams:[],queryParams:[],bodyParams:["token"],path:()=>"oauth/revoke"};j.oauthIntrospect={method:"post",pathParams:[],queryParams:[],bodyParams:["token"],path:()=>"oauth/introspect"};j.listDataSourceTemplates={method:"get",pathParams:["data_source_id"],queryParams:["name","start_cursor","page_size"],bodyParams:[],path:n=>`data_sources/${n.data_source_id}/templates`}});var ih=G((TN,ex)=>{ex.exports={name:"@notionhq/client",version:"5.3.0",description:"A simple and easy to use client for the Notion API",engines:{node:">=18"},homepage:"https://developers.notion.com/docs/getting-started",bugs:{url:"https://github.com/makenotion/notion-sdk-js/issues"},repository:{type:"git",url:"https://github.com/makenotion/notion-sdk-js/"},keywords:["notion","notionapi","rest","notion-api"],main:"./build/src",types:"./build/src/index.d.ts",scripts:{prepare:"npm run build",prepublishOnly:"npm run checkLoggedIn && npm run lint && npm run test",build:"tsc",prettier:"prettier --write .",lint:"prettier --check . && eslint . --ext .ts && cspell '**/*' ",test:"jest ./test","check-links":"git ls-files | grep md$ | xargs -n 1 markdown-link-check",prebuild:"npm run clean",clean:"rm -rf ./build",checkLoggedIn:"./scripts/verifyLoggedIn.sh","install:examples":'for dir in examples/*/; do echo "Installing dependencies in $dir..."; (cd "$dir" && npm install); done',"examples:install":"npm run install:examples","examples:typecheck":'for dir in examples/*/; do echo "Typechecking $dir..."; (cd "$dir" && npx tsc --noEmit) || exit 1; done'},author:"",license:"MIT",files:["build/package.json","build/src/**"],devDependencies:{"@types/jest":"28.1.4","@typescript-eslint/eslint-plugin":"5.39.0","@typescript-eslint/parser":"5.39.0",cspell:"5.4.1",eslint:"7.24.0",jest:"28.1.2","markdown-link-check":"3.13.7",prettier:"2.8.8","ts-jest":"28.0.5",typescript:"5.9.2"}}});var ah=G(Mn=>{"use strict";var Bt=Mn&&Mn.__classPrivateFieldSet||function(n,t,e,r,i){if(r==="m")throw new TypeError("Private method is not writable");if(r==="a"&&!i)throw new TypeError("Private accessor was defined without a setter");if(typeof t=="function"?n!==t||!i:!t.has(n))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r==="a"?i.call(n,e):i?i.value=e:t.set(n,e),e},jt=Mn&&Mn.__classPrivateFieldGet||function(n,t,e,r){if(e==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof t=="function"?n!==t||!r:!t.has(n))throw new TypeError("Cannot read private member from an object whose class did not declare it");return e==="m"?r:e==="a"?r.call(n):r?r.value:t.get(n)},jo,Uo,qo,Ho,Wo,zo,Yo,Vo,Go;Object.defineProperty(Mn,"__esModule",{value:!0});var pn=_l(),Bo=kl(),W=Oo(),I=rh(),oh=ih(),Zo=class n{constructor(t){var e,r,i,o,a,l;jo.set(this,void 0),Uo.set(this,void 0),qo.set(this,void 0),Ho.set(this,void 0),Wo.set(this,void 0),zo.set(this,void 0),Yo.set(this,void 0),Vo.set(this,void 0),Go.set(this,void 0),this.blocks={retrieve:s=>this.request({path:I.getBlock.path(s),method:I.getBlock.method,query:(0,W.pick)(s,I.getBlock.queryParams),body:(0,W.pick)(s,I.getBlock.bodyParams),auth:s==null?void 0:s.auth}),update:s=>this.request({path:I.updateBlock.path(s),method:I.updateBlock.method,query:(0,W.pick)(s,I.updateBlock.queryParams),body:(0,W.pick)(s,I.updateBlock.bodyParams),auth:s==null?void 0:s.auth}),delete:s=>this.request({path:I.deleteBlock.path(s),method:I.deleteBlock.method,query:(0,W.pick)(s,I.deleteBlock.queryParams),body:(0,W.pick)(s,I.deleteBlock.bodyParams),auth:s==null?void 0:s.auth}),children:{append:s=>this.request({path:I.appendBlockChildren.path(s),method:I.appendBlockChildren.method,query:(0,W.pick)(s,I.appendBlockChildren.queryParams),body:(0,W.pick)(s,I.appendBlockChildren.bodyParams),auth:s==null?void 0:s.auth}),list:s=>this.request({path:I.listBlockChildren.path(s),method:I.listBlockChildren.method,query:(0,W.pick)(s,I.listBlockChildren.queryParams),body:(0,W.pick)(s,I.listBlockChildren.bodyParams),auth:s==null?void 0:s.auth})}},this.databases={retrieve:s=>this.request({path:I.getDatabase.path(s),method:I.getDatabase.method,query:(0,W.pick)(s,I.getDatabase.queryParams),body:(0,W.pick)(s,I.getDatabase.bodyParams),auth:s==null?void 0:s.auth}),create:s=>this.request({path:I.createDatabase.path(),method:I.createDatabase.method,query:(0,W.pick)(s,I.createDatabase.queryParams),body:(0,W.pick)(s,I.createDatabase.bodyParams),auth:s==null?void 0:s.auth}),update:s=>this.request({path:I.updateDatabase.path(s),method:I.updateDatabase.method,query:(0,W.pick)(s,I.updateDatabase.queryParams),body:(0,W.pick)(s,I.updateDatabase.bodyParams),auth:s==null?void 0:s.auth})},this.dataSources={retrieve:s=>this.request({path:I.getDataSource.path(s),method:I.getDataSource.method,query:(0,W.pick)(s,I.getDataSource.queryParams),body:(0,W.pick)(s,I.getDataSource.bodyParams),auth:s==null?void 0:s.auth}),query:s=>this.request({path:I.queryDataSource.path(s),method:I.queryDataSource.method,query:(0,W.pick)(s,I.queryDataSource.queryParams),body:(0,W.pick)(s,I.queryDataSource.bodyParams),auth:s==null?void 0:s.auth}),create:s=>this.request({path:I.createDataSource.path(),method:I.createDataSource.method,query:(0,W.pick)(s,I.createDataSource.queryParams),body:(0,W.pick)(s,I.createDataSource.bodyParams),auth:s==null?void 0:s.auth}),update:s=>this.request({path:I.updateDataSource.path(s),method:I.updateDataSource.method,query:(0,W.pick)(s,I.updateDataSource.queryParams),body:(0,W.pick)(s,I.updateDataSource.bodyParams),auth:s==null?void 0:s.auth}),listTemplates:s=>this.request({path:I.listDataSourceTemplates.path(s),method:I.listDataSourceTemplates.method,query:(0,W.pick)(s,I.listDataSourceTemplates.queryParams),body:(0,W.pick)(s,I.listDataSourceTemplates.bodyParams),auth:s==null?void 0:s.auth})},this.pages={create:s=>this.request({path:I.createPage.path(),method:I.createPage.method,query:(0,W.pick)(s,I.createPage.queryParams),body:(0,W.pick)(s,I.createPage.bodyParams),auth:s==null?void 0:s.auth}),retrieve:s=>this.request({path:I.getPage.path(s),method:I.getPage.method,query:(0,W.pick)(s,I.getPage.queryParams),body:(0,W.pick)(s,I.getPage.bodyParams),auth:s==null?void 0:s.auth}),update:s=>this.request({path:I.updatePage.path(s),method:I.updatePage.method,query:(0,W.pick)(s,I.updatePage.queryParams),body:(0,W.pick)(s,I.updatePage.bodyParams),auth:s==null?void 0:s.auth}),properties:{retrieve:s=>this.request({path:I.getPageProperty.path(s),method:I.getPageProperty.method,query:(0,W.pick)(s,I.getPageProperty.queryParams),body:(0,W.pick)(s,I.getPageProperty.bodyParams),auth:s==null?void 0:s.auth})}},this.users={retrieve:s=>this.request({path:I.getUser.path(s),method:I.getUser.method,query:(0,W.pick)(s,I.getUser.queryParams),body:(0,W.pick)(s,I.getUser.bodyParams),auth:s==null?void 0:s.auth}),list:s=>this.request({path:I.listUsers.path(),method:I.listUsers.method,query:(0,W.pick)(s,I.listUsers.queryParams),body:(0,W.pick)(s,I.listUsers.bodyParams),auth:s==null?void 0:s.auth}),me:s=>this.request({path:I.getSelf.path(),method:I.getSelf.method,query:(0,W.pick)(s,I.getSelf.queryParams),body:(0,W.pick)(s,I.getSelf.bodyParams),auth:s==null?void 0:s.auth})},this.comments={create:s=>this.request({path:I.createComment.path(),method:I.createComment.method,query:(0,W.pick)(s,I.createComment.queryParams),body:(0,W.pick)(s,I.createComment.bodyParams),auth:s==null?void 0:s.auth}),list:s=>this.request({path:I.listComments.path(),method:I.listComments.method,query:(0,W.pick)(s,I.listComments.queryParams),body:(0,W.pick)(s,I.listComments.bodyParams),auth:s==null?void 0:s.auth}),retrieve:s=>this.request({path:I.getComment.path(s),method:I.getComment.method,query:(0,W.pick)(s,I.getComment.queryParams),body:(0,W.pick)(s,I.getComment.bodyParams),auth:s==null?void 0:s.auth})},this.fileUploads={create:s=>this.request({path:I.createFileUpload.path(),method:I.createFileUpload.method,query:(0,W.pick)(s,I.createFileUpload.queryParams),body:(0,W.pick)(s,I.createFileUpload.bodyParams),auth:s==null?void 0:s.auth}),retrieve:s=>this.request({path:I.getFileUpload.path(s),method:I.getFileUpload.method,query:(0,W.pick)(s,I.getFileUpload.queryParams),auth:s==null?void 0:s.auth}),list:s=>this.request({path:I.listFileUploads.path(),method:I.listFileUploads.method,query:(0,W.pick)(s,I.listFileUploads.queryParams),auth:s==null?void 0:s.auth}),send:s=>this.request({path:I.sendFileUpload.path(s),method:I.sendFileUpload.method,query:(0,W.pick)(s,I.sendFileUpload.queryParams),formDataParams:(0,W.pick)(s,I.sendFileUpload.formDataParams),auth:s==null?void 0:s.auth}),complete:s=>this.request({path:I.completeFileUpload.path(s),method:I.completeFileUpload.method,query:(0,W.pick)(s,I.completeFileUpload.queryParams),auth:s==null?void 0:s.auth})},this.search=s=>this.request({path:I.search.path(),method:I.search.method,query:(0,W.pick)(s,I.search.queryParams),body:(0,W.pick)(s,I.search.bodyParams),auth:s==null?void 0:s.auth}),this.oauth={token:s=>this.request({path:I.oauthToken.path(),method:I.oauthToken.method,query:(0,W.pick)(s,I.oauthToken.queryParams),body:(0,W.pick)(s,I.oauthToken.bodyParams),auth:{client_id:s.client_id,client_secret:s.client_secret}}),introspect:s=>this.request({path:I.oauthIntrospect.path(),method:I.oauthIntrospect.method,query:(0,W.pick)(s,I.oauthIntrospect.queryParams),body:(0,W.pick)(s,I.oauthIntrospect.bodyParams),auth:{client_id:s.client_id,client_secret:s.client_secret}}),revoke:s=>this.request({path:I.oauthRevoke.path(),method:I.oauthRevoke.method,query:(0,W.pick)(s,I.oauthRevoke.queryParams),body:(0,W.pick)(s,I.oauthRevoke.bodyParams),auth:{client_id:s.client_id,client_secret:s.client_secret}})},Bt(this,jo,t==null?void 0:t.auth,"f"),Bt(this,Uo,(e=t==null?void 0:t.logLevel)!==null&&e!==void 0?e:pn.LogLevel.WARN,"f"),Bt(this,qo,(r=t==null?void 0:t.logger)!==null&&r!==void 0?r:(0,pn.makeConsoleLogger)(oh.name),"f"),Bt(this,Ho,`${(i=t==null?void 0:t.baseUrl)!==null&&i!==void 0?i:"https://api.notion.com"}/v1/`,"f"),Bt(this,Wo,(o=t==null?void 0:t.timeoutMs)!==null&&o!==void 0?o:6e4,"f"),Bt(this,zo,(a=t==null?void 0:t.notionVersion)!==null&&a!==void 0?a:n.defaultNotionVersion,"f"),Bt(this,Yo,(l=t==null?void 0:t.fetch)!==null&&l!==void 0?l:fetch,"f"),Bt(this,Vo,t==null?void 0:t.agent,"f"),Bt(this,Go,`notionhq-client/${oh.version}`,"f")}async request(t){let{path:e,method:r,query:i,body:o,formDataParams:a,auth:l}=t;this.log(pn.LogLevel.INFO,"request start",{method:r,path:e});let s=!o||Object.entries(o).length===0?void 0:JSON.stringify(o),c=new URL(`${jt(this,Ho,"f")}${e}`);if(i){for(let[h,b]of Object.entries(i))if(b!==void 0)if(Array.isArray(b))for(let d of b)c.searchParams.append(h,decodeURIComponent(d));else c.searchParams.append(h,String(b))}let p;if(typeof l=="object"){let h=`${l.client_id}:${l.client_secret}`;p={authorization:`Basic ${Buffer.from(h).toString("base64")}`}}else p=this.authAsHeaders(l);let u={...t.headers,...p,"Notion-Version":jt(this,zo,"f"),"user-agent":jt(this,Go,"f")};s!==void 0&&(u["content-type"]="application/json");let f;if(a){delete u["content-type"],f=new FormData;for(let[h,b]of Object.entries(a))typeof b=="string"?f.append(h,b):typeof b=="object"&&f.append(h,typeof b.data=="object"?b.data:new Blob([b.data]),b.filename)}try{let h=await Bo.RequestTimeoutError.rejectAfterTimeout(jt(this,Yo,"f").call(this,c.toString(),{method:r.toUpperCase(),headers:u,body:s!=null?s:f,agent:jt(this,Vo,"f")}),jt(this,Wo,"f")),b=await h.text();if(!h.ok)throw(0,Bo.buildRequestError)(h,b);let d=JSON.parse(b);return this.log(pn.LogLevel.INFO,"request success",{method:r,path:e,..."request_id"in d&&d.request_id?{requestId:d.request_id}:{}}),d}catch(h){throw(0,Bo.isNotionClientError)(h)&&(this.log(pn.LogLevel.WARN,"request fail",{code:h.code,message:h.message,..."request_id"in h&&h.request_id?{requestId:h.request_id}:{}}),(0,Bo.isHTTPResponseError)(h)&&this.log(pn.LogLevel.DEBUG,"failed response body",{body:h.body})),h}}log(t,e,r){(0,pn.logLevelSeverity)(t)>=(0,pn.logLevelSeverity)(jt(this,Uo,"f"))&&jt(this,qo,"f").call(this,t,e,r)}authAsHeaders(t){let e={},r=t!=null?t:jt(this,jo,"f");return r!==void 0&&(e.authorization=`Bearer ${r}`),e}};jo=new WeakMap,Uo=new WeakMap,qo=new WeakMap,Ho=new WeakMap,Wo=new WeakMap,zo=new WeakMap,Yo=new WeakMap,Vo=new WeakMap,Go=new WeakMap;Zo.defaultNotionVersion="2025-09-03";Mn.default=Zo});var uh=G(xe=>{"use strict";Object.defineProperty(xe,"__esModule",{value:!0});xe.iteratePaginatedAPI=sh;xe.collectPaginatedAPI=tx;xe.iterateDataSourceTemplates=lh;xe.collectDataSourceTemplates=nx;xe.isFullBlock=rx;xe.isFullPage=ch;xe.isFullDataSource=ph;xe.isFullDatabase=ix;xe.isFullPageOrDataSource=ox;xe.isFullUser=ax;xe.isFullComment=sx;xe.isTextRichTextItemResponse=lx;xe.isEquationRichTextItemResponse=cx;xe.isMentionRichTextItemResponse=px;xe.extractNotionId=Al;xe.extractDatabaseId=ux;xe.extractPageId=dx;xe.extractBlockId=fx;async function*sh(n,t){let e=t.start_cursor;do{let r=await n({...t,start_cursor:e});yield*r.results,e=r.next_cursor}while(e)}async function tx(n,t){let e=[];for await(let r of sh(n,t))e.push(r);return e}async function*lh(n,t){let e=t.start_cursor;do{let r=await n.dataSources.listTemplates({...t,start_cursor:e});yield*r.templates,e=r.next_cursor}while(e)}async function nx(n,t){let e=[];for await(let r of lh(n,t))e.push(r);return e}function rx(n){return n.object==="block"&&"type"in n}function ch(n){return n.object==="page"&&"url"in n}function ph(n){return n.object==="data_source"}function ix(n){return n.object==="database"}function ox(n){return n.object==="data_source"?ph(n):ch(n)}function ax(n){return"type"in n}function sx(n){return"created_by"in n}function lx(n){return n.type==="text"}function cx(n){return n.type==="equation"}function px(n){return n.type==="mention"}function Al(n){if(!n||typeof n!="string")return null;let t=n.trim();if(/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i.test(t))return t.toLowerCase();if(/^[0-9a-f]{32}$/i.test(t))return si(t);let i=t.match(/\/[^/?#]*-([0-9a-f]{32})(?:[/?#]|$)/i);if(i&&i[1])return si(i[1]);let o=t.match(/[?&](?:p|page_id|database_id)=([0-9a-f]{32})/i);if(o&&o[1])return si(o[1]);let a=t.match(/([0-9a-f]{32})/i);return a&&a[1]?si(a[1]):null}function si(n){let t=n.toLowerCase();return`${t.slice(0,8)}-${t.slice(8,12)}-${t.slice(12,16)}-${t.slice(16,20)}-${t.slice(20,32)}`}function ux(n){return Al(n)}function dx(n){return Al(n)}function fx(n){if(!n||typeof n!="string")return null;let t=n.match(/#(?:block-)?([0-9a-f]{32})/i);return t&&t[1]?si(t[1]):null}});var dh=G(X=>{"use strict";Object.defineProperty(X,"__esModule",{value:!0});X.extractBlockId=X.extractPageId=X.extractDatabaseId=X.extractNotionId=X.isFullPageOrDataSource=X.isFullComment=X.isFullUser=X.isFullPage=X.isFullDatabase=X.isFullDataSource=X.isFullBlock=X.iterateDataSourceTemplates=X.collectDataSourceTemplates=X.iteratePaginatedAPI=X.collectPaginatedAPI=X.isNotionClientError=X.RequestTimeoutError=X.UnknownHTTPResponseError=X.APIResponseError=X.ClientErrorCode=X.APIErrorCode=X.LogLevel=X.Client=void 0;var mx=ah();Object.defineProperty(X,"Client",{enumerable:!0,get:function(){return mx.default}});var hx=_l();Object.defineProperty(X,"LogLevel",{enumerable:!0,get:function(){return hx.LogLevel}});var hr=kl();Object.defineProperty(X,"APIErrorCode",{enumerable:!0,get:function(){return hr.APIErrorCode}});Object.defineProperty(X,"ClientErrorCode",{enumerable:!0,get:function(){return hr.ClientErrorCode}});Object.defineProperty(X,"APIResponseError",{enumerable:!0,get:function(){return hr.APIResponseError}});Object.defineProperty(X,"UnknownHTTPResponseError",{enumerable:!0,get:function(){return hr.UnknownHTTPResponseError}});Object.defineProperty(X,"RequestTimeoutError",{enumerable:!0,get:function(){return hr.RequestTimeoutError}});Object.defineProperty(X,"isNotionClientError",{enumerable:!0,get:function(){return hr.isNotionClientError}});var Me=uh();Object.defineProperty(X,"collectPaginatedAPI",{enumerable:!0,get:function(){return Me.collectPaginatedAPI}});Object.defineProperty(X,"iteratePaginatedAPI",{enumerable:!0,get:function(){return Me.iteratePaginatedAPI}});Object.defineProperty(X,"collectDataSourceTemplates",{enumerable:!0,get:function(){return Me.collectDataSourceTemplates}});Object.defineProperty(X,"iterateDataSourceTemplates",{enumerable:!0,get:function(){return Me.iterateDataSourceTemplates}});Object.defineProperty(X,"isFullBlock",{enumerable:!0,get:function(){return Me.isFullBlock}});Object.defineProperty(X,"isFullDataSource",{enumerable:!0,get:function(){return Me.isFullDataSource}});Object.defineProperty(X,"isFullDatabase",{enumerable:!0,get:function(){return Me.isFullDatabase}});Object.defineProperty(X,"isFullPage",{enumerable:!0,get:function(){return Me.isFullPage}});Object.defineProperty(X,"isFullUser",{enumerable:!0,get:function(){return Me.isFullUser}});Object.defineProperty(X,"isFullComment",{enumerable:!0,get:function(){return Me.isFullComment}});Object.defineProperty(X,"isFullPageOrDataSource",{enumerable:!0,get:function(){return Me.isFullPageOrDataSource}});Object.defineProperty(X,"extractNotionId",{enumerable:!0,get:function(){return Me.extractNotionId}});Object.defineProperty(X,"extractDatabaseId",{enumerable:!0,get:function(){return Me.extractDatabaseId}});Object.defineProperty(X,"extractPageId",{enumerable:!0,get:function(){return Me.extractPageId}});Object.defineProperty(X,"extractBlockId",{enumerable:!0,get:function(){return Me.extractBlockId}})});var E1={};je(E1,{ATTACHMENT_EXTS:()=>ur,AUTH_REDIRECT_URI:()=>sa,ImportContext:()=>ha,ImporterModal:()=>mi,default:()=>ga});module.exports=Lh(E1);var fn=require("obsidian");var Et=require("obsidian");var Ut=class{constructor(t){this.importer=t,this.app=t.app}};var wr=class extends Ut{constructor(t,e){super(t),this.scan=e.mergableDataObject,this.objects=this.scan.mergeableDataObjectData.mergeableDataObjectEntry}async format(t,e){let r=[];for(let i of this.objects){if(!i.customMap)continue;let o=i.customMap.mapEntry[0].value.stringValue,a=await this.importer.database.get`
				SELECT z_pk, zmedia, ztypeuti FROM ziccloudsyncingobject 
				WHERE zidentifier = ${o}`,l=await this.importer.resolveAttachment(a.Z_PK,"com.apple.notes.gallery");if(l||(l=await this.importer.resolveAttachment(a.ZMEDIA,a.ZTYPEUTI)),l)r.push(this.importer.app.fileManager.generateMarkdownLink(l,e));else return"**Cannot decode scan**"}return`
${r.join(`
`)}
`}};wr.protobufType="ciofecaforensics.MergableDataProto";var xr=class extends Ut{constructor(e,r){super(e);this.rowLocations={};this.columnLocations={};this.table=r.mergableDataObject;let i=this.table.mergeableDataObjectData;this.keys=i.mergeableDataObjectKeyItem,this.types=i.mergeableDataObjectTypeItem,this.uuids=i.mergeableDataObjectUuidItem.map(this.uuidToString),this.objects=i.mergeableDataObjectEntry}async parse(){let e=this.objects.find(i=>i.customMap&&this.types[i.customMap.type]=="com.apple.notes.ICTable");if(!e)return null;let r=null;for(let i of e.customMap.mapEntry){let o=this.objects[i.value.objectIndex];switch(this.keys[i.key]){case"crRows":[this.rowLocations,this.rowCount]=this.findLocations(o);break;case"crColumns":[this.columnLocations,this.columnCount]=this.findLocations(o);break;case"cellColumns":r=o;break}}return r?await this.computeCells(r):null}findLocations(e){let r=[],i={};for(let o of e.orderedSet.ordering.array.attachment)r.push(this.uuidToString(o.uuid));for(let o of e.orderedSet.ordering.contents.element){let a=this.getTargetUuid(o.key),l=this.getTargetUuid(o.value);i[l]=r.indexOf(a)}return[i,r.length]}async computeCells(e){let r=Array(this.rowCount).fill(0).map(()=>Array(this.columnCount));for(let i of e.dictionary.element){let o=this.columnLocations[this.getTargetUuid(i.key)],a=this.objects[i.value.objectIndex];for(let l of a.dictionary.element){let s=this.rowLocations[this.getTargetUuid(l.key)],c=this.objects[l.value.objectIndex];if(!(s in r)||!c)continue;let p=new gn(this.importer,c);r[s][o]=await p.format(!0)}}return r}async format(){let e=await this.parse();if(!e)return"";let r=`
`;for(let i=0;i<e.length;i++)r+=`| ${e[i].join(" | ")} |
`,i==0&&(r+=`|${" -- |".repeat(e[0].length)}
`);return r+`
`}getTargetUuid(e){let i=this.objects[e.objectIndex].customMap.mapEntry[0].value.unsignedIntegerValue;return this.uuids[i]}uuidToString(e){return Buffer.from(e).toString("hex")}};xr.protobufType="ciofecaforensics.MergableDataProto";var $h=/(^\s+|(?:\s+)?\n(?:\s+)?|\s+$)/,ba=/applenotes:note\/([-0-9a-f]+)(?:\?ownerIdentifier=.*)?/,Mh=".AppleColorEmojiUI",$l=[100,101,102,103],gn=class extends Ut{constructor(e,r){super(e);this.listNumber=0;this.listIndent=0;this.multiRun=0;this.note=r.note}parseTokens(){let e=0,r=0,i=0,o=[];for(;e<this.note.attributeRun.length;){let a,l="",s=!0;do a=this.note.attributeRun[e],i=i+a.length,l+=this.note.noteText.substring(r,i),r=i,s=e==this.note.attributeRun.length-1?!1:Ml(a,this.note.attributeRun[e+1]),e++;while(s);for(let c of l.split($h))c&&o.push({attr:a,fragment:c})}return o}async format(e=!1,r=""){var l;let i=this.parseTokens(),o=!e&&this.importer.omitFirstLine&&this.note.noteText.contains(`
`),a="";for(let s=0;s<i.length;s++){let{attr:c,fragment:p}=i[s];if(o)if(p.contains(`
`)||c.attachmentInfo)o=!1;else continue;c.fragment=p,c.atLineStart=s==0?!0:(l=i[s-1])==null?void 0:l.fragment.contains(`
`),a+=this.formatMultiRun(c),!/\S/.test(c.fragment)||this.multiRun==1?a+=c.fragment:c.attachmentInfo?a+=await this.formatAttachment(c,r):c.superscript||c.underlined||c.color||c.font||this.multiRun==2?a+=await this.formatHtmlAttr(c):a+=await this.formatAttr(c)}return this.multiRun!=0&&(a+=this.formatMultiRun({})),e&&a.replace(`
`,"<br>").replace("|","&#124;"),a.trim()}formatMultiRun(e){var o,a,l,s,c,p;let r=(o=e.paragraphStyle)==null?void 0:o.styleType,i="";switch(this.multiRun){case 3:(((a=e.paragraphStyle)==null?void 0:a.indentAmount)==0&&!$l.includes(r)||Bh(e))&&(this.multiRun=0);break;case 1:r!=4&&(this.multiRun=0,i+="```\n");break;case 2:(l=e.paragraphStyle)!=null&&l.alignment||(this.multiRun=0,i+=`</p>
`);break}if(this.multiRun==0){if(r==4)this.multiRun=1,i+="\n```\n";else if($l.includes(r))this.multiRun=3,(s=e.paragraphStyle)!=null&&s.indentAmount&&(i+=`
- &nbsp;
`);else if((c=e.paragraphStyle)!=null&&c.alignment){this.multiRun=2;let u=this.convertAlign((p=e==null?void 0:e.paragraphStyle)==null?void 0:p.alignment);i+=`
<p style="text-align:${u};margin:0">`}}return i}async formatHtmlAttr(e){var i,o;e.strikethrough&&(e.fragment=`<s>${e.fragment}</s>`),e.underlined&&(e.fragment=`<u>${e.fragment}</u>`),e.superscript==1&&(e.fragment=`<sup>${e.fragment}</sup>`),e.superscript==-1&&(e.fragment=`<sub>${e.fragment}</sub>`);let r="";switch(e.fontWeight){case 1:e.fragment=`<b>${e.fragment}</b>`;break;case 2:e.fragment=`<i>${e.fragment}</i>`;break;case 3:e.fragment=`<b><i>${e.fragment}</i></b>`;break}return(i=e.font)!=null&&i.fontName&&e.font.fontName!==Mh&&(r+=`font-family:${e.font.fontName};`),(o=e.font)!=null&&o.pointSize&&(r+=`font-size:${e.font.pointSize}pt;`),e.color&&(r+=`color:${this.convertColor(e.color)};`),e.link&&!ba.test(e.link)?(r&&(r=` style="${r}"`),e.fragment=`<a href="${e.link}" rel="noopener" class="external-link" target="_blank"${r}>${e.fragment}</a>`):r&&(e.link&&(e.fragment=await this.getInternalLink(e.link,e.fragment)),e.fragment=`<span style="${r}">${e.fragment}</span>`),e.atLineStart?this.formatParagraph(e):e.fragment}async formatAttr(e){switch(e.fontWeight){case 1:e.fragment=`**${e.fragment}**`;break;case 2:e.fragment=`*${e.fragment}*`;break;case 3:e.fragment=`***${e.fragment}***`;break}return e.strikethrough&&(e.fragment=`~~${e.fragment}~~`),e.link&&e.link!=e.fragment&&(ba.test(e.link)?e.fragment=await this.getInternalLink(e.link,e.fragment):e.fragment=`[${e.fragment}](${e.link})`),e.atLineStart?this.formatParagraph(e):e.fragment}formatParagraph(e){var a,l,s,c,p,u;let r="	".repeat(((a=e.paragraphStyle)==null?void 0:a.indentAmount)||0),i=(l=e.paragraphStyle)==null?void 0:l.styleType,o=(s=e.paragraphStyle)!=null&&s.blockquote?"> ":"";switch(this.listNumber!=0&&(i!==102||this.listIndent!==((c=e.paragraphStyle)==null?void 0:c.indentAmount))&&(this.listIndent=((p=e.paragraphStyle)==null?void 0:p.indentAmount)||0,this.listNumber=0),i){case 0:return`${o}# ${e.fragment}`;case 1:return`${o}## ${e.fragment}`;case 2:return`${o}### ${e.fragment}`;case 101:case 100:return`${o}${r}- ${e.fragment}`;case 102:return this.listNumber++,`${o}${r}${this.listNumber}. ${e.fragment}`;case 103:let f=(u=e.paragraphStyle.checklist)!=null&&u.done?"[x]":"[ ]";return`${o}${r}- ${f} ${e.fragment}`}return this.multiRun==3&&(o+=r),`${o}${e.fragment}`}async formatAttachment(e,r){var c,p,u;let i,o,a;switch((c=e.attachmentInfo)==null?void 0:c.typeUti){case"com.apple.notes.inlinetextattachment.hashtag":case"com.apple.notes.inlinetextattachment.mention":return i=await this.importer.database.get`
					SELECT zalttext FROM ziccloudsyncingobject 
					WHERE zidentifier = ${e.attachmentInfo.attachmentIdentifier}`,i.ZALTTEXT;case"com.apple.notes.inlinetextattachment.link":return i=await this.importer.database.get`
					SELECT ztokencontentidentifier FROM ziccloudsyncingobject 
					WHERE zidentifier = ${e.attachmentInfo.attachmentIdentifier}`,await this.getInternalLink(i.ZTOKENCONTENTIDENTIFIER,void 0,r);case"com.apple.notes.table":return i=await this.importer.database.get`
					SELECT hex(zmergeabledata1) as zhexdata FROM ziccloudsyncingobject 
					WHERE zidentifier = ${e.attachmentInfo.attachmentIdentifier}`,a=this.importer.decodeData(i.zhexdata,xr),await a.format();case"public.url":return i=await this.importer.database.get`
					SELECT ztitle, zurlstring FROM ziccloudsyncingobject 
					WHERE zidentifier = ${e.attachmentInfo.attachmentIdentifier}`,`[**${i.ZTITLE}**](${i.ZURLSTRING})`;case"com.apple.notes.gallery":return i=await this.importer.database.get`
					SELECT hex(zmergeabledata1) as zhexdata FROM ziccloudsyncingobject 
					WHERE zidentifier = ${e.attachmentInfo.attachmentIdentifier}`,a=this.importer.decodeData(i.zhexdata,wr),await a.format(!1,r);case"com.apple.paper.doc.scan":case"com.apple.drawing":case"com.apple.drawing.2":case"com.apple.paper":i=await this.importer.database.get`
					SELECT z_pk, zhandwritingsummary 
					FROM (SELECT *, NULL AS zhandwritingsummary FROM ziccloudsyncingobject) 
					WHERE zidentifier = ${e.attachmentInfo.attachmentIdentifier}`,o=i==null?void 0:i.Z_PK;break;default:i=await this.importer.database.get`
					SELECT zmedia FROM ziccloudsyncingobject 
					WHERE zidentifier = ${(p=e.attachmentInfo)==null?void 0:p.attachmentIdentifier}`,o=i==null?void 0:i.ZMEDIA;break}if(!o)return` **(unknown attachment: ${(u=e.attachmentInfo)==null?void 0:u.typeUti})** `;let l=await this.importer.resolveAttachment(o,e.attachmentInfo.typeUti),s=l?`
${this.app.fileManager.generateMarkdownLink(l,r)}
`:" **(error reading attachment)**";return this.importer.includeHandwriting&&i.ZHANDWRITINGSUMMARY&&(s=`
> [!Handwriting]-
> ${i.ZHANDWRITINGSUMMARY.replace(`
`,`
> `)}${s}`),s}async getInternalLink(e,r=void 0,i=""){let o=e.match(ba)[1],a=await this.importer.database.get`
			SELECT z_pk FROM ziccloudsyncingobject 
			WHERE zidentifier = ${o.toUpperCase()}`,l=await this.importer.resolveNote(a.Z_PK);return l?this.app.fileManager.generateMarkdownLink(l,i,void 0,r):"(unknown file link)"}convertColor(e){let r="#";for(let i of Object.values(e))r+=Math.floor(i*255).toString(16);return r}convertAlign(e){switch(e){default:return"left";case 1:return"center";case 2:return"right";case 3:return"justify"}}};gn.protobufType="ciofecaforensics.Document";function Bh(n){return n.attachmentInfo?!n.attachmentInfo.typeUti.includes("com.apple.notes.inlinetextattachment"):!1}function Ml(n,t){var e,r;if(!t||n.$type!=t.$type)return!1;for(let i of n.$type.fieldsArray)if(i.name!="length"){if((e=n[i.name])!=null&&e.$type&&((r=t[i.name])!=null&&r.$type)){if(!Ml(n[i.name],t[i.name]))return!1}else if(n[i.name]!=t[i.name])return!1}return!0}var Bl={nested:{ciofecaforensics:{nested:{Color:{fields:{red:{type:"float",id:1},green:{type:"float",id:2},blue:{type:"float",id:3},alpha:{type:"float",id:4}}},AttachmentInfo:{fields:{attachmentIdentifier:{type:"string",id:1},typeUti:{type:"string",id:2}}},Font:{fields:{fontName:{type:"string",id:1},pointSize:{type:"float",id:2},fontHints:{type:"int32",id:3}}},ParagraphStyle:{fields:{styleType:{type:"int32",id:1,options:{default:-1}},alignment:{type:"int32",id:2},indentAmount:{type:"int32",id:4},checklist:{type:"Checklist",id:5},blockquote:{type:"int32",id:8}}},Checklist:{fields:{uuid:{type:"bytes",id:1},done:{type:"int32",id:2}}},DictionaryElement:{fields:{key:{type:"ObjectID",id:1},value:{type:"ObjectID",id:2}}},Dictionary:{fields:{element:{rule:"repeated",type:"DictionaryElement",id:1,options:{packed:!1}}}},ObjectID:{fields:{unsignedIntegerValue:{type:"uint64",id:2},stringValue:{type:"string",id:4},objectIndex:{type:"int32",id:6}}},RegisterLatest:{fields:{contents:{type:"ObjectID",id:2}}},MapEntry:{fields:{key:{type:"int32",id:1},value:{type:"ObjectID",id:2}}},AttributeRun:{fields:{length:{type:"int32",id:1},paragraphStyle:{type:"ParagraphStyle",id:2},font:{type:"Font",id:3},fontWeight:{type:"int32",id:5},underlined:{type:"int32",id:6},strikethrough:{type:"int32",id:7},superscript:{type:"int32",id:8},link:{type:"string",id:9},color:{type:"Color",id:10},attachmentInfo:{type:"AttachmentInfo",id:12}}},NoteStoreProto:{fields:{document:{type:"Document",id:2}}},Document:{fields:{version:{type:"int32",id:2},note:{type:"Note",id:3}}},Note:{fields:{noteText:{type:"string",id:2},attributeRun:{rule:"repeated",type:"AttributeRun",id:5,options:{packed:!1}}}},MergableDataProto:{fields:{mergableDataObject:{type:"MergableDataObject",id:2}}},MergableDataObject:{fields:{version:{type:"int32",id:2},mergeableDataObjectData:{type:"MergeableDataObjectData",id:3}}},MergeableDataObjectData:{fields:{mergeableDataObjectEntry:{rule:"repeated",type:"MergeableDataObjectEntry",id:3,options:{packed:!1}},mergeableDataObjectKeyItem:{rule:"repeated",type:"string",id:4},mergeableDataObjectTypeItem:{rule:"repeated",type:"string",id:5},mergeableDataObjectUuidItem:{rule:"repeated",type:"bytes",id:6}}},MergeableDataObjectEntry:{fields:{registerLatest:{type:"RegisterLatest",id:1},list:{type:"List",id:5},dictionary:{type:"Dictionary",id:6},unknownMessage:{type:"UnknownMergeableDataObjectEntryMessage",id:9},note:{type:"Note",id:10},customMap:{type:"MergeableDataObjectMap",id:13},orderedSet:{type:"OrderedSet",id:16}}},UnknownMergeableDataObjectEntryMessage:{fields:{unknownEntry:{type:"UnknownMergeableDataObjectEntryMessageEntry",id:1}}},UnknownMergeableDataObjectEntryMessageEntry:{fields:{unknownInt1:{type:"int32",id:1},unknownInt2:{type:"int64",id:2}}},MergeableDataObjectMap:{fields:{type:{type:"int32",id:1},mapEntry:{rule:"repeated",type:"MapEntry",id:3,options:{packed:!1}}}},OrderedSet:{fields:{ordering:{type:"OrderedSetOrdering",id:1},elements:{type:"Dictionary",id:2}}},OrderedSetOrdering:{fields:{array:{type:"OrderedSetOrderingArray",id:1},contents:{type:"Dictionary",id:2}}},OrderedSetOrderingArray:{fields:{contents:{type:"Note",id:1},attachment:{rule:"repeated",type:"OrderedSetOrderingArrayAttachment",id:2,options:{packed:!1}}}},OrderedSetOrderingArrayAttachment:{fields:{index:{type:"int32",id:1},uuid:{type:"bytes",id:2}}},List:{fields:{listEntry:{rule:"repeated",type:"ListEntry",id:1,options:{packed:!1}}}},ListEntry:{fields:{id:{type:"ObjectID",id:2},details:{type:"ListEntryDetails",id:3},additionalDetails:{type:"ListEntryDetails",id:4}}},ListEntryDetails:{fields:{listEntryDetailsKey:{type:"ListEntryDetailsKey",id:1},id:{type:"ObjectID",id:2}}},ListEntryDetailsKey:{fields:{listEntryDetailsTypeIndex:{type:"int32",id:1},listEntryDetailsKey:{type:"int32",id:2}}}}}}};var We=[0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535],oc=1440,jh=0,Uh=4,qh=9,Hh=5,Wh=[96,7,256,0,8,80,0,8,16,84,8,115,82,7,31,0,8,112,0,8,48,0,9,192,80,7,10,0,8,96,0,8,32,0,9,160,0,8,0,0,8,128,0,8,64,0,9,224,80,7,6,0,8,88,0,8,24,0,9,144,83,7,59,0,8,120,0,8,56,0,9,208,81,7,17,0,8,104,0,8,40,0,9,176,0,8,8,0,8,136,0,8,72,0,9,240,80,7,4,0,8,84,0,8,20,85,8,227,83,7,43,0,8,116,0,8,52,0,9,200,81,7,13,0,8,100,0,8,36,0,9,168,0,8,4,0,8,132,0,8,68,0,9,232,80,7,8,0,8,92,0,8,28,0,9,152,84,7,83,0,8,124,0,8,60,0,9,216,82,7,23,0,8,108,0,8,44,0,9,184,0,8,12,0,8,140,0,8,76,0,9,248,80,7,3,0,8,82,0,8,18,85,8,163,83,7,35,0,8,114,0,8,50,0,9,196,81,7,11,0,8,98,0,8,34,0,9,164,0,8,2,0,8,130,0,8,66,0,9,228,80,7,7,0,8,90,0,8,26,0,9,148,84,7,67,0,8,122,0,8,58,0,9,212,82,7,19,0,8,106,0,8,42,0,9,180,0,8,10,0,8,138,0,8,74,0,9,244,80,7,5,0,8,86,0,8,22,192,8,0,83,7,51,0,8,118,0,8,54,0,9,204,81,7,15,0,8,102,0,8,38,0,9,172,0,8,6,0,8,134,0,8,70,0,9,236,80,7,9,0,8,94,0,8,30,0,9,156,84,7,99,0,8,126,0,8,62,0,9,220,82,7,27,0,8,110,0,8,46,0,9,188,0,8,14,0,8,142,0,8,78,0,9,252,96,7,256,0,8,81,0,8,17,85,8,131,82,7,31,0,8,113,0,8,49,0,9,194,80,7,10,0,8,97,0,8,33,0,9,162,0,8,1,0,8,129,0,8,65,0,9,226,80,7,6,0,8,89,0,8,25,0,9,146,83,7,59,0,8,121,0,8,57,0,9,210,81,7,17,0,8,105,0,8,41,0,9,178,0,8,9,0,8,137,0,8,73,0,9,242,80,7,4,0,8,85,0,8,21,80,8,258,83,7,43,0,8,117,0,8,53,0,9,202,81,7,13,0,8,101,0,8,37,0,9,170,0,8,5,0,8,133,0,8,69,0,9,234,80,7,8,0,8,93,0,8,29,0,9,154,84,7,83,0,8,125,0,8,61,0,9,218,82,7,23,0,8,109,0,8,45,0,9,186,0,8,13,0,8,141,0,8,77,0,9,250,80,7,3,0,8,83,0,8,19,85,8,195,83,7,35,0,8,115,0,8,51,0,9,198,81,7,11,0,8,99,0,8,35,0,9,166,0,8,3,0,8,131,0,8,67,0,9,230,80,7,7,0,8,91,0,8,27,0,9,150,84,7,67,0,8,123,0,8,59,0,9,214,82,7,19,0,8,107,0,8,43,0,9,182,0,8,11,0,8,139,0,8,75,0,9,246,80,7,5,0,8,87,0,8,23,192,8,0,83,7,51,0,8,119,0,8,55,0,9,206,81,7,15,0,8,103,0,8,39,0,9,174,0,8,7,0,8,135,0,8,71,0,9,238,80,7,9,0,8,95,0,8,31,0,9,158,84,7,99,0,8,127,0,8,63,0,9,222,82,7,27,0,8,111,0,8,47,0,9,190,0,8,15,0,8,143,0,8,79,0,9,254,96,7,256,0,8,80,0,8,16,84,8,115,82,7,31,0,8,112,0,8,48,0,9,193,80,7,10,0,8,96,0,8,32,0,9,161,0,8,0,0,8,128,0,8,64,0,9,225,80,7,6,0,8,88,0,8,24,0,9,145,83,7,59,0,8,120,0,8,56,0,9,209,81,7,17,0,8,104,0,8,40,0,9,177,0,8,8,0,8,136,0,8,72,0,9,241,80,7,4,0,8,84,0,8,20,85,8,227,83,7,43,0,8,116,0,8,52,0,9,201,81,7,13,0,8,100,0,8,36,0,9,169,0,8,4,0,8,132,0,8,68,0,9,233,80,7,8,0,8,92,0,8,28,0,9,153,84,7,83,0,8,124,0,8,60,0,9,217,82,7,23,0,8,108,0,8,44,0,9,185,0,8,12,0,8,140,0,8,76,0,9,249,80,7,3,0,8,82,0,8,18,85,8,163,83,7,35,0,8,114,0,8,50,0,9,197,81,7,11,0,8,98,0,8,34,0,9,165,0,8,2,0,8,130,0,8,66,0,9,229,80,7,7,0,8,90,0,8,26,0,9,149,84,7,67,0,8,122,0,8,58,0,9,213,82,7,19,0,8,106,0,8,42,0,9,181,0,8,10,0,8,138,0,8,74,0,9,245,80,7,5,0,8,86,0,8,22,192,8,0,83,7,51,0,8,118,0,8,54,0,9,205,81,7,15,0,8,102,0,8,38,0,9,173,0,8,6,0,8,134,0,8,70,0,9,237,80,7,9,0,8,94,0,8,30,0,9,157,84,7,99,0,8,126,0,8,62,0,9,221,82,7,27,0,8,110,0,8,46,0,9,189,0,8,14,0,8,142,0,8,78,0,9,253,96,7,256,0,8,81,0,8,17,85,8,131,82,7,31,0,8,113,0,8,49,0,9,195,80,7,10,0,8,97,0,8,33,0,9,163,0,8,1,0,8,129,0,8,65,0,9,227,80,7,6,0,8,89,0,8,25,0,9,147,83,7,59,0,8,121,0,8,57,0,9,211,81,7,17,0,8,105,0,8,41,0,9,179,0,8,9,0,8,137,0,8,73,0,9,243,80,7,4,0,8,85,0,8,21,80,8,258,83,7,43,0,8,117,0,8,53,0,9,203,81,7,13,0,8,101,0,8,37,0,9,171,0,8,5,0,8,133,0,8,69,0,9,235,80,7,8,0,8,93,0,8,29,0,9,155,84,7,83,0,8,125,0,8,61,0,9,219,82,7,23,0,8,109,0,8,45,0,9,187,0,8,13,0,8,141,0,8,77,0,9,251,80,7,3,0,8,83,0,8,19,85,8,195,83,7,35,0,8,115,0,8,51,0,9,199,81,7,11,0,8,99,0,8,35,0,9,167,0,8,3,0,8,131,0,8,67,0,9,231,80,7,7,0,8,91,0,8,27,0,9,151,84,7,67,0,8,123,0,8,59,0,9,215,82,7,19,0,8,107,0,8,43,0,9,183,0,8,11,0,8,139,0,8,75,0,9,247,80,7,5,0,8,87,0,8,23,192,8,0,83,7,51,0,8,119,0,8,55,0,9,207,81,7,15,0,8,103,0,8,39,0,9,175,0,8,7,0,8,135,0,8,71,0,9,239,80,7,9,0,8,95,0,8,31,0,9,159,84,7,99,0,8,127,0,8,63,0,9,223,82,7,27,0,8,111,0,8,47,0,9,191,0,8,15,0,8,143,0,8,79,0,9,255],zh=[80,5,1,87,5,257,83,5,17,91,5,4097,81,5,5,89,5,1025,85,5,65,93,5,16385,80,5,3,88,5,513,84,5,33,92,5,8193,82,5,9,90,5,2049,86,5,129,192,5,24577,80,5,2,87,5,385,83,5,25,91,5,6145,81,5,7,89,5,1537,85,5,97,93,5,24577,80,5,4,88,5,769,84,5,49,92,5,12289,82,5,13,90,5,3073,86,5,193,192,5,24577],Yh=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],Vh=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,112,112],Gh=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577],Zh=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],qt=15;function Ta(){let n=this,t,e,r,i,o,a;function l(c,p,u,f,h,b,d,m,y,T,k){let _,A,E,P,v,D,N,C,F,L,z,K,M,le,J;L=0,v=u;do r[c[p+L]]++,L++,v--;while(v!==0);if(r[0]==u)return d[0]=-1,m[0]=0,0;for(C=m[0],D=1;D<=qt&&r[D]===0;D++);for(N=D,C<D&&(C=D),v=qt;v!==0&&r[v]===0;v--);for(E=v,C>v&&(C=v),m[0]=C,le=1<<D;D<v;D++,le<<=1)if((le-=r[D])<0)return-3;if((le-=r[v])<0)return-3;for(r[v]+=le,a[1]=D=0,L=1,M=2;--v!==0;)a[M]=D+=r[L],M++,L++;v=0,L=0;do(D=c[p+L])!==0&&(k[a[D]++]=v),L++;while(++v<u);for(u=a[E],a[0]=v=0,L=0,P=-1,K=-C,o[0]=0,z=0,J=0;N<=E;N++)for(_=r[N];_--!==0;){for(;N>K+C;){if(P++,K+=C,J=E-K,J=J>C?C:J,(A=1<<(D=N-K))>_+1&&(A-=_+1,M=N,D<J))for(;++D<J&&!((A<<=1)<=r[++M]);)A-=r[M];if(J=1<<D,T[0]+J>oc)return-3;o[P]=z=T[0],T[0]+=J,P!==0?(a[P]=v,i[0]=D,i[1]=C,D=v>>>K-C,i[2]=z-o[P-1]-D,y.set(i,(o[P-1]+D)*3)):d[0]=z}for(i[1]=N-K,L>=u?i[0]=192:k[L]<f?(i[0]=k[L]<256?0:96,i[2]=k[L++]):(i[0]=b[k[L]-f]+16+64,i[2]=h[k[L++]-f]),A=1<<N-K,D=v>>>K;D<J;D+=A)y.set(i,(z+D)*3);for(D=1<<N-1;(v&D)!==0;D>>>=1)v^=D;for(v^=D,F=(1<<K)-1;(v&F)!=a[P];)P--,K-=C,F=(1<<K)-1}return le!==0&&E!=1?-5:0}function s(c){let p;for(t||(t=[],e=[],r=new Int32Array(qt+1),i=[],o=new Int32Array(qt),a=new Int32Array(qt+1)),e.length<c&&(e=[]),p=0;p<c;p++)e[p]=0;for(p=0;p<qt+1;p++)r[p]=0;for(p=0;p<3;p++)i[p]=0;o.set(r.subarray(0,qt),0),a.set(r.subarray(0,qt+1),0)}n.inflate_trees_bits=function(c,p,u,f,h){let b;return s(19),t[0]=0,b=l(c,0,19,19,null,null,u,p,f,t,e),b==-3?h.msg="oversubscribed dynamic bit lengths tree":(b==-5||p[0]===0)&&(h.msg="incomplete dynamic bit lengths tree",b=-3),b},n.inflate_trees_dynamic=function(c,p,u,f,h,b,d,m,y){let T;return s(288),t[0]=0,T=l(u,0,c,257,Yh,Vh,b,f,m,t,e),T!=0||f[0]===0?(T==-3?y.msg="oversubscribed literal/length tree":T!=-4&&(y.msg="incomplete literal/length tree",T=-3),T):(s(288),T=l(u,c,p,0,Gh,Zh,d,h,m,t,e),T!=0||h[0]===0&&c>257?(T==-3?y.msg="oversubscribed distance tree":T==-5?(y.msg="incomplete distance tree",T=-3):T!=-4&&(y.msg="empty distance tree with lengths",T=-3),T):0)}}Ta.inflate_trees_fixed=function(n,t,e,r){return n[0]=qh,t[0]=Hh,e[0]=Wh,r[0]=zh,0};var yi=0,jl=1,Ul=2,ql=3,Hl=4,Wl=5,zl=6,va=7,Yl=8,bi=9;function Kh(){let n=this,t,e=0,r,i=0,o=0,a=0,l=0,s=0,c=0,p=0,u,f=0,h,b=0;function d(m,y,T,k,_,A,E,P){let v,D,N,C,F,L,z,K,M,le,J,be,q,Be,Q,oe;z=P.next_in_index,K=P.avail_in,F=E.bitb,L=E.bitk,M=E.write,le=M<E.read?E.read-M-1:E.end-M,J=We[m],be=We[y];do{for(;L<20;)K--,F|=(P.read_byte(z++)&255)<<L,L+=8;if(v=F&J,D=T,N=k,oe=(N+v)*3,(C=D[oe])===0){F>>=D[oe+1],L-=D[oe+1],E.win[M++]=D[oe+2],le--;continue}do{if(F>>=D[oe+1],L-=D[oe+1],(C&16)!==0){for(C&=15,q=D[oe+2]+(F&We[C]),F>>=C,L-=C;L<15;)K--,F|=(P.read_byte(z++)&255)<<L,L+=8;v=F&be,D=_,N=A,oe=(N+v)*3,C=D[oe];do if(F>>=D[oe+1],L-=D[oe+1],(C&16)!==0){for(C&=15;L<C;)K--,F|=(P.read_byte(z++)&255)<<L,L+=8;if(Be=D[oe+2]+(F&We[C]),F>>=C,L-=C,le-=q,M>=Be)Q=M-Be,M-Q>0&&2>M-Q?(E.win[M++]=E.win[Q++],E.win[M++]=E.win[Q++],q-=2):(E.win.set(E.win.subarray(Q,Q+2),M),M+=2,Q+=2,q-=2);else{Q=M-Be;do Q+=E.end;while(Q<0);if(C=E.end-Q,q>C){if(q-=C,M-Q>0&&C>M-Q)do E.win[M++]=E.win[Q++];while(--C!==0);else E.win.set(E.win.subarray(Q,Q+C),M),M+=C,Q+=C,C=0;Q=0}}if(M-Q>0&&q>M-Q)do E.win[M++]=E.win[Q++];while(--q!==0);else E.win.set(E.win.subarray(Q,Q+q),M),M+=q,Q+=q,q=0;break}else if((C&64)===0)v+=D[oe+2],v+=F&We[C],oe=(N+v)*3,C=D[oe];else return P.msg="invalid distance code",q=P.avail_in-K,q=L>>3<q?L>>3:q,K+=q,z-=q,L-=q<<3,E.bitb=F,E.bitk=L,P.avail_in=K,P.total_in+=z-P.next_in_index,P.next_in_index=z,E.write=M,-3;while(!0);break}if((C&64)===0){if(v+=D[oe+2],v+=F&We[C],oe=(N+v)*3,(C=D[oe])===0){F>>=D[oe+1],L-=D[oe+1],E.win[M++]=D[oe+2],le--;break}}else return(C&32)!==0?(q=P.avail_in-K,q=L>>3<q?L>>3:q,K+=q,z-=q,L-=q<<3,E.bitb=F,E.bitk=L,P.avail_in=K,P.total_in+=z-P.next_in_index,P.next_in_index=z,E.write=M,1):(P.msg="invalid literal/length code",q=P.avail_in-K,q=L>>3<q?L>>3:q,K+=q,z-=q,L-=q<<3,E.bitb=F,E.bitk=L,P.avail_in=K,P.total_in+=z-P.next_in_index,P.next_in_index=z,E.write=M,-3)}while(!0)}while(le>=258&&K>=10);return q=P.avail_in-K,q=L>>3<q?L>>3:q,K+=q,z-=q,L-=q<<3,E.bitb=F,E.bitk=L,P.avail_in=K,P.total_in+=z-P.next_in_index,P.next_in_index=z,E.write=M,0}n.init=function(m,y,T,k,_,A){t=yi,c=m,p=y,u=T,f=k,h=_,b=A,r=null},n.proc=function(m,y,T){let k,_,A,E=0,P=0,v=0,D,N,C,F;for(v=y.next_in_index,D=y.avail_in,E=m.bitb,P=m.bitk,N=m.write,C=N<m.read?m.read-N-1:m.end-N;;)switch(t){case yi:if(C>=258&&D>=10&&(m.bitb=E,m.bitk=P,y.avail_in=D,y.total_in+=v-y.next_in_index,y.next_in_index=v,m.write=N,T=d(c,p,u,f,h,b,m,y),v=y.next_in_index,D=y.avail_in,E=m.bitb,P=m.bitk,N=m.write,C=N<m.read?m.read-N-1:m.end-N,T!=0)){t=T==1?va:bi;break}o=c,r=u,i=f,t=jl;case jl:for(k=o;P<k;){if(D!==0)T=0;else return m.bitb=E,m.bitk=P,y.avail_in=D,y.total_in+=v-y.next_in_index,y.next_in_index=v,m.write=N,m.inflate_flush(y,T);D--,E|=(y.read_byte(v++)&255)<<P,P+=8}if(_=(i+(E&We[k]))*3,E>>>=r[_+1],P-=r[_+1],A=r[_],A===0){a=r[_+2],t=zl;break}if((A&16)!==0){l=A&15,e=r[_+2],t=Ul;break}if((A&64)===0){o=A,i=_/3+r[_+2];break}if((A&32)!==0){t=va;break}return t=bi,y.msg="invalid literal/length code",T=-3,m.bitb=E,m.bitk=P,y.avail_in=D,y.total_in+=v-y.next_in_index,y.next_in_index=v,m.write=N,m.inflate_flush(y,T);case Ul:for(k=l;P<k;){if(D!==0)T=0;else return m.bitb=E,m.bitk=P,y.avail_in=D,y.total_in+=v-y.next_in_index,y.next_in_index=v,m.write=N,m.inflate_flush(y,T);D--,E|=(y.read_byte(v++)&255)<<P,P+=8}e+=E&We[k],E>>=k,P-=k,o=p,r=h,i=b,t=ql;case ql:for(k=o;P<k;){if(D!==0)T=0;else return m.bitb=E,m.bitk=P,y.avail_in=D,y.total_in+=v-y.next_in_index,y.next_in_index=v,m.write=N,m.inflate_flush(y,T);D--,E|=(y.read_byte(v++)&255)<<P,P+=8}if(_=(i+(E&We[k]))*3,E>>=r[_+1],P-=r[_+1],A=r[_],(A&16)!==0){l=A&15,s=r[_+2],t=Hl;break}if((A&64)===0){o=A,i=_/3+r[_+2];break}return t=bi,y.msg="invalid distance code",T=-3,m.bitb=E,m.bitk=P,y.avail_in=D,y.total_in+=v-y.next_in_index,y.next_in_index=v,m.write=N,m.inflate_flush(y,T);case Hl:for(k=l;P<k;){if(D!==0)T=0;else return m.bitb=E,m.bitk=P,y.avail_in=D,y.total_in+=v-y.next_in_index,y.next_in_index=v,m.write=N,m.inflate_flush(y,T);D--,E|=(y.read_byte(v++)&255)<<P,P+=8}s+=E&We[k],E>>=k,P-=k,t=Wl;case Wl:for(F=N-s;F<0;)F+=m.end;for(;e!==0;){if(C===0&&(N==m.end&&m.read!==0&&(N=0,C=N<m.read?m.read-N-1:m.end-N),C===0&&(m.write=N,T=m.inflate_flush(y,T),N=m.write,C=N<m.read?m.read-N-1:m.end-N,N==m.end&&m.read!==0&&(N=0,C=N<m.read?m.read-N-1:m.end-N),C===0)))return m.bitb=E,m.bitk=P,y.avail_in=D,y.total_in+=v-y.next_in_index,y.next_in_index=v,m.write=N,m.inflate_flush(y,T);m.win[N++]=m.win[F++],C--,F==m.end&&(F=0),e--}t=yi;break;case zl:if(C===0&&(N==m.end&&m.read!==0&&(N=0,C=N<m.read?m.read-N-1:m.end-N),C===0&&(m.write=N,T=m.inflate_flush(y,T),N=m.write,C=N<m.read?m.read-N-1:m.end-N,N==m.end&&m.read!==0&&(N=0,C=N<m.read?m.read-N-1:m.end-N),C===0)))return m.bitb=E,m.bitk=P,y.avail_in=D,y.total_in+=v-y.next_in_index,y.next_in_index=v,m.write=N,m.inflate_flush(y,T);T=0,m.win[N++]=a,C--,t=yi;break;case va:if(P>7&&(P-=8,D++,v--),m.write=N,T=m.inflate_flush(y,T),N=m.write,C=N<m.read?m.read-N-1:m.end-N,m.read!=m.write)return m.bitb=E,m.bitk=P,y.avail_in=D,y.total_in+=v-y.next_in_index,y.next_in_index=v,m.write=N,m.inflate_flush(y,T);t=Yl;case Yl:return T=1,m.bitb=E,m.bitk=P,y.avail_in=D,y.total_in+=v-y.next_in_index,y.next_in_index=v,m.write=N,m.inflate_flush(y,T);case bi:return T=-3,m.bitb=E,m.bitk=P,y.avail_in=D,y.total_in+=v-y.next_in_index,y.next_in_index=v,m.write=N,m.inflate_flush(y,T);default:return T=-2,m.bitb=E,m.bitk=P,y.avail_in=D,y.total_in+=v-y.next_in_index,y.next_in_index=v,m.write=N,m.inflate_flush(y,T)}},n.free=function(){}}var Vl=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],jn=0,wa=1,Gl=2,Zl=3,Kl=4,Xl=5,vi=6,wi=7,Jl=8,yn=9;function Xh(n,t){let e=this,r=jn,i=0,o=0,a=0,l,s=[0],c=[0],p=new Kh,u=0,f=new Int32Array(oc*3),h=0,b=new Ta;e.bitk=0,e.bitb=0,e.win=new Uint8Array(t),e.end=t,e.read=0,e.write=0,e.reset=function(d,m){m&&(m[0]=h),r==vi&&p.free(d),r=jn,e.bitk=0,e.bitb=0,e.read=e.write=0},e.reset(n,null),e.inflate_flush=function(d,m){let y,T,k;return T=d.next_out_index,k=e.read,y=(k<=e.write?e.write:e.end)-k,y>d.avail_out&&(y=d.avail_out),y!==0&&m==-5&&(m=0),d.avail_out-=y,d.total_out+=y,d.next_out.set(e.win.subarray(k,k+y),T),T+=y,k+=y,k==e.end&&(k=0,e.write==e.end&&(e.write=0),y=e.write-k,y>d.avail_out&&(y=d.avail_out),y!==0&&m==-5&&(m=0),d.avail_out-=y,d.total_out+=y,d.next_out.set(e.win.subarray(k,k+y),T),T+=y,k+=y),d.next_out_index=T,e.read=k,m},e.proc=function(d,m){let y,T,k,_,A,E,P,v;for(_=d.next_in_index,A=d.avail_in,T=e.bitb,k=e.bitk,E=e.write,P=E<e.read?e.read-E-1:e.end-E;;){let D,N,C,F,L,z,K,M;switch(r){case jn:for(;k<3;){if(A!==0)m=0;else return e.bitb=T,e.bitk=k,d.avail_in=A,d.total_in+=_-d.next_in_index,d.next_in_index=_,e.write=E,e.inflate_flush(d,m);A--,T|=(d.read_byte(_++)&255)<<k,k+=8}switch(y=T&7,u=y&1,y>>>1){case 0:T>>>=3,k-=3,y=k&7,T>>>=y,k-=y,r=wa;break;case 1:D=[],N=[],C=[[]],F=[[]],Ta.inflate_trees_fixed(D,N,C,F),p.init(D[0],N[0],C[0],0,F[0],0),T>>>=3,k-=3,r=vi;break;case 2:T>>>=3,k-=3,r=Zl;break;case 3:return T>>>=3,k-=3,r=yn,d.msg="invalid block type",m=-3,e.bitb=T,e.bitk=k,d.avail_in=A,d.total_in+=_-d.next_in_index,d.next_in_index=_,e.write=E,e.inflate_flush(d,m)}break;case wa:for(;k<32;){if(A!==0)m=0;else return e.bitb=T,e.bitk=k,d.avail_in=A,d.total_in+=_-d.next_in_index,d.next_in_index=_,e.write=E,e.inflate_flush(d,m);A--,T|=(d.read_byte(_++)&255)<<k,k+=8}if((~T>>>16&65535)!=(T&65535))return r=yn,d.msg="invalid stored block lengths",m=-3,e.bitb=T,e.bitk=k,d.avail_in=A,d.total_in+=_-d.next_in_index,d.next_in_index=_,e.write=E,e.inflate_flush(d,m);i=T&65535,T=k=0,r=i!==0?Gl:u!==0?wi:jn;break;case Gl:if(A===0||P===0&&(E==e.end&&e.read!==0&&(E=0,P=E<e.read?e.read-E-1:e.end-E),P===0&&(e.write=E,m=e.inflate_flush(d,m),E=e.write,P=E<e.read?e.read-E-1:e.end-E,E==e.end&&e.read!==0&&(E=0,P=E<e.read?e.read-E-1:e.end-E),P===0)))return e.bitb=T,e.bitk=k,d.avail_in=A,d.total_in+=_-d.next_in_index,d.next_in_index=_,e.write=E,e.inflate_flush(d,m);if(m=0,y=i,y>A&&(y=A),y>P&&(y=P),e.win.set(d.read_buf(_,y),E),_+=y,A-=y,E+=y,P-=y,(i-=y)!==0)break;r=u!==0?wi:jn;break;case Zl:for(;k<14;){if(A!==0)m=0;else return e.bitb=T,e.bitk=k,d.avail_in=A,d.total_in+=_-d.next_in_index,d.next_in_index=_,e.write=E,e.inflate_flush(d,m);A--,T|=(d.read_byte(_++)&255)<<k,k+=8}if(o=y=T&16383,(y&31)>29||(y>>5&31)>29)return r=yn,d.msg="too many length or distance symbols",m=-3,e.bitb=T,e.bitk=k,d.avail_in=A,d.total_in+=_-d.next_in_index,d.next_in_index=_,e.write=E,e.inflate_flush(d,m);if(y=258+(y&31)+(y>>5&31),!l||l.length<y)l=[];else for(v=0;v<y;v++)l[v]=0;T>>>=14,k-=14,a=0,r=Kl;case Kl:for(;a<4+(o>>>10);){for(;k<3;){if(A!==0)m=0;else return e.bitb=T,e.bitk=k,d.avail_in=A,d.total_in+=_-d.next_in_index,d.next_in_index=_,e.write=E,e.inflate_flush(d,m);A--,T|=(d.read_byte(_++)&255)<<k,k+=8}l[Vl[a++]]=T&7,T>>>=3,k-=3}for(;a<19;)l[Vl[a++]]=0;if(s[0]=7,y=b.inflate_trees_bits(l,s,c,f,d),y!=0)return m=y,m==-3&&(l=null,r=yn),e.bitb=T,e.bitk=k,d.avail_in=A,d.total_in+=_-d.next_in_index,d.next_in_index=_,e.write=E,e.inflate_flush(d,m);a=0,r=Xl;case Xl:for(;y=o,!(a>=258+(y&31)+(y>>5&31));){let le,J;for(y=s[0];k<y;){if(A!==0)m=0;else return e.bitb=T,e.bitk=k,d.avail_in=A,d.total_in+=_-d.next_in_index,d.next_in_index=_,e.write=E,e.inflate_flush(d,m);A--,T|=(d.read_byte(_++)&255)<<k,k+=8}if(y=f[(c[0]+(T&We[y]))*3+1],J=f[(c[0]+(T&We[y]))*3+2],J<16)T>>>=y,k-=y,l[a++]=J;else{for(v=J==18?7:J-14,le=J==18?11:3;k<y+v;){if(A!==0)m=0;else return e.bitb=T,e.bitk=k,d.avail_in=A,d.total_in+=_-d.next_in_index,d.next_in_index=_,e.write=E,e.inflate_flush(d,m);A--,T|=(d.read_byte(_++)&255)<<k,k+=8}if(T>>>=y,k-=y,le+=T&We[v],T>>>=v,k-=v,v=a,y=o,v+le>258+(y&31)+(y>>5&31)||J==16&&v<1)return l=null,r=yn,d.msg="invalid bit length repeat",m=-3,e.bitb=T,e.bitk=k,d.avail_in=A,d.total_in+=_-d.next_in_index,d.next_in_index=_,e.write=E,e.inflate_flush(d,m);J=J==16?l[v-1]:0;do l[v++]=J;while(--le!==0);a=v}}if(c[0]=-1,L=[],z=[],K=[],M=[],L[0]=9,z[0]=6,y=o,y=b.inflate_trees_dynamic(257+(y&31),1+(y>>5&31),l,L,z,K,M,f,d),y!=0)return y==-3&&(l=null,r=yn),m=y,e.bitb=T,e.bitk=k,d.avail_in=A,d.total_in+=_-d.next_in_index,d.next_in_index=_,e.write=E,e.inflate_flush(d,m);p.init(L[0],z[0],f,K[0],f,M[0]),r=vi;case vi:if(e.bitb=T,e.bitk=k,d.avail_in=A,d.total_in+=_-d.next_in_index,d.next_in_index=_,e.write=E,(m=p.proc(e,d,m))!=1)return e.inflate_flush(d,m);if(m=0,p.free(d),_=d.next_in_index,A=d.avail_in,T=e.bitb,k=e.bitk,E=e.write,P=E<e.read?e.read-E-1:e.end-E,u===0){r=jn;break}r=wi;case wi:if(e.write=E,m=e.inflate_flush(d,m),E=e.write,P=E<e.read?e.read-E-1:e.end-E,e.read!=e.write)return e.bitb=T,e.bitk=k,d.avail_in=A,d.total_in+=_-d.next_in_index,d.next_in_index=_,e.write=E,e.inflate_flush(d,m);r=Jl;case Jl:return m=1,e.bitb=T,e.bitk=k,d.avail_in=A,d.total_in+=_-d.next_in_index,d.next_in_index=_,e.write=E,e.inflate_flush(d,m);case yn:return m=-3,e.bitb=T,e.bitk=k,d.avail_in=A,d.total_in+=_-d.next_in_index,d.next_in_index=_,e.write=E,e.inflate_flush(d,m);default:return m=-2,e.bitb=T,e.bitk=k,d.avail_in=A,d.total_in+=_-d.next_in_index,d.next_in_index=_,e.write=E,e.inflate_flush(d,m)}}},e.free=function(d){e.reset(d,null),e.win=null,f=null},e.set_dictionary=function(d,m,y){e.win.set(d.subarray(m,m+y),0),e.read=e.write=y},e.sync_point=function(){return r==wa?1:0}}var Jh=32,Qh=8,eg=0,Ql=1,ec=2,tc=3,nc=4,rc=5,xa=6,Tr=7,ic=12,Ht=13,tg=[0,0,255,255];function ng(){let n=this;n.mode=0,n.method=0,n.was=[0],n.need=0,n.marker=0,n.wbits=0;function t(e){return!e||!e.istate?-2:(e.total_in=e.total_out=0,e.msg=null,e.istate.mode=Tr,e.istate.blocks.reset(e,null),0)}n.inflateEnd=function(e){return n.blocks&&n.blocks.free(e),n.blocks=null,0},n.inflateInit=function(e,r){return e.msg=null,n.blocks=null,r<8||r>15?(n.inflateEnd(e),-2):(n.wbits=r,e.istate.blocks=new Xh(e,1<<r),t(e),0)},n.inflate=function(e,r){let i,o;if(!e||!e.istate||!e.next_in)return-2;let a=e.istate;for(r=r==Uh?-5:0,i=-5;;)switch(a.mode){case eg:if(e.avail_in===0)return i;if(i=r,e.avail_in--,e.total_in++,((a.method=e.read_byte(e.next_in_index++))&15)!=Qh){a.mode=Ht,e.msg="unknown compression method",a.marker=5;break}if((a.method>>4)+8>a.wbits){a.mode=Ht,e.msg="invalid win size",a.marker=5;break}a.mode=Ql;case Ql:if(e.avail_in===0)return i;if(i=r,e.avail_in--,e.total_in++,o=e.read_byte(e.next_in_index++)&255,((a.method<<8)+o)%31!==0){a.mode=Ht,e.msg="incorrect header check",a.marker=5;break}if((o&Jh)===0){a.mode=Tr;break}a.mode=ec;case ec:if(e.avail_in===0)return i;i=r,e.avail_in--,e.total_in++,a.need=(e.read_byte(e.next_in_index++)&255)<<24&4278190080,a.mode=tc;case tc:if(e.avail_in===0)return i;i=r,e.avail_in--,e.total_in++,a.need+=(e.read_byte(e.next_in_index++)&255)<<16&16711680,a.mode=nc;case nc:if(e.avail_in===0)return i;i=r,e.avail_in--,e.total_in++,a.need+=(e.read_byte(e.next_in_index++)&255)<<8&65280,a.mode=rc;case rc:return e.avail_in===0?i:(i=r,e.avail_in--,e.total_in++,a.need+=e.read_byte(e.next_in_index++)&255,a.mode=xa,2);case xa:return a.mode=Ht,e.msg="need dictionary",a.marker=0,-2;case Tr:if(i=a.blocks.proc(e,i),i==-3){a.mode=Ht,a.marker=0;break}if(i==0&&(i=r),i!=1)return i;i=r,a.blocks.reset(e,a.was),a.mode=ic;case ic:return e.avail_in=0,1;case Ht:return-3;default:return-2}},n.inflateSetDictionary=function(e,r,i){let o=0,a=i;if(!e||!e.istate||e.istate.mode!=xa)return-2;let l=e.istate;return a>=1<<l.wbits&&(a=(1<<l.wbits)-1,o=i-a),l.blocks.set_dictionary(r,o,a),l.mode=Tr,0},n.inflateSync=function(e){let r,i,o,a,l;if(!e||!e.istate)return-2;let s=e.istate;if(s.mode!=Ht&&(s.mode=Ht,s.marker=0),(r=e.avail_in)===0)return-5;for(i=e.next_in_index,o=s.marker;r!==0&&o<4;)e.read_byte(i)==tg[o]?o++:e.read_byte(i)!==0?o=0:o=4-o,i++,r--;return e.total_in+=i-e.next_in_index,e.next_in_index=i,e.avail_in=r,s.marker=o,o!=4?-3:(a=e.total_in,l=e.total_out,t(e),e.total_in=a,e.total_out=l,s.mode=Tr,0)},n.inflateSyncPoint=function(e){return!e||!e.istate||!e.istate.blocks?-2:e.istate.blocks.sync_point()}}function ac(){}ac.prototype={inflateInit(n){let t=this;return t.istate=new ng,n||(n=15),t.istate.inflateInit(t,n)},inflate(n){let t=this;return t.istate?t.istate.inflate(t,n):-2},inflateEnd(){let n=this;if(!n.istate)return-2;let t=n.istate.inflateEnd(n);return n.istate=null,t},inflateSync(){let n=this;return n.istate?n.istate.inflateSync(n):-2},inflateSetDictionary(n,t){let e=this;return e.istate?e.istate.inflateSetDictionary(e,n,t):-2},read_byte(n){return this.next_in[n]},read_buf(n,t){return this.next_in.subarray(n,n+t)}};function sc(n){let t=this,e=new ac,r=n&&n.chunkSize?Math.floor(n.chunkSize*2):128*1024,i=jh,o=new Uint8Array(r),a=!1;e.inflateInit(),e.next_out=o,t.append=function(l,s){let c=[],p,u,f=0,h=0,b=0;if(l.length!==0){e.next_in_index=0,e.next_in=l,e.avail_in=l.length;do{if(e.next_out_index=0,e.avail_out=r,e.avail_in===0&&!a&&(e.next_in_index=0,a=!0),p=e.inflate(i),a&&p===-5){if(e.avail_in!==0)throw new Error("inflating: bad input")}else if(p!==0&&p!==1)throw new Error("inflating: "+e.msg);if((a||p===1)&&e.avail_in===l.length)throw new Error("inflating: bad input");e.next_out_index&&(e.next_out_index===r?c.push(new Uint8Array(o)):c.push(o.subarray(0,e.next_out_index))),b+=e.next_out_index,s&&e.next_in_index>0&&e.next_in_index!=f&&(s(e.next_in_index),f=e.next_in_index)}while(e.avail_in>0||e.avail_out===0);return c.length>1?(u=new Uint8Array(b),c.forEach(function(d){u.set(d,h),h+=d.length})):u=c[0]?new Uint8Array(c[0]):new Uint8Array,u}},t.flush=function(){e.inflateEnd()}}var _a="/",iT=new Date(2107,11,31),oT=new Date(1980,0,1),me=void 0,ze="undefined",Pt="function";var _r=class{constructor(t){return class extends TransformStream{constructor(e,r){let i=new t(r);super({transform(o,a){a.enqueue(i.append(o))},flush(o){let a=i.flush();a&&o.enqueue(a)}})}}}};var rg=64,lc=2;try{typeof navigator!=ze&&navigator.hardwareConcurrency&&(lc=navigator.hardwareConcurrency)}catch(n){}var ig={chunkSize:512*1024,maxWorkers:lc,terminateWorkerTimeout:5e3,useWebWorkers:!0,useCompressionStream:!0,workerScripts:me,CompressionStreamNative:typeof CompressionStream!=ze&&CompressionStream,DecompressionStreamNative:typeof DecompressionStream!=ze&&DecompressionStream},zt=Object.assign({},ig);function Ea(){return zt}function cc(n){return Math.max(n.chunkSize,rg)}function xi(n){let{baseURL:t,chunkSize:e,maxWorkers:r,terminateWorkerTimeout:i,useCompressionStream:o,useWebWorkers:a,Deflate:l,Inflate:s,CompressionStream:c,DecompressionStream:p,workerScripts:u}=n;if(Wt("baseURL",t),Wt("chunkSize",e),Wt("maxWorkers",r),Wt("terminateWorkerTimeout",i),Wt("useCompressionStream",o),Wt("useWebWorkers",a),l&&(zt.CompressionStream=new _r(l)),s&&(zt.DecompressionStream=new _r(s)),Wt("CompressionStream",c),Wt("DecompressionStream",p),u!==me){let{deflate:f,inflate:h}=u;if((f||h)&&(zt.workerScripts||(zt.workerScripts={})),f){if(!Array.isArray(f))throw new Error("workerScripts.deflate must be an array");zt.workerScripts.deflate=f}if(h){if(!Array.isArray(h))throw new Error("workerScripts.inflate must be an array");zt.workerScripts.inflate=h}}}function Wt(n,t){t!==me&&(zt[n]=t)}var pc=[];for(let n=0;n<256;n++){let t=n;for(let e=0;e<8;e++)t&1?t=t>>>1^3988292384:t=t>>>1;pc[n]=t}var Ct=class{constructor(t){this.crc=t||-1}append(t){let e=this.crc|0;for(let r=0,i=t.length|0;r<i;r++)e=e>>>8^pc[(e^t[r])&255];this.crc=e}get(){return~this.crc}};var Er=class extends TransformStream{constructor(){let t,e=new Ct;super({transform(r,i){e.append(r),i.enqueue(r)},flush(){let r=new Uint8Array(4);new DataView(r.buffer).setUint32(0,e.get()),t.value=r}}),t=this}};function uc(n){if(typeof TextEncoder==ze){n=unescape(encodeURIComponent(n));let t=new Uint8Array(n.length);for(let e=0;e<t.length;e++)t[e]=n.charCodeAt(e);return t}else return new TextEncoder().encode(n)}var Ie={concat(n,t){if(n.length===0||t.length===0)return n.concat(t);let e=n[n.length-1],r=Ie.getPartial(e);return r===32?n.concat(t):Ie._shiftRight(t,r,e|0,n.slice(0,n.length-1))},bitLength(n){let t=n.length;if(t===0)return 0;let e=n[t-1];return(t-1)*32+Ie.getPartial(e)},clamp(n,t){if(n.length*32<t)return n;n=n.slice(0,Math.ceil(t/32));let e=n.length;return t=t&31,e>0&&t&&(n[e-1]=Ie.partial(t,n[e-1]&2147483648>>t-1,1)),n},partial(n,t,e){return n===32?t:(e?t|0:t<<32-n)+n*1099511627776},getPartial(n){return Math.round(n/1099511627776)||32},_shiftRight(n,t,e,r){for(r===void 0&&(r=[]);t>=32;t-=32)r.push(e),e=0;if(t===0)return r.concat(n);for(let a=0;a<n.length;a++)r.push(e|n[a]>>>t),e=n[a]<<32-t;let i=n.length?n[n.length-1]:0,o=Ie.getPartial(i);return r.push(Ie.partial(t+o&31,t+o>32?e:r.pop(),1)),r}},kr={bytes:{fromBits(n){let e=Ie.bitLength(n)/8,r=new Uint8Array(e),i;for(let o=0;o<e;o++)(o&3)===0&&(i=n[o/4]),r[o]=i>>>24,i<<=8;return r},toBits(n){let t=[],e,r=0;for(e=0;e<n.length;e++)r=r<<8|n[e],(e&3)===3&&(t.push(r),r=0);return e&3&&t.push(Ie.partial(8*(e&3),r)),t}}},dc={};dc.sha1=class{constructor(n){let t=this;t.blockSize=512,t._init=[1732584193,4023233417,2562383102,271733878,3285377520],t._key=[1518500249,1859775393,2400959708,3395469782],n?(t._h=n._h.slice(0),t._buffer=n._buffer.slice(0),t._length=n._length):t.reset()}reset(){let n=this;return n._h=n._init.slice(0),n._buffer=[],n._length=0,n}update(n){let t=this;typeof n=="string"&&(n=kr.utf8String.toBits(n));let e=t._buffer=Ie.concat(t._buffer,n),r=t._length,i=t._length=r+Ie.bitLength(n);if(i>9007199254740991)throw new Error("Cannot hash more than 2^53 - 1 bits");let o=new Uint32Array(e),a=0;for(let l=t.blockSize+r-(t.blockSize+r&t.blockSize-1);l<=i;l+=t.blockSize)t._block(o.subarray(16*a,16*(a+1))),a+=1;return e.splice(0,16*a),t}finalize(){let n=this,t=n._buffer,e=n._h;t=Ie.concat(t,[Ie.partial(1,1)]);for(let r=t.length+2;r&15;r++)t.push(0);for(t.push(Math.floor(n._length/4294967296)),t.push(n._length|0);t.length;)n._block(t.splice(0,16));return n.reset(),e}_f(n,t,e,r){if(n<=19)return t&e|~t&r;if(n<=39)return t^e^r;if(n<=59)return t&e|t&r|e&r;if(n<=79)return t^e^r}_S(n,t){return t<<n|t>>>32-n}_block(n){let t=this,e=t._h,r=Array(80);for(let c=0;c<16;c++)r[c]=n[c];let i=e[0],o=e[1],a=e[2],l=e[3],s=e[4];for(let c=0;c<=79;c++){c>=16&&(r[c]=t._S(1,r[c-3]^r[c-8]^r[c-14]^r[c-16]));let p=t._S(5,i)+t._f(c,o,a,l)+s+r[c]+t._key[Math.floor(c/20)]|0;s=l,l=a,a=t._S(30,o),o=i,i=p}e[0]=e[0]+i|0,e[1]=e[1]+o|0,e[2]=e[2]+a|0,e[3]=e[3]+l|0,e[4]=e[4]+s|0}};var ka={};ka.aes=class{constructor(n){let t=this;t._tables=[[[],[],[],[],[]],[[],[],[],[],[]]],t._tables[0][0][0]||t._precompute();let e=t._tables[0][4],r=t._tables[1],i=n.length,o,a,l,s=1;if(i!==4&&i!==6&&i!==8)throw new Error("invalid aes key size");for(t._key=[a=n.slice(0),l=[]],o=i;o<4*i+28;o++){let c=a[o-1];(o%i===0||i===8&&o%i===4)&&(c=e[c>>>24]<<24^e[c>>16&255]<<16^e[c>>8&255]<<8^e[c&255],o%i===0&&(c=c<<8^c>>>24^s<<24,s=s<<1^(s>>7)*283)),a[o]=a[o-i]^c}for(let c=0;o;c++,o--){let p=a[c&3?o:o-4];o<=4||c<4?l[c]=p:l[c]=r[0][e[p>>>24]]^r[1][e[p>>16&255]]^r[2][e[p>>8&255]]^r[3][e[p&255]]}}encrypt(n){return this._crypt(n,0)}decrypt(n){return this._crypt(n,1)}_precompute(){let n=this._tables[0],t=this._tables[1],e=n[4],r=t[4],i=[],o=[],a,l,s,c;for(let p=0;p<256;p++)o[(i[p]=p<<1^(p>>7)*283)^p]=p;for(let p=a=0;!e[p];p^=l||1,a=o[a]||1){let u=a^a<<1^a<<2^a<<3^a<<4;u=u>>8^u&255^99,e[p]=u,r[u]=p,c=i[s=i[l=i[p]]];let f=c*16843009^s*65537^l*257^p*16843008,h=i[u]*257^u*16843008;for(let b=0;b<4;b++)n[b][p]=h=h<<24^h>>>8,t[b][u]=f=f<<24^f>>>8}for(let p=0;p<5;p++)n[p]=n[p].slice(0),t[p]=t[p].slice(0)}_crypt(n,t){if(n.length!==4)throw new Error("invalid aes block size");let e=this._key[t],r=e.length/4-2,i=[0,0,0,0],o=this._tables[t],a=o[0],l=o[1],s=o[2],c=o[3],p=o[4],u=n[0]^e[0],f=n[t?3:1]^e[1],h=n[2]^e[2],b=n[t?1:3]^e[3],d=4,m,y,T;for(let k=0;k<r;k++)m=a[u>>>24]^l[f>>16&255]^s[h>>8&255]^c[b&255]^e[d],y=a[f>>>24]^l[h>>16&255]^s[b>>8&255]^c[u&255]^e[d+1],T=a[h>>>24]^l[b>>16&255]^s[u>>8&255]^c[f&255]^e[d+2],b=a[b>>>24]^l[u>>16&255]^s[f>>8&255]^c[h&255]^e[d+3],d+=4,u=m,f=y,h=T;for(let k=0;k<4;k++)i[t?3&-k:k]=p[u>>>24]<<24^p[f>>16&255]<<16^p[h>>8&255]<<8^p[b&255]^e[d++],m=u,u=f,f=h,h=b,b=m;return i}};var fc={getRandomValues(n){let t=new Uint32Array(n.buffer),e=r=>{let i=987654321,o=4294967295;return function(){return i=36969*(i&65535)+(i>>16)&o,r=18e3*(r&65535)+(r>>16)&o,(((i<<16)+r&o)/4294967296+.5)*(Math.random()>.5?1:-1)}};for(let r=0,i;r<n.length;r+=4){let o=e((i||Math.random())*4294967296);i=o()*987654071,t[r/4]=o()*4294967296|0}return n}},Aa={};Aa.ctrGladman=class{constructor(n,t){this._prf=n,this._initIv=t,this._iv=t}reset(){this._iv=this._initIv}update(n){return this.calculate(this._prf,n,this._iv)}incWord(n){if((n>>24&255)===255){let t=n>>16&255,e=n>>8&255,r=n&255;t===255?(t=0,e===255?(e=0,r===255?r=0:++r):++e):++t,n=0,n+=t<<16,n+=e<<8,n+=r}else n+=1<<24;return n}incCounter(n){(n[0]=this.incWord(n[0]))===0&&(n[1]=this.incWord(n[1]))}calculate(n,t,e){let r;if(!(r=t.length))return[];let i=Ie.bitLength(t);for(let o=0;o<r;o+=4){this.incCounter(e);let a=n.encrypt(e);t[o]^=a[0],t[o+1]^=a[1],t[o+2]^=a[2],t[o+3]^=a[3]}return Ie.clamp(t,i)}};var Yt={importKey(n){return new Yt.hmacSha1(kr.bytes.toBits(n))},pbkdf2(n,t,e,r){if(e=e||1e4,r<0||e<0)throw new Error("invalid params to pbkdf2");let i=(r>>5)+1<<2,o,a,l,s,c,p=new ArrayBuffer(i),u=new DataView(p),f=0,h=Ie;for(t=kr.bytes.toBits(t),c=1;f<(i||1);c++){for(o=a=n.encrypt(h.concat(t,[c])),l=1;l<e;l++)for(a=n.encrypt(a),s=0;s<a.length;s++)o[s]^=a[s];for(l=0;f<(i||1)&&l<o.length;l++)u.setInt32(f,o[l]),f+=4}return p.slice(0,r/8)}};Yt.hmacSha1=class{constructor(n){let t=this,e=t._hash=dc.sha1,r=[[],[]];t._baseHash=[new e,new e];let i=t._baseHash[0].blockSize/32;n.length>i&&(n=new e().update(n).finalize());for(let o=0;o<i;o++)r[0][o]=n[o]^909522486,r[1][o]=n[o]^1549556828;t._baseHash[0].update(r[0]),t._baseHash[1].update(r[1]),t._resultHash=new e(t._baseHash[0])}reset(){let n=this;n._resultHash=new n._hash(n._baseHash[0]),n._updated=!1}update(n){let t=this;t._updated=!0,t._resultHash.update(n)}digest(){let n=this,t=n._resultHash.finalize(),e=new n._hash(n._baseHash[1]).update(t).finalize();return n.reset(),e}encrypt(n){if(this._updated)throw new Error("encrypt on already updated hmac called!");return this.update(n),this.digest(n)}};var og=typeof crypto!=ze&&typeof crypto.getRandomValues==Pt,Vt="Invalid password",bn="Invalid signature",Nt="zipjs-abort-check-password";function Ti(n){return og?crypto.getRandomValues(n):fc.getRandomValues(n)}var Un=16,ag="raw",gc={name:"PBKDF2"},sg={name:"HMAC"},lg="SHA-1",cg=Object.assign({hash:sg},gc),Pa=Object.assign({iterations:1e3,hash:{name:lg}},gc),pg=["deriveBits"],Pr=[8,12,16],Ar=[16,24,32],Gt=10,ug=[0,0,0,0],ki=typeof crypto!=ze,Sr=ki&&crypto.subtle,yc=ki&&typeof Sr!=ze,ht=kr.bytes,dg=ka.aes,fg=Aa.ctrGladman,mg=Yt.hmacSha1,mc=ki&&yc&&typeof Sr.importKey==Pt,hc=ki&&yc&&typeof Sr.deriveBits==Pt,_i=class extends TransformStream{constructor({password:t,rawPassword:e,signed:r,encryptionStrength:i,checkPasswordOnly:o}){super({start(){Object.assign(this,{ready:new Promise(a=>this.resolveReady=a),password:wc(t,e),signed:r,strength:i-1,pending:new Uint8Array})},async transform(a,l){let s=this,{password:c,strength:p,resolveReady:u,ready:f}=s;c?(await hg(s,p,c,Ge(a,0,Pr[p]+2)),a=Ge(a,Pr[p]+2),o?l.error(new Error(Nt)):u()):await f;let h=new Uint8Array(a.length-Gt-(a.length-Gt)%Un);l.enqueue(bc(s,a,h,0,Gt,!0))},async flush(a){let{signed:l,ctr:s,hmac:c,pending:p,ready:u}=this;if(c&&s){await u;let f=Ge(p,0,p.length-Gt),h=Ge(p,p.length-Gt),b=new Uint8Array;if(f.length){let d=Nr(ht,f);c.update(d);let m=s.update(d);b=Cr(ht,m)}if(l){let d=Ge(Cr(ht,c.digest()),0,Gt);for(let m=0;m<Gt;m++)if(d[m]!=h[m])throw new Error(bn)}a.enqueue(b)}}})}},Ei=class extends TransformStream{constructor({password:t,rawPassword:e,encryptionStrength:r}){let i;super({start(){Object.assign(this,{ready:new Promise(o=>this.resolveReady=o),password:wc(t,e),strength:r-1,pending:new Uint8Array})},async transform(o,a){let l=this,{password:s,strength:c,resolveReady:p,ready:u}=l,f=new Uint8Array;s?(f=await gg(l,c,s),p()):await u;let h=new Uint8Array(f.length+o.length-o.length%Un);h.set(f,0),a.enqueue(bc(l,o,h,f.length,0))},async flush(o){let{ctr:a,hmac:l,pending:s,ready:c}=this;if(l&&a){await c;let p=new Uint8Array;if(s.length){let u=a.update(Nr(ht,s));l.update(u),p=Cr(ht,u)}i.signature=Cr(ht,l.digest()).slice(0,Gt),o.enqueue(Ca(p,i.signature))}}}),i=this}};function bc(n,t,e,r,i,o){let{ctr:a,hmac:l,pending:s}=n,c=t.length-i;s.length&&(t=Ca(s,t),e=vg(e,c-c%Un));let p;for(p=0;p<=c-Un;p+=Un){let u=Nr(ht,Ge(t,p,p+Un));o&&l.update(u);let f=a.update(u);o||l.update(f),e.set(Cr(ht,f),p+r)}return n.pending=Ge(t,p),e}async function hg(n,t,e,r){let i=await vc(n,t,e,Ge(r,0,Pr[t])),o=Ge(r,Pr[t]);if(i[0]!=o[0]||i[1]!=o[1])throw new Error(Vt)}async function gg(n,t,e){let r=Ti(new Uint8Array(Pr[t])),i=await vc(n,t,e,r);return Ca(r,i)}async function vc(n,t,e,r){n.password=null;let i=await yg(ag,e,cg,!1,pg),o=await bg(Object.assign({salt:r},Pa),i,8*(Ar[t]*2+2)),a=new Uint8Array(o),l=Nr(ht,Ge(a,0,Ar[t])),s=Nr(ht,Ge(a,Ar[t],Ar[t]*2)),c=Ge(a,Ar[t]*2);return Object.assign(n,{keys:{key:l,authentication:s,passwordVerification:c},ctr:new fg(new dg(l),Array.from(ug)),hmac:new mg(s)}),c}async function yg(n,t,e,r,i){if(mc)try{return await Sr.importKey(n,t,e,r,i)}catch(o){return mc=!1,Yt.importKey(t)}else return Yt.importKey(t)}async function bg(n,t,e){if(hc)try{return await Sr.deriveBits(n,t,e)}catch(r){return hc=!1,Yt.pbkdf2(t,n.salt,Pa.iterations,e)}else return Yt.pbkdf2(t,n.salt,Pa.iterations,e)}function wc(n,t){return t===me?uc(n):t}function Ca(n,t){let e=n;return n.length+t.length&&(e=new Uint8Array(n.length+t.length),e.set(n,0),e.set(t,n.length)),e}function vg(n,t){if(t&&t>n.length){let e=n;n=new Uint8Array(t),n.set(e,0)}return n}function Ge(n,t,e){return n.subarray(t,e)}function Cr(n,t){return n.fromBits(t)}function Nr(n,t){return n.toBits(t)}var qn=12,Ai=class extends TransformStream{constructor({password:t,passwordVerification:e,checkPasswordOnly:r}){super({start(){Object.assign(this,{password:t,passwordVerification:e}),Ec(this,t)},transform(i,o){let a=this;if(a.password){let l=xc(a,i.subarray(0,qn));if(a.password=null,l[qn-1]!=a.passwordVerification)throw new Error(Vt);i=i.subarray(qn)}r?o.error(new Error(Nt)):o.enqueue(xc(a,i))}})}},Pi=class extends TransformStream{constructor({password:t,passwordVerification:e}){super({start(){Object.assign(this,{password:t,passwordVerification:e}),Ec(this,t)},transform(r,i){let o=this,a,l;if(o.password){o.password=null;let s=Ti(new Uint8Array(qn));s[qn-1]=o.passwordVerification,a=new Uint8Array(r.length+s.length),a.set(Tc(o,s),0),l=qn}else a=new Uint8Array(r.length),l=0;a.set(Tc(o,r),l),i.enqueue(a)}})}};function xc(n,t){let e=new Uint8Array(t.length);for(let r=0;r<t.length;r++)e[r]=kc(n)^t[r],Na(n,e[r]);return e}function Tc(n,t){let e=new Uint8Array(t.length);for(let r=0;r<t.length;r++)e[r]=kc(n)^t[r],Na(n,t[r]);return e}function Ec(n,t){let e=[305419896,591751049,878082192];Object.assign(n,{keys:e,crcKey0:new Ct(e[0]),crcKey2:new Ct(e[2])});for(let r=0;r<t.length;r++)Na(n,t.charCodeAt(r))}function Na(n,t){let[e,r,i]=n.keys;n.crcKey0.append([t]),e=~n.crcKey0.get(),r=_c(Math.imul(_c(r+Ac(e)),134775813)+1),n.crcKey2.append([r>>>24]),i=~n.crcKey2.get(),n.keys=[e,r,i]}function kc(n){let t=n.keys[2]|2;return Ac(Math.imul(t,t^1)>>>8)}function Ac(n){return n&255}function _c(n){return n&4294967295}var Pc="deflate-raw",Ci=class extends TransformStream{constructor(t,{chunkSize:e,CompressionStream:r,CompressionStreamNative:i}){super({});let{compressed:o,encrypted:a,useCompressionStream:l,zipCrypto:s,signed:c,level:p}=t,u=this,f,h,b=Cc(super.readable);(!a||s)&&c&&(f=new Er,b=gt(b,f)),o&&(b=Sc(b,l,{level:p,chunkSize:e},i,r)),a&&(s?b=gt(b,new Pi(t)):(h=new Ei(t),b=gt(b,h))),Nc(u,b,()=>{let d;a&&!s&&(d=h.signature),(!a||s)&&c&&(d=new DataView(f.value.buffer).getUint32(0)),u.signature=d})}},Ni=class extends TransformStream{constructor(t,{chunkSize:e,DecompressionStream:r,DecompressionStreamNative:i}){super({});let{zipCrypto:o,encrypted:a,signed:l,signature:s,compressed:c,useCompressionStream:p}=t,u,f,h=Cc(super.readable);a&&(o?h=gt(h,new Ai(t)):(f=new _i(t),h=gt(h,f))),c&&(h=Sc(h,p,{chunkSize:e},i,r)),(!a||o)&&l&&(u=new Er,h=gt(h,u)),Nc(this,h,()=>{if((!a||o)&&l){let b=new DataView(u.value.buffer);if(s!=b.getUint32(0,!1))throw new Error(bn)}})}};function Cc(n){return gt(n,new TransformStream({transform(t,e){t&&t.length&&e.enqueue(t)}}))}function Nc(n,t,e){t=gt(t,new TransformStream({flush:e})),Object.defineProperty(n,"readable",{get(){return t}})}function Sc(n,t,e,r,i){try{let o=t&&r?r:i;n=gt(n,new o(Pc,e))}catch(o){if(t)try{n=gt(n,new i(Pc,e))}catch(a){return n}else return n}return n}function gt(n,t){return n.pipeThrough(t)}var Rc="message",Ic="start",Dc="pull",Sa="data",Oc="ack",Ra="close",Fc="deflate",Ii="inflate";var Si=class extends TransformStream{constructor(t,e){super({});let r=this,{codecType:i}=t,o;i.startsWith(Fc)?o=Ci:i.startsWith(Ii)&&(o=Ni);let a=0,l=0,s=new o(t,e),c=super.readable,p=new TransformStream({transform(f,h){f&&f.length&&(l+=f.length,h.enqueue(f))},flush(){Object.assign(r,{inputSize:l})}}),u=new TransformStream({transform(f,h){f&&f.length&&(a+=f.length,h.enqueue(f))},flush(){let{signature:f}=s;Object.assign(r,{signature:f,outputSize:a,inputSize:l})}});Object.defineProperty(r,"readable",{get(){return c.pipeThrough(p).pipeThrough(s).pipeThrough(u)}})}},Ri=class extends TransformStream{constructor(t){let e;super({transform:r,flush(i){e&&e.length&&i.enqueue(e)}});function r(i,o){if(e){let a=new Uint8Array(e.length+i.length);a.set(e),a.set(i,e.length),i=a,e=null}i.length>t?(o.enqueue(i.slice(0,t)),r(i.slice(t),o)):e=i}}};var Mc=typeof Worker!=ze;var Hn=class{constructor(t,{readable:e,writable:r},{options:i,config:o,streamOptions:a,useWebWorkers:l,transferStreams:s,scripts:c},p){let{signal:u}=a;return Object.assign(t,{busy:!0,readable:e.pipeThrough(new Ri(o.chunkSize)).pipeThrough(new Da(e,a),{signal:u}),writable:r,options:Object.assign({},i),scripts:c,transferStreams:s,terminate(){return new Promise(f=>{let{worker:h,busy:b}=t;h?(b?t.resolveTerminated=f:(h.terminate(),f()),t.interface=null):f()})},onTaskFinished(){let{resolveTerminated:f}=t;f&&(t.resolveTerminated=null,t.terminated=!0,t.worker.terminate(),f()),t.busy=!1,p(t)}}),(l&&Mc?wg:Bc)(t,o)}},Da=class extends TransformStream{constructor(t,{onstart:e,onprogress:r,size:i,onend:o}){let a=0;super({async start(){e&&await Ia(e,i)},async transform(l,s){a+=l.length,r&&await Ia(r,a,i),s.enqueue(l)},async flush(){t.size=a,o&&await Ia(o,a)}})}};async function Ia(n,...t){try{await n(...t)}catch(e){}}function Bc(n,t){return{run:()=>xg(n,t)}}function wg(n,t){let{baseURL:e,chunkSize:r}=t;if(!n.interface){let i;try{i=Eg(n.scripts[0],e,n)}catch(o){return Mc=!1,Bc(n,t)}Object.assign(n,{worker:i,interface:{run:()=>Tg(n,{chunkSize:r})}})}return n.interface}async function xg({options:n,readable:t,writable:e,onTaskFinished:r},i){try{let o=new Si(n,i);await t.pipeThrough(o).pipeTo(e,{preventClose:!0,preventAbort:!0});let{signature:a,inputSize:l,outputSize:s}=o;return{signature:a,inputSize:l,outputSize:s}}finally{r()}}async function Tg(n,t){let e,r,i=new Promise((f,h)=>{e=f,r=h});Object.assign(n,{reader:null,writer:null,resolveResult:e,rejectResult:r,result:i});let{readable:o,options:a,scripts:l}=n,{writable:s,closed:c}=_g(n.writable),p=Di({type:Ic,scripts:l.slice(1),options:a,config:t,readable:o,writable:s},n);p||Object.assign(n,{reader:o.getReader(),writer:s.getWriter()});let u=await i;return p||await s.getWriter().close(),await c,u}function _g(n){let t,e=new Promise(i=>t=i);return{writable:new WritableStream({async write(i){let o=n.getWriter();await o.ready,await o.write(i),o.releaseLock()},close(){t()},abort(i){return n.getWriter().abort(i)}}),closed:e}}var Lc=!0,$c=!0;function Eg(n,t,e){let r={type:"module"},i,o;typeof n==Pt&&(n=n());try{i=new URL(n,t)}catch(a){i=n}if(Lc)try{o=new Worker(i)}catch(a){Lc=!1,o=new Worker(i,r)}else o=new Worker(i,r);return o.addEventListener(Rc,a=>kg(a,e)),o}function Di(n,{worker:t,writer:e,onTaskFinished:r,transferStreams:i}){try{let{value:o,readable:a,writable:l}=n,s=[];if(o&&(o.byteLength<o.buffer.byteLength?n.value=o.buffer.slice(0,o.byteLength):n.value=o.buffer,s.push(n.value)),i&&$c?(a&&s.push(a),l&&s.push(l)):n.readable=n.writable=null,s.length)try{return t.postMessage(n,s),!0}catch(c){$c=!1,n.readable=n.writable=null,t.postMessage(n)}else t.postMessage(n)}catch(o){throw e&&e.releaseLock(),r(),o}}async function kg({data:n},t){let{type:e,value:r,messageId:i,result:o,error:a}=n,{reader:l,writer:s,resolveResult:c,rejectResult:p,onTaskFinished:u}=t;try{if(a){let{message:h,stack:b,code:d,name:m}=a,y=new Error(h);Object.assign(y,{stack:b,code:d,name:m}),f(y)}else{if(e==Dc){let{value:h,done:b}=await l.read();Di({type:Sa,value:h,done:b,messageId:i},t)}e==Sa&&(await s.ready,await s.write(new Uint8Array(r)),Di({type:Oc,messageId:i},t)),e==Ra&&f(null,o)}}catch(h){Di({type:Ra,messageId:i},t),f(h)}function f(h,b){h?p(h):c(b),s&&s.releaseLock(),u()}}var vn=[],Oa=[];var jc=0;async function qc(n,t){let{options:e,config:r}=t,{transferStreams:i,useWebWorkers:o,useCompressionStream:a,codecType:l,compressed:s,signed:c,encrypted:p}=e,{workerScripts:u,maxWorkers:f}=r;t.transferStreams=i||i===me;let h=!s&&!c&&!p&&!t.transferStreams;return t.useWebWorkers=!h&&(o||o===me&&r.useWebWorkers),t.scripts=t.useWebWorkers&&u?u[l]:[],e.useCompressionStream=a||a===me&&r.useCompressionStream,(await b()).run();async function b(){let m=vn.find(y=>!y.busy);if(m)return Uc(m),new Hn(m,n,t,d);if(vn.length<f){let y={indexWorker:jc};return jc++,vn.push(y),new Hn(y,n,t,d)}else return new Promise(y=>Oa.push({resolve:y,stream:n,workerOptions:t}))}function d(m){if(Oa.length){let[{resolve:y,stream:T,workerOptions:k}]=Oa.splice(0,1);y(new Hn(m,T,k,d))}else m.worker?(Uc(m),Ag(m,t)):vn=vn.filter(y=>y!=m)}}function Ag(n,t){let{config:e}=t,{terminateWorkerTimeout:r}=e;Number.isFinite(r)&&r>=0&&(n.terminated?n.terminated=!1:n.terminateTimeout=setTimeout(async()=>{vn=vn.filter(i=>i!=n);try{await n.terminate()}catch(i){}},r))}function Uc(n){let{terminateTimeout:t}=n;t&&(clearTimeout(t),n.terminateTimeout=null)}var Pg="Writer iterator completed too soon";var Cg="Content-Type";var Ng=64*1024,Hc="writable",Rr=class{constructor(){this.size=0}init(){this.initialized=!0}},Wn=class extends Rr{get readable(){let t=this,{chunkSize:e=Ng}=t,r=new ReadableStream({start(){this.chunkOffset=0},async pull(i){let{offset:o=0,size:a,diskNumberStart:l}=r,{chunkOffset:s}=this,c=a===me?e:Math.min(e,a-s),p=await Ce(t,o+s,c,l);i.enqueue(p),s+e>a||a===me&&!p.length&&c?i.close():this.chunkOffset+=e}});return r}};var Zt=class extends Wn{constructor(t){super(),Object.assign(this,{blob:t,size:t.size})}async readUint8Array(t,e){let r=this,i=t+e,a=await(t||i<r.size?r.blob.slice(t,i):r.blob).arrayBuffer();return a.byteLength>e&&(a=a.slice(t,i)),new Uint8Array(a)}},Ir=class extends Rr{constructor(t){super();let e=this,r=new TransformStream,i=[];t&&i.push([Cg,t]),Object.defineProperty(e,Hc,{get(){return r.writable}}),e.blob=new Response(r.readable,{headers:i}).blob()}getData(){return this.blob}};var Oi=class extends Ir{constructor(t){super(t),Object.assign(this,{encoding:t,utf8:!t||t.toLowerCase()=="utf-8"})}async getData(){let{encoding:t,utf8:e}=this,r=await super.getData();if(r.text&&e)return r.text();{let i=new FileReader;return new Promise((o,a)=>{Object.assign(i,{onload:({target:l})=>o(l.result),onerror:()=>a(i.error)}),i.readAsText(r,t)})}}};var Fa=class extends Wn{constructor(t){super(),this.readers=t}async init(){let t=this,{readers:e}=t;t.lastDiskNumber=0,t.lastDiskOffset=0,await Promise.all(e.map(async(r,i)=>{await r.init(),i!=e.length-1&&(t.lastDiskOffset+=r.size),t.size+=r.size})),super.init()}async readUint8Array(t,e,r=0){let i=this,{readers:o}=this,a,l=r;l==-1&&(l=o.length-1);let s=t;for(;s>=o[l].size;)s-=o[l].size,l++;let c=o[l],p=c.size;if(s+e<=p)a=await Ce(c,s,e);else{let u=p-s;a=new Uint8Array(e),a.set(await Ce(c,s,u)),a.set(await i.readUint8Array(t+u,e-u,r),u)}return i.lastDiskNumber=Math.max(l,i.lastDiskNumber),a}},Fi=class extends Rr{constructor(t,e=4294967295){super();let r=this;Object.assign(r,{diskNumber:0,diskOffset:0,size:0,maxSize:e,availableSize:e});let i,o,a,l=new WritableStream({async write(p){let{availableSize:u}=r;if(a)p.length>=u?(await s(p.slice(0,u)),await c(),r.diskOffset+=i.size,r.diskNumber++,a=null,await this.write(p.slice(u))):await s(p);else{let{value:f,done:h}=await t.next();if(h&&!f)throw new Error(Pg);i=f,i.size=0,i.maxSize&&(r.maxSize=i.maxSize),r.availableSize=r.maxSize,await Dr(i),o=f.writable,a=o.getWriter(),await this.write(p)}},async close(){await a.ready,await c()}});Object.defineProperty(r,Hc,{get(){return l}});async function s(p){let u=p.length;u&&(await a.ready,await a.write(p),i.size+=u,r.size+=u,r.availableSize-=u)}async function c(){o.size=i.size,await a.close()}}};async function Dr(n,t){if(n.init&&!n.initialized)await n.init(t);else return Promise.resolve()}function Wc(n){return Array.isArray(n)&&(n=new Fa(n)),n instanceof ReadableStream&&(n={readable:n}),n}function zc(n){n.writable===me&&typeof n.next==Pt&&(n=new Fi(n)),n instanceof WritableStream&&(n={writable:n});let{writable:t}=n;return t.size===me&&(t.size=0),n instanceof Fi||Object.assign(n,{diskNumber:0,diskOffset:0,availableSize:1/0,maxSize:1/0}),n}function Ce(n,t,e,r){return n.readUint8Array(t,e,r)}var Yc="\0\u263A\u263B\u2665\u2666\u2663\u2660\u2022\u25D8\u25CB\u25D9\u2642\u2640\u266A\u266B\u263C\u25BA\u25C4\u2195\u203C\xB6\xA7\u25AC\u21A8\u2191\u2193\u2192\u2190\u221F\u2194\u25B2\u25BC !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_`abcdefghijklmnopqrstuvwxyz{|}~\u2302\xC7\xFC\xE9\xE2\xE4\xE0\xE5\xE7\xEA\xEB\xE8\xEF\xEE\xEC\xC4\xC5\xC9\xE6\xC6\xF4\xF6\xF2\xFB\xF9\xFF\xD6\xDC\xA2\xA3\xA5\u20A7\u0192\xE1\xED\xF3\xFA\xF1\xD1\xAA\xBA\xBF\u2310\xAC\xBD\xBC\xA1\xAB\xBB\u2591\u2592\u2593\u2502\u2524\u2561\u2562\u2556\u2555\u2563\u2551\u2557\u255D\u255C\u255B\u2510\u2514\u2534\u252C\u251C\u2500\u253C\u255E\u255F\u255A\u2554\u2569\u2566\u2560\u2550\u256C\u2567\u2568\u2564\u2565\u2559\u2558\u2552\u2553\u256B\u256A\u2518\u250C\u2588\u2584\u258C\u2590\u2580\u03B1\xDF\u0393\u03C0\u03A3\u03C3\xB5\u03C4\u03A6\u0398\u03A9\u03B4\u221E\u03C6\u03B5\u2229\u2261\xB1\u2265\u2264\u2320\u2321\xF7\u2248\xB0\u2219\xB7\u221A\u207F\xB2\u25A0 ".split(""),Sg=Yc.length==256;function Vc(n){if(Sg){let t="";for(let e=0;e<n.length;e++)t+=Yc[n[e]];return t}else return new TextDecoder().decode(n)}function Or(n,t){return t&&t.trim().toLowerCase()=="cp437"?Vc(n):new TextDecoder(t).decode(n)}var La="filename",$a="rawFilename",Ma="comment",Ba="rawComment",ja="uncompressedSize",Ua="compressedSize",qa="offset",Li="diskNumberStart",$i="lastModDate",Mi="rawLastModDate",Ha="lastAccessDate",Gc="rawLastAccessDate",Wa="creationDate",Zc="rawCreationDate",Rg="internalFileAttribute",Ig="internalFileAttributes",Dg="externalFileAttribute",Og="externalFileAttributes",Fg="msDosCompatible",Lg="zip64",$g="encrypted",Mg="version",Bg="versionMadeBy",jg="zipCrypto",Ug="directory",qg="executable",Hg=[La,$a,Ua,ja,$i,Mi,Ma,Ba,Ha,Wa,qa,Li,Li,Rg,Ig,Dg,Og,Fg,Lg,$g,Mg,Bg,jg,Ug,qg,"bitFlag","signature","filenameUTF8","commentUTF8","compressionMethod","extraField","rawExtraField","extraFieldZip64","extraFieldUnicodePath","extraFieldUnicodeComment","extraFieldAES","extraFieldNTFS","extraFieldExtendedTimestamp"],Fr=class{constructor(t){Hg.forEach(e=>this[e]=t[e])}};var Va="File format is not recognized",a0="End of central directory not found",s0="End of Zip64 central directory locator not found",l0="Central directory header not found",c0="Local file header not found",p0="Zip64 extra field not found",u0="File contains encrypted entry",d0="Encryption method not supported",ip="Compression method not supported",op="Split zip file",ap="utf-8",sp="cp437",f0=[[ja,4294967295],[Ua,4294967295],[qa,4294967295],[Li,65535]],m0={[65535]:{getValue:he,bytes:4},[4294967295]:{getValue:Bi,bytes:8}},Tn=class{constructor(t,e={}){Object.assign(this,{reader:Wc(t),options:e,config:Ea()})}async*getEntriesGenerator(t={}){let e=this,{reader:r}=e,{config:i}=e;if(await Dr(r),(r.size===me||!r.readUint8Array)&&(r=new Zt(await new Response(r.readable).blob()),await Dr(r)),r.size<22)throw new Error(Va);r.chunkSize=cc(i);let o=await v0(r,101010256,r.size,22,65535*16);if(!o){let N=await Ce(r,0,4),C=Ee(N);throw he(C)==134695760?new Error(op):new Error(a0)}let a=Ee(o),l=he(a,12),s=he(a,16),c=o.offset,p=_e(a,20),u=c+22+p,f=_e(a,4),h=r.lastDiskNumber||0,b=_e(a,6),d=_e(a,8),m=0,y=0;if(s==4294967295||l==4294967295||d==65535||b==65535){let N=await Ce(r,o.offset-20,20),C=Ee(N);if(he(C,0)==117853008){s=Bi(C,8);let F=await Ce(r,s,56,-1),L=Ee(F),z=o.offset-20-56;if(he(L,0)!=101075792&&s!=z){let K=s;s=z,m=s-K,F=await Ce(r,s,56,-1),L=Ee(F)}if(he(L,0)!=101075792)throw new Error(s0);f==65535&&(f=he(L,16)),b==65535&&(b=he(L,20)),d==65535&&(d=Bi(L,32)),l==4294967295&&(l=Bi(L,40)),s-=l}}if(s>=r.size&&(m=r.size-s-l-22,s=r.size-l-22),h!=f)throw new Error(op);if(s<0)throw new Error(Va);let T=0,k=await Ce(r,s,l,b),_=Ee(k);if(l){let N=o.offset-l;if(he(_,T)!=33639248&&s!=N){let C=s;s=N,m+=s-C,k=await Ce(r,s,l,b),_=Ee(k)}}let A=o.offset-s-(r.lastDiskOffset||0);if(l!=A&&A>=0&&(l=A,k=await Ce(r,s,l,b),_=Ee(k)),s<0||s>=r.size)throw new Error(Va);let E=De(e,t,"filenameEncoding"),P=De(e,t,"commentEncoding");for(let N=0;N<d;N++){let C=new Za(r,i,e.options);if(he(_,T)!=33639248)throw new Error(l0);cp(C,_,T+6);let F=!!C.bitFlag.languageEncodingFlag,L=T+46,z=L+C.filenameLength,K=z+C.extraFieldLength,M=_e(_,T+4),le=M>>8==0,J=M>>8==3,be=k.subarray(L,z),q=_e(_,T+32),Be=K+q,Q=k.subarray(K,Be),oe=F,mt=F,mn=he(_,T+38),w=le&&(zn(_,T+38)&16)==16||J&&(mn>>16&16384)==16384||be.length&&be[be.length-1]==_a.charCodeAt(0),g=J&&(mn>>16&73)==73,S=he(_,T+42)+m;Object.assign(C,{versionMadeBy:M,msDosCompatible:le,compressedSize:0,uncompressedSize:0,commentLength:q,directory:w,offset:S,diskNumberStart:_e(_,T+34),internalFileAttributes:_e(_,T+36),externalFileAttributes:mn,rawFilename:be,filenameUTF8:oe,commentUTF8:mt,rawExtraField:k.subarray(z,K),executable:g}),C.internalFileAttribute=C.internalFileAttributes,C.externalFileAttribute=C.externalFileAttributes;let x=De(e,t,"decodeText")||Or,R=oe?ap:E||sp,O=mt?ap:P||sp,$=x(be,R);$===me&&($=Or(be,R));let B=x(Q,O);B===me&&(B=Or(Q,O)),Object.assign(C,{rawComment:Q,filename:$,comment:B,directory:w||$.endsWith(_a)}),y=Math.max(S,y),pp(C,C,_,T+6),C.zipCrypto=C.encrypted&&!C.extraFieldAES;let V=new Fr(C);V.getData=(ae,ue)=>C.getData(ae,V,ue),T=Be;let{onprogress:se}=t;if(se)try{await se(N+1,d,new Fr(C))}catch(ae){}yield V}let v=De(e,t,"extractPrependedData"),D=De(e,t,"extractAppendedData");return v&&(e.prependedData=y>0?await Ce(r,0,y):new Uint8Array),e.comment=p?await Ce(r,c+22,p):new Uint8Array,D&&(e.appendedData=u<r.size?await Ce(r,u,r.size-u):new Uint8Array),!0}async getEntries(t={}){let e=[];for await(let r of this.getEntriesGenerator(t))e.push(r);return e}async close(){}};var Za=class{constructor(t,e,r){Object.assign(this,{reader:t,config:e,options:r})}async getData(t,e,r={}){let i=this,{reader:o,offset:a,diskNumberStart:l,extraFieldAES:s,compressionMethod:c,config:p,bitFlag:u,signature:f,rawLastModDate:h,uncompressedSize:b,compressedSize:d}=i,m=e.localDirectory={},y=await Ce(o,a,30,l),T=Ee(y),k=De(i,r,"password"),_=De(i,r,"rawPassword"),A=De(i,r,"passThrough");if(k=k&&k.length&&k,_=_&&_.length&&_,s&&s.originalCompressionMethod!=99)throw new Error(ip);if(c!=0&&c!=8&&!A)throw new Error(ip);if(he(T,0)!=67324752)throw new Error(c0);cp(m,T,4),m.rawExtraField=m.extraFieldLength?await Ce(o,a+30+m.filenameLength,m.extraFieldLength,l):new Uint8Array,pp(i,m,T,4,!0),Object.assign(e,{lastAccessDate:m.lastAccessDate,creationDate:m.creationDate});let E=i.encrypted&&m.encrypted&&!A,P=E&&!s;if(A||(e.zipCrypto=P),E){if(!P&&s.strength===me)throw new Error(d0);if(!k&&!_)throw new Error(u0)}let v=a+30+m.filenameLength+m.extraFieldLength,D=d,N=o.readable;Object.assign(N,{diskNumberStart:l,offset:v,size:D});let C=De(i,r,"signal"),F=De(i,r,"checkPasswordOnly");F&&(t=new WritableStream),t=zc(t),await Dr(t,A?d:b);let{writable:L}=t,{onstart:z,onprogress:K,onend:M}=r,le={options:{codecType:Ii,password:k,rawPassword:_,zipCrypto:P,encryptionStrength:s&&s.strength,signed:De(i,r,"checkSignature")&&!A,passwordVerification:P&&(u.dataDescriptor?h>>>8&255:f>>>24&255),signature:f,compressed:c!=0&&!A,encrypted:i.encrypted&&!A,useWebWorkers:De(i,r,"useWebWorkers"),useCompressionStream:De(i,r,"useCompressionStream"),transferStreams:De(i,r,"transferStreams"),checkPasswordOnly:F},config:p,streamOptions:{signal:C,size:D,onstart:z,onprogress:K,onend:M}},J=0;try{({outputSize:J}=await qc({readable:N,writable:L},le))}catch(be){if(!F||be.message!=Nt)throw be}finally{let be=De(i,r,"preventClose");L.size+=J,!be&&!L.locked&&await L.getWriter().close()}return F?me:t.getData?t.getData():L}};function cp(n,t,e){let r=n.rawBitFlag=_e(t,e+2),i=(r&1)==1,o=he(t,e+6);Object.assign(n,{encrypted:i,version:_e(t,e),bitFlag:{level:(r&6)>>1,dataDescriptor:(r&8)==8,languageEncodingFlag:(r&2048)==2048},rawLastModDate:o,lastModDate:w0(o),filenameLength:_e(t,e+22),extraFieldLength:_e(t,e+24)})}function pp(n,t,e,r,i){let{rawExtraField:o}=t,a=t.extraField=new Map,l=Ee(new Uint8Array(o)),s=0;try{for(;s<o.length;){let y=_e(l,s),T=_e(l,s+2);a.set(y,{type:y,data:o.slice(s+4,s+4+T)}),s+=4+T}}catch(y){}let c=_e(e,r+4);Object.assign(t,{signature:he(e,r+10),uncompressedSize:he(e,r+18),compressedSize:he(e,r+14)});let p=a.get(1);p&&(h0(p,t),t.extraFieldZip64=p);let u=a.get(28789);u&&(lp(u,La,$a,t,n),t.extraFieldUnicodePath=u);let f=a.get(25461);f&&(lp(f,Ma,Ba,t,n),t.extraFieldUnicodeComment=f);let h=a.get(39169);h?(g0(h,t,c),t.extraFieldAES=h):t.compressionMethod=c;let b=a.get(10);b&&(y0(b,t),t.extraFieldNTFS=b);let d=a.get(21589);d&&(b0(d,t,i),t.extraFieldExtendedTimestamp=d);let m=a.get(6534);m&&(t.extraFieldUSDZ=m)}function h0(n,t){t.zip64=!0;let e=Ee(n.data),r=f0.filter(([i,o])=>t[i]==o);for(let i=0,o=0;i<r.length;i++){let[a,l]=r[i];if(t[a]==l){let s=m0[l];t[a]=n[a]=s.getValue(e,o),o+=s.bytes}else if(n[a])throw new Error(p0)}}function lp(n,t,e,r,i){let o=Ee(n.data),a=new Ct;a.append(i[e]);let l=Ee(new Uint8Array(4));l.setUint32(0,a.get(),!0);let s=he(o,1);Object.assign(n,{version:zn(o,0),[t]:Or(n.data.subarray(5)),valid:!i.bitFlag.languageEncodingFlag&&s==he(l,0)}),n.valid&&(r[t]=n[t],r[t+"UTF8"]=!0)}function g0(n,t,e){let r=Ee(n.data),i=zn(r,4);Object.assign(n,{vendorVersion:zn(r,0),vendorId:zn(r,2),strength:i,originalCompressionMethod:e,compressionMethod:_e(r,5)}),t.compressionMethod=n.compressionMethod}function y0(n,t){let e=Ee(n.data),r=4,i;try{for(;r<n.data.length&&!i;){let o=_e(e,r),a=_e(e,r+2);o==1&&(i=n.data.slice(r+4,r+4+a)),r+=4+a}}catch(o){}try{if(i&&i.length==24){let o=Ee(i),a=o.getBigUint64(0,!0),l=o.getBigUint64(8,!0),s=o.getBigUint64(16,!0);Object.assign(n,{rawLastModDate:a,rawLastAccessDate:l,rawCreationDate:s});let c=Ga(a),p=Ga(l),u=Ga(s),f={lastModDate:c,lastAccessDate:p,creationDate:u};Object.assign(n,f),Object.assign(t,f)}}catch(o){}}function b0(n,t,e){let r=Ee(n.data),i=zn(r,0),o=[],a=[];e?((i&1)==1&&(o.push($i),a.push(Mi)),(i&2)==2&&(o.push(Ha),a.push(Gc)),(i&4)==4&&(o.push(Wa),a.push(Zc))):n.data.length>=5&&(o.push($i),a.push(Mi));let l=1;o.forEach((s,c)=>{if(n.data.length>=l+4){let p=he(r,l);t[s]=n[s]=new Date(p*1e3);let u=a[c];n[u]=p}l+=4})}async function v0(n,t,e,r,i){let o=new Uint8Array(4),a=Ee(o);x0(a,0,t);let l=r+i;return await s(r)||await s(Math.min(l,e));async function s(c){let p=e-c,u=await Ce(n,p,c);for(let f=u.length-r;f>=0;f--)if(u[f]==o[0]&&u[f+1]==o[1]&&u[f+2]==o[2]&&u[f+3]==o[3])return{offset:p+f,buffer:u.slice(f,f+r).buffer}}}function De(n,t,e){return t[e]===me?n.options[e]:t[e]}function w0(n){let t=(n&4294901760)>>16,e=n&65535;try{return new Date(1980+((t&65024)>>9),((t&480)>>5)-1,t&31,(e&63488)>>11,(e&2016)>>5,(e&31)*2,0)}catch(r){}}function Ga(n){return new Date(Number(n/BigInt(1e4)-BigInt(116444736e5)))}function zn(n,t){return n.getUint8(t)}function _e(n,t){return n.getUint16(t,!0)}function he(n,t){return n.getUint32(t,!0)}function Bi(n,t){return Number(n.getBigUint64(t,!0))}function x0(n,t,e){n.setUint32(t,e,!0)}function Ee(n){return new DataView(n.buffer)}xi({Inflate:sc});var En=require("obsidian");function up(n){let t=()=>URL.createObjectURL(new Blob([`const{Array:e,Object:t,Number:n,Math:r,Error:s,Uint8Array:i,Uint16Array:o,Uint32Array:c,Int32Array:f,Map:a,DataView:l,Promise:u,TextEncoder:w,crypto:h,postMessage:d,TransformStream:p,ReadableStream:y,WritableStream:m,CompressionStream:b,DecompressionStream:g}=self;class k{constructor(e){return class extends p{constructor(t,n){const r=new e(n);super({transform(e,t){t.enqueue(r.append(e))},flush(e){const t=r.flush();t&&e.enqueue(t)}})}}}}const v=[];for(let e=0;256>e;e++){let t=e;for(let e=0;8>e;e++)1&t?t=t>>>1^3988292384:t>>>=1;v[e]=t}class S{constructor(e){this.t=e||-1}append(e){let t=0|this.t;for(let n=0,r=0|e.length;r>n;n++)t=t>>>8^v[255&(t^e[n])];this.t=t}get(){return~this.t}}class z extends p{constructor(){let e;const t=new S;super({transform(e,n){t.append(e),n.enqueue(e)},flush(){const n=new i(4);new l(n.buffer).setUint32(0,t.get()),e.value=n}}),e=this}}const C={concat(e,t){if(0===e.length||0===t.length)return e.concat(t);const n=e[e.length-1],r=C.i(n);return 32===r?e.concat(t):C.o(t,r,0|n,e.slice(0,e.length-1))},l(e){const t=e.length;if(0===t)return 0;const n=e[t-1];return 32*(t-1)+C.i(n)},u(e,t){if(32*e.length<t)return e;const n=(e=e.slice(0,r.ceil(t/32))).length;return t&=31,n>0&&t&&(e[n-1]=C.h(t,e[n-1]&2147483648>>t-1,1)),e},h:(e,t,n)=>32===e?t:(n?0|t:t<<32-e)+1099511627776*e,i:e=>r.round(e/1099511627776)||32,o(e,t,n,r){for(void 0===r&&(r=[]);t>=32;t-=32)r.push(n),n=0;if(0===t)return r.concat(e);for(let s=0;s<e.length;s++)r.push(n|e[s]>>>t),n=e[s]<<32-t;const s=e.length?e[e.length-1]:0,i=C.i(s);return r.push(C.h(t+i&31,t+i>32?n:r.pop(),1)),r}},x={p:{m(e){const t=C.l(e)/8,n=new i(t);let r;for(let s=0;t>s;s++)0==(3&s)&&(r=e[s/4]),n[s]=r>>>24,r<<=8;return n},g(e){const t=[];let n,r=0;for(n=0;n<e.length;n++)r=r<<8|e[n],3==(3&n)&&(t.push(r),r=0);return 3&n&&t.push(C.h(8*(3&n),r)),t}}},_=class{constructor(e){const t=this;t.blockSize=512,t.k=[1732584193,4023233417,2562383102,271733878,3285377520],t.v=[1518500249,1859775393,2400959708,3395469782],e?(t.S=e.S.slice(0),t.C=e.C.slice(0),t._=e._):t.reset()}reset(){const e=this;return e.S=e.k.slice(0),e.C=[],e._=0,e}update(e){const t=this;"string"==typeof e&&(e=x.A.g(e));const n=t.C=C.concat(t.C,e),r=t._,i=t._=r+C.l(e);if(i>9007199254740991)throw new s("Cannot hash more than 2^53 - 1 bits");const o=new c(n);let f=0;for(let e=t.blockSize+r-(t.blockSize+r&t.blockSize-1);i>=e;e+=t.blockSize)t.I(o.subarray(16*f,16*(f+1))),f+=1;return n.splice(0,16*f),t}D(){const e=this;let t=e.C;const n=e.S;t=C.concat(t,[C.h(1,1)]);for(let e=t.length+2;15&e;e++)t.push(0);for(t.push(r.floor(e._/4294967296)),t.push(0|e._);t.length;)e.I(t.splice(0,16));return e.reset(),n}V(e,t,n,r){return e>19?e>39?e>59?e>79?void 0:t^n^r:t&n|t&r|n&r:t^n^r:t&n|~t&r}P(e,t){return t<<e|t>>>32-e}I(t){const n=this,s=n.S,i=e(80);for(let e=0;16>e;e++)i[e]=t[e];let o=s[0],c=s[1],f=s[2],a=s[3],l=s[4];for(let e=0;79>=e;e++){16>e||(i[e]=n.P(1,i[e-3]^i[e-8]^i[e-14]^i[e-16]));const t=n.P(5,o)+n.V(e,c,f,a)+l+i[e]+n.v[r.floor(e/20)]|0;l=a,a=f,f=n.P(30,c),c=o,o=t}s[0]=s[0]+o|0,s[1]=s[1]+c|0,s[2]=s[2]+f|0,s[3]=s[3]+a|0,s[4]=s[4]+l|0}},A={getRandomValues(e){const t=new c(e.buffer),n=e=>{let t=987654321;const n=4294967295;return()=>(t=36969*(65535&t)+(t>>16)&n,(((t<<16)+(e=18e3*(65535&e)+(e>>16)&n)&n)/4294967296+.5)*(r.random()>.5?1:-1))};for(let s,i=0;i<e.length;i+=4){const e=n(4294967296*(s||r.random()));s=987654071*e(),t[i/4]=4294967296*e()|0}return e}},I={importKey:e=>new I.R(x.p.g(e)),B(e,t,n,r){if(n=n||1e4,0>r||0>n)throw new s("invalid params to pbkdf2");const i=1+(r>>5)<<2;let o,c,f,a,u;const w=new ArrayBuffer(i),h=new l(w);let d=0;const p=C;for(t=x.p.g(t),u=1;(i||1)>d;u++){for(o=c=e.encrypt(p.concat(t,[u])),f=1;n>f;f++)for(c=e.encrypt(c),a=0;a<c.length;a++)o[a]^=c[a];for(f=0;(i||1)>d&&f<o.length;f++)h.setInt32(d,o[f]),d+=4}return w.slice(0,r/8)},R:class{constructor(e){const t=this,n=t.M=_,r=[[],[]];t.K=[new n,new n];const s=t.K[0].blockSize/32;e.length>s&&(e=(new n).update(e).D());for(let t=0;s>t;t++)r[0][t]=909522486^e[t],r[1][t]=1549556828^e[t];t.K[0].update(r[0]),t.K[1].update(r[1]),t.U=new n(t.K[0])}reset(){const e=this;e.U=new e.M(e.K[0]),e.N=!1}update(e){this.N=!0,this.U.update(e)}digest(){const e=this,t=e.U.D(),n=new e.M(e.K[1]).update(t).D();return e.reset(),n}encrypt(e){if(this.N)throw new s("encrypt on already updated hmac called!");return this.update(e),this.digest(e)}}},D=void 0!==h&&"function"==typeof h.getRandomValues,V="Invalid password",P="Invalid signature",R="zipjs-abort-check-password";function B(e){return D?h.getRandomValues(e):A.getRandomValues(e)}const E=16,M={name:"PBKDF2"},K=t.assign({hash:{name:"HMAC"}},M),U=t.assign({iterations:1e3,hash:{name:"SHA-1"}},M),N=["deriveBits"],O=[8,12,16],T=[16,24,32],W=10,j=[0,0,0,0],H="undefined",L="function",F=typeof h!=H,q=F&&h.subtle,G=F&&typeof q!=H,J=x.p,Q=class{constructor(e){const t=this;t.O=[[[],[],[],[],[]],[[],[],[],[],[]]],t.O[0][0][0]||t.T();const n=t.O[0][4],r=t.O[1],i=e.length;let o,c,f,a=1;if(4!==i&&6!==i&&8!==i)throw new s("invalid aes key size");for(t.v=[c=e.slice(0),f=[]],o=i;4*i+28>o;o++){let e=c[o-1];(o%i==0||8===i&&o%i==4)&&(e=n[e>>>24]<<24^n[e>>16&255]<<16^n[e>>8&255]<<8^n[255&e],o%i==0&&(e=e<<8^e>>>24^a<<24,a=a<<1^283*(a>>7))),c[o]=c[o-i]^e}for(let e=0;o;e++,o--){const t=c[3&e?o:o-4];f[e]=4>=o||4>e?t:r[0][n[t>>>24]]^r[1][n[t>>16&255]]^r[2][n[t>>8&255]]^r[3][n[255&t]]}}encrypt(e){return this.W(e,0)}decrypt(e){return this.W(e,1)}T(){const e=this.O[0],t=this.O[1],n=e[4],r=t[4],s=[],i=[];let o,c,f,a;for(let e=0;256>e;e++)i[(s[e]=e<<1^283*(e>>7))^e]=e;for(let l=o=0;!n[l];l^=c||1,o=i[o]||1){let i=o^o<<1^o<<2^o<<3^o<<4;i=i>>8^255&i^99,n[l]=i,r[i]=l,a=s[f=s[c=s[l]]];let u=16843009*a^65537*f^257*c^16843008*l,w=257*s[i]^16843008*i;for(let n=0;4>n;n++)e[n][l]=w=w<<24^w>>>8,t[n][i]=u=u<<24^u>>>8}for(let n=0;5>n;n++)e[n]=e[n].slice(0),t[n]=t[n].slice(0)}W(e,t){if(4!==e.length)throw new s("invalid aes block size");const n=this.v[t],r=n.length/4-2,i=[0,0,0,0],o=this.O[t],c=o[0],f=o[1],a=o[2],l=o[3],u=o[4];let w,h,d,p=e[0]^n[0],y=e[t?3:1]^n[1],m=e[2]^n[2],b=e[t?1:3]^n[3],g=4;for(let e=0;r>e;e++)w=c[p>>>24]^f[y>>16&255]^a[m>>8&255]^l[255&b]^n[g],h=c[y>>>24]^f[m>>16&255]^a[b>>8&255]^l[255&p]^n[g+1],d=c[m>>>24]^f[b>>16&255]^a[p>>8&255]^l[255&y]^n[g+2],b=c[b>>>24]^f[p>>16&255]^a[y>>8&255]^l[255&m]^n[g+3],g+=4,p=w,y=h,m=d;for(let e=0;4>e;e++)i[t?3&-e:e]=u[p>>>24]<<24^u[y>>16&255]<<16^u[m>>8&255]<<8^u[255&b]^n[g++],w=p,p=y,y=m,m=b,b=w;return i}},X=class{constructor(e,t){this.j=e,this.H=t,this.L=t}reset(){this.L=this.H}update(e){return this.F(this.j,e,this.L)}q(e){if(255==(e>>24&255)){let t=e>>16&255,n=e>>8&255,r=255&e;255===t?(t=0,255===n?(n=0,255===r?r=0:++r):++n):++t,e=0,e+=t<<16,e+=n<<8,e+=r}else e+=1<<24;return e}G(e){0===(e[0]=this.q(e[0]))&&(e[1]=this.q(e[1]))}F(e,t,n){let r;if(!(r=t.length))return[];const s=C.l(t);for(let s=0;r>s;s+=4){this.G(n);const r=e.encrypt(n);t[s]^=r[0],t[s+1]^=r[1],t[s+2]^=r[2],t[s+3]^=r[3]}return C.u(t,s)}},Y=I.R;let Z=F&&G&&typeof q.importKey==L,$=F&&G&&typeof q.deriveBits==L;class ee extends p{constructor({password:e,signed:n,encryptionStrength:r,checkPasswordOnly:o}){super({start(){t.assign(this,{ready:new u((e=>this.J=e)),password:e,signed:n,X:r-1,pending:new i})},async transform(e,t){const n=this,{password:r,X:c,J:f,ready:a}=n;r?(await(async(e,t,n,r)=>{const i=await re(e,t,n,ie(r,0,O[t])),o=ie(r,O[t]);if(i[0]!=o[0]||i[1]!=o[1])throw new s(V)})(n,c,r,ie(e,0,O[c]+2)),e=ie(e,O[c]+2),o?t.error(new s(R)):f()):await a;const l=new i(e.length-W-(e.length-W)%E);t.enqueue(ne(n,e,l,0,W,!0))},async flush(e){const{signed:t,Y:n,Z:r,pending:o,ready:c}=this;await c;const f=ie(o,0,o.length-W),a=ie(o,o.length-W);let l=new i;if(f.length){const e=ce(J,f);r.update(e);const t=n.update(e);l=oe(J,t)}if(t){const e=ie(oe(J,r.digest()),0,W);for(let t=0;W>t;t++)if(e[t]!=a[t])throw new s(P)}e.enqueue(l)}})}}class te extends p{constructor({password:e,encryptionStrength:n}){let r;super({start(){t.assign(this,{ready:new u((e=>this.J=e)),password:e,X:n-1,pending:new i})},async transform(e,t){const n=this,{password:r,X:s,J:o,ready:c}=n;let f=new i;r?(f=await(async(e,t,n)=>{const r=B(new i(O[t]));return se(r,await re(e,t,n,r))})(n,s,r),o()):await c;const a=new i(f.length+e.length-e.length%E);a.set(f,0),t.enqueue(ne(n,e,a,f.length,0))},async flush(e){const{Y:t,Z:n,pending:s,ready:o}=this;await o;let c=new i;if(s.length){const e=t.update(ce(J,s));n.update(e),c=oe(J,e)}r.signature=oe(J,n.digest()).slice(0,W),e.enqueue(se(c,r.signature))}}),r=this}}function ne(e,t,n,r,s,o){const{Y:c,Z:f,pending:a}=e,l=t.length-s;let u;for(a.length&&(t=se(a,t),n=((e,t)=>{if(t&&t>e.length){const n=e;(e=new i(t)).set(n,0)}return e})(n,l-l%E)),u=0;l-E>=u;u+=E){const e=ce(J,ie(t,u,u+E));o&&f.update(e);const s=c.update(e);o||f.update(s),n.set(oe(J,s),u+r)}return e.pending=ie(t,u),n}async function re(n,r,s,o){n.password=null;const c=(e=>{if(void 0===w){const t=new i((e=unescape(encodeURIComponent(e))).length);for(let n=0;n<t.length;n++)t[n]=e.charCodeAt(n);return t}return(new w).encode(e)})(s),f=await(async(e,t,n,r,s)=>{if(!Z)return I.importKey(t);try{return await q.importKey("raw",t,n,!1,s)}catch(e){return Z=!1,I.importKey(t)}})(0,c,K,0,N),a=await(async(e,t,n)=>{if(!$)return I.B(t,e.salt,U.iterations,n);try{return await q.deriveBits(e,t,n)}catch(r){return $=!1,I.B(t,e.salt,U.iterations,n)}})(t.assign({salt:o},U),f,8*(2*T[r]+2)),l=new i(a),u=ce(J,ie(l,0,T[r])),h=ce(J,ie(l,T[r],2*T[r])),d=ie(l,2*T[r]);return t.assign(n,{keys:{key:u,$:h,passwordVerification:d},Y:new X(new Q(u),e.from(j)),Z:new Y(h)}),d}function se(e,t){let n=e;return e.length+t.length&&(n=new i(e.length+t.length),n.set(e,0),n.set(t,e.length)),n}function ie(e,t,n){return e.subarray(t,n)}function oe(e,t){return e.m(t)}function ce(e,t){return e.g(t)}class fe extends p{constructor({password:e,passwordVerification:n,checkPasswordOnly:r}){super({start(){t.assign(this,{password:e,passwordVerification:n}),we(this,e)},transform(e,t){const n=this;if(n.password){const t=le(n,e.subarray(0,12));if(n.password=null,t[11]!=n.passwordVerification)throw new s(V);e=e.subarray(12)}r?t.error(new s(R)):t.enqueue(le(n,e))}})}}class ae extends p{constructor({password:e,passwordVerification:n}){super({start(){t.assign(this,{password:e,passwordVerification:n}),we(this,e)},transform(e,t){const n=this;let r,s;if(n.password){n.password=null;const t=B(new i(12));t[11]=n.passwordVerification,r=new i(e.length+t.length),r.set(ue(n,t),0),s=12}else r=new i(e.length),s=0;r.set(ue(n,e),s),t.enqueue(r)}})}}function le(e,t){const n=new i(t.length);for(let r=0;r<t.length;r++)n[r]=de(e)^t[r],he(e,n[r]);return n}function ue(e,t){const n=new i(t.length);for(let r=0;r<t.length;r++)n[r]=de(e)^t[r],he(e,t[r]);return n}function we(e,n){const r=[305419896,591751049,878082192];t.assign(e,{keys:r,ee:new S(r[0]),te:new S(r[2])});for(let t=0;t<n.length;t++)he(e,n.charCodeAt(t))}function he(e,t){let[n,s,i]=e.keys;e.ee.append([t]),n=~e.ee.get(),s=ye(r.imul(ye(s+pe(n)),134775813)+1),e.te.append([s>>>24]),i=~e.te.get(),e.keys=[n,s,i]}function de(e){const t=2|e.keys[2];return pe(r.imul(t,1^t)>>>8)}function pe(e){return 255&e}function ye(e){return 4294967295&e}const me="deflate-raw";class be extends p{constructor(e,{chunkSize:t,CompressionStream:n,CompressionStreamNative:r}){super({});const{compressed:s,encrypted:i,useCompressionStream:o,zipCrypto:c,signed:f,level:a}=e,u=this;let w,h,d=ke(super.readable);i&&!c||!f||(w=new z,d=ze(d,w)),s&&(d=Se(d,o,{level:a,chunkSize:t},r,n)),i&&(c?d=ze(d,new ae(e)):(h=new te(e),d=ze(d,h))),ve(u,d,(async()=>{let e;i&&!c&&(e=h.signature),i&&!c||!f||(e=new l(w.value.buffer).getUint32(0)),u.signature=e}))}}class ge extends p{constructor(e,{chunkSize:t,DecompressionStream:n,DecompressionStreamNative:r}){super({});const{zipCrypto:i,encrypted:o,signed:c,signature:f,compressed:a,useCompressionStream:u}=e;let w,h,d=ke(super.readable);o&&(i?d=ze(d,new fe(e)):(h=new ee(e),d=ze(d,h))),a&&(d=Se(d,u,{chunkSize:t},r,n)),o&&!i||!c||(w=new z,d=ze(d,w)),ve(this,d,(async()=>{if((!o||i)&&c){const e=new l(w.value.buffer);if(f!=e.getUint32(0,!1))throw new s(P)}}))}}function ke(e){return ze(e,new p({transform(e,t){e&&e.length&&t.enqueue(e)}}))}function ve(e,n,r){n=ze(n,new p({flush:r})),t.defineProperty(e,"readable",{get:()=>n})}function Se(e,t,n,r,s){try{e=ze(e,new(t&&r?r:s)(me,n))}catch(r){if(!t)throw r;e=ze(e,new s(me,n))}return e}function ze(e,t){return e.pipeThrough(t)}const Ce="data";class xe extends p{constructor(e,n){super({});const r=this,{codecType:s}=e;let i;s.startsWith("deflate")?i=be:s.startsWith("inflate")&&(i=ge);let o=0;const c=new i(e,n),f=super.readable,a=new p({transform(e,t){e&&e.length&&(o+=e.length,t.enqueue(e))},flush(){const{signature:e}=c;t.assign(r,{signature:e,size:o})}});t.defineProperty(r,"readable",{get:()=>f.pipeThrough(c).pipeThrough(a)})}}const _e=new a,Ae=new a;let Ie=0;async function De(e){try{const{options:t,scripts:r,config:s}=e;r&&r.length&&importScripts.apply(void 0,r),self.initCodec&&self.initCodec(),s.CompressionStreamNative=self.CompressionStream,s.DecompressionStreamNative=self.DecompressionStream,self.Deflate&&(s.CompressionStream=new k(self.Deflate)),self.Inflate&&(s.DecompressionStream=new k(self.Inflate));const i={highWaterMark:1,size:()=>s.chunkSize},o=e.readable||new y({async pull(e){const t=new u((e=>_e.set(Ie,e)));Ve({type:"pull",messageId:Ie}),Ie=(Ie+1)%n.MAX_SAFE_INTEGER;const{value:r,done:s}=await t;e.enqueue(r),s&&e.close()}},i),c=e.writable||new m({async write(e){let t;const r=new u((e=>t=e));Ae.set(Ie,t),Ve({type:Ce,value:e,messageId:Ie}),Ie=(Ie+1)%n.MAX_SAFE_INTEGER,await r}},i),f=new xe(t,s);await o.pipeThrough(f).pipeTo(c,{preventClose:!0,preventAbort:!0});try{await c.getWriter().close()}catch(e){}const{signature:a,size:l}=f;Ve({type:"close",result:{signature:a,size:l}})}catch(e){Pe(e)}}function Ve(e){let{value:t}=e;if(t)if(t.length)try{t=new i(t),e.value=t.buffer,d(e,[e.value])}catch(t){d(e)}else d(e);else d(e)}function Pe(e){const{message:t,stack:n,code:r,name:s}=e;d({error:{message:t,stack:n,code:r,name:s}})}addEventListener("message",(({data:e})=>{const{type:t,messageId:n,value:r,done:s}=e;try{if("start"==t&&De(e),t==Ce){const e=_e.get(n);_e.delete(n),e({value:new i(r),done:s})}if("ack"==t){const e=Ae.get(n);Ae.delete(n),e()}}catch(e){Pe(e)}}));const Re=-2;function Be(t){return Ee(t.map((([t,n])=>new e(t).fill(n,0,t))))}function Ee(t){return t.reduce(((t,n)=>t.concat(e.isArray(n)?Ee(n):n)),[])}const Me=[0,1,2,3].concat(...Be([[2,4],[2,5],[4,6],[4,7],[8,8],[8,9],[16,10],[16,11],[32,12],[32,13],[64,14],[64,15],[2,0],[1,16],[1,17],[2,18],[2,19],[4,20],[4,21],[8,22],[8,23],[16,24],[16,25],[32,26],[32,27],[64,28],[64,29]]));function Ke(){const e=this;function t(e,t){let n=0;do{n|=1&e,e>>>=1,n<<=1}while(--t>0);return n>>>1}e.ne=n=>{const s=e.re,i=e.ie.se,o=e.ie.oe;let c,f,a,l=-1;for(n.ce=0,n.fe=573,c=0;o>c;c++)0!==s[2*c]?(n.ae[++n.ce]=l=c,n.le[c]=0):s[2*c+1]=0;for(;2>n.ce;)a=n.ae[++n.ce]=2>l?++l:0,s[2*a]=1,n.le[a]=0,n.ue--,i&&(n.we-=i[2*a+1]);for(e.he=l,c=r.floor(n.ce/2);c>=1;c--)n.de(s,c);a=o;do{c=n.ae[1],n.ae[1]=n.ae[n.ce--],n.de(s,1),f=n.ae[1],n.ae[--n.fe]=c,n.ae[--n.fe]=f,s[2*a]=s[2*c]+s[2*f],n.le[a]=r.max(n.le[c],n.le[f])+1,s[2*c+1]=s[2*f+1]=a,n.ae[1]=a++,n.de(s,1)}while(n.ce>=2);n.ae[--n.fe]=n.ae[1],(t=>{const n=e.re,r=e.ie.se,s=e.ie.pe,i=e.ie.ye,o=e.ie.me;let c,f,a,l,u,w,h=0;for(l=0;15>=l;l++)t.be[l]=0;for(n[2*t.ae[t.fe]+1]=0,c=t.fe+1;573>c;c++)f=t.ae[c],l=n[2*n[2*f+1]+1]+1,l>o&&(l=o,h++),n[2*f+1]=l,f>e.he||(t.be[l]++,u=0,i>f||(u=s[f-i]),w=n[2*f],t.ue+=w*(l+u),r&&(t.we+=w*(r[2*f+1]+u)));if(0!==h){do{for(l=o-1;0===t.be[l];)l--;t.be[l]--,t.be[l+1]+=2,t.be[o]--,h-=2}while(h>0);for(l=o;0!==l;l--)for(f=t.be[l];0!==f;)a=t.ae[--c],a>e.he||(n[2*a+1]!=l&&(t.ue+=(l-n[2*a+1])*n[2*a],n[2*a+1]=l),f--)}})(n),((e,n,r)=>{const s=[];let i,o,c,f=0;for(i=1;15>=i;i++)s[i]=f=f+r[i-1]<<1;for(o=0;n>=o;o++)c=e[2*o+1],0!==c&&(e[2*o]=t(s[c]++,c))})(s,e.he,n.be)}}function Ue(e,t,n,r,s){const i=this;i.se=e,i.pe=t,i.ye=n,i.oe=r,i.me=s}Ke.ge=[0,1,2,3,4,5,6,7].concat(...Be([[2,8],[2,9],[2,10],[2,11],[4,12],[4,13],[4,14],[4,15],[8,16],[8,17],[8,18],[8,19],[16,20],[16,21],[16,22],[16,23],[32,24],[32,25],[32,26],[31,27],[1,28]])),Ke.ke=[0,1,2,3,4,5,6,7,8,10,12,14,16,20,24,28,32,40,48,56,64,80,96,112,128,160,192,224,0],Ke.ve=[0,1,2,3,4,6,8,12,16,24,32,48,64,96,128,192,256,384,512,768,1024,1536,2048,3072,4096,6144,8192,12288,16384,24576],Ke.Se=e=>256>e?Me[e]:Me[256+(e>>>7)],Ke.ze=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],Ke.Ce=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],Ke.xe=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],Ke._e=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];const Ne=Be([[144,8],[112,9],[24,7],[8,8]]);Ue.Ae=Ee([12,140,76,204,44,172,108,236,28,156,92,220,60,188,124,252,2,130,66,194,34,162,98,226,18,146,82,210,50,178,114,242,10,138,74,202,42,170,106,234,26,154,90,218,58,186,122,250,6,134,70,198,38,166,102,230,22,150,86,214,54,182,118,246,14,142,78,206,46,174,110,238,30,158,94,222,62,190,126,254,1,129,65,193,33,161,97,225,17,145,81,209,49,177,113,241,9,137,73,201,41,169,105,233,25,153,89,217,57,185,121,249,5,133,69,197,37,165,101,229,21,149,85,213,53,181,117,245,13,141,77,205,45,173,109,237,29,157,93,221,61,189,125,253,19,275,147,403,83,339,211,467,51,307,179,435,115,371,243,499,11,267,139,395,75,331,203,459,43,299,171,427,107,363,235,491,27,283,155,411,91,347,219,475,59,315,187,443,123,379,251,507,7,263,135,391,71,327,199,455,39,295,167,423,103,359,231,487,23,279,151,407,87,343,215,471,55,311,183,439,119,375,247,503,15,271,143,399,79,335,207,463,47,303,175,431,111,367,239,495,31,287,159,415,95,351,223,479,63,319,191,447,127,383,255,511,0,64,32,96,16,80,48,112,8,72,40,104,24,88,56,120,4,68,36,100,20,84,52,116,3,131,67,195,35,163,99,227].map(((e,t)=>[e,Ne[t]])));const Oe=Be([[30,5]]);function Te(e,t,n,r,s){const i=this;i.Ie=e,i.De=t,i.Ve=n,i.Pe=r,i.Re=s}Ue.Be=Ee([0,16,8,24,4,20,12,28,2,18,10,26,6,22,14,30,1,17,9,25,5,21,13,29,3,19,11,27,7,23].map(((e,t)=>[e,Oe[t]]))),Ue.Ee=new Ue(Ue.Ae,Ke.ze,257,286,15),Ue.Me=new Ue(Ue.Be,Ke.Ce,0,30,15),Ue.Ke=new Ue(null,Ke.xe,0,19,7);const We=[new Te(0,0,0,0,0),new Te(4,4,8,4,1),new Te(4,5,16,8,1),new Te(4,6,32,32,1),new Te(4,4,16,16,2),new Te(8,16,32,32,2),new Te(8,16,128,128,2),new Te(8,32,128,256,2),new Te(32,128,258,1024,2),new Te(32,258,258,4096,2)],je=["need dictionary","stream end","","","stream error","data error","","buffer error","",""],He=113,Le=666,Fe=262;function qe(e,t,n,r){const s=e[2*t],i=e[2*n];return i>s||s==i&&r[t]<=r[n]}function Ge(){const e=this;let t,n,s,c,f,a,l,u,w,h,d,p,y,m,b,g,k,v,S,z,C,x,_,A,I,D,V,P,R,B,E,M,K;const U=new Ke,N=new Ke,O=new Ke;let T,W,j,H,L,F;function q(){let t;for(t=0;286>t;t++)E[2*t]=0;for(t=0;30>t;t++)M[2*t]=0;for(t=0;19>t;t++)K[2*t]=0;E[512]=1,e.ue=e.we=0,W=j=0}function G(e,t){let n,r=-1,s=e[1],i=0,o=7,c=4;0===s&&(o=138,c=3),e[2*(t+1)+1]=65535;for(let f=0;t>=f;f++)n=s,s=e[2*(f+1)+1],++i<o&&n==s||(c>i?K[2*n]+=i:0!==n?(n!=r&&K[2*n]++,K[32]++):i>10?K[36]++:K[34]++,i=0,r=n,0===s?(o=138,c=3):n==s?(o=6,c=3):(o=7,c=4))}function J(t){e.Ue[e.pending++]=t}function Q(e){J(255&e),J(e>>>8&255)}function X(e,t){let n;const r=t;F>16-r?(n=e,L|=n<<F&65535,Q(L),L=n>>>16-F,F+=r-16):(L|=e<<F&65535,F+=r)}function Y(e,t){const n=2*e;X(65535&t[n],65535&t[n+1])}function Z(e,t){let n,r,s=-1,i=e[1],o=0,c=7,f=4;for(0===i&&(c=138,f=3),n=0;t>=n;n++)if(r=i,i=e[2*(n+1)+1],++o>=c||r!=i){if(f>o)do{Y(r,K)}while(0!=--o);else 0!==r?(r!=s&&(Y(r,K),o--),Y(16,K),X(o-3,2)):o>10?(Y(18,K),X(o-11,7)):(Y(17,K),X(o-3,3));o=0,s=r,0===i?(c=138,f=3):r==i?(c=6,f=3):(c=7,f=4)}}function $(){16==F?(Q(L),L=0,F=0):8>F||(J(255&L),L>>>=8,F-=8)}function ee(t,n){let s,i,o;if(e.Ne[W]=t,e.Oe[W]=255&n,W++,0===t?E[2*n]++:(j++,t--,E[2*(Ke.ge[n]+256+1)]++,M[2*Ke.Se(t)]++),0==(8191&W)&&V>2){for(s=8*W,i=C-k,o=0;30>o;o++)s+=M[2*o]*(5+Ke.Ce[o]);if(s>>>=3,j<r.floor(W/2)&&s<r.floor(i/2))return!0}return W==T-1}function te(t,n){let r,s,i,o,c=0;if(0!==W)do{r=e.Ne[c],s=e.Oe[c],c++,0===r?Y(s,t):(i=Ke.ge[s],Y(i+256+1,t),o=Ke.ze[i],0!==o&&(s-=Ke.ke[i],X(s,o)),r--,i=Ke.Se(r),Y(i,n),o=Ke.Ce[i],0!==o&&(r-=Ke.ve[i],X(r,o)))}while(W>c);Y(256,t),H=t[513]}function ne(){F>8?Q(L):F>0&&J(255&L),L=0,F=0}function re(t,n,r){X(0+(r?1:0),3),((t,n)=>{ne(),H=8,Q(n),Q(~n),e.Ue.set(u.subarray(t,t+n),e.pending),e.pending+=n})(t,n)}function se(n){((t,n,r)=>{let s,i,o=0;V>0?(U.ne(e),N.ne(e),o=(()=>{let t;for(G(E,U.he),G(M,N.he),O.ne(e),t=18;t>=3&&0===K[2*Ke._e[t]+1];t--);return e.ue+=14+3*(t+1),t})(),s=e.ue+3+7>>>3,i=e.we+3+7>>>3,i>s||(s=i)):s=i=n+5,n+4>s||-1==t?i==s?(X(2+(r?1:0),3),te(Ue.Ae,Ue.Be)):(X(4+(r?1:0),3),((e,t,n)=>{let r;for(X(e-257,5),X(t-1,5),X(n-4,4),r=0;n>r;r++)X(K[2*Ke._e[r]+1],3);Z(E,e-1),Z(M,t-1)})(U.he+1,N.he+1,o+1),te(E,M)):re(t,n,r),q(),r&&ne()})(0>k?-1:k,C-k,n),k=C,t.Te()}function ie(){let e,n,r,s;do{if(s=w-_-C,0===s&&0===C&&0===_)s=f;else if(-1==s)s--;else if(C>=f+f-Fe){u.set(u.subarray(f,f+f),0),x-=f,C-=f,k-=f,e=y,r=e;do{n=65535&d[--r],d[r]=f>n?0:n-f}while(0!=--e);e=f,r=e;do{n=65535&h[--r],h[r]=f>n?0:n-f}while(0!=--e);s+=f}if(0===t.We)return;e=t.je(u,C+_,s),_+=e,3>_||(p=255&u[C],p=(p<<g^255&u[C+1])&b)}while(Fe>_&&0!==t.We)}function oe(e){let t,n,r=I,s=C,i=A;const o=C>f-Fe?C-(f-Fe):0;let c=B;const a=l,w=C+258;let d=u[s+i-1],p=u[s+i];R>A||(r>>=2),c>_&&(c=_);do{if(t=e,u[t+i]==p&&u[t+i-1]==d&&u[t]==u[s]&&u[++t]==u[s+1]){s+=2,t++;do{}while(u[++s]==u[++t]&&u[++s]==u[++t]&&u[++s]==u[++t]&&u[++s]==u[++t]&&u[++s]==u[++t]&&u[++s]==u[++t]&&u[++s]==u[++t]&&u[++s]==u[++t]&&w>s);if(n=258-(w-s),s=w-258,n>i){if(x=e,i=n,n>=c)break;d=u[s+i-1],p=u[s+i]}}}while((e=65535&h[e&a])>o&&0!=--r);return i>_?_:i}e.le=[],e.be=[],e.ae=[],E=[],M=[],K=[],e.de=(t,n)=>{const r=e.ae,s=r[n];let i=n<<1;for(;i<=e.ce&&(i<e.ce&&qe(t,r[i+1],r[i],e.le)&&i++,!qe(t,s,r[i],e.le));)r[n]=r[i],n=i,i<<=1;r[n]=s},e.He=(t,S,x,W,j,G)=>(W||(W=8),j||(j=8),G||(G=0),t.Le=null,-1==S&&(S=6),1>j||j>9||8!=W||9>x||x>15||0>S||S>9||0>G||G>2?Re:(t.Fe=e,a=x,f=1<<a,l=f-1,m=j+7,y=1<<m,b=y-1,g=r.floor((m+3-1)/3),u=new i(2*f),h=[],d=[],T=1<<j+6,e.Ue=new i(4*T),s=4*T,e.Ne=new o(T),e.Oe=new i(T),V=S,P=G,(t=>(t.qe=t.Ge=0,t.Le=null,e.pending=0,e.Je=0,n=He,c=0,U.re=E,U.ie=Ue.Ee,N.re=M,N.ie=Ue.Me,O.re=K,O.ie=Ue.Ke,L=0,F=0,H=8,q(),(()=>{w=2*f,d[y-1]=0;for(let e=0;y-1>e;e++)d[e]=0;D=We[V].De,R=We[V].Ie,B=We[V].Ve,I=We[V].Pe,C=0,k=0,_=0,v=A=2,z=0,p=0})(),0))(t))),e.Qe=()=>42!=n&&n!=He&&n!=Le?Re:(e.Oe=null,e.Ne=null,e.Ue=null,d=null,h=null,u=null,e.Fe=null,n==He?-3:0),e.Xe=(e,t,n)=>{let r=0;return-1==t&&(t=6),0>t||t>9||0>n||n>2?Re:(We[V].Re!=We[t].Re&&0!==e.qe&&(r=e.Ye(1)),V!=t&&(V=t,D=We[V].De,R=We[V].Ie,B=We[V].Ve,I=We[V].Pe),P=n,r)},e.Ze=(e,t,r)=>{let s,i=r,o=0;if(!t||42!=n)return Re;if(3>i)return 0;for(i>f-Fe&&(i=f-Fe,o=r-i),u.set(t.subarray(o,o+i),0),C=i,k=i,p=255&u[0],p=(p<<g^255&u[1])&b,s=0;i-3>=s;s++)p=(p<<g^255&u[s+2])&b,h[s&l]=d[p],d[p]=s;return 0},e.Ye=(r,i)=>{let o,w,m,I,R;if(i>4||0>i)return Re;if(!r.$e||!r.et&&0!==r.We||n==Le&&4!=i)return r.Le=je[4],Re;if(0===r.tt)return r.Le=je[7],-5;var B;if(t=r,I=c,c=i,42==n&&(w=8+(a-8<<4)<<8,m=(V-1&255)>>1,m>3&&(m=3),w|=m<<6,0!==C&&(w|=32),w+=31-w%31,n=He,J((B=w)>>8&255),J(255&B)),0!==e.pending){if(t.Te(),0===t.tt)return c=-1,0}else if(0===t.We&&I>=i&&4!=i)return t.Le=je[7],-5;if(n==Le&&0!==t.We)return r.Le=je[7],-5;if(0!==t.We||0!==_||0!=i&&n!=Le){switch(R=-1,We[V].Re){case 0:R=(e=>{let n,r=65535;for(r>s-5&&(r=s-5);;){if(1>=_){if(ie(),0===_&&0==e)return 0;if(0===_)break}if(C+=_,_=0,n=k+r,(0===C||C>=n)&&(_=C-n,C=n,se(!1),0===t.tt))return 0;if(C-k>=f-Fe&&(se(!1),0===t.tt))return 0}return se(4==e),0===t.tt?4==e?2:0:4==e?3:1})(i);break;case 1:R=(e=>{let n,r=0;for(;;){if(Fe>_){if(ie(),Fe>_&&0==e)return 0;if(0===_)break}if(3>_||(p=(p<<g^255&u[C+2])&b,r=65535&d[p],h[C&l]=d[p],d[p]=C),0===r||(C-r&65535)>f-Fe||2!=P&&(v=oe(r)),3>v)n=ee(0,255&u[C]),_--,C++;else if(n=ee(C-x,v-3),_-=v,v>D||3>_)C+=v,v=0,p=255&u[C],p=(p<<g^255&u[C+1])&b;else{v--;do{C++,p=(p<<g^255&u[C+2])&b,r=65535&d[p],h[C&l]=d[p],d[p]=C}while(0!=--v);C++}if(n&&(se(!1),0===t.tt))return 0}return se(4==e),0===t.tt?4==e?2:0:4==e?3:1})(i);break;case 2:R=(e=>{let n,r,s=0;for(;;){if(Fe>_){if(ie(),Fe>_&&0==e)return 0;if(0===_)break}if(3>_||(p=(p<<g^255&u[C+2])&b,s=65535&d[p],h[C&l]=d[p],d[p]=C),A=v,S=x,v=2,0!==s&&D>A&&f-Fe>=(C-s&65535)&&(2!=P&&(v=oe(s)),5>=v&&(1==P||3==v&&C-x>4096)&&(v=2)),3>A||v>A)if(0!==z){if(n=ee(0,255&u[C-1]),n&&se(!1),C++,_--,0===t.tt)return 0}else z=1,C++,_--;else{r=C+_-3,n=ee(C-1-S,A-3),_-=A-1,A-=2;do{++C>r||(p=(p<<g^255&u[C+2])&b,s=65535&d[p],h[C&l]=d[p],d[p]=C)}while(0!=--A);if(z=0,v=2,C++,n&&(se(!1),0===t.tt))return 0}}return 0!==z&&(n=ee(0,255&u[C-1]),z=0),se(4==e),0===t.tt?4==e?2:0:4==e?3:1})(i)}if(2!=R&&3!=R||(n=Le),0==R||2==R)return 0===t.tt&&(c=-1),0;if(1==R){if(1==i)X(2,3),Y(256,Ue.Ae),$(),9>1+H+10-F&&(X(2,3),Y(256,Ue.Ae),$()),H=7;else if(re(0,0,!1),3==i)for(o=0;y>o;o++)d[o]=0;if(t.Te(),0===t.tt)return c=-1,0}}return 4!=i?0:1}}function Je(){const e=this;e.nt=0,e.rt=0,e.We=0,e.qe=0,e.tt=0,e.Ge=0}function Qe(e){const t=new Je,n=(o=e&&e.chunkSize?e.chunkSize:65536)+5*(r.floor(o/16383)+1);var o;const c=new i(n);let f=e?e.level:-1;void 0===f&&(f=-1),t.He(f),t.$e=c,this.append=(e,r)=>{let o,f,a=0,l=0,u=0;const w=[];if(e.length){t.nt=0,t.et=e,t.We=e.length;do{if(t.rt=0,t.tt=n,o=t.Ye(0),0!=o)throw new s("deflating: "+t.Le);t.rt&&(t.rt==n?w.push(new i(c)):w.push(c.subarray(0,t.rt))),u+=t.rt,r&&t.nt>0&&t.nt!=a&&(r(t.nt),a=t.nt)}while(t.We>0||0===t.tt);return w.length>1?(f=new i(u),w.forEach((e=>{f.set(e,l),l+=e.length}))):f=w[0]?new i(w[0]):new i,f}},this.flush=()=>{let e,r,o=0,f=0;const a=[];do{if(t.rt=0,t.tt=n,e=t.Ye(4),1!=e&&0!=e)throw new s("deflating: "+t.Le);n-t.tt>0&&a.push(c.slice(0,t.rt)),f+=t.rt}while(t.We>0||0===t.tt);return t.Qe(),r=new i(f),a.forEach((e=>{r.set(e,o),o+=e.length})),r}}Je.prototype={He(e,t){const n=this;return n.Fe=new Ge,t||(t=15),n.Fe.He(n,e,t)},Ye(e){const t=this;return t.Fe?t.Fe.Ye(t,e):Re},Qe(){const e=this;if(!e.Fe)return Re;const t=e.Fe.Qe();return e.Fe=null,t},Xe(e,t){const n=this;return n.Fe?n.Fe.Xe(n,e,t):Re},Ze(e,t){const n=this;return n.Fe?n.Fe.Ze(n,e,t):Re},je(e,t,n){const r=this;let s=r.We;return s>n&&(s=n),0===s?0:(r.We-=s,e.set(r.et.subarray(r.nt,r.nt+s),t),r.nt+=s,r.qe+=s,s)},Te(){const e=this;let t=e.Fe.pending;t>e.tt&&(t=e.tt),0!==t&&(e.$e.set(e.Fe.Ue.subarray(e.Fe.Je,e.Fe.Je+t),e.rt),e.rt+=t,e.Fe.Je+=t,e.Ge+=t,e.tt-=t,e.Fe.pending-=t,0===e.Fe.pending&&(e.Fe.Je=0))}};const Xe=-2,Ye=-3,Ze=-5,$e=[0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535],et=[96,7,256,0,8,80,0,8,16,84,8,115,82,7,31,0,8,112,0,8,48,0,9,192,80,7,10,0,8,96,0,8,32,0,9,160,0,8,0,0,8,128,0,8,64,0,9,224,80,7,6,0,8,88,0,8,24,0,9,144,83,7,59,0,8,120,0,8,56,0,9,208,81,7,17,0,8,104,0,8,40,0,9,176,0,8,8,0,8,136,0,8,72,0,9,240,80,7,4,0,8,84,0,8,20,85,8,227,83,7,43,0,8,116,0,8,52,0,9,200,81,7,13,0,8,100,0,8,36,0,9,168,0,8,4,0,8,132,0,8,68,0,9,232,80,7,8,0,8,92,0,8,28,0,9,152,84,7,83,0,8,124,0,8,60,0,9,216,82,7,23,0,8,108,0,8,44,0,9,184,0,8,12,0,8,140,0,8,76,0,9,248,80,7,3,0,8,82,0,8,18,85,8,163,83,7,35,0,8,114,0,8,50,0,9,196,81,7,11,0,8,98,0,8,34,0,9,164,0,8,2,0,8,130,0,8,66,0,9,228,80,7,7,0,8,90,0,8,26,0,9,148,84,7,67,0,8,122,0,8,58,0,9,212,82,7,19,0,8,106,0,8,42,0,9,180,0,8,10,0,8,138,0,8,74,0,9,244,80,7,5,0,8,86,0,8,22,192,8,0,83,7,51,0,8,118,0,8,54,0,9,204,81,7,15,0,8,102,0,8,38,0,9,172,0,8,6,0,8,134,0,8,70,0,9,236,80,7,9,0,8,94,0,8,30,0,9,156,84,7,99,0,8,126,0,8,62,0,9,220,82,7,27,0,8,110,0,8,46,0,9,188,0,8,14,0,8,142,0,8,78,0,9,252,96,7,256,0,8,81,0,8,17,85,8,131,82,7,31,0,8,113,0,8,49,0,9,194,80,7,10,0,8,97,0,8,33,0,9,162,0,8,1,0,8,129,0,8,65,0,9,226,80,7,6,0,8,89,0,8,25,0,9,146,83,7,59,0,8,121,0,8,57,0,9,210,81,7,17,0,8,105,0,8,41,0,9,178,0,8,9,0,8,137,0,8,73,0,9,242,80,7,4,0,8,85,0,8,21,80,8,258,83,7,43,0,8,117,0,8,53,0,9,202,81,7,13,0,8,101,0,8,37,0,9,170,0,8,5,0,8,133,0,8,69,0,9,234,80,7,8,0,8,93,0,8,29,0,9,154,84,7,83,0,8,125,0,8,61,0,9,218,82,7,23,0,8,109,0,8,45,0,9,186,0,8,13,0,8,141,0,8,77,0,9,250,80,7,3,0,8,83,0,8,19,85,8,195,83,7,35,0,8,115,0,8,51,0,9,198,81,7,11,0,8,99,0,8,35,0,9,166,0,8,3,0,8,131,0,8,67,0,9,230,80,7,7,0,8,91,0,8,27,0,9,150,84,7,67,0,8,123,0,8,59,0,9,214,82,7,19,0,8,107,0,8,43,0,9,182,0,8,11,0,8,139,0,8,75,0,9,246,80,7,5,0,8,87,0,8,23,192,8,0,83,7,51,0,8,119,0,8,55,0,9,206,81,7,15,0,8,103,0,8,39,0,9,174,0,8,7,0,8,135,0,8,71,0,9,238,80,7,9,0,8,95,0,8,31,0,9,158,84,7,99,0,8,127,0,8,63,0,9,222,82,7,27,0,8,111,0,8,47,0,9,190,0,8,15,0,8,143,0,8,79,0,9,254,96,7,256,0,8,80,0,8,16,84,8,115,82,7,31,0,8,112,0,8,48,0,9,193,80,7,10,0,8,96,0,8,32,0,9,161,0,8,0,0,8,128,0,8,64,0,9,225,80,7,6,0,8,88,0,8,24,0,9,145,83,7,59,0,8,120,0,8,56,0,9,209,81,7,17,0,8,104,0,8,40,0,9,177,0,8,8,0,8,136,0,8,72,0,9,241,80,7,4,0,8,84,0,8,20,85,8,227,83,7,43,0,8,116,0,8,52,0,9,201,81,7,13,0,8,100,0,8,36,0,9,169,0,8,4,0,8,132,0,8,68,0,9,233,80,7,8,0,8,92,0,8,28,0,9,153,84,7,83,0,8,124,0,8,60,0,9,217,82,7,23,0,8,108,0,8,44,0,9,185,0,8,12,0,8,140,0,8,76,0,9,249,80,7,3,0,8,82,0,8,18,85,8,163,83,7,35,0,8,114,0,8,50,0,9,197,81,7,11,0,8,98,0,8,34,0,9,165,0,8,2,0,8,130,0,8,66,0,9,229,80,7,7,0,8,90,0,8,26,0,9,149,84,7,67,0,8,122,0,8,58,0,9,213,82,7,19,0,8,106,0,8,42,0,9,181,0,8,10,0,8,138,0,8,74,0,9,245,80,7,5,0,8,86,0,8,22,192,8,0,83,7,51,0,8,118,0,8,54,0,9,205,81,7,15,0,8,102,0,8,38,0,9,173,0,8,6,0,8,134,0,8,70,0,9,237,80,7,9,0,8,94,0,8,30,0,9,157,84,7,99,0,8,126,0,8,62,0,9,221,82,7,27,0,8,110,0,8,46,0,9,189,0,8,14,0,8,142,0,8,78,0,9,253,96,7,256,0,8,81,0,8,17,85,8,131,82,7,31,0,8,113,0,8,49,0,9,195,80,7,10,0,8,97,0,8,33,0,9,163,0,8,1,0,8,129,0,8,65,0,9,227,80,7,6,0,8,89,0,8,25,0,9,147,83,7,59,0,8,121,0,8,57,0,9,211,81,7,17,0,8,105,0,8,41,0,9,179,0,8,9,0,8,137,0,8,73,0,9,243,80,7,4,0,8,85,0,8,21,80,8,258,83,7,43,0,8,117,0,8,53,0,9,203,81,7,13,0,8,101,0,8,37,0,9,171,0,8,5,0,8,133,0,8,69,0,9,235,80,7,8,0,8,93,0,8,29,0,9,155,84,7,83,0,8,125,0,8,61,0,9,219,82,7,23,0,8,109,0,8,45,0,9,187,0,8,13,0,8,141,0,8,77,0,9,251,80,7,3,0,8,83,0,8,19,85,8,195,83,7,35,0,8,115,0,8,51,0,9,199,81,7,11,0,8,99,0,8,35,0,9,167,0,8,3,0,8,131,0,8,67,0,9,231,80,7,7,0,8,91,0,8,27,0,9,151,84,7,67,0,8,123,0,8,59,0,9,215,82,7,19,0,8,107,0,8,43,0,9,183,0,8,11,0,8,139,0,8,75,0,9,247,80,7,5,0,8,87,0,8,23,192,8,0,83,7,51,0,8,119,0,8,55,0,9,207,81,7,15,0,8,103,0,8,39,0,9,175,0,8,7,0,8,135,0,8,71,0,9,239,80,7,9,0,8,95,0,8,31,0,9,159,84,7,99,0,8,127,0,8,63,0,9,223,82,7,27,0,8,111,0,8,47,0,9,191,0,8,15,0,8,143,0,8,79,0,9,255],tt=[80,5,1,87,5,257,83,5,17,91,5,4097,81,5,5,89,5,1025,85,5,65,93,5,16385,80,5,3,88,5,513,84,5,33,92,5,8193,82,5,9,90,5,2049,86,5,129,192,5,24577,80,5,2,87,5,385,83,5,25,91,5,6145,81,5,7,89,5,1537,85,5,97,93,5,24577,80,5,4,88,5,769,84,5,49,92,5,12289,82,5,13,90,5,3073,86,5,193,192,5,24577],nt=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],rt=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,112,112],st=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577],it=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13];function ot(){let e,t,n,r,s,i;function o(e,t,o,c,f,a,l,u,w,h,d){let p,y,m,b,g,k,v,S,z,C,x,_,A,I,D;C=0,g=o;do{n[e[t+C]]++,C++,g--}while(0!==g);if(n[0]==o)return l[0]=-1,u[0]=0,0;for(S=u[0],k=1;15>=k&&0===n[k];k++);for(v=k,k>S&&(S=k),g=15;0!==g&&0===n[g];g--);for(m=g,S>g&&(S=g),u[0]=S,I=1<<k;g>k;k++,I<<=1)if(0>(I-=n[k]))return Ye;if(0>(I-=n[g]))return Ye;for(n[g]+=I,i[1]=k=0,C=1,A=2;0!=--g;)i[A]=k+=n[C],A++,C++;g=0,C=0;do{0!==(k=e[t+C])&&(d[i[k]++]=g),C++}while(++g<o);for(o=i[m],i[0]=g=0,C=0,b=-1,_=-S,s[0]=0,x=0,D=0;m>=v;v++)for(p=n[v];0!=p--;){for(;v>_+S;){if(b++,_+=S,D=m-_,D=D>S?S:D,(y=1<<(k=v-_))>p+1&&(y-=p+1,A=v,D>k))for(;++k<D&&(y<<=1)>n[++A];)y-=n[A];if(D=1<<k,h[0]+D>1440)return Ye;s[b]=x=h[0],h[0]+=D,0!==b?(i[b]=g,r[0]=k,r[1]=S,k=g>>>_-S,r[2]=x-s[b-1]-k,w.set(r,3*(s[b-1]+k))):l[0]=x}for(r[1]=v-_,o>C?d[C]<c?(r[0]=256>d[C]?0:96,r[2]=d[C++]):(r[0]=a[d[C]-c]+16+64,r[2]=f[d[C++]-c]):r[0]=192,y=1<<v-_,k=g>>>_;D>k;k+=y)w.set(r,3*(x+k));for(k=1<<v-1;0!=(g&k);k>>>=1)g^=k;for(g^=k,z=(1<<_)-1;(g&z)!=i[b];)b--,_-=S,z=(1<<_)-1}return 0!==I&&1!=m?Ze:0}function c(o){let c;for(e||(e=[],t=[],n=new f(16),r=[],s=new f(15),i=new f(16)),t.length<o&&(t=[]),c=0;o>c;c++)t[c]=0;for(c=0;16>c;c++)n[c]=0;for(c=0;3>c;c++)r[c]=0;s.set(n.subarray(0,15),0),i.set(n.subarray(0,16),0)}this.st=(n,r,s,i,f)=>{let a;return c(19),e[0]=0,a=o(n,0,19,19,null,null,s,r,i,e,t),a==Ye?f.Le="oversubscribed dynamic bit lengths tree":a!=Ze&&0!==r[0]||(f.Le="incomplete dynamic bit lengths tree",a=Ye),a},this.it=(n,r,s,i,f,a,l,u,w)=>{let h;return c(288),e[0]=0,h=o(s,0,n,257,nt,rt,a,i,u,e,t),0!=h||0===i[0]?(h==Ye?w.Le="oversubscribed literal/length tree":-4!=h&&(w.Le="incomplete literal/length tree",h=Ye),h):(c(288),h=o(s,n,r,0,st,it,l,f,u,e,t),0!=h||0===f[0]&&n>257?(h==Ye?w.Le="oversubscribed distance tree":h==Ze?(w.Le="incomplete distance tree",h=Ye):-4!=h&&(w.Le="empty distance tree with lengths",h=Ye),h):0)}}function ct(){const e=this;let t,n,r,s,i=0,o=0,c=0,f=0,a=0,l=0,u=0,w=0,h=0,d=0;function p(e,t,n,r,s,i,o,c){let f,a,l,u,w,h,d,p,y,m,b,g,k,v,S,z;d=c.nt,p=c.We,w=o.ot,h=o.ct,y=o.write,m=y<o.read?o.read-y-1:o.end-y,b=$e[e],g=$e[t];do{for(;20>h;)p--,w|=(255&c.ft(d++))<<h,h+=8;if(f=w&b,a=n,l=r,z=3*(l+f),0!==(u=a[z]))for(;;){if(w>>=a[z+1],h-=a[z+1],0!=(16&u)){for(u&=15,k=a[z+2]+(w&$e[u]),w>>=u,h-=u;15>h;)p--,w|=(255&c.ft(d++))<<h,h+=8;for(f=w&g,a=s,l=i,z=3*(l+f),u=a[z];;){if(w>>=a[z+1],h-=a[z+1],0!=(16&u)){for(u&=15;u>h;)p--,w|=(255&c.ft(d++))<<h,h+=8;if(v=a[z+2]+(w&$e[u]),w>>=u,h-=u,m-=k,v>y){S=y-v;do{S+=o.end}while(0>S);if(u=o.end-S,k>u){if(k-=u,y-S>0&&u>y-S)do{o.lt[y++]=o.lt[S++]}while(0!=--u);else o.lt.set(o.lt.subarray(S,S+u),y),y+=u,S+=u,u=0;S=0}}else S=y-v,y-S>0&&2>y-S?(o.lt[y++]=o.lt[S++],o.lt[y++]=o.lt[S++],k-=2):(o.lt.set(o.lt.subarray(S,S+2),y),y+=2,S+=2,k-=2);if(y-S>0&&k>y-S)do{o.lt[y++]=o.lt[S++]}while(0!=--k);else o.lt.set(o.lt.subarray(S,S+k),y),y+=k,S+=k,k=0;break}if(0!=(64&u))return c.Le="invalid distance code",k=c.We-p,k=k>h>>3?h>>3:k,p+=k,d-=k,h-=k<<3,o.ot=w,o.ct=h,c.We=p,c.qe+=d-c.nt,c.nt=d,o.write=y,Ye;f+=a[z+2],f+=w&$e[u],z=3*(l+f),u=a[z]}break}if(0!=(64&u))return 0!=(32&u)?(k=c.We-p,k=k>h>>3?h>>3:k,p+=k,d-=k,h-=k<<3,o.ot=w,o.ct=h,c.We=p,c.qe+=d-c.nt,c.nt=d,o.write=y,1):(c.Le="invalid literal/length code",k=c.We-p,k=k>h>>3?h>>3:k,p+=k,d-=k,h-=k<<3,o.ot=w,o.ct=h,c.We=p,c.qe+=d-c.nt,c.nt=d,o.write=y,Ye);if(f+=a[z+2],f+=w&$e[u],z=3*(l+f),0===(u=a[z])){w>>=a[z+1],h-=a[z+1],o.lt[y++]=a[z+2],m--;break}}else w>>=a[z+1],h-=a[z+1],o.lt[y++]=a[z+2],m--}while(m>=258&&p>=10);return k=c.We-p,k=k>h>>3?h>>3:k,p+=k,d-=k,h-=k<<3,o.ot=w,o.ct=h,c.We=p,c.qe+=d-c.nt,c.nt=d,o.write=y,0}e.init=(e,i,o,c,f,a)=>{t=0,u=e,w=i,r=o,h=c,s=f,d=a,n=null},e.ut=(e,y,m)=>{let b,g,k,v,S,z,C,x=0,_=0,A=0;for(A=y.nt,v=y.We,x=e.ot,_=e.ct,S=e.write,z=S<e.read?e.read-S-1:e.end-S;;)switch(t){case 0:if(z>=258&&v>=10&&(e.ot=x,e.ct=_,y.We=v,y.qe+=A-y.nt,y.nt=A,e.write=S,m=p(u,w,r,h,s,d,e,y),A=y.nt,v=y.We,x=e.ot,_=e.ct,S=e.write,z=S<e.read?e.read-S-1:e.end-S,0!=m)){t=1==m?7:9;break}c=u,n=r,o=h,t=1;case 1:for(b=c;b>_;){if(0===v)return e.ot=x,e.ct=_,y.We=v,y.qe+=A-y.nt,y.nt=A,e.write=S,e.wt(y,m);m=0,v--,x|=(255&y.ft(A++))<<_,_+=8}if(g=3*(o+(x&$e[b])),x>>>=n[g+1],_-=n[g+1],k=n[g],0===k){f=n[g+2],t=6;break}if(0!=(16&k)){a=15&k,i=n[g+2],t=2;break}if(0==(64&k)){c=k,o=g/3+n[g+2];break}if(0!=(32&k)){t=7;break}return t=9,y.Le="invalid literal/length code",m=Ye,e.ot=x,e.ct=_,y.We=v,y.qe+=A-y.nt,y.nt=A,e.write=S,e.wt(y,m);case 2:for(b=a;b>_;){if(0===v)return e.ot=x,e.ct=_,y.We=v,y.qe+=A-y.nt,y.nt=A,e.write=S,e.wt(y,m);m=0,v--,x|=(255&y.ft(A++))<<_,_+=8}i+=x&$e[b],x>>=b,_-=b,c=w,n=s,o=d,t=3;case 3:for(b=c;b>_;){if(0===v)return e.ot=x,e.ct=_,y.We=v,y.qe+=A-y.nt,y.nt=A,e.write=S,e.wt(y,m);m=0,v--,x|=(255&y.ft(A++))<<_,_+=8}if(g=3*(o+(x&$e[b])),x>>=n[g+1],_-=n[g+1],k=n[g],0!=(16&k)){a=15&k,l=n[g+2],t=4;break}if(0==(64&k)){c=k,o=g/3+n[g+2];break}return t=9,y.Le="invalid distance code",m=Ye,e.ot=x,e.ct=_,y.We=v,y.qe+=A-y.nt,y.nt=A,e.write=S,e.wt(y,m);case 4:for(b=a;b>_;){if(0===v)return e.ot=x,e.ct=_,y.We=v,y.qe+=A-y.nt,y.nt=A,e.write=S,e.wt(y,m);m=0,v--,x|=(255&y.ft(A++))<<_,_+=8}l+=x&$e[b],x>>=b,_-=b,t=5;case 5:for(C=S-l;0>C;)C+=e.end;for(;0!==i;){if(0===z&&(S==e.end&&0!==e.read&&(S=0,z=S<e.read?e.read-S-1:e.end-S),0===z&&(e.write=S,m=e.wt(y,m),S=e.write,z=S<e.read?e.read-S-1:e.end-S,S==e.end&&0!==e.read&&(S=0,z=S<e.read?e.read-S-1:e.end-S),0===z)))return e.ot=x,e.ct=_,y.We=v,y.qe+=A-y.nt,y.nt=A,e.write=S,e.wt(y,m);e.lt[S++]=e.lt[C++],z--,C==e.end&&(C=0),i--}t=0;break;case 6:if(0===z&&(S==e.end&&0!==e.read&&(S=0,z=S<e.read?e.read-S-1:e.end-S),0===z&&(e.write=S,m=e.wt(y,m),S=e.write,z=S<e.read?e.read-S-1:e.end-S,S==e.end&&0!==e.read&&(S=0,z=S<e.read?e.read-S-1:e.end-S),0===z)))return e.ot=x,e.ct=_,y.We=v,y.qe+=A-y.nt,y.nt=A,e.write=S,e.wt(y,m);m=0,e.lt[S++]=f,z--,t=0;break;case 7:if(_>7&&(_-=8,v++,A--),e.write=S,m=e.wt(y,m),S=e.write,z=S<e.read?e.read-S-1:e.end-S,e.read!=e.write)return e.ot=x,e.ct=_,y.We=v,y.qe+=A-y.nt,y.nt=A,e.write=S,e.wt(y,m);t=8;case 8:return m=1,e.ot=x,e.ct=_,y.We=v,y.qe+=A-y.nt,y.nt=A,e.write=S,e.wt(y,m);case 9:return m=Ye,e.ot=x,e.ct=_,y.We=v,y.qe+=A-y.nt,y.nt=A,e.write=S,e.wt(y,m);default:return m=Xe,e.ot=x,e.ct=_,y.We=v,y.qe+=A-y.nt,y.nt=A,e.write=S,e.wt(y,m)}},e.ht=()=>{}}ot.dt=(e,t,n,r)=>(e[0]=9,t[0]=5,n[0]=et,r[0]=tt,0);const ft=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];function at(e,t){const n=this;let r,s=0,o=0,c=0,a=0;const l=[0],u=[0],w=new ct;let h=0,d=new f(4320);const p=new ot;n.ct=0,n.ot=0,n.lt=new i(t),n.end=t,n.read=0,n.write=0,n.reset=(e,t)=>{t&&(t[0]=0),6==s&&w.ht(e),s=0,n.ct=0,n.ot=0,n.read=n.write=0},n.reset(e,null),n.wt=(e,t)=>{let r,s,i;return s=e.rt,i=n.read,r=(i>n.write?n.end:n.write)-i,r>e.tt&&(r=e.tt),0!==r&&t==Ze&&(t=0),e.tt-=r,e.Ge+=r,e.$e.set(n.lt.subarray(i,i+r),s),s+=r,i+=r,i==n.end&&(i=0,n.write==n.end&&(n.write=0),r=n.write-i,r>e.tt&&(r=e.tt),0!==r&&t==Ze&&(t=0),e.tt-=r,e.Ge+=r,e.$e.set(n.lt.subarray(i,i+r),s),s+=r,i+=r),e.rt=s,n.read=i,t},n.ut=(e,t)=>{let i,f,y,m,b,g,k,v;for(m=e.nt,b=e.We,f=n.ot,y=n.ct,g=n.write,k=g<n.read?n.read-g-1:n.end-g;;){let S,z,C,x,_,A,I,D;switch(s){case 0:for(;3>y;){if(0===b)return n.ot=f,n.ct=y,e.We=b,e.qe+=m-e.nt,e.nt=m,n.write=g,n.wt(e,t);t=0,b--,f|=(255&e.ft(m++))<<y,y+=8}switch(i=7&f,h=1&i,i>>>1){case 0:f>>>=3,y-=3,i=7&y,f>>>=i,y-=i,s=1;break;case 1:S=[],z=[],C=[[]],x=[[]],ot.dt(S,z,C,x),w.init(S[0],z[0],C[0],0,x[0],0),f>>>=3,y-=3,s=6;break;case 2:f>>>=3,y-=3,s=3;break;case 3:return f>>>=3,y-=3,s=9,e.Le="invalid block type",t=Ye,n.ot=f,n.ct=y,e.We=b,e.qe+=m-e.nt,e.nt=m,n.write=g,n.wt(e,t)}break;case 1:for(;32>y;){if(0===b)return n.ot=f,n.ct=y,e.We=b,e.qe+=m-e.nt,e.nt=m,n.write=g,n.wt(e,t);t=0,b--,f|=(255&e.ft(m++))<<y,y+=8}if((~f>>>16&65535)!=(65535&f))return s=9,e.Le="invalid stored block lengths",t=Ye,n.ot=f,n.ct=y,e.We=b,e.qe+=m-e.nt,e.nt=m,n.write=g,n.wt(e,t);o=65535&f,f=y=0,s=0!==o?2:0!==h?7:0;break;case 2:if(0===b)return n.ot=f,n.ct=y,e.We=b,e.qe+=m-e.nt,e.nt=m,n.write=g,n.wt(e,t);if(0===k&&(g==n.end&&0!==n.read&&(g=0,k=g<n.read?n.read-g-1:n.end-g),0===k&&(n.write=g,t=n.wt(e,t),g=n.write,k=g<n.read?n.read-g-1:n.end-g,g==n.end&&0!==n.read&&(g=0,k=g<n.read?n.read-g-1:n.end-g),0===k)))return n.ot=f,n.ct=y,e.We=b,e.qe+=m-e.nt,e.nt=m,n.write=g,n.wt(e,t);if(t=0,i=o,i>b&&(i=b),i>k&&(i=k),n.lt.set(e.je(m,i),g),m+=i,b-=i,g+=i,k-=i,0!=(o-=i))break;s=0!==h?7:0;break;case 3:for(;14>y;){if(0===b)return n.ot=f,n.ct=y,e.We=b,e.qe+=m-e.nt,e.nt=m,n.write=g,n.wt(e,t);t=0,b--,f|=(255&e.ft(m++))<<y,y+=8}if(c=i=16383&f,(31&i)>29||(i>>5&31)>29)return s=9,e.Le="too many length or distance symbols",t=Ye,n.ot=f,n.ct=y,e.We=b,e.qe+=m-e.nt,e.nt=m,n.write=g,n.wt(e,t);if(i=258+(31&i)+(i>>5&31),!r||r.length<i)r=[];else for(v=0;i>v;v++)r[v]=0;f>>>=14,y-=14,a=0,s=4;case 4:for(;4+(c>>>10)>a;){for(;3>y;){if(0===b)return n.ot=f,n.ct=y,e.We=b,e.qe+=m-e.nt,e.nt=m,n.write=g,n.wt(e,t);t=0,b--,f|=(255&e.ft(m++))<<y,y+=8}r[ft[a++]]=7&f,f>>>=3,y-=3}for(;19>a;)r[ft[a++]]=0;if(l[0]=7,i=p.st(r,l,u,d,e),0!=i)return(t=i)==Ye&&(r=null,s=9),n.ot=f,n.ct=y,e.We=b,e.qe+=m-e.nt,e.nt=m,n.write=g,n.wt(e,t);a=0,s=5;case 5:for(;i=c,258+(31&i)+(i>>5&31)>a;){let o,w;for(i=l[0];i>y;){if(0===b)return n.ot=f,n.ct=y,e.We=b,e.qe+=m-e.nt,e.nt=m,n.write=g,n.wt(e,t);t=0,b--,f|=(255&e.ft(m++))<<y,y+=8}if(i=d[3*(u[0]+(f&$e[i]))+1],w=d[3*(u[0]+(f&$e[i]))+2],16>w)f>>>=i,y-=i,r[a++]=w;else{for(v=18==w?7:w-14,o=18==w?11:3;i+v>y;){if(0===b)return n.ot=f,n.ct=y,e.We=b,e.qe+=m-e.nt,e.nt=m,n.write=g,n.wt(e,t);t=0,b--,f|=(255&e.ft(m++))<<y,y+=8}if(f>>>=i,y-=i,o+=f&$e[v],f>>>=v,y-=v,v=a,i=c,v+o>258+(31&i)+(i>>5&31)||16==w&&1>v)return r=null,s=9,e.Le="invalid bit length repeat",t=Ye,n.ot=f,n.ct=y,e.We=b,e.qe+=m-e.nt,e.nt=m,n.write=g,n.wt(e,t);w=16==w?r[v-1]:0;do{r[v++]=w}while(0!=--o);a=v}}if(u[0]=-1,_=[],A=[],I=[],D=[],_[0]=9,A[0]=6,i=c,i=p.it(257+(31&i),1+(i>>5&31),r,_,A,I,D,d,e),0!=i)return i==Ye&&(r=null,s=9),t=i,n.ot=f,n.ct=y,e.We=b,e.qe+=m-e.nt,e.nt=m,n.write=g,n.wt(e,t);w.init(_[0],A[0],d,I[0],d,D[0]),s=6;case 6:if(n.ot=f,n.ct=y,e.We=b,e.qe+=m-e.nt,e.nt=m,n.write=g,1!=(t=w.ut(n,e,t)))return n.wt(e,t);if(t=0,w.ht(e),m=e.nt,b=e.We,f=n.ot,y=n.ct,g=n.write,k=g<n.read?n.read-g-1:n.end-g,0===h){s=0;break}s=7;case 7:if(n.write=g,t=n.wt(e,t),g=n.write,k=g<n.read?n.read-g-1:n.end-g,n.read!=n.write)return n.ot=f,n.ct=y,e.We=b,e.qe+=m-e.nt,e.nt=m,n.write=g,n.wt(e,t);s=8;case 8:return t=1,n.ot=f,n.ct=y,e.We=b,e.qe+=m-e.nt,e.nt=m,n.write=g,n.wt(e,t);case 9:return t=Ye,n.ot=f,n.ct=y,e.We=b,e.qe+=m-e.nt,e.nt=m,n.write=g,n.wt(e,t);default:return t=Xe,n.ot=f,n.ct=y,e.We=b,e.qe+=m-e.nt,e.nt=m,n.write=g,n.wt(e,t)}}},n.ht=e=>{n.reset(e,null),n.lt=null,d=null},n.yt=(e,t,r)=>{n.lt.set(e.subarray(t,t+r),0),n.read=n.write=r},n.bt=()=>1==s?1:0}const lt=13,ut=[0,0,255,255];function wt(){const e=this;function t(e){return e&&e.gt?(e.qe=e.Ge=0,e.Le=null,e.gt.mode=7,e.gt.kt.reset(e,null),0):Xe}e.mode=0,e.method=0,e.vt=[0],e.St=0,e.marker=0,e.zt=0,e.Ct=t=>(e.kt&&e.kt.ht(t),e.kt=null,0),e.xt=(n,r)=>(n.Le=null,e.kt=null,8>r||r>15?(e.Ct(n),Xe):(e.zt=r,n.gt.kt=new at(n,1<<r),t(n),0)),e._t=(e,t)=>{let n,r;if(!e||!e.gt||!e.et)return Xe;const s=e.gt;for(t=4==t?Ze:0,n=Ze;;)switch(s.mode){case 0:if(0===e.We)return n;if(n=t,e.We--,e.qe++,8!=(15&(s.method=e.ft(e.nt++)))){s.mode=lt,e.Le="unknown compression method",s.marker=5;break}if(8+(s.method>>4)>s.zt){s.mode=lt,e.Le="invalid win size",s.marker=5;break}s.mode=1;case 1:if(0===e.We)return n;if(n=t,e.We--,e.qe++,r=255&e.ft(e.nt++),((s.method<<8)+r)%31!=0){s.mode=lt,e.Le="incorrect header check",s.marker=5;break}if(0==(32&r)){s.mode=7;break}s.mode=2;case 2:if(0===e.We)return n;n=t,e.We--,e.qe++,s.St=(255&e.ft(e.nt++))<<24&4278190080,s.mode=3;case 3:if(0===e.We)return n;n=t,e.We--,e.qe++,s.St+=(255&e.ft(e.nt++))<<16&16711680,s.mode=4;case 4:if(0===e.We)return n;n=t,e.We--,e.qe++,s.St+=(255&e.ft(e.nt++))<<8&65280,s.mode=5;case 5:return 0===e.We?n:(n=t,e.We--,e.qe++,s.St+=255&e.ft(e.nt++),s.mode=6,2);case 6:return s.mode=lt,e.Le="need dictionary",s.marker=0,Xe;case 7:if(n=s.kt.ut(e,n),n==Ye){s.mode=lt,s.marker=0;break}if(0==n&&(n=t),1!=n)return n;n=t,s.kt.reset(e,s.vt),s.mode=12;case 12:return e.We=0,1;case lt:return Ye;default:return Xe}},e.At=(e,t,n)=>{let r=0,s=n;if(!e||!e.gt||6!=e.gt.mode)return Xe;const i=e.gt;return s<1<<i.zt||(s=(1<<i.zt)-1,r=n-s),i.kt.yt(t,r,s),i.mode=7,0},e.It=e=>{let n,r,s,i,o;if(!e||!e.gt)return Xe;const c=e.gt;if(c.mode!=lt&&(c.mode=lt,c.marker=0),0===(n=e.We))return Ze;for(r=e.nt,s=c.marker;0!==n&&4>s;)e.ft(r)==ut[s]?s++:s=0!==e.ft(r)?0:4-s,r++,n--;return e.qe+=r-e.nt,e.nt=r,e.We=n,c.marker=s,4!=s?Ye:(i=e.qe,o=e.Ge,t(e),e.qe=i,e.Ge=o,c.mode=7,0)},e.Dt=e=>e&&e.gt&&e.gt.kt?e.gt.kt.bt():Xe}function ht(){}function dt(e){const t=new ht,n=e&&e.chunkSize?r.floor(2*e.chunkSize):131072,o=new i(n);let c=!1;t.xt(),t.$e=o,this.append=(e,r)=>{const f=[];let a,l,u=0,w=0,h=0;if(0!==e.length){t.nt=0,t.et=e,t.We=e.length;do{if(t.rt=0,t.tt=n,0!==t.We||c||(t.nt=0,c=!0),a=t._t(0),c&&a===Ze){if(0!==t.We)throw new s("inflating: bad input")}else if(0!==a&&1!==a)throw new s("inflating: "+t.Le);if((c||1===a)&&t.We===e.length)throw new s("inflating: bad input");t.rt&&(t.rt===n?f.push(new i(o)):f.push(o.subarray(0,t.rt))),h+=t.rt,r&&t.nt>0&&t.nt!=u&&(r(t.nt),u=t.nt)}while(t.We>0||0===t.tt);return f.length>1?(l=new i(h),f.forEach((e=>{l.set(e,w),w+=e.length}))):l=f[0]?new i(f[0]):new i,l}},this.flush=()=>{t.Ct()}}ht.prototype={xt(e){const t=this;return t.gt=new wt,e||(e=15),t.gt.xt(t,e)},_t(e){const t=this;return t.gt?t.gt._t(t,e):Xe},Ct(){const e=this;if(!e.gt)return Xe;const t=e.gt.Ct(e);return e.gt=null,t},It(){const e=this;return e.gt?e.gt.It(e):Xe},At(e,t){const n=this;return n.gt?n.gt.At(n,e,t):Xe},ft(e){return this.et[e]},je(e,t){return this.et.subarray(e,e+t)}},self.initCodec=()=>{self.Deflate=Qe,self.Inflate=dt};
`],{type:"text/javascript"}));n({workerScripts:{inflate:[t],deflate:[t]}})}up(xi);var ne=En.Platform.isDesktopApp?window.require("node:original-fs"):null,Ze=En.Platform.isDesktopApp?ne.promises:null,ot=En.Platform.isDesktopApp?window.require("node:os"):null,H=En.Platform.isDesktopApp?window.require("node:path"):null,Lr=En.Platform.isDesktopApp?window.require("node:url"):null,dp=En.Platform.isDesktopApp?window.require("node:zlib"):null;function Ui(n,t=0,e=n.byteLength){return n.buffer.slice(n.byteOffset+t,n.byteOffset+t+e)}var Ke=class{constructor(t){this.type="file";this.filepath=t;let e=this.name=H.basename(t);this.fullpath=e;let r=H.extname(e);this.extension=r.substring(1).toLowerCase(),this.basename=H.basename(e,r)}async readText(){return Ze.readFile(this.filepath,"utf8")}async read(){let t=await Ze.readFile(this.filepath);return Ui(t)}async readZip(t){let e=null;try{e=await Ze.open(this.filepath,"r");let r=await e.stat();return await t(new Tn(new Ka(e,r.size)))}finally{await(e==null?void 0:e.close())}}createReadStream(){return ne.createReadStream(this.filepath)}toString(){return this.filepath}},_n=class n{constructor(t){this.type="folder";this.filepath=t,this.name=H.basename(t)}async list(){let{filepath:t}=this,e=await Ze.readdir(t,{withFileTypes:!0}),r=[];for(let i of e)i.isFile()?r.push(new Ke(H.join(t,i.name))):i.isDirectory()&&r.push(new n(H.join(t,i.name)));return r}toString(){return this.filepath}},ji=class{constructor(t){this.type="file";this.file=t;let e=this.name=t.name;this.fullpath=e;let{basename:r,extension:i}=ee(e);this.basename=r,this.extension=i}readText(){let{file:t}=this;return t.text?t.text():new Promise((e,r)=>{let i=new FileReader;i.addEventListener("load",()=>e(i.result)),i.addEventListener("error",r),i.readAsText(this.file)})}async read(){let{file:t}=this;return t.arrayBuffer?t.arrayBuffer():new Promise((e,r)=>{let i=new FileReader;i.addEventListener("load",()=>e(i.result)),i.addEventListener("error",r),i.readAsArrayBuffer(this.file)})}async readZip(t){return t(new Tn(new Zt(this.file)))}toString(){return this.file.toString()}};async function Xa(n,t){let e=[];for(let r of n)try{r.type==="folder"?e.push(...await Xa(await r.list(),t)):r.type==="file"&&(!t||t(r))&&e.push(r)}catch(i){console.log("Skipping path: ",r.name,i)}return e}function ee(n){let t=Math.max(n.lastIndexOf("/"),n.lastIndexOf("\\")),e=n,r="";t>=0&&(e=n.substring(t+1),r=n.substring(0,t));let[i,o]=Yn(e);return{parent:r,name:e,basename:i,extension:o}}function Yn(n){let t=n.lastIndexOf("."),e=n,r="";return t>0&&(e=n.substring(0,t),r=n.substring(t+1).toLowerCase()),[e,r]}var Ka=class extends Wn{constructor(t,e){super(t),this.fd=t,this.size=e}async readUint8Array(t,e){let r=Buffer.alloc(e),i=await this.fd.read(r,0,e,t);return new Uint8Array(Ui(r,0,i.bytesRead))}};var fp=require("obsidian"),T0=/[\/\?<>\\:\*\|"]/g,_0=/[\x00-\x1f\x80-\x9f]/g,E0=/^\.+$/,k0=/^(con|prn|aux|nul|com[0-9]|lpt[0-9])(\..*)?$/i,A0=/[\. ]+$/,P0=/^\./,C0=/[\[\]#|^]/g;function de(n){return n.replace(T0,"").replace(_0,"").replace(E0,"").replace(k0,"").replace(A0,"").replace(P0,"").replace(C0,"")}function Vn(n){let t=[];for(let e=0;e<n;e++)t.push((Math.random()*16|0).toString(16));return t.join("")}function St(n){return new DOMParser().parseFromString(n,"text/html").documentElement}function N0(n){return n.buffer.slice(n.byteOffset,n.byteOffset+n.byteLength)}function Ja(n){return N0(new TextEncoder().encode(n))}function Gn(n){return Object.isEmpty(n)?"":`---
`+(0,fp.stringifyYaml)(n)+`---
`}function $r(n,t,e="..."){return n.length<t?n:n.substring(0,t)+e}var Ue=require("obsidian");var mp=300,ce=class{constructor(t,e){this.files=[];this.outputLocation="";this.notAvailable=!1;this.outputFolder=null;this.app=t,this.vault=t.vault,this.modal=e,this.init()}async showTemplateConfiguration(t,e){return null}registerAuthCallback(t){this.modal.plugin.registerAuthCallback(t)}addFileChooserSetting(t,e,r=!1,i,o){let a=new Ue.Setting(this.modal.contentEl).setName("Files to import").setDesc(i||"Pick the files that you want to import.").addButton(s=>s.setButtonText(r?"Choose files":"Choose file").onClick(async()=>{if(Ue.Platform.isDesktopApp){let c=["openFile","dontAddToRecent"];r&&c.push("multiSelections");let p=window.electron.remote.dialog.showOpenDialogSync({title:"Pick files to import",properties:c,filters:[{name:t,extensions:e}],defaultPath:o||void 0});p&&p.length>0&&(this.files=p.map(u=>new Ke(u)),l())}else{let c=createEl("input");c.type="file",c.accept=e.map(p=>"."+p.toLowerCase()).join(","),c.addEventListener("change",()=>{if(!c.files)return;let p=Array.from(c.files);p.length>0&&(this.files=p.map(u=>new ji(u)).filter(u=>e.contains(u.extension)),l())}),c.click()}}));r&&Ue.Platform.isDesktopApp&&a.addButton(s=>s.setButtonText("Choose folders").onClick(async()=>{if(Ue.Platform.isDesktopApp){let c=window.electron.remote.dialog.showOpenDialogSync({title:"Pick folders to import",properties:["openDirectory","multiSelections","dontAddToRecent"],defaultPath:o||void 0});if(c&&c.length>0){a.setDesc("Reading folders...");let p=c.map(u=>new _n(u));this.files=await Xa(p,u=>e.contains(u.extension)),l()}}}));let l=()=>{let s=document.createDocumentFragment(),c=this.files.length,p=this.files.map(u=>u.name).join(", ");p.length>mp&&(p=p.substring(0,mp)+"..."),s.createEl("span",{text:`These ${c} files will be imported: `}),s.createEl("br"),s.createEl("span",{cls:"u-pop",text:p}),a.setDesc(s)}}addOutputLocationSetting(t){this.outputLocation=t,new Ue.Setting(this.modal.contentEl).setName("Output folder").setDesc("Choose a folder in the vault to put the imported files. Leave empty to output to vault root.").addText(e=>e.setValue(t).onChange(r=>{this.outputLocation=r,this.outputFolder=null}))}async getOutputFolder(){if(this.outputFolder)return this.outputFolder;let{vault:t}=this.app,e=this.outputLocation;e===""&&(e="/");let r=t.getAbstractFileByPath(e);return(r===null||!(r instanceof Ue.TFolder))&&(await t.createFolder(e),r=t.getAbstractFileByPath(e)),r instanceof Ue.TFolder?(this.outputFolder=r,r):null}async getAvailablePathForAttachment(t,e){let r=await this.getOutputFolder(),i=r?{parent:r}:null,{basename:o,extension:a}=ee(t),l=await this.vault.getAvailablePathForAttachments(o,a,i),s=ee(l),c=s.extension?"."+s.extension:"."+a,p=1,u=l;for(;e.includes(u)||this.vault.getAbstractFileByPath(u);)u=H.join(s.parent,`${s.name} ${p}${c}`),p++;return u}async pause(t,e,r){let i=new Promise(o=>setTimeout(o,t*1e3));if(r){let o=r.statusMessage;r.status(`\u23F8\uFE0F Pausing import for ${t} seconds (${e})`),await i,r.status(o)}else await i}sanitizeFilePath(t){return t.replace(/[:|?<>*\\]/g,"")}async createFolders(t){let e=t.split("/").map(o=>o.replace(/^\.+/,"")).join("/"),r=(0,Ue.normalizePath)(e),i=this.vault.getAbstractFileByPathInsensitive(r);if(i&&i instanceof Ue.TFolder)return i;if(await this.vault.createFolder(r),i=this.vault.getAbstractFileByPathInsensitive(r),!(i instanceof Ue.TFolder))throw new Error(`Failed to create folder at "${t}"`);return i}async saveAsMarkdownFile(t,e,r){let i=de(e);return await this.app.fileManager.createNewMarkdownFile(t,i,r)}};var _d=gi(fd());var Gs=require("obsidian");var md=n=>{let e=uo.execSync(`${n} --version`).toString().toString().match(/(\d+)\.(\d+).(\d+)/);return(e==null?void 0:e[1])>3||(e==null?void 0:e[2])>32},hd=n=>{let t=[];if(!n)return t;let e=[],r=0,i=-1,o={};for(;r<n.length;){let a="";if(n[r]==="'")for(r++;r<n.length;)if(n[r]!=="'"){let l=n.indexOf("'",r);a+=n.substring(r,l),r=l}else if(n[r+1]==="'")a+=n[r],r+=2;else{r++;break}else if(n[r]==="N")a=null,r+=4;else{let l=Math.min(...[n.indexOf(",",r),n.indexOf(`
`,r)].filter(s=>s>0),n.length-1);a=parseFloat(n.substring(r,l)),r=l}i==-1?e.push(a):(o[e[i]]=a,i++),(n[r]==`
`||e.length<i)&&(i!==-1&&t.push(o),i=0,o={}),r++}return t};function gd(n){for(var t=n[0],e=1,r=arguments.length;e<r;e++)t+=arguments[e]+n[e];return t}var{isArray:Uy}=Array,fo=class extends String{},yd=(n,...t)=>{let e=[n[0]],r=[e];for(let i=0;i<t.length;i++)t[i]instanceof fo?e[e.length-1]+=t[i]+n[i+1]:(Uy(t[i])?(e.push(...t[i].slice(1).map(o=>",")),r.push(...t[i].length?t[i]:[""])):r.push(t[i]),e.push(n[i+1]));return r},bd=n=>new fo(n);var Zr=(n,t)=>{let e="SQLITE_ERROR",r=new Error(e+": "+t);return r.code=e,n(r),""},vd=(...n)=>bd(gd(...n)),{from:qy}=Array,Hy=/'/g,Wy=n=>n.toString(16).padStart(2,"0"),zy=n=>`x'${qy(n,Wy).join("")}'`,Yy=n=>{switch(typeof n){case"string":return"'"+n.replace(Hy,"''")+"'";case"number":if(!isFinite(n))return;case"boolean":return+n;case"object":case"undefined":switch(!0){case!n:return"NULL";case n instanceof Date:return"'"+n.toISOString()+"'";case n instanceof Buffer:case n instanceof ArrayBuffer:n=new Uint8Array(n);case n instanceof Uint8Array:case n instanceof Uint8ClampedArray:return zy(n)}}},zs=(n,t)=>{let[e,...r]=yd(...t),i=[e[0]];for(let a=0;a<r.length;a++){let l=Yy(r[a]);if(l===void 0)return Zr(n,"incompatible "+typeof l+"value");i.push(l,e[a+1])}let o=i.join("").trim();return o.length?o:Zr(n,"empty query")};var Ys=Gs.Platform.isDesktopApp?window.require("node:crypto"):null,uo=Gs.Platform.isDesktopApp?window.require("node:child_process"):null,Zs=Ys==null?void 0:Ys.randomUUID(),Vy=`[{"_":"${Zs}"}]
`,Gy=`'_'
'${Zs}'
`,{isArray:Zy}=Array,{parse:xd}=JSON,{defineProperty:Ky}=Object,Xy=()=>{},Jy=(n,t,e,r,i,o)=>{let a=[],{stdout:l,stderr:s}=uo.spawn(r,i,o).on("close",p=>{if(c||p!==0){p!==0&&Zr(t,"busy DB or query too slow");return}let u=a.join("").trim();if(e==="query")n(u);else{let f=xd(u||"[]");n(e==="get"&&Zy(f)?f.shift():f)}});l.on("data",p=>{a.push(p)});let c=!1;s.on("data",p=>{c=!0,Zr(t,"".trim.call(p))})},Qy=(n,t,e)=>{let r=md(n),i=r?Vy:Gy,{stdin:o,stdout:a,stderr:l}=uo.spawn(n,t);r?o.write(`.mode json
`):o.write(`.mode quote
.headers on
`),e&&o.write(`.timeout ${e}
`);let s=Promise.resolve();return(c,p,u,f,h)=>{u==="close"?(o.write(`.quit
`),s=null):s&&(s=s.then(()=>new Promise(b=>{let d="",m=k=>{d+=k;let _=!1;for(;d.endsWith(i);)_=!0,d=d.slice(0,-i.length);if(_){for(T();d.startsWith(i);)d=d.slice(i.length);if(u==="query")c(d);else{let A=r?xd(d||"[]"):hd(d);c(u==="get"?A.shift():A)}}},y=k=>{T(),p(new Error(k))},T=()=>{b(),a.removeListener("data",m),l.removeListener("data",y)};a.on("data",m),l.once("data",y),o.write(`${h[h.length-1]};
`),o.write(`SELECT '${Zs}' as _;
`)})))}},Vs=(n,t,e,r,i)=>(...o)=>new Promise((a,l)=>{let s=zs(l,o);s.length&&(n==="get"&&/^SELECT\s+/i.test(s)&&!/\s+LIMIT\s+\d+$/i.test(s)&&(s+=" LIMIT 1"),e(a,l,n,t,r.concat(s),i))}),wd="";function Ks(n,t={}){n===":memory:"&&(n=wd||(wd=H.join(ot.tmpdir(),randomUUID())));let e=t.timeout||0,r=t.bin||"sqlite3",i=[n,"-bail"],o={timeout:e};t.readonly&&i.push("-readonly"),e&&i.push("-cmd",".timeout "+e);let a=i.concat("-json"),l=t.exec||(t.persistent?Qy(r,i,e):Jy);return{transaction(){let s=[];return Ky((...c)=>{s.push(c)},"commit",{value(){return new Promise((c,p)=>{let u=["BEGIN TRANSACTION"];for(let f of s){let h=zs(p,f);if(!h.length)return;u.push(h)}u.push("COMMIT"),l(c,p,"query",r,i.concat(u.join(";")),o)})}})},query:Vs("query",r,l,i,o),get:Vs("get",r,l,a,o),all:Vs("all",r,l,a,o),close:t.persistent?()=>l(null,null,"close"):Xy,raw:vd}}var Xs="Library/Group Containers/group.com.apple.notes",Td="NoteStore.sqlite",eb=978307200,mo=class extends ce{constructor(){super(...arguments);this.owners={};this.resolvedAccounts={};this.resolvedFiles={};this.resolvedFolders={};this.multiAccount=!1;this.noteCount=0;this.parsedNotes=0;this.omitFirstLine=!0;this.importTrashed=!1;this.includeHandwriting=!1;this.trashFolders=[]}init(){if(!Et.Platform.isMacOS||!Et.Platform.isDesktop){this.modal.contentEl.createEl("p",{text:"Due to platform limitations, Apple Notes cannot be exported from this device. Open your vault on a Mac to export from Apple Notes."}),this.notAvailable=!0;return}this.addOutputLocationSetting("Apple Notes"),new Et.Setting(this.modal.contentEl).setName("Import recently deleted notes").setDesc('Import notes in the "Recently Deleted" folder. Unlike in Apple Notes, they will not be automatically removed after a set amount of time.').addToggle(e=>e.setValue(!1).onChange(async r=>this.importTrashed=r)),new Et.Setting(this.modal.contentEl).setName("Omit first line").setDesc("Don't include the first line in the text, since Apple Notes uses it as the title. It will still be used as the note name.").addToggle(e=>e.setValue(!0).onChange(async r=>this.omitFirstLine=r)),new Et.Setting(this.modal.contentEl).setName("Include handwriting text").setDesc("When Apple Notes has detected handwriting in drawings, include it as text before the drawing.").addToggle(e=>e.setValue(!1).onChange(async r=>this.includeHandwriting=r))}async getNotesDatabase(){let e=H.join(ot.homedir(),Xs),r=window.electron.remote.dialog.showOpenDialogSync({defaultPath:e,properties:["openDirectory"],message:'Select the "group.com.apple.notes" folder to allow Obsidian to read Apple Notes data.'});if(!(r!=null&&r.includes(e)))return new Et.Notice("Data import failed. Ensure you have selected the correct Apple Notes data folder."),null;let i=H.join(e,Td),o=H.join(ot.tmpdir(),Td);return await Ze.copyFile(i,o),await Ze.copyFile(i+"-shm",o+"-shm"),await Ze.copyFile(i+"-wal",o+"-wal"),new Ks(o,{readonly:!0,persistent:!0})}async import(e){if(this.ctx=e,this.protobufRoot=_d.Root.fromJSON(Bl),this.rootFolder=await this.getOutputFolder(),!this.rootFolder){new Et.Notice("Please select a location to export to.");return}if(this.database=await this.getNotesDatabase(),!this.database)return;this.keys=Object.fromEntries((await this.database.all`SELECT z_ent, z_name FROM z_primarykey`).map(a=>[a.Z_NAME,a.Z_ENT]));let r=await this.database.all`
			SELECT z_pk FROM ziccloudsyncingobject WHERE z_ent = ${this.keys.ICAccount}
		`,i=await this.database.all`
			SELECT z_pk, ztitle2 FROM ziccloudsyncingobject WHERE z_ent = ${this.keys.ICFolder}
		`;for(let a of r)await this.resolveAccount(a.Z_PK);for(let a of i)try{await this.resolveFolder(a.Z_PK)}catch(l){this.ctx.reportFailed(a.ZTITLE2,l==null?void 0:l.message),console.error(l)}let o=await this.database.all`
			SELECT
				z_pk, zfolder, ztitle1 FROM ziccloudsyncingobject
			WHERE
				z_ent = ${this.keys.ICNote}
				AND ztitle1 IS NOT NULL
				AND zfolder NOT IN (${this.trashFolders})
		`;this.noteCount=o.length;for(let a of o)try{await this.resolveNote(a.Z_PK)}catch(l){this.ctx.reportFailed(a.ZTITLE1,l==null?void 0:l.message),console.error(l)}this.database.close()}async resolveAccount(e){!this.multiAccount&&Object.keys(this.resolvedAccounts).length&&(this.multiAccount=!0);let r=await this.database.get`
			SELECT zname, zidentifier FROM ziccloudsyncingobject
			WHERE z_ent = ${this.keys.ICAccount} AND z_pk = ${e}
		`;this.resolvedAccounts[e]={name:r.ZNAME,uuid:r.ZIDENTIFIER,path:H.join(ot.homedir(),Xs,"Accounts",r.ZIDENTIFIER)}}async resolveFolder(e){var a;if(e in this.resolvedFiles)return this.resolvedFolders[e];let r=await this.database.get`
			SELECT ztitle2, zparent, zidentifier, zfoldertype, zowner
			FROM ziccloudsyncingobject
			WHERE z_ent = ${this.keys.ICFolder} AND z_pk = ${e}
		`,i;if(r.ZFOLDERTYPE==3)return null;if(!this.importTrashed&&r.ZFOLDERTYPE==1)return this.trashFolders.push(e),null;if(r.ZPARENT!==null)i=((a=await this.resolveFolder(r.ZPARENT))==null?void 0:a.path)+"/";else if(this.multiAccount){let l=this.resolvedAccounts[r.ZOWNER].name;i=`${this.rootFolder.path}/${l}/`}else i=`${this.rootFolder.path}/`;r.ZIDENTIFIER.startsWith("DefaultFolder")||(i+=de(r.ZTITLE2));let o=await this.createFolders(i);return this.resolvedFolders[e]=o,this.owners[e]=r.ZOWNER,o}async resolveNote(e){if(e in this.resolvedFiles)return this.resolvedFiles[e];let r=await this.database.get`
			SELECT
				nd.z_pk, hex(nd.zdata) as zhexdata, zcso.ztitle1, zfolder,
				zcreationdate1, zcreationdate2, zcreationdate3, zmodificationdate1, zispasswordprotected
			FROM
				zicnotedata AS nd,
				(SELECT
					*, NULL AS zcreationdate3, NULL AS zcreationdate2,
					NULL AS zispasswordprotected FROM ziccloudsyncingobject
				) AS zcso
			WHERE
				zcso.z_pk = nd.znote
				AND zcso.z_pk = ${e}
		`;if(r.ZISPASSWORDPROTECTED)return this.ctx.reportSkipped(r.ZTITLE1,"note is password protected"),null;let i=this.resolvedFolders[r.ZFOLDER]||this.rootFolder,o=`${r.ZTITLE1}.md`,a=await this.saveAsMarkdownFile(i,o,"");this.ctx.status(`Importing note ${o}`),this.resolvedFiles[e]=a,this.owners[e]=this.owners[r.ZFOLDER];let l=this.decodeData(r.zhexdata,gn);return this.vault.modify(a,await l.format(!1,a.path),{ctime:this.decodeTime(r.ZCREATIONDATE3||r.ZCREATIONDATE2||r.ZCREATIONDATE1),mtime:this.decodeTime(r.ZMODIFICATIONDATE1)}),this.parsedNotes++,this.ctx.reportProgress(this.parsedNotes,this.noteCount),a}async resolveAttachment(e,r){if(e in this.resolvedFiles)return this.resolvedFiles[e];let i,o,a,l,s;switch(r){case"com.apple.paper.doc.scan":l=await this.database.get`
					SELECT
						zidentifier, zfallbackpdfgeneration, zcreationdate, zmodificationdate, znote
					FROM
						(SELECT *, NULL AS zfallbackpdfgeneration FROM ziccloudsyncingobject)
					WHERE
						z_ent = ${this.keys.ICAttachment}
						AND z_pk = ${e}
				`,i=H.join("FallbackPDFs",l.ZIDENTIFIER,l.ZFALLBACKPDFGENERATION||"","FallbackPDF.pdf"),o="Scan",a="pdf";break;case"com.apple.notes.gallery":l=await this.database.get`
					SELECT
						zidentifier, zsizeheight, zsizewidth, zcreationdate, zmodificationdate, znote
					FROM ziccloudsyncingobject
					WHERE
						z_ent = ${this.keys.ICAttachment}
						AND z_pk = ${e}
				`,i=H.join("Previews",`${l.ZIDENTIFIER}-1-${l.ZSIZEWIDTH}x${l.ZSIZEHEIGHT}-0.jpeg`),o="Scan Page",a="jpg";break;case"com.apple.paper":l=await this.database.get`
					SELECT
						zidentifier, zfallbackimagegeneration, zcreationdate, zmodificationdate,
						znote, zhandwritingsummary
					FROM
						(SELECT *, NULL AS zfallbackimagegeneration FROM ziccloudsyncingobject)
					WHERE
						z_ent = ${this.keys.ICAttachment}
						AND z_pk = ${e}
				`,l.ZFALLBACKIMAGEGENERATION?i=H.join("FallbackImages",l.ZIDENTIFIER,l.ZFALLBACKIMAGEGENERATION,"FallbackImage.png"):i=H.join("FallbackImages",`${l.ZIDENTIFIER}.jpg`),o="Drawing",a="png";break;default:l=await this.database.get`
					SELECT
						a.zidentifier, a.zfilename,
						a.zgeneration1, b.zcreationdate, b.zmodificationdate, b.znote
					FROM
						(SELECT *, NULL AS zgeneration1 FROM ziccloudsyncingobject) AS a,
						ziccloudsyncingobject AS b
					WHERE
						a.z_ent = ${this.keys.ICMedia}
						AND a.z_pk = ${e}
						AND a.z_pk = b.zmedia
				`,i=H.join("Media",l.ZIDENTIFIER,l.ZGENERATION1||"",l.ZFILENAME),[o,a]=Yn(l.ZFILENAME);break}try{let c=await this.getAttachmentSource(this.resolvedAccounts[this.owners[l.ZNOTE]],i),p=await this.getAvailablePathForAttachment(`${o}.${a}`,[]);s=await this.vault.createBinary(p,c,{ctime:this.decodeTime(l.ZCREATIONDATE),mtime:this.decodeTime(l.ZMODIFICATIONDATE)})}catch(c){return this.ctx.reportFailed(i),console.error(c),null}return this.resolvedFiles[e]=s,this.ctx.reportAttachmentSuccess(this.resolvedFiles[e].path),s}decodeData(e,r){let i=dp.gunzipSync(Buffer.from(e,"hex")),o=this.protobufRoot.lookupType(r.protobufType).decode(i);return new r(this,o)}decodeTime(e){return!e||e<1?new Date().getTime():Math.floor((e+eb)*1e3)}async getAttachmentSource(e,r){try{return await Ze.readFile(H.join(e.path,r))}catch(i){return await Ze.readFile(H.join(ot.homedir(),Xs,r))}}};var tr=require("obsidian");var Kr=class{constructor(t,e){this.type="file";this.entry=e,this.fullpath=t.fullpath+"/"+e.filename;let{parent:r,name:i,basename:o,extension:a}=ee(e.filename);this.parent=r,this.name=i,this.basename=o,this.extension=a}async readText(){return this.entry.getData(new Oi)}async read(){return(await this.entry.getData(new Ir)).arrayBuffer()}get filepath(){return this.entry.filename}get size(){return this.entry.uncompressedSize}get ctime(){return this.entry.creationDate}get mtime(){return this.entry.lastModDate}async readZip(t){return t(new Tn(new Zt(new Blob([await this.read()]))))}};async function Ot(n,t){await n.readZip(async e=>{let i=(await e.getEntries()).filter(o=>!o.directory&&!!o.getData).map(o=>new Kr(n,o));return t(e,i)})}var ho=class extends ce{constructor(){super(...arguments);this.attachmentMap={}}init(){this.addFileChooserSetting("Bear2bk",["bear2bk"]),this.addOutputLocationSetting("Bear")}async import(e){let{files:r}=this;if(r.length===0){new tr.Notice("Please pick at least one file to import.");return}let i=await this.getOutputFolder();if(!i){new tr.Notice("Please select a location to export to.");return}let o=i,a=new RegExp("\\[[^\\]]*\\]\\((assets/[^\\)]+)\\)","gm"),l=await this.createFolders(`${i.path}/archive`),s=await this.createFolders(`${i.path}/trash`);for(let c of r){if(e.isCancelled())return;e.status("Processing "+c.name),await Ot(c,async(p,u)=>{let f=await this.collectMetadata(e,u);for(let h of u){if(e.isCancelled())return;let{fullpath:b,filepath:d,parent:m,name:y,extension:T}=h;if(!(y==="info.json"||y==="tags.json")){e.status("Processing "+y);try{if(T==="md"||T==="markdown"){let k=ee(m).basename;e.status("Importing note "+k);let _=await h.readText();_=this.removeMarkdownHeader(k,_);let A=[..._.matchAll(a)];if(A.length>0)for(let N of A){let[C,F]=N,L=H.join(m,decodeURI(F)),z=await this.getAttachmentStoragePath(L);z=encodeURI(z);let K=C.replace(F,z);_=_.replace(C,K)}let E=(0,tr.normalizePath)(k),P=f[m],v=o;P!=null&&P.archived?v=l:P!=null&&P.trashed&&(v=s);let D=await this.saveAsMarkdownFile(v,E,_);P!=null&&P.ctime&&(P!=null&&P.mtime)&&await this.modifFileTimestamps(P,D),e.reportNoteSuccess(k)}else if(d.match(/\/assets\//g)){e.status("Importing asset "+h.name);let k=await this.getAttachmentStoragePath(h.filepath),_=await h.read();await this.vault.createBinary(k,_),e.reportAttachmentSuccess(h.fullpath)}else e.reportSkipped(b,"unknown type of file")}catch(k){e.reportFailed(b,k)}}}})}}async modifFileTimestamps(e,r){let i={ctime:e.ctime,mtime:e.mtime};await this.vault.append(r,"",i)}async collectMetadata(e,r){let i={};for(let o of r){if(e.isCancelled())return i;if(o.name!=="info.json")continue;let a=await o.readText(),s=JSON.parse(a)["net.shinyfrog.bear"],c=Date.parse(s.creationDate),p=Date.parse(s.modificationDate);i[o.parent]={ctime:isNaN(c)?void 0:c,mtime:isNaN(p)?void 0:p,archived:s.archived===1,trashed:s.trashed===1}}return i}async getAttachmentStoragePath(e){let r=(0,tr.normalizePath)(e);if(this.attachmentMap[r])return this.attachmentMap[r];let i=Object.values(this.attachmentMap),o=await this.getAvailablePathForAttachment(r,i);return o=o.replace(/:/g,""),this.attachmentMap[r]=o,o}removeMarkdownHeader(e,r){if(!r.startsWith("# "))return r;let i=r.indexOf(`
`),o=i>0?r.substring(2,i):r.substring(2);return o=o.trim(),o!==e.trim()&&o!==""?r:i>0?r.substring(i+1):""}};var Ft=require("obsidian");var rn=require("obsidian"),go=class{constructor(t){var e,r,i,o,a;this.fields=t.fields,this.placeholderSyntax=t.placeholderSyntax||"{{field_name}}",this.config={titleTemplate:((e=t.defaults)==null?void 0:e.titleTemplate)||"",locationTemplate:((r=t.defaults)==null?void 0:r.locationTemplate)||"",propertyNames:((i=t.defaults)==null?void 0:i.propertyNames)||new Map,propertyValues:((o=t.defaults)==null?void 0:o.propertyValues)||new Map,bodyTemplate:((a=t.defaults)==null?void 0:a.bodyTemplate)||""}}async show(t){return new Promise(e=>{t.empty(),t.createEl("p",{text:`Configure how your data should be imported. Use ${this.placeholderSyntax} syntax to reference field values.`}),new rn.Setting(t).setName("Note title").setDesc("Template for the note title. Use {{field_name}} to insert values.").addText(l=>l.setPlaceholder("{{Title}}").setValue(this.config.titleTemplate).onChange(s=>{this.config.titleTemplate=s})),new rn.Setting(t).setName("Note location").setDesc("Template for note location/path. Use {{field_name}} to organize notes.").addText(l=>l.setPlaceholder("{{Category}}/{{Subcategory}}").setValue(this.config.locationTemplate).onChange(s=>{this.config.locationTemplate=s})),t.createDiv({cls:"importer-frontmatter-header"}).createEl("h4",{text:"Properties"});let i=t.createDiv("importer-column-list"),o=i.createDiv("importer-column-header-row");o.createDiv("importer-column-name-col").setText("Property name"),o.createDiv("importer-column-value-col").setText("Property value"),o.createDiv("importer-column-example-col").setText("Example"),o.createDiv("importer-column-delete-col");for(let l of this.fields){let s=i.createDiv("importer-column-row"),p=s.createDiv("importer-column-name-col").createEl("input",{type:"text",cls:"importer-column-property",value:this.config.propertyNames.get(l.id)||""});p.addEventListener("input",()=>{this.config.propertyNames.set(l.id,p.value)});let f=s.createDiv("importer-column-value-col").createEl("input",{type:"text",cls:"importer-column-property",value:this.config.propertyValues.get(l.id)||""});f.addEventListener("input",()=>{this.config.propertyValues.set(l.id,f.value)});let h=s.createDiv("importer-column-example-col"),b=l.exampleValue||"",d=b.length>50?b.substring(0,50)+"...":b;h.setText(d||"\u2014");let y=s.createDiv("importer-column-delete-col").createEl("button",{cls:"clickable-icon",attr:{"aria-label":"Delete property"}});(0,rn.setIcon)(y,"trash-2"),y.addEventListener("click",()=>{this.config.propertyNames.delete(l.id),this.config.propertyValues.delete(l.id),s.remove()})}new rn.Setting(t).setName("Note content").setDesc("Template for the note content. Use {{field_name}} to insert values.").addTextArea(l=>{l.setPlaceholder("{{Content}}").setValue(this.config.bodyTemplate).onChange(s=>{this.config.bodyTemplate=s}),l.inputEl.rows=6});let a=t.createDiv("modal-button-container");a.createEl("button",{cls:"mod-cta",text:"Continue"},l=>{l.addEventListener("click",()=>{if(!this.config.titleTemplate.trim()){new rn.Notice("Please provide a note title template.");return}e(this.config)})}),a.createEl("button",{text:"Cancel"},l=>{l.addEventListener("click",()=>{e(null)})})})}};function Xr(n,t){return n?n.replace(/\{\{\s*([^}]+?)\s*\}\}/g,(e,r)=>{let i=r.trim();return t[i]!==void 0?t[i]:e}):""}function tb(n){let t=n.trim().toLowerCase();return t==="null"||t==="undefined"||n===""?"":t==="true"||t==="false"?t:isNaN(Number(n))?JSON.stringify(n):n}function Ed(n,t,e){if(t.size===0)return"";let r=["---"];for(let[i,o]of t){if(!o)continue;let a=e.get(i)||"";if(!a)continue;let l=Xr(a,n),s=tb(l);r.push(`${o}: ${s}`)}return r.push("---"),r.join(`
`)}var nr=require("obsidian");async function kd(n,t,e,r){let i=(0,nr.stringifyYaml)(e),o=(0,nr.normalizePath)(H.join(n.path,t+".base")),a=r.getAbstractFileByPath(o);return a instanceof nr.TFile?(await r.modify(a,i),a):await r.create(o,i)}var yo=class extends ce{constructor(){super(...arguments);this.csvHeaders=[];this.csvRows=[];this.config=null}init(){this.addFileChooserSetting("CSV",["csv"]),this.addOutputLocationSetting("CSV import"),this.hasHeaderRow=!0,new Ft.Setting(this.modal.contentEl).setName("CSV has header row").setDesc("If enabled, the first row of the CSV file will be treated as column headers.").addToggle(e=>{e.setValue(this.hasHeaderRow),e.onChange(async r=>{this.hasHeaderRow=r})})}async showTemplateConfiguration(e,r){let{files:i}=this;if(i.length===0)return new Ft.Notice("Please pick at least one CSV file to import."),!1;if(i.length>1)return new Ft.Notice("CSV files must be imported one at a time."),!1;let o=i[0];if(e.isCancelled())return!1;e.status("Parsing "+o.name);let a=await o.readText(),l=this.parseCSV(a);if(this.csvHeaders.length===0&&l.rows.length>0&&(this.csvHeaders=l.headers),this.csvRows.push(...l.rows),this.csvHeaders.length===0||this.csvRows.length===0)return new Ft.Notice("No data found in CSV file(s)."),!1;let s=this.csvHeaders.map(h=>({id:h,label:h,exampleValue:this.findExampleValue(h)})),c=new Map,p=new Map;this.csvHeaders.forEach(h=>{c.set(h,this.sanitizeYAMLKey(h)),p.set(h,`{{${h}}}`)});let u=this.csvHeaders.length>0?`{{${this.csvHeaders[0]}}}`:"",f=new go({fields:s,defaults:{titleTemplate:u,locationTemplate:"",bodyTemplate:"",propertyNames:c,propertyValues:p},placeholderSyntax:"{{column_name}}"});return this.config=await f.show(r),this.config!==null}async import(e){if(!this.config){new Ft.Notice("Configuration is missing.");return}await this.processRows(e)}findExampleValue(e){for(let r of this.csvRows){let i=r[e];if(i&&i.trim().length>0)return i}return""}parseCSV(e){let r=this.splitCSVLines(e);if(r.length===0)return{headers:[],rows:[]};let i,o;this.hasHeaderRow?(i=this.parseCSVLine(r[0]),o=1):(i=this.parseCSVLine(r[0]).map((s,c)=>`Column ${c+1}`),o=0);let a=[];for(let l=o;l<r.length;l++){let s=this.parseCSVLine(r[l]);if(s.length===0)continue;let c={};for(let p=0;p<i.length;p++)c[i[p]]=s[p]||"";a.push(c)}return{headers:i,rows:a}}splitCSVLines(e){let r=[],i="",o=!1;for(let a=0;a<e.length;a++){let l=e[a],s=e[a+1];l==='"'?(i+=l,o&&s==='"'?(i+='"',a++):o=!o):l===`
`&&!o?(i.trim().length>0&&r.push(i),i=""):l==="\r"&&s===`
`&&!o?(i.trim().length>0&&r.push(i),i="",a++):l==="\r"&&!o?(i.trim().length>0&&r.push(i),i=""):i+=l}return i.trim().length>0&&r.push(i),r}parseCSVLine(e){let r=[],i="",o=!1,a=!0;for(let l=0;l<e.length;l++){let s=e[l],c=e[l+1];s==='"'&&a?(o=!0,a=!1):s==='"'&&o?c==='"'?(i+='"',l++):o=!1:s===","&&!o?(r.push(i),i="",a=!0):(s!==" "||!a||i.length>0)&&(i+=s,a=!1)}return r.push(i),r.map(l=>l.trim())}sanitizeYAMLKey(e){return e.replace(/[^\w\s-]/g,"")}async processRows(e){if(!this.config){new Ft.Notice("Configuration is missing.");return}let r=await this.getOutputFolder();if(!r){new Ft.Notice("Please select a location to export to.");return}e.reportProgress(0,this.csvRows.length);for(let i=0;i<this.csvRows.length;i++){if(e.isCancelled())return;let o=this.csvRows[i];try{let a=Xr(this.config.titleTemplate,o);if(!a.trim()){e.reportSkipped(`Row ${i+1}`,"Empty title");continue}e.status(`Creating note: ${a}`);let l=Xr(this.config.locationTemplate,o),s=await this.getTargetFolder(r,l),c="",p=Ed(o,this.config.propertyNames,this.config.propertyValues);p&&(c+=p+`

`);let u=Xr(this.config.bodyTemplate,o);u&&(c+=u),await this.saveAsMarkdownFile(s,a,c),e.reportNoteSuccess(a)}catch(a){e.reportFailed(`Row ${i+1}`,a)}e.reportProgress(i+1,this.csvRows.length)}!e.isCancelled()&&r.path!==""&&await this.createBase(r)}async createBase(e){try{let i=["file.name",...Array.from(this.config.propertyNames.values()).filter(s=>s&&s.trim())],o=e.name,a=e.parent||e,l={filters:`file.folder == "${e.path}"`,views:[{type:"table",name:"Table",order:i}]};await kd(a,o,l,this.app.vault)}catch(r){console.error("Failed to create Base file:",r)}}async getTargetFolder(e,r){if(!r||!r.trim())return e;let i=this.sanitizeFilePath(r),o=e.path+"/"+i;return await this.createFolders(o)}};var ii=require("obsidian");var Sm=require("obsidian");var Ad=require("obsidian");var Pd=n=>({...n,created:Jr(n.created),statusupdated:Jr(n.statusupdated),updated:Jr(n.updated),duedate:Jr(n.duedate),taskflag:n.taskflag==="true",reminderdate:n.reminder?Jr(n.reminder.reminderdate):void 0,sortweight:n.sortweight}),Jr=n=>n?(0,Ad.moment)(n,"YYYYMMDDThhmmssZ").toDate():void 0;var pf=gi(qd());var we=n=>{let t={get(e,r){return e[r]}};return new Proxy(n.attributes,t)};var Hd="\n```\n",tl=n=>{let t=we(n);return t.style&&t.style.value.indexOf("-en-codeblock:true")>=0},db=n=>{let t=we(n),e="padding-left:",r=0;return t.style&&t.style.value.indexOf(e)>=0&&(r=Math.floor(t.style.value.split(e)[1].split("px")[0]/20)),r},nl=n=>n.replace(/\\(.)/g,"$1"),Wd=(n,t)=>{let e=db(t);return n=`${"	".repeat(e)}${n}`,tl(t)?(n=nl(n),`${Hd}${n}${Hd}`):t.parentElement&&tl(t.parentElement)&&t.parentElement.firstElementChild===t?`${n}`:t.parentElement&&tl(t.parentElement)?`
${n}`:t.isBlock?`
${n}
`:n};var bo="\n```\n",fb="-en-codeblock:true",mb=/\b(Courier|Mono|Consolas|Console|Inconsolata|Pitch|Monaco|monospace)\b/,zd=n=>{var o,a;if(n.nodeType!==1)return null;let t=n.childNodes,e=t.length;if(e>1)return"mixed";if(e===1){let l=zd(t[0]);if(l)return l}let r=we(n);if(n.tagName==="FONT")return(o=r.face)==null?void 0:o.value;let i=(a=r.style)==null?void 0:a.value;if(i){let l=i.match(/font-family:([^;]+)/);if(l)return l[1]}return null},Qr=n=>{var i;let e=(i=we(n).style)==null?void 0:i.value;if(e&&e.includes(fb))return!0;let r=zd(n);return!!r&&mb.test(r)},Yd=(n,t)=>{if(Qr(t)){let e=t.previousSibling,r=e&&e.tagName===t.tagName&&Qr(e),i=t.nextSibling,o=i&&i.tagName===t.tagName&&Qr(i);return r||o?(n=r?`
${n}`:`${bo}${n}`,n=o?`${n}
`:`${n}${bo}`,n):(n=nl(n),n.trim()?`${bo}${n}${bo}`:n)}return t.parentElement&&Qr(t.parentElement)&&t.parentElement.firstElementChild===t?n:t.parentElement&&Qr(t.parentElement)?`
${n}`:t.isBlock?`
${n}
`:n};var nt=n=>t=>t.nodeName===n||t.nodeName.toLowerCase()===n;var Vd={filter:nt("IMG"),replacement:(n,t)=>{let e=we(t);if(!e.src)return"";let r=e.src.value,i=t.width||"",o=t.height||"",a=r;U.sanitizeResourceNameSpaces?a=a.replace(/ /g,U.replacementChar):U.urlEncodeFileNamesAndLinks&&(a=encodeURI(a));let l=i||o?` =${i}x${o}`:"";if(U.keepImageSize)return l=i||o?`|${i||0}x${o||0}`:"",a.startsWith("./")?`![[${a}${l}]]`:`![${l}](${a})`;if(!r.match(/^[a-z]+:/))return`![[${a}]]`;let s=e.src.value.split("/");return`![${s[s.length-1]}](${a})`}};var Oe=class n{constructor(){this.noteIdNameMap={},this.noteIdNameTOCMap={}}static getInstance(){return n.instance||(n.instance=new n),n.instance}addItemToMap(t){this.noteIdNameMap[t.url]={...this.noteIdNameMap[t.url],title:t.title,noteName:this.currentNoteName,notebookName:this.currentNotebookName,uniqueEnd:t.uniqueEnd}}addItemToTOCMap(t){this.noteIdNameTOCMap[t.url]={...this.noteIdNameMap[t.url],title:t.title,noteName:this.currentNoteName,notebookName:this.currentNotebookName,uniqueEnd:t.uniqueEnd}}getNoteIdNameMap(){return this.noteIdNameMap}getNoteIdNameTOCMap(){return this.noteIdNameTOCMap}getAllNoteIdNameMap(){return{...this.noteIdNameMap,...this.noteIdNameTOCMap}}getNoteIdNameMapByNoteTitle(t){return Object.values(this.getAllNoteIdNameMap()).filter(e=>e.title===t)}setCurrentNotebookName(t){this.currentNotebookName=t}getCurrentNotebookName(){return this.currentNotebookName}setCurrentNotebookFullpath(t){this.currentNotebookFullpath=t}setCurrentNoteName(t){this.currentNoteName=t}getCurrentNoteName(){return this.currentNoteName}getCurrentNotePath(){return this.currentNotePath}setCurrentNotePath(t){this.currentNotePath=t}getCurrentNotebookFullpath(){return this.currentNotebookFullpath}};var Gd=require("obsidian");var rr=n=>n.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&");var hb={"application/andrew-inset":"ez","application/applixware":"aw","application/atom+xml":"atom","application/atomcat+xml":"atomcat","application/atomdeleted+xml":"atomdeleted","application/atomsvc+xml":"atomsvc","application/atsc-dwd+xml":"dwd","application/atsc-held+xml":"held","application/atsc-rsat+xml":"rsat","application/bdoc":"bdoc","application/calendar+xml":"xcs","application/ccxml+xml":"ccxml","application/cdfx+xml":"cdfx","application/cdmi-capability":"cdmia","application/cdmi-container":"cdmic","application/cdmi-domain":"cdmid","application/cdmi-object":"cdmio","application/cdmi-queue":"cdmiq","application/cpl+xml":"cpl","application/cu-seeme":"cu","application/dash+xml":"mpd","application/dash-patch+xml":"mpp","application/davmount+xml":"davmount","application/docbook+xml":"dbk","application/dssc+der":"dssc","application/dssc+xml":"xdssc","application/ecmascript":"es","application/emma+xml":"emma","application/emotionml+xml":"emotionml","application/epub+zip":"epub","application/exi":"exi","application/express":"exp","application/fdt+xml":"fdt","application/font-tdpfr":"pfr","application/geo+json":"geojson","application/gml+xml":"gml","application/gpx+xml":"gpx","application/gxf":"gxf","application/gzip":"gz","application/hjson":"hjson","application/hyperstudio":"stk","application/inkml+xml":"ink","application/ipfix":"ipfix","application/its+xml":"its","application/java-archive":"jar","application/java-serialized-object":"ser","application/java-vm":"class","application/javascript":"js","application/json":"json","application/json5":"json5","application/jsonml+json":"jsonml","application/ld+json":"jsonld","application/lgr+xml":"lgr","application/lost+xml":"lostxml","application/mac-binhex40":"hqx","application/mac-compactpro":"cpt","application/mads+xml":"mads","application/manifest+json":"webmanifest","application/marc":"mrc","application/marcxml+xml":"mrcx","application/mathematica":"ma","application/mathml+xml":"mathml","application/mbox":"mbox","application/media-policy-dataset+xml":"mpf","application/mediaservercontrol+xml":"mscml","application/metalink+xml":"metalink","application/metalink4+xml":"meta4","application/mets+xml":"mets","application/mmt-aei+xml":"maei","application/mmt-usd+xml":"musd","application/mods+xml":"mods","application/mp21":"m21","application/mp4":"mp4s","application/msword":"doc","application/mxf":"mxf","application/n-quads":"nq","application/n-triples":"nt","application/node":"cjs","application/octet-stream":"bin","application/oda":"oda","application/oebps-package+xml":"opf","application/ogg":"ogx","application/omdoc+xml":"omdoc","application/onenote":"onetoc","application/oxps":"oxps","application/p2p-overlay+xml":"relo","application/patch-ops-error+xml":"xer","application/pdf":"pdf","application/pgp-encrypted":"pgp","application/pgp-keys":"asc","application/pgp-signature":"asc","application/pics-rules":"prf","application/pkcs10":"p10","application/pkcs7-mime":"p7m","application/pkcs7-signature":"p7s","application/pkcs8":"p8","application/pkix-attr-cert":"ac","application/pkix-cert":"cer","application/pkix-crl":"crl","application/pkix-pkipath":"pkipath","application/pkixcmp":"pki","application/pls+xml":"pls","application/postscript":"ai","application/provenance+xml":"provx","application/prs.cww":"cww","application/pskc+xml":"pskcxml","application/raml+yaml":"raml","application/rdf+xml":"rdf","application/reginfo+xml":"rif","application/relax-ng-compact-syntax":"rnc","application/resource-lists+xml":"rl","application/resource-lists-diff+xml":"rld","application/rls-services+xml":"rs","application/route-apd+xml":"rapd","application/route-s-tsid+xml":"sls","application/route-usd+xml":"rusd","application/rpki-ghostbusters":"gbr","application/rpki-manifest":"mft","application/rpki-roa":"roa","application/rsd+xml":"rsd","application/rss+xml":"rss","application/rtf":"rtf","application/sbml+xml":"sbml","application/scvp-cv-request":"scq","application/scvp-cv-response":"scs","application/scvp-vp-request":"spq","application/scvp-vp-response":"spp","application/sdp":"sdp","application/senml+xml":"senmlx","application/sensml+xml":"sensmlx","application/set-payment-initiation":"setpay","application/set-registration-initiation":"setreg","application/shf+xml":"shf","application/sieve":"siv","application/smil+xml":"smi","application/sparql-query":"rq","application/sparql-results+xml":"srx","application/srgs":"gram","application/srgs+xml":"grxml","application/sru+xml":"sru","application/ssdl+xml":"ssdl","application/ssml+xml":"ssml","application/swid+xml":"swidtag","application/tei+xml":"tei","application/thraud+xml":"tfi","application/timestamped-data":"tsd","application/toml":"toml","application/trig":"trig","application/ttml+xml":"ttml","application/ubjson":"ubj","application/urc-ressheet+xml":"rsheet","application/urc-targetdesc+xml":"td","application/vnd.1000minds.decision-model+xml":"1km","application/vnd.3gpp.pic-bw-large":"plb","application/vnd.3gpp.pic-bw-small":"psb","application/vnd.3gpp.pic-bw-var":"pvb","application/vnd.3gpp2.tcap":"tcap","application/vnd.3m.post-it-notes":"pwn","application/vnd.accpac.simply.aso":"aso","application/vnd.accpac.simply.imp":"imp","application/vnd.acucobol":"acu","application/vnd.acucorp":"atc","application/vnd.adobe.air-application-installer-package+zip":"air","application/vnd.adobe.formscentral.fcdt":"fcdt","application/vnd.adobe.fxp":"fxp","application/vnd.adobe.xdp+xml":"xdp","application/vnd.adobe.xfdf":"xfdf","application/vnd.age":"age","application/vnd.ahead.space":"ahead","application/vnd.airzip.filesecure.azf":"azf","application/vnd.airzip.filesecure.azs":"azs","application/vnd.amazon.ebook":"azw","application/vnd.americandynamics.acc":"acc","application/vnd.amiga.ami":"ami","application/vnd.android.package-archive":"apk","application/vnd.anser-web-certificate-issue-initiation":"cii","application/vnd.anser-web-funds-transfer-initiation":"fti","application/vnd.antix.game-component":"atx","application/vnd.apple.installer+xml":"mpkg","application/vnd.apple.keynote":"key","application/vnd.apple.mpegurl":"m3u8","application/vnd.apple.numbers":"numbers","application/vnd.apple.pages":"pages","application/vnd.apple.pkpass":"pkpass","application/vnd.aristanetworks.swi":"swi","application/vnd.astraea-software.iota":"iota","application/vnd.audiograph":"aep","application/vnd.balsamiq.bmml+xml":"bmml","application/vnd.blueice.multipass":"mpm","application/vnd.bmi":"bmi","application/vnd.businessobjects":"rep","application/vnd.chemdraw+xml":"cdxml","application/vnd.chipnuts.karaoke-mmd":"mmd","application/vnd.cinderella":"cdy","application/vnd.citationstyles.style+xml":"csl","application/vnd.claymore":"cla","application/vnd.cloanto.rp9":"rp9","application/vnd.clonk.c4group":"c4g","application/vnd.cluetrust.cartomobile-config":"c11amc","application/vnd.cluetrust.cartomobile-config-pkg":"c11amz","application/vnd.commonspace":"csp","application/vnd.contact.cmsg":"cdbcmsg","application/vnd.cosmocaller":"cmc","application/vnd.crick.clicker":"clkx","application/vnd.crick.clicker.keyboard":"clkk","application/vnd.crick.clicker.palette":"clkp","application/vnd.crick.clicker.template":"clkt","application/vnd.crick.clicker.wordbank":"clkw","application/vnd.criticaltools.wbs+xml":"wbs","application/vnd.ctc-posml":"pml","application/vnd.cups-ppd":"ppd","application/vnd.curl.car":"car","application/vnd.curl.pcurl":"pcurl","application/vnd.dart":"dart","application/vnd.data-vision.rdz":"rdz","application/vnd.dbf":"dbf","application/vnd.dece.data":"uvf","application/vnd.dece.ttml+xml":"uvt","application/vnd.dece.unspecified":"uvx","application/vnd.dece.zip":"uvz","application/vnd.denovo.fcselayout-link":"fe_launch","application/vnd.dna":"dna","application/vnd.dolby.mlp":"mlp","application/vnd.dpgraph":"dpg","application/vnd.dreamfactory":"dfac","application/vnd.ds-keypoint":"kpxx","application/vnd.dvb.ait":"ait","application/vnd.dvb.service":"svc","application/vnd.dynageo":"geo","application/vnd.ecowin.chart":"mag","application/vnd.enliven":"nml","application/vnd.epson.esf":"esf","application/vnd.epson.msf":"msf","application/vnd.epson.quickanime":"qam","application/vnd.epson.salt":"slt","application/vnd.epson.ssf":"ssf","application/vnd.eszigno3+xml":"es3","application/vnd.ezpix-album":"ez2","application/vnd.ezpix-package":"ez3","application/vnd.fdf":"fdf","application/vnd.fdsn.mseed":"mseed","application/vnd.fdsn.seed":"seed","application/vnd.flographit":"gph","application/vnd.fluxtime.clip":"ftc","application/vnd.framemaker":"fm","application/vnd.frogans.fnc":"fnc","application/vnd.frogans.ltf":"ltf","application/vnd.fsc.weblaunch":"fsc","application/vnd.fujitsu.oasys":"oas","application/vnd.fujitsu.oasys2":"oa2","application/vnd.fujitsu.oasys3":"oa3","application/vnd.fujitsu.oasysgp":"fg5","application/vnd.fujitsu.oasysprs":"bh2","application/vnd.fujixerox.ddd":"ddd","application/vnd.fujixerox.docuworks":"xdw","application/vnd.fujixerox.docuworks.binder":"xbd","application/vnd.fuzzysheet":"fzs","application/vnd.genomatix.tuxedo":"txd","application/vnd.geogebra.file":"ggb","application/vnd.geogebra.tool":"ggt","application/vnd.geometry-explorer":"gex","application/vnd.geonext":"gxt","application/vnd.geoplan":"g2w","application/vnd.geospace":"g3w","application/vnd.gmx":"gmx","application/vnd.google-apps.document":"gdoc","application/vnd.google-apps.presentation":"gslides","application/vnd.google-apps.spreadsheet":"gsheet","application/vnd.google-earth.kml+xml":"kml","application/vnd.google-earth.kmz":"kmz","application/vnd.grafeq":"gqf","application/vnd.groove-account":"gac","application/vnd.groove-help":"ghf","application/vnd.groove-identity-message":"gim","application/vnd.groove-injector":"grv","application/vnd.groove-tool-message":"gtm","application/vnd.groove-tool-template":"tpl","application/vnd.groove-vcard":"vcg","application/vnd.hal+xml":"hal","application/vnd.handheld-entertainment+xml":"zmm","application/vnd.hbci":"hbci","application/vnd.hhe.lesson-player":"les","application/vnd.hp-hpgl":"hpgl","application/vnd.hp-hpid":"hpid","application/vnd.hp-hps":"hps","application/vnd.hp-jlyt":"jlt","application/vnd.hp-pcl":"pcl","application/vnd.hp-pclxl":"pclxl","application/vnd.hydrostatix.sof-data":"sfd-hdstx","application/vnd.ibm.minipay":"mpy","application/vnd.ibm.modcap":"afp","application/vnd.ibm.rights-management":"irm","application/vnd.ibm.secure-container":"sc","application/vnd.iccprofile":"icc","application/vnd.igloader":"igl","application/vnd.immervision-ivp":"ivp","application/vnd.immervision-ivu":"ivu","application/vnd.insors.igm":"igm","application/vnd.intercon.formnet":"xpw","application/vnd.intergeo":"i2g","application/vnd.intu.qbo":"qbo","application/vnd.intu.qfx":"qfx","application/vnd.ipunplugged.rcprofile":"rcprofile","application/vnd.irepository.package+xml":"irp","application/vnd.is-xpr":"xpr","application/vnd.isac.fcs":"fcs","application/vnd.jam":"jam","application/vnd.jcp.javame.midlet-rms":"rms","application/vnd.jisp":"jisp","application/vnd.joost.joda-archive":"joda","application/vnd.kahootz":"ktz","application/vnd.kde.karbon":"karbon","application/vnd.kde.kchart":"chrt","application/vnd.kde.kformula":"kfo","application/vnd.kde.kivio":"flw","application/vnd.kde.kontour":"kon","application/vnd.kde.kpresenter":"kpr","application/vnd.kde.kspread":"ksp","application/vnd.kde.kword":"kwd","application/vnd.kenameaapp":"htke","application/vnd.kidspiration":"kia","application/vnd.kinar":"kne","application/vnd.koan":"skp","application/vnd.kodak-descriptor":"sse","application/vnd.las.las+xml":"lasxml","application/vnd.llamagraphics.life-balance.desktop":"lbd","application/vnd.llamagraphics.life-balance.exchange+xml":"lbe","application/vnd.lotus-1-2-3":"123","application/vnd.lotus-approach":"apr","application/vnd.lotus-freelance":"pre","application/vnd.lotus-notes":"nsf","application/vnd.lotus-organizer":"org","application/vnd.lotus-screencam":"scm","application/vnd.lotus-wordpro":"lwp","application/vnd.macports.portpkg":"portpkg","application/vnd.mapbox-vector-tile":"mvt","application/vnd.mcd":"mcd","application/vnd.medcalcdata":"mc1","application/vnd.mediastation.cdkey":"cdkey","application/vnd.mfer":"mwf","application/vnd.mfmp":"mfm","application/vnd.micrografx.flo":"flo","application/vnd.micrografx.igx":"igx","application/vnd.mif":"mif","application/vnd.mobius.daf":"daf","application/vnd.mobius.dis":"dis","application/vnd.mobius.mbk":"mbk","application/vnd.mobius.mqy":"mqy","application/vnd.mobius.msl":"msl","application/vnd.mobius.plc":"plc","application/vnd.mobius.txf":"txf","application/vnd.mophun.application":"mpn","application/vnd.mophun.certificate":"mpc","application/vnd.mozilla.xul+xml":"xul","application/vnd.ms-artgalry":"cil","application/vnd.ms-cab-compressed":"cab","application/vnd.ms-excel":"xls","application/vnd.ms-excel.addin.macroenabled.12":"xlam","application/vnd.ms-excel.sheet.binary.macroenabled.12":"xlsb","application/vnd.ms-excel.sheet.macroenabled.12":"xlsm","application/vnd.ms-excel.template.macroenabled.12":"xltm","application/vnd.ms-fontobject":"eot","application/vnd.ms-htmlhelp":"chm","application/vnd.ms-ims":"ims","application/vnd.ms-lrm":"lrm","application/vnd.ms-officetheme":"thmx","application/vnd.ms-outlook":"msg","application/vnd.ms-pki.seccat":"cat","application/vnd.ms-pki.stl":"stl","application/vnd.ms-powerpoint":"ppt","application/vnd.ms-powerpoint.addin.macroenabled.12":"ppam","application/vnd.ms-powerpoint.presentation.macroenabled.12":"pptm","application/vnd.ms-powerpoint.slide.macroenabled.12":"sldm","application/vnd.ms-powerpoint.slideshow.macroenabled.12":"ppsm","application/vnd.ms-powerpoint.template.macroenabled.12":"potm","application/vnd.ms-project":"mpp","application/vnd.ms-word.document.macroenabled.12":"docm","application/vnd.ms-word.template.macroenabled.12":"dotm","application/vnd.ms-works":"wps","application/vnd.ms-wpl":"wpl","application/vnd.ms-xpsdocument":"xps","application/vnd.mseq":"mseq","application/vnd.musician":"mus","application/vnd.muvee.style":"msty","application/vnd.mynfc":"taglet","application/vnd.neurolanguage.nlu":"nlu","application/vnd.nitf":"ntf","application/vnd.noblenet-directory":"nnd","application/vnd.noblenet-sealer":"nns","application/vnd.noblenet-web":"nnw","application/vnd.nokia.n-gage.ac+xml":"ac","application/vnd.nokia.n-gage.data":"ngdat","application/vnd.nokia.n-gage.symbian.install":"n-gage","application/vnd.nokia.radio-preset":"rpst","application/vnd.nokia.radio-presets":"rpss","application/vnd.novadigm.edm":"edm","application/vnd.novadigm.edx":"edx","application/vnd.novadigm.ext":"ext","application/vnd.oasis.opendocument.chart":"odc","application/vnd.oasis.opendocument.chart-template":"otc","application/vnd.oasis.opendocument.database":"odb","application/vnd.oasis.opendocument.formula":"odf","application/vnd.oasis.opendocument.formula-template":"odft","application/vnd.oasis.opendocument.graphics":"odg","application/vnd.oasis.opendocument.graphics-template":"otg","application/vnd.oasis.opendocument.image":"odi","application/vnd.oasis.opendocument.image-template":"oti","application/vnd.oasis.opendocument.presentation":"odp","application/vnd.oasis.opendocument.presentation-template":"otp","application/vnd.oasis.opendocument.spreadsheet":"ods","application/vnd.oasis.opendocument.spreadsheet-template":"ots","application/vnd.oasis.opendocument.text":"odt","application/vnd.oasis.opendocument.text-master":"odm","application/vnd.oasis.opendocument.text-template":"ott","application/vnd.oasis.opendocument.text-web":"oth","application/vnd.olpc-sugar":"xo","application/vnd.oma.dd2+xml":"dd2","application/vnd.openblox.game+xml":"obgx","application/vnd.openofficeorg.extension":"oxt","application/vnd.openstreetmap.data+xml":"osm","application/vnd.openxmlformats-officedocument.presentationml.presentation":"pptx","application/vnd.openxmlformats-officedocument.presentationml.slide":"sldx","application/vnd.openxmlformats-officedocument.presentationml.slideshow":"ppsx","application/vnd.openxmlformats-officedocument.presentationml.template":"potx","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet":"xlsx","application/vnd.openxmlformats-officedocument.spreadsheetml.template":"xltx","application/vnd.openxmlformats-officedocument.wordprocessingml.document":"docx","application/vnd.openxmlformats-officedocument.wordprocessingml.template":"dotx","application/vnd.osgeo.mapguide.package":"mgp","application/vnd.osgi.dp":"dp","application/vnd.osgi.subsystem":"esa","application/vnd.palm":"pdb","application/vnd.pawaafile":"paw","application/vnd.pg.format":"str","application/vnd.pg.osasli":"ei6","application/vnd.picsel":"efif","application/vnd.pmi.widget":"wg","application/vnd.pocketlearn":"plf","application/vnd.powerbuilder6":"pbd","application/vnd.previewsystems.box":"box","application/vnd.proteus.magazine":"mgz","application/vnd.publishare-delta-tree":"qps","application/vnd.pvi.ptid1":"ptid","application/vnd.quark.quarkxpress":"qxd","application/vnd.rar":"rar","application/vnd.realvnc.bed":"bed","application/vnd.recordare.musicxml":"mxl","application/vnd.recordare.musicxml+xml":"musicxml","application/vnd.rig.cryptonote":"cryptonote","application/vnd.rim.cod":"cod","application/vnd.rn-realmedia":"rm","application/vnd.rn-realmedia-vbr":"rmvb","application/vnd.route66.link66+xml":"link66","application/vnd.sailingtracker.track":"st","application/vnd.seemail":"see","application/vnd.sema":"sema","application/vnd.semd":"semd","application/vnd.semf":"semf","application/vnd.shana.informed.formdata":"ifm","application/vnd.shana.informed.formtemplate":"itp","application/vnd.shana.informed.interchange":"iif","application/vnd.shana.informed.package":"ipk","application/vnd.simtech-mindmapper":"twd","application/vnd.smaf":"mmf","application/vnd.smart.teacher":"teacher","application/vnd.software602.filler.form+xml":"fo","application/vnd.solent.sdkm+xml":"sdkm","application/vnd.spotfire.dxp":"dxp","application/vnd.spotfire.sfs":"sfs","application/vnd.stardivision.calc":"sdc","application/vnd.stardivision.draw":"sda","application/vnd.stardivision.impress":"sdd","application/vnd.stardivision.math":"smf","application/vnd.stardivision.writer":"sdw","application/vnd.stardivision.writer-global":"sgl","application/vnd.stepmania.package":"smzip","application/vnd.stepmania.stepchart":"sm","application/vnd.sun.wadl+xml":"wadl","application/vnd.sun.xml.calc":"sxc","application/vnd.sun.xml.calc.template":"stc","application/vnd.sun.xml.draw":"sxd","application/vnd.sun.xml.draw.template":"std","application/vnd.sun.xml.impress":"sxi","application/vnd.sun.xml.impress.template":"sti","application/vnd.sun.xml.math":"sxm","application/vnd.sun.xml.writer":"sxw","application/vnd.sun.xml.writer.global":"sxg","application/vnd.sun.xml.writer.template":"stw","application/vnd.sus-calendar":"sus","application/vnd.svd":"svd","application/vnd.symbian.install":"sis","application/vnd.syncml+xml":"xsm","application/vnd.syncml.dm+wbxml":"bdm","application/vnd.syncml.dm+xml":"xdm","application/vnd.syncml.dmddf+xml":"ddf","application/vnd.tao.intent-module-archive":"tao","application/vnd.tcpdump.pcap":"pcap","application/vnd.tmobile-livetv":"tmo","application/vnd.trid.tpt":"tpt","application/vnd.triscape.mxs":"mxs","application/vnd.trueapp":"tra","application/vnd.ufdl":"ufd","application/vnd.uiq.theme":"utz","application/vnd.umajin":"umj","application/vnd.unity":"unityweb","application/vnd.uoml+xml":"uoml","application/vnd.vcx":"vcx","application/vnd.visio":"vsd","application/vnd.visionary":"vis","application/vnd.vsf":"vsf","application/vnd.wap.wbxml":"wbxml","application/vnd.wap.wmlc":"wmlc","application/vnd.wap.wmlscriptc":"wmlsc","application/vnd.webturbo":"wtb","application/vnd.wolfram.player":"nbp","application/vnd.wordperfect":"wpd","application/vnd.wqd":"wqd","application/vnd.wt.stf":"stf","application/vnd.xara":"xar","application/vnd.xfdl":"xfdl","application/vnd.yamaha.hv-dic":"hvd","application/vnd.yamaha.hv-script":"hvs","application/vnd.yamaha.hv-voice":"hvp","application/vnd.yamaha.openscoreformat":"osf","application/vnd.yamaha.openscoreformat.osfpvg+xml":"osfpvg","application/vnd.yamaha.smaf-audio":"saf","application/vnd.yamaha.smaf-phrase":"spf","application/vnd.yellowriver-custom-menu":"cmp","application/vnd.zul":"zir","application/vnd.zzazz.deck+xml":"zaz","application/voicexml+xml":"vxml","application/wasm":"wasm","application/watcherinfo+xml":"wif","application/widget":"wgt","application/winhlp":"hlp","application/wsdl+xml":"wsdl","application/wspolicy+xml":"wspolicy","application/x-7z-compressed":"7z","application/x-abiword":"abw","application/x-ace-compressed":"ace","application/x-apple-diskimage":"dmg","application/x-arj":"arj","application/x-authorware-bin":"aab","application/x-authorware-map":"aam","application/x-authorware-seg":"aas","application/x-bcpio":"bcpio","application/x-bdoc":"bdoc","application/x-bittorrent":"torrent","application/x-blorb":"blb","application/x-bzip":"bz","application/x-bzip2":"bz2","application/x-cbr":"cbr","application/x-cdlink":"vcd","application/x-cfs-compressed":"cfs","application/x-chat":"chat","application/x-chess-pgn":"pgn","application/x-chrome-extension":"crx","application/x-cocoa":"cco","application/x-conference":"nsc","application/x-cpio":"cpio","application/x-csh":"csh","application/x-debian-package":"deb","application/x-dgc-compressed":"dgc","application/x-director":"dir","application/x-doom":"wad","application/x-dtbncx+xml":"ncx","application/x-dtbook+xml":"dtb","application/x-dtbresource+xml":"res","application/x-dvi":"dvi","application/x-envoy":"evy","application/x-eva":"eva","application/x-font-bdf":"bdf","application/x-font-ghostscript":"gsf","application/x-font-linux-psf":"psf","application/x-font-pcf":"pcf","application/x-font-snf":"snf","application/x-font-type1":"pfa","application/x-freearc":"arc","application/x-futuresplash":"spl","application/x-gca-compressed":"gca","application/x-glulx":"ulx","application/x-gnumeric":"gnumeric","application/x-gramps-xml":"gramps","application/x-gtar":"gtar","application/x-hdf":"hdf","application/x-httpd-php":"php","application/x-install-instructions":"install","application/x-iso9660-image":"iso","application/x-iwork-keynote-sffkey":"key","application/x-iwork-numbers-sffnumbers":"numbers","application/x-iwork-pages-sffpages":"pages","application/x-java-archive-diff":"jardiff","application/x-java-jnlp-file":"jnlp","application/x-keepass2":"kdbx","application/x-latex":"latex","application/x-lua-bytecode":"luac","application/x-lzh-compressed":"lzh","application/x-makeself":"run","application/x-mie":"mie","application/x-mobipocket-ebook":"prc","application/x-ms-application":"application","application/x-ms-shortcut":"lnk","application/x-ms-wmd":"wmd","application/x-ms-wmz":"wmz","application/x-ms-xbap":"xbap","application/x-msaccess":"mdb","application/x-msbinder":"obd","application/x-mscardfile":"crd","application/x-msclip":"clp","application/x-msdos-program":"exe","application/x-msdownload":"exe","application/x-msmediaview":"mvb","application/x-msmetafile":"wmf","application/x-msmoney":"mny","application/x-mspublisher":"pub","application/x-msschedule":"scd","application/x-msterminal":"trm","application/x-mswrite":"wri","application/x-netcdf":"nc","application/x-ns-proxy-autoconfig":"pac","application/x-nzb":"nzb","application/x-perl":"pl","application/x-pilot":"prc","application/x-pkcs12":"p12","application/x-pkcs7-certificates":"p7b","application/x-pkcs7-certreqresp":"p7r","application/x-rar-compressed":"rar","application/x-redhat-package-manager":"rpm","application/x-research-info-systems":"ris","application/x-sea":"sea","application/x-sh":"sh","application/x-shar":"shar","application/x-shockwave-flash":"swf","application/x-silverlight-app":"xap","application/x-sql":"sql","application/x-stuffit":"sit","application/x-stuffitx":"sitx","application/x-subrip":"srt","application/x-sv4cpio":"sv4cpio","application/x-sv4crc":"sv4crc","application/x-t3vm-image":"t3","application/x-tads":"gam","application/x-tar":"tar","application/x-tcl":"tcl","application/x-tex":"tex","application/x-tex-tfm":"tfm","application/x-texinfo":"texinfo","application/x-tgif":"obj","application/x-ustar":"ustar","application/x-virtualbox-hdd":"hdd","application/x-virtualbox-ova":"ova","application/x-virtualbox-ovf":"ovf","application/x-virtualbox-vbox":"vbox","application/x-virtualbox-vbox-extpack":"vbox-extpack","application/x-virtualbox-vdi":"vdi","application/x-virtualbox-vhd":"vhd","application/x-virtualbox-vmdk":"vmdk","application/x-wais-source":"src","application/x-web-app-manifest+json":"webapp","application/x-x509-ca-cert":"der","application/x-xfig":"fig","application/x-xliff+xml":"xlf","application/x-xpinstall":"xpi","application/x-xz":"xz","application/x-zmachine":"z1","application/xaml+xml":"xaml","application/xcap-att+xml":"xav","application/xcap-caps+xml":"xca","application/xcap-diff+xml":"xdf","application/xcap-el+xml":"xel","application/xcap-ns+xml":"xns","application/xenc+xml":"xenc","application/xhtml+xml":"xhtml","application/xliff+xml":"xlf","application/xml":"xml","application/xml-dtd":"dtd","application/xop+xml":"xop","application/xproc+xml":"xpl","application/xslt+xml":"xsl","application/xspf+xml":"xspf","application/xv+xml":"mxml","application/yang":"yang","application/yin+xml":"yin","application/zip":"zip","audio/3gpp":"3gpp","audio/adpcm":"adp","audio/amr":"amr","audio/basic":"au","audio/midi":"mid","audio/mobile-xmf":"mxmf","audio/mp3":"mp3","audio/mp4":"m4a","audio/mpeg":"mpga","audio/ogg":"oga","audio/s3m":"s3m","audio/silk":"sil","audio/vnd.dece.audio":"uva","audio/vnd.digital-winds":"eol","audio/vnd.dra":"dra","audio/vnd.dts":"dts","audio/vnd.dts.hd":"dtshd","audio/vnd.lucent.voice":"lvp","audio/vnd.ms-playready.media.pya":"pya","audio/vnd.nuera.ecelp4800":"ecelp4800","audio/vnd.nuera.ecelp7470":"ecelp7470","audio/vnd.nuera.ecelp9600":"ecelp9600","audio/vnd.rip":"rip","audio/wav":"wav","audio/wave":"wav","audio/webm":"weba","audio/x-aac":"aac","audio/x-aiff":"aif","audio/x-caf":"caf","audio/x-flac":"flac","audio/x-m4a":"m4a","audio/x-matroska":"mka","audio/x-mpegurl":"m3u","audio/x-ms-wax":"wax","audio/x-ms-wma":"wma","audio/x-pn-realaudio":"ram","audio/x-pn-realaudio-plugin":"rmp","audio/x-realaudio":"ra","audio/x-wav":"wav","audio/xm":"xm","chemical/x-cdx":"cdx","chemical/x-cif":"cif","chemical/x-cmdf":"cmdf","chemical/x-cml":"cml","chemical/x-csml":"csml","chemical/x-xyz":"xyz","font/collection":"ttc","font/otf":"otf","font/ttf":"ttf","font/woff":"woff","font/woff2":"woff2","image/aces":"exr","image/apng":"apng","image/avci":"avci","image/avcs":"avcs","image/avif":"avif","image/bmp":"bmp","image/cgm":"cgm","image/dicom-rle":"drle","image/emf":"emf","image/fits":"fits","image/g3fax":"g3","image/gif":"gif","image/heic":"heic","image/heic-sequence":"heics","image/heif":"heif","image/heif-sequence":"heifs","image/hej2k":"hej2","image/hsj2":"hsj2","image/ief":"ief","image/jls":"jls","image/jp2":"jp2","image/jpeg":"jpeg","image/jph":"jph","image/jphc":"jhc","image/jpm":"jpm","image/jpx":"jpx","image/jxr":"jxr","image/jxra":"jxra","image/jxrs":"jxrs","image/jxs":"jxs","image/jxsc":"jxsc","image/jxsi":"jxsi","image/jxss":"jxss","image/ktx":"ktx","image/ktx2":"ktx2","image/png":"png","image/prs.btif":"btif","image/prs.pti":"pti","image/sgi":"sgi","image/svg+xml":"svg","image/t38":"t38","image/tiff":"tif","image/tiff-fx":"tfx","image/vnd.adobe.photoshop":"psd","image/vnd.airzip.accelerator.azv":"azv","image/vnd.dece.graphic":"uvi","image/vnd.djvu":"djvu","image/vnd.dvb.subtitle":"sub","image/vnd.dwg":"dwg","image/vnd.dxf":"dxf","image/vnd.fastbidsheet":"fbs","image/vnd.fpx":"fpx","image/vnd.fst":"fst","image/vnd.fujixerox.edmics-mmr":"mmr","image/vnd.fujixerox.edmics-rlc":"rlc","image/vnd.microsoft.icon":"ico","image/vnd.ms-dds":"dds","image/vnd.ms-modi":"mdi","image/vnd.ms-photo":"wdp","image/vnd.net-fpx":"npx","image/vnd.pco.b16":"b16","image/vnd.tencent.tap":"tap","image/vnd.valve.source.texture":"vtf","image/vnd.wap.wbmp":"wbmp","image/vnd.xiff":"xif","image/vnd.zbrush.pcx":"pcx","image/webp":"webp","image/wmf":"wmf","image/x-3ds":"3ds","image/x-cmu-raster":"ras","image/x-cmx":"cmx","image/x-freehand":"fh","image/x-icon":"ico","image/x-jng":"jng","image/x-mrsid-image":"sid","image/x-ms-bmp":"bmp","image/x-pcx":"pcx","image/x-pict":"pic","image/x-portable-anymap":"pnm","image/x-portable-bitmap":"pbm","image/x-portable-graymap":"pgm","image/x-portable-pixmap":"ppm","image/x-rgb":"rgb","image/x-tga":"tga","image/x-xbitmap":"xbm","image/x-xpixmap":"xpm","image/x-xwindowdump":"xwd","message/disposition-notification":"disposition-notification","message/global":"u8msg","message/global-delivery-status":"u8dsn","message/global-disposition-notification":"u8mdn","message/global-headers":"u8hdr","message/rfc822":"eml","message/vnd.wfa.wsc":"wsc","model/3mf":"3mf","model/gltf+json":"gltf","model/gltf-binary":"glb","model/iges":"igs","model/mesh":"msh","model/mtl":"mtl","model/obj":"obj","model/step+xml":"stpx","model/step+zip":"stpz","model/step-xml+zip":"stpxz","model/stl":"stl","model/vnd.collada+xml":"dae","model/vnd.dwf":"dwf","model/vnd.gdl":"gdl","model/vnd.gtw":"gtw","model/vnd.mts":"mts","model/vnd.opengex":"ogex","model/vnd.parasolid.transmit.binary":"x_b","model/vnd.parasolid.transmit.text":"x_t","model/vnd.sap.vds":"vds","model/vnd.usdz+zip":"usdz","model/vnd.valve.source.compiled-map":"bsp","model/vnd.vtu":"vtu","model/vrml":"wrl","model/x3d+binary":"x3db","model/x3d+fastinfoset":"x3db","model/x3d+vrml":"x3dv","model/x3d+xml":"x3d","model/x3d-vrml":"x3dv","text/cache-manifest":"appcache","text/calendar":"ics","text/coffeescript":"coffee","text/css":"css","text/csv":"csv","text/html":"html","text/jade":"jade","text/jsx":"jsx","text/less":"less","text/markdown":"markdown","text/mathml":"mml","text/mdx":"mdx","text/n3":"n3","text/plain":"txt","text/prs.lines.tag":"dsc","text/richtext":"rtx","text/rtf":"rtf","text/sgml":"sgml","text/shex":"shex","text/slim":"slim","text/spdx":"spdx","text/stylus":"stylus","text/tab-separated-values":"tsv","text/troff":"t","text/turtle":"ttl","text/uri-list":"uri","text/vcard":"vcard","text/vnd.curl":"curl","text/vnd.curl.dcurl":"dcurl","text/vnd.curl.mcurl":"mcurl","text/vnd.curl.scurl":"scurl","text/vnd.dvb.subtitle":"sub","text/vnd.familysearch.gedcom":"ged","text/vnd.fly":"fly","text/vnd.fmi.flexstor":"flx","text/vnd.graphviz":"gv","text/vnd.in3d.3dml":"3dml","text/vnd.in3d.spot":"spot","text/vnd.sun.j2me.app-descriptor":"jad","text/vnd.wap.wml":"wml","text/vnd.wap.wmlscript":"wmls","text/vtt":"vtt","text/x-asm":"s","text/x-c":"c","text/x-component":"htc","text/x-fortran":"f","text/x-handlebars-template":"hbs","text/x-java-source":"java","text/x-lua":"lua","text/x-markdown":"mkd","text/x-nfo":"nfo","text/x-opml":"opml","text/x-org":"org","text/x-pascal":"p","text/x-processing":"pde","text/x-sass":"sass","text/x-scss":"scss","text/x-setext":"etx","text/x-sfv":"sfv","text/x-suse-ymp":"ymp","text/x-uuencode":"uu","text/x-vcalendar":"vcs","text/x-vcard":"vcf","text/xml":"xml","text/yaml":"yaml","video/3gpp":"3gp","video/3gpp2":"3g2","video/h261":"h261","video/h263":"h263","video/h264":"h264","video/iso.segment":"m4s","video/jpeg":"jpgv","video/jpm":"jpm","video/mj2":"mj2","video/mp2t":"ts","video/mp4":"mp4","video/mpeg":"mpeg","video/ogg":"ogv","video/quicktime":"qt","video/vnd.dece.hd":"uvh","video/vnd.dece.mobile":"uvm","video/vnd.dece.pd":"uvp","video/vnd.dece.sd":"uvs","video/vnd.dece.video":"uvv","video/vnd.dvb.file":"dvb","video/vnd.fvt":"fvt","video/vnd.mpegurl":"mxu","video/vnd.ms-playready.media.pyv":"pyv","video/vnd.uvvu.mp4":"uvu","video/vnd.vivo":"viv","video/webm":"webm","video/x-f4v":"f4v","video/x-fli":"fli","video/x-flv":"flv","video/x-m4v":"m4v","video/x-matroska":"mkv","video/x-mng":"mng","video/x-ms-asf":"asf","video/x-ms-vob":"vob","video/x-ms-wm":"wm","video/x-ms-wmv":"wmv","video/x-ms-wmx":"wmx","video/x-ms-wvx":"wvx","video/x-msvideo":"avi","video/x-sgi-movie":"movie","video/x-smv":"smv","x-conference/x-cooltalk":"ice"},gb=/^\s*([^;\s]*)(?:;|\s|$)/;function ir(n){if(!n||typeof n!="string")return"";let t=gb.exec(n);return t&&hb[t[1].toLowerCase()]||""}var or=n=>de(n).replace(/[\[\]\#\^]/g,""),ei=(n,t)=>ne.readdirSync(n).filter(r=>{let i=r.split(".").slice(0,-1).join("."),o=rr(t),a=i.match(new RegExp(`${o}\\.\\d+`));return i===t||a}).length,Zd=(n,t)=>{let e=U.useUniqueUnknownFileNames?"unknown_filename"+(Math.random().toString(16)+"0000000").slice(2,10):"unknown_filename",r=vb(t),i=e;if(t["resource-attributes"]&&t["resource-attributes"]["file-name"]){let l=t["resource-attributes"]["file-name"].substr(0,50);i=ee(l).basename}i=i.replace(/[/\\?%*:|"<>\[\]\+]/g,"-"),U.sanitizeResourceNameSpaces&&(i=i.replace(/ /g,U.replacementChar));let o=ei(n,i);return{fileName:`${o>0?`${i}.${o}`:i}.${r}`,extension:r,index:o}},rl=n=>or(n.title?`${n.title.toString()}`:"Untitled"),Kd=(n,t,e="md")=>`${il(n,t)}.${e}`,yb=n=>{if(!(n["resource-attributes"]&&n["resource-attributes"]["file-name"]))return"";let t=n["resource-attributes"]["file-name"].split(".");return t.length>1?t[t.length-1]:void 0},bb=n=>{let t=n.mime;return t&&ir(t)||""},vb=n=>yb(n)||bb(n)||"dat",wb=(n,t)=>(0,Gd.moment)(n.created).format("YYYYMMDDHHmm"),il=(n,t)=>{let e;if(U.isZettelkastenNeeded||U.useZettelIdAsFilename){let r=wb(t,n),i=ei(n,r),o=" ";e=i!==0?`${r}.${i}`:r,U.useZettelIdAsFilename||(e+=rl(t)!=="Untitled"?`${o}${rl(t)}`:"")}else{let r=rl(t),i=ei(n,r);e=i===0?r:`${r}.${i}`}return e};var Xd=n=>n==="Table of Contents";var xb=n=>n.replace(/\[|\]/g,""),Tb=n=>n.replace(/\\/g,""),Qd={filter:nt("A"),replacement:(n,t)=>{let e=we(t);if(!e.href)return"";let r=vo(U).turndown(xb(t.innerHTML));r=Tb(r);let i="",o=r.match(/^(#{1,6} )(.*)/);o&&(i=o[1],r=o[2]);let a=e.href.value,l=e.type?e.type.value:void 0,s=U.urlEncodeFileNamesAndLinks?encodeURI(a):a;if(l==="file")return`![[${s}]]`;if(a.match(/^(https?:|www\.|file:|ftp:|mailto:)/))return i+kb(r,a);if(a.startsWith("evernote://")){let c=or(r),p=Oe.getInstance(),u=Vn(6);return Xd(p.getCurrentNoteName())?p.addItemToTOCMap({url:a,title:c,uniqueEnd:u}):p.addItemToMap({url:a,title:c,uniqueEnd:u}),i+`[[${a}]]`}return i+`[[${s}${r===s?"":`|${r}`}]]`}},_b={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"},ef=/&(?:amp|lt|gt|quot|#39);/g,Eb=RegExp(ef.source);function Jd(n){return n&&Eb.test(n)?n.replace(ef,t=>_b[t]):n}var kb=(n,t)=>!n||Jd(n)===Jd(t)?U.generateNakedUrls?t:`<${t}>`:`[${n}](${t})`;var Ne={bold:"**",italic:"_",highlight:"==",strikethrough:"~~"};var Ab="-evernote-highlight:true;",Pb="--en-highlight",Cb="bold",Nb="italic",tf={filter:nt("SPAN"),replacement:(n,t)=>{let e=we(t);if(e.style&&n.trim()!==""){let r=e.style.value;if(n!=="<YARLE_NEWLINE_PLACEHOLDER>"){let i=r.includes(Cb),o=r.includes(Nb);if(i&&!o)return`${Ne.bold}${n}${Ne.bold}`;if(!i&&o)return`${Ne.italic}${n}${Ne.italic}`;if(i&&o)return`${Ne.italic}${Ne.bold}${n}${Ne.bold}${Ne.italic}`}return r.includes(Ab)||r.includes(Pb)?`${Ne.highlight}${n}${Ne.highlight}`:n}return n}};var nf={filter:["del","s","strike"],replacement:n=>`${Ne.strikethrough}${n}${Ne.strikethrough}`};var rf={filter:nt("EN-TODO"),replacement:(n,t)=>{var i,o;let e=we(t);return`${((o=(i=t.parentElement)==null?void 0:i.nodeName)==null?void 0:o.toUpperCase())==="LI"?"":"- "}${e.checked&&e.checked.value==="true"?"[x]":"[ ]"} ${n}`}};var of={filter:nt("BR"),replacement:(n,t)=>"<YARLE_NEWLINE_PLACEHOLDER>"};var Sb=n=>{let t=we(n);return t.style&&t.style.value.indexOf("--en-task-group:true")>=0},Rb=n=>we(n).style.value.split("--en-id:")[1].split(";")[0],af={filter:nt("DIV"),replacement:(n,t)=>Sb(t)?`<YARLE-EN-V10-TASK>${Rb(t)}</YARLE-EN-V10-TASK>`:U.monospaceIsCodeBlock?Yd(n,t):Wd(n,t)};var sf={filter:["i"],replacement:n=>n.trim()!==""?`${Ne.italic}${n}${Ne.italic}`:n};var wo="- [ ]",xo="- [x]";var lf="	",cf={filter:"li",replacement:(n,t,e)=>{let r=u=>{let f=we(u);return f.style&&f.style.value.indexOf("--en-checked:true;")>=0},i=u=>{let f=we(u);return f.style&&f.style.value.indexOf("--en-checked:false;")>=0},o=n.match(/^\n*/)[0].length||0,a=lf.repeat(o),l=n.replace(/^\n+/,"").replace(/\n+$/,`
`).replace(/\n/gm,`
${lf}`),s=o>0?a:r(t)?`${xo} `:i(t)?`${wo} `:"* ",c=t.parentNode;if(c.nodeName==="OL"){let u=c.getAttribute("start"),f=Array.prototype.indexOf.call(c.children,t);s=`${u?Number(u)+f:f+1}. `}let p;return p=s+l+(t.nextSibling&&!/\n$/.test(l)?`
`:""),p}};var vo=n=>{let t=new window.TurndownService({br:"",...n.turndownOptions,blankReplacement:(e,r)=>r.isBlock?`

`:"",keepReplacement:(e,r)=>r.isBlock?`
${r.outerHTML}
`:r.outerHTML,defaultReplacement:(e,r)=>r.isBlock?`
${e}
`:e});return t.use(pf.gfm),t.addRule("span",tf),t.addRule("strikethrough",nf),t.addRule("evernote task items",rf),t.addRule("wikistyle links",Qd),t.addRule("images",Vd),t.addRule("list",cf),t.addRule("italic",sf),n.keepMDCharactersOfENNotes&&(t.escape=e=>e),t.addRule("divBlock",af),n.keepOriginalAmountOfNewlines&&t.addRule("newline",of),t};var uf=n=>{n.replaceWith(...Array.from(n.children))},df=n=>{let t=n.parentElement;t.replaceWith(...Array.from(t.childNodes)),t.append(...Array.from(n.childNodes)),n.appendChild(t)},Ib=n=>(Array.from(n.querySelectorAll("span>en-todo")).forEach(df),Array.from(n.querySelectorAll("a>en-todo")).forEach(df),n),Db=n=>{let t=n.replace(/<li>/g,"<li><div>");return t=t.replace(/<\/li>/g,"</div></li>"),t=t.replace(/<li><div>(\s)*<div>/g,"<li><div>"),t=t.replace(/<\/div>(\s)*<\/div><\/li>/g,"</div></li>"),t},Ob=n=>{var o;let t=Array.from(n.getElementsByTagName("ul")),e=Array.from(n.getElementsByTagName("ol")),r=t.concat(e);r.forEach(a=>{a.parentElement.tagName==="LI"&&a.parentElement.replaceWith(a),a.previousElementSibling&&a.previousElementSibling.tagName==="LI"&&a.previousElementSibling.appendChild(a)});for(let a of r){let l=a.parentElement;(l==null?void 0:l.tagName)==="DIV"&&((o=l==null?void 0:l.parentElement)==null?void 0:o.tagName)==="UL"&&uf(l),((l==null?void 0:l.tagName)==="UL"||(l==null?void 0:l.tagName)==="OL")&&(l==null?void 0:l.childNodes.length)===1&&uf(l)}let i=Array.from(n.getElementsByTagName("li"));for(let a of i){let l=a.firstElementChild;if(l&&l.tagName==="DIV"){let s=Array.from(l.childNodes);l.replaceWith(...s)}}return n},ff=(n,{htmlContent:t})=>{let e=t.replace(/<!DOCTYPE en-note [^>]*>/,"<!DOCTYPE html>").replace(/(<a [^>]*)\/>/,"$1></a>").replace(/<div[^\/\<]*\/>/g,""),r=new DOMParser().parseFromString(Db(e),"text/html").getElementsByTagName("en-note").item(0),i=vo(n).turndown(Ib(Ob(r))),o=new RegExp("<YARLE_NEWLINE_PLACEHOLDER>","g");return i=i.replace(o,""),i&&i!=="undefined"?{content:i}:{content:""}};var im=gi(require("crypto"));var Lt=require("obsidian");var mf=(n,t)=>({createdAt:Fb(n),updatedAt:Lb(n),sourceUrl:$b(n),location:Mb(n),reminderTime:Bb(n),reminderOrder:jb(n),reminderDoneTime:Ub(n),notebookName:t});var Fb=n=>!U.skipCreationTime&&n.created?(0,Lt.moment)(n.created).format(U.dateFormat):"",Lb=n=>!U.skipUpdateTime&&n.updated?(0,Lt.moment)(n.updated).format(U.dateFormat):"",$b=n=>!U.skipSourceUrl&&n["note-attributes"]?n["note-attributes"]["source-url"]:"",Mb=n=>!U.skipLocation&&n["note-attributes"]&&n["note-attributes"].longitude?`${n["note-attributes"].latitude},${n["note-attributes"].longitude}`:"",Bb=n=>!U.skipReminderTime&&n["note-attributes"]&&n["note-attributes"]["reminder-time"]?(0,Lt.moment)(n["note-attributes"]["reminder-time"]).format(U.dateFormat):"",jb=n=>!U.skipReminderOrder&&n["note-attributes"]&&n["note-attributes"]["reminder-order"]?n["note-attributes"]["reminder-order"]:"",Ub=n=>!U.skipReminderDoneTime&&n["note-attributes"]&&n["note-attributes"]["reminder-done-time"]?(0,Lt.moment)(n["note-attributes"]["reminder-done-time"]).format(U.dateFormat):"",hf=n=>({tags:qb(n)}),qb=n=>{if(!U.skipTags&&n.tag){let t=Array.isArray(n.tag)?n.tag:[n.tag],e=U.nestedTags;return t.map(i=>{let o=i.toString().replace(/^#/,"");e&&(o=o.replace(new RegExp(rr(e.separatorInEN),"g"),e.replaceSeparatorWith));let a=e&&e.replaceSpaceWith||"-";return o=o.replace(/ /g,a),`${U.useHashTags?"#":""}${o}`}).join(" ")}return""},ol;try{ol=window.require("btime")}catch(n){}var To=(n,t)=>{let e=(0,Lt.moment)(t.created).valueOf();e>0&&ol&&ol.btime(n,e);let i=(0,Lt.moment)(t.updated).valueOf()/1e3;try{ne.utimesSync(n,i,i)}catch(o){}},gf=n=>n["resource-attributes"]&&n["resource-attributes"].timestamp?(0,Lt.moment)(n["resource-attributes"].timestamp):(0,Lt.moment)();var yf=(n,t,e)=>{let r=n.lastIndexOf(t);return r<0?n:n.substring(0,r)+e+n.substring(r+t.length)};var Fe={mdPath:"",resourcePath:""},Eo=249,bf=(n,t)=>il(n,t).replace(/\s/g,"_"),vf=(n,t)=>{if(n.length<=11)throw Error("FATAL: note folder directory path exceeds the OS limitation. Please pick a destination closer to the root folder.");return`${sl()}${H.sep}${n}`.length<Eo?n:`${n.slice(0,Eo-11)}_${t}.md`},Hb=(n,t,e)=>{let i=Oe.getInstance().getNoteIdNameMapByNoteTitle(or(n.title))[0]||{uniqueEnd:Vn(6)};if(t.length<=11)throw Error("FATAL: note folder directory path exceeds the OS limitation. Please pick a destination closer to the root folder.");return`${e.slice(0,Eo-11)}_${i.uniqueEnd}.md`},Wb=(n,t,e)=>{let r=Kd(n,t,e),i=`${n}${H.sep}${or(r)}`;return i.length<Eo?i:Hb(t,r,i)},wf=n=>Wb(Fe.mdPath,n,"md");var zb=n=>{ne.existsSync(n)&&(ne.rmSync?ne.rmSync(n,{recursive:!0,force:!0}):ne.rmdirSync(n,{recursive:!0})),ne.mkdirSync(n)},xf=n=>{let t=`${H.sep}${U.resourcesDir}`;return U.haveGlobalResources?`..${t}`:U.haveEnexLevelResources?`.${t}`:`.${t}${H.sep}${bf(Fe.mdPath,n)}.resources`},al=n=>U.haveGlobalResources?H.resolve(Fe.resourcePath,"..","..",U.resourcesDir):U.haveEnexLevelResources?Fe.resourcePath:`${Fe.resourcePath}${H.sep}${bf(Fe.mdPath,n)}.resources`,_o=new Map,Tf=n=>{let t=al(n);_o.has(t)||_o.set(t,0);let e=_o.get(t)||0;(U.haveEnexLevelResources||U.haveGlobalResources)&&e>=1||(zb(t),_o.set(t,e+1))},_f=n=>{let t=n.split("@@@"),e=t.pop();return e||(e=n),{notebookName:e,notebookFolderNames:t}},Ef=n=>{if(!(n instanceof Ke))throw new Error("Evernote import currently only works on desktop");let{notebookName:t}=_f(n.basename);return{fullpath:yf(n.fullpath,n.basename,t||n.basename),basename:t}},kf=(n,t)=>{let{notebookFolderNames:e}=_f(n.basename);return ne.mkdirSync(H.join(t.outputDir,...e),{recursive:!0}),[t.outputDir,...e].join(t.pathSeparator)},Af=(n,t)=>{let e=n.basename;Cf(e,t)},Pf=(n,t)=>{let e=n.basename;Cf(e,t)},Cf=(n,t)=>{let e=H.isAbsolute(t.outputDir)?t.outputDir:`${process.cwd()}${H.sep}${t.outputDir}`;Fe.mdPath=`${e}${H.sep}`,Fe.resourcePath=`${e}${H.sep}${t.resourcesDir}`,t.skipEnexFileNameFromOutputPath||(Fe.mdPath=`${Fe.mdPath}${n}`,Fe.resourcePath=`${e}${H.sep}${n}${H.sep}${t.resourcesDir}`),ne.mkdirSync(Fe.mdPath,{recursive:!0}),!t.haveEnexLevelResources&&!t.haveGlobalResources&&ne.mkdirSync(Fe.resourcePath,{recursive:!0}),console.log(`path ${Fe.mdPath} created`)},sl=()=>Fe.mdPath;var Nf=n=>!!n.resource,Sf=n=>n["note-attributes"]&&(n["note-attributes"]["source-application"]==="webclipper.evernote"||n["note-attributes"].source==="web.clip7");var ll={};je(ll,{CONTENT_PLACEHOLDER:()=>Yb,END_BLOCK:()=>Gb,START_BLOCK:()=>Vb});var Yb="{content}",Vb="{content-block}",Gb="{end-content-block}";var an=({template:n,check:t,startBlockPlaceholder:e,endBlockPlaceholder:r,valuePlaceholder:i,value:o})=>{if(o&&t())return n.replace(new RegExp(`${e}`,"g"),"").replace(new RegExp(`${r}`,"g"),"").replace(new RegExp(`${i}`,"g"),o);let a=`${e}([\\d\\D])(?:.|(\r
|\r|
))*?(?=${r})${r}`;return n.replace(new RegExp(a,"g"),"")};var sn=(n,t,e,r)=>({template:n,check:t,startBlockPlaceholder:e.START_BLOCK,endBlockPlaceholder:e.END_BLOCK,valuePlaceholder:e.CONTENT_PLACEHOLDER,value:r});var Rf=(n,t,e)=>{let r=sn(t,e,ll,n.content);return an(r)};var ti={};je(ti,{CONTENT_PLACEHOLDER:()=>Zb,END_BLOCK:()=>Xb,START_BLOCK:()=>Kb});var Zb="{tags}",Kb="{tags-block}",Xb="{end-tags-block}";var If=(n,t,e)=>{let r=sn(t,e,ti,n.tags);return an(r)};var cl={};je(cl,{CONTENT_PLACEHOLDER:()=>Jb,END_BLOCK:()=>ev,START_BLOCK:()=>Qb});var Jb="{title}",Qb="{title-block}",ev="{end-title-block}";var Df=(n,t,e)=>{let r=sn(t,e,cl,n.title);return an(r)};var Rn={};je(Rn,{CONTENT_PLACEHOLDER:()=>tv,END_BLOCK:()=>rv,START_BLOCK:()=>nv});var tv="{created-at}",nv="{created-at-block}",rv="{end-created-at-block}";var Re=(n,t,e)=>n.replace(new RegExp(`${t.CONTENT_PLACEHOLDER}`,"g"),e||"").replace(new RegExp(`${t.START_BLOCK}`,"g"),"").replace(new RegExp(`${t.END_BLOCK}`,"g"),"");var Of=(n,t)=>Re(t,Rn,n.createdAt);var In={};je(In,{CONTENT_PLACEHOLDER:()=>iv,END_BLOCK:()=>av,START_BLOCK:()=>ov});var iv="{updated-at}",ov="{updated-at-block}",av="{end-updated-at-block}";var Ff=(n,t)=>Re(t,In,n.updatedAt);var Dn={};je(Dn,{CONTENT_PLACEHOLDER:()=>sv,END_BLOCK:()=>cv,START_BLOCK:()=>lv});var sv="{source-url}",lv="{source-url-block}",cv="{end-source-url-block}";var Lf=(n,t)=>Re(t,Dn,n.sourceUrl);var On={};je(On,{CONTENT_PLACEHOLDER:()=>pv,END_BLOCK:()=>dv,START_BLOCK:()=>uv});var pv="{location}",uv="{location-block}",dv="{end-location-block}";var $f=(n,t)=>Re(t,On,n.location);var Fn={};je(Fn,{CONTENT_PLACEHOLDER:()=>fv,END_BLOCK:()=>hv,START_BLOCK:()=>mv});var fv="{notebook}",mv="{notebook-block}",hv="{end-notebook-block}";var Mf=(n,t)=>Re(t,Fn,n.notebookName);var ar={};je(ar,{CONTENT_PLACEHOLDER:()=>gv,END_BLOCK:()=>bv,START_BLOCK:()=>yv});var gv="{reminder-time}",yv="{reminder-time-block}",bv="{end-reminder-time-block}";var Bf=(n,t)=>Re(t,ar,n.reminderTime);var sr={};je(sr,{CONTENT_PLACEHOLDER:()=>vv,END_BLOCK:()=>xv,START_BLOCK:()=>wv});var vv="{reminder-order}",wv="{reminder-order-block}",xv="{end-reminder-order-block}";var jf=(n,t)=>Re(t,sr,n.reminderOrder);var lr={};je(lr,{CONTENT_PLACEHOLDER:()=>Tv,END_BLOCK:()=>Ev,START_BLOCK:()=>_v});var Tv="{reminder-done-time}",_v="{reminder-done-time-block}",Ev="{end-reminder-done-time-block}";var Uf=(n,t)=>Re(t,lr,n.reminderDoneTime);var ni={};je(ni,{CONTENT_PLACEHOLDER:()=>kv,END_BLOCK:()=>Pv,START_BLOCK:()=>Av});var kv="{tags-yaml-list}",Av="{tags-yaml-list-block}",Pv="{end-tags-yaml-list-block}";var qf=(n,t,e)=>{let r;n.tags&&(r=`
`+n.tags.split(" ").map(o=>`  - ${o.replace(/^#/,"")}`).join(`
`));let i=sn(t,e,ni,r);return an(i)};var pl="{metadata-block}",ul="{end-metadata-block}";var Hf=`\r?
?`;var Te=(n,t)=>n.replace(new RegExp(`${t.START_BLOCK}(?<=${t.START_BLOCK})(.*)(?=${t.END_BLOCK})${t.END_BLOCK}${Hf}`,"g"),"");var Wf=n=>Te(n,Rn);var zf=n=>Te(n,In);var Yf=n=>Te(n,Dn);var Vf=n=>Te(n,Fn);var Gf=n=>Te(n,On);var ko={};je(ko,{CONTENT_PLACEHOLDER:()=>Nv,END_BLOCK:()=>Rv,START_BLOCK:()=>Sv});var Nv="{link-to-original}",Sv="{link-to-original-block}",Rv="{end-link-to-original-block}";var Zf=n=>Te(n,ko);var Kf=n=>Te(n,ar);var Xf=n=>Te(n,lr);var Jf=n=>Te(n,sr);var Qf=(n,t)=>{let e=t.currentTemplate;return e=Df(n,e,()=>n.title),e=If(n,e,()=>!t.skipTags),e=qf(n,e,()=>!t.skipTags),e=Rf(n,e,()=>n.content),e=Zf(e),e=!t.skipCreationTime&&n.createdAt?Of(n,e):Wf(e),e=!t.skipUpdateTime&&n.updatedAt?Ff(n,e):zf(e),e=!t.skipSourceUrl&&n.sourceUrl?Lf(n,e):Yf(e),e=!t.skipLocation&&n.location?$f(n,e):Gf(e),e=t.isNotebookNameNeeded&&n.notebookName?Mf(n,e):Vf(e),e=!t.skipReminderTime&&n.reminderTime?Bf(n,e):Kf(e),e=!t.skipReminderOrder&&n.reminderOrder?jf(n,e):Jf(e),e=!t.skipReminderDoneTime&&n.reminderDoneTime?Uf(n,e):Xf(e),e=e.replace(pl,"").replace(ul,""),e};var em=(n,t,e)=>{try{ne.writeFileSync(n,t),To(n,e)}catch(r){throw console.error("Cannot write file ",r),r}};var tm=(n,t)=>{let e=wf(t);Oe.getInstance().setCurrentNotePath(e),em(e,n,t),console.log(`Note saved to ${e}`)};var om=n=>{let t=new RegExp(`\\${H.sep}`,"g"),e=xf(n).replace(t,U.pathSeparator||"/");return{absoluteResourceWorkDir:al(n),relativeResourceWorkDir:e}},am=n=>{let t={},e=n.content,{absoluteResourceWorkDir:r,relativeResourceWorkDir:i}=om(n);if(console.log(`relative resource work dir: ${i}`),console.log(`absolute resource work dir: ${r}`),Tf(n),Array.isArray(n.resource))for(let o of n.resource)t={...t,...rm(r,o)};else t={...t,...rm(r,n.resource)};for(let o of Object.keys(t))e=Iv(e,t,o,i);return e},Iv=(n,t,e,r)=>{let i=`${r}${U.pathSeparator}${t[e].fileName.replace(/ /g," ")}`;console.log(`mediaReference src ${i} added`);let o,a=`<en-media ([^>]*)hash="${e}".([^>]*)>`,l=new RegExp(a,"g"),s=n.match(l),c=s&&s.length>0&&s[0].split("type=");if(c&&c.length>1&&c[1].startsWith('"image')){let p=s[0].match(/width="(\w+)"/),u=p?` width="${p[1]}"`:"",f=s[0].match(/height="(\w+)"/),h=f?` height="${f[1]}"`:"";o=n.replace(l,`<img src="${i}"${u}${h} alt="${t[e].fileName}">`)}else o=n.replace(l,`<a href="${i}" type="file">${t[e].fileName}</a>`);return o},rm=(n,t)=>{let e={},r=t.data.$text,i=gf(t),a=Zd(n,t).fileName,l=`${n}${H.sep}${a}`;console.log(t),console.log(r);let s=Buffer.from(r,"base64");ne.writeFileSync(l,s);let c=i.valueOf()/1e3;try{ne.utimesSync(l,c,c)}catch(p){}if(t.recognition&&a){let p=t.recognition.match(/[a-f0-9]{32}/);console.log(`resource ${a} added with hash ${p}`),e[p]={fileName:a,alreadyUsed:!1}}else{let p=im.default.createHash("md5");p.update(s);let u=p.digest("hex");e[u]={fileName:a,alreadyUsed:!1}}return e},sm=(n,t)=>{if(t.indexOf('src="data:')<0)return t;let{absoluteResourceWorkDir:e,relativeResourceWorkDir:r}=om(n);return ne.mkdirSync(e,{recursive:!0}),t.replace(/src="data:([^;,]*)(;base64)?,([^"]*)"/g,(i,o,a,l)=>{let s=Dv(o,a===";base64",l,e,n);return`src="${`${r}${U.pathSeparator}${s}`}"`})},Dv=(n,t,e,r,i)=>{let o="embedded",a=Ov(n)||".dat",l=ei(r,o),s=l<1?`${o}.${a}`:`${o}.${l}.${a}`,c=`${r}${H.sep}${s}`;return t||(e=decodeURIComponent(e)),ne.writeFileSync(c,e,t?"base64":void 0),To(c,i),console.log(`data url resource ${s} added`),s},Ov=n=>n.split("/").pop().split("+")[0];var lm=(n,t)=>{let e=new Date;Oe.getInstance().setCurrentNoteName(n.title),Array.isArray(n.content)&&(n.content=n.content.join(""));let i={title:n.title,content:n.content,htmlContent:n.content,originalContent:n.content};console.log(`Converting for note "${i.title}" started at ${e}...`);try{Nf(n)&&(i.htmlContent=am(n)),i.htmlContent=sm(n,i.htmlContent),i={...i,...ff(U,i)},i={...i,...mf(n,t)},i={...i,...hf(n)};let o=Qf(i,U);tm(o,n)}catch(o){throw console.error(`Failed to convert note: ${i.title}`,o),o}finally{let o=new Date,a=(o.getTime()-e.getTime())/1e3;console.log(`Conversion for note "${i.title}" finished at ${o}. Took ${a} seconds`)}};var um=require("obsidian");var cm=n=>n.taskstatus==="open"?wo:xo;var Fv="\u{1F53C}",Lv="\u{1F53D}",$v="\u{1F4C5}",Mv="\u23F3",dm=(n,t)=>{let e=cm(n),r=n.title?` ${n.title}`:"",i=U.obsidianTaskTag!==""?` ${U.obsidianTaskTag}`:"",o=n.duedate&&!isNaN(n.duedate.getTime())?` ${$v} ${pm(n.duedate)}`:"",a=n.reminderdate?` ${Mv} ${pm(n.reminderdate)}`:"",l=n.taskflag?` ${Fv}`:` ${Lv}`;return`${e}${i}${r}${o}${a}${l}`},pm=n=>(0,um.moment)(n).format("YYYY-MM-DD").toString();var fl=(n,t,e)=>{let r=ne.readdirSync(n);return t=t||[],r.forEach(i=>{ne.statSync(`${n}${H.sep}${i}`).isDirectory()?t=fl(`${n}${H.sep}${i}`,t,e):(e&&H.extname(i)==`.${e}`||!e)&&t.push(H.join(n,"/",i))}),t};var fm=(n,t)=>{let r=Oe.getInstance().getAllNoteIdNameMap(),i=Object.entries(r);if(i.length===0)return;console.log("About to update links...");let o=[];for(let a of t)fl(a,o,"");for(let a of t){console.log(`Notebook: ${a}`);let s=ne.readdirSync(a).filter(c=>H.extname(c).toLowerCase()===".md");console.log(`${s.length} files to check for links`);for(let c of s){let p=H.join(a,c),u=ne.readFileSync(p,"utf8"),f=u;for(let[h,b]of i){let d=b.uniqueEnd,m=b.title;o.find(A=>A.includes(d))&&(m=vf(m,d));let y=b.notebookName,T=n.urlEncodeFileNamesAndLinks?encodeURI(m):m,k=T;y&&!a.endsWith(y)&&(k=`${y}/${T}`);let _=new RegExp(rr(h),"g");f=f.replace(_,k)}u!==f&&(console.log(`File written: ${p}`),ne.writeFileSync(p,f))}}console.log("Link update complete.")};var mm=n=>Ln(Rn,n);var hm=n=>Ln(On,n),gm=n=>Ln(Fn,n);var ym=n=>Ln(Dn,n),bm=n=>Ln(ti,n)||Ln(ni,n);var vm=n=>Ln(In,n),Ln=(n,t)=>t.includes(n.START_BLOCK)&&t.includes(n.CONTENT_PLACEHOLDER)&&t.includes(n.END_BLOCK);var wm=`---
`,Bv=`{source-url-block}source: {source-url}{end-source-url-block}
`,jv=`{tags-yaml-list-block}
tags: {tags-yaml-list}

{end-tags-yaml-list-block}`,Uv=`{content-block}{content}{end-content-block}
`,xm=wm+jv+Bv+wm+Uv;var rw=Sm.Platform.isDesktopApp?Nm():null,Co={enexSources:[],currentTemplate:"",outputDir:"./mdNotes",isMetadataNeeded:!1,isNotebookNameNeeded:!1,isZettelkastenNeeded:!1,useZettelIdAsFilename:!1,plainTextNotesOnly:!1,skipWebClips:!1,useHashTags:!0,nestedTags:{separatorInEN:"_",replaceSeparatorWith:"/",replaceSpaceWith:"-"},obsidianTaskTag:"",urlEncodeFileNamesAndLinks:!1,sanitizeResourceNameSpaces:!1,replacementChar:"_",pathSeparator:"/",resourcesDir:"_resources",turndownOptions:{headingStyle:"atx"}},iw="@@@",U={...Co};function ow(n){return n==null?n:JSON.parse(JSON.stringify(n))}function Rm(n,...t){for(let e of t)for(let r of Object.keys(e)){let i=e[r],o=n[r];!Array.isArray(i)&&typeof i=="object"&&!Array.isArray(o)&&typeof o=="object"?n[r]=Rm({},o,i):n[r]=ow(i)}return n}var aw=n=>{U=Rm({},Co,n);let t=U.templateFile?ne.readFileSync(U.templateFile,"utf-8"):xm;t=U.currentTemplate?U.currentTemplate:t,U.skipCreationTime=!mm(t),U.skipLocation=!hm(t),U.skipSourceUrl=!ym(t),U.skipTags=!bm(t),U.skipUpdateTime=!vm(t),U.isNotebookNameNeeded=gm(t),U.currentTemplate=t,console.log(`Current config is: ${JSON.stringify(U,null,4)}`),console.log(`Path separator:${H.sep}`)},sw=async(n,t,e)=>{if(!(t instanceof Ke))throw new Error("Evernote import currently only works on desktop");let r=Oe.getInstance();e.status("Processing "+t.name),console.log(`Getting stream from ${t}`);let i=t.createReadStream(),o={},a=r.getCurrentNotebookName();return new Promise((l,s)=>{let c=f=>(e.reportFailed(r.getCurrentNotebookFullpath(),f),s(f)),p=rw(i),u=null;p.on("tag:note-attributes",f=>{u=f}),p.on("tag:note",f=>{if(e.isCancelled()){i.close();return}if(n.skipWebClips&&Sf(f))e.reportSkipped(f.title);else{e.status("Importing note "+f.title),u&&(f["note-attributes"]=u);try{lm(f,a),e.reportNoteSuccess(a+"/"+f.title)}catch(b){return e.reportFailed(f.title||t,b),l()}}u=null;let h=r.getCurrentNotePath();if(h)for(let b of Object.keys(o)){let d=`<YARLE-EN-V10-TASK>${b}</YARLE-EN-V10-TASK>`,m=ne.readFileSync(h,"utf8"),y=new Map([...o[b]].sort()),T=m.replace(d,[...y.values()].join(`
`));ne.writeFileSync(h,T)}}),p.on("tag:task",f=>{let h=Pd(f);o[h.taskgroupnotelevelid]||(o[h.taskgroupnotelevelid]=new Map),o[h.taskgroupnotelevelid].set(h.sortweight,dm(h,a))}),p.on("end",l),p.on("error",c),i.on("error",c)})};async function Im(n,t){aw(n);let e=[],r=n.outputDir;for(let i of n.enexSources){if(t.isCancelled())return;let o,a=Oe.getInstance();i.basename.includes(iw)?(n.outputDir=kf(i,n),o=Ef(i),Pf(o,n),a.setCurrentNotebookName(o.basename),a.setCurrentNotebookFullpath(o.fullpath)):(Af(i,n),a.setCurrentNotebookName(i.basename),a.setCurrentNotebookFullpath(i.fullpath)),await sw(n,i,t),e.push(sl()),n.outputDir=r}t.isCancelled()||await fm(n,e)}var No=class extends ce{init(){this.addFileChooserSetting("Evernote",["enex"],!0),this.addOutputLocationSetting("Evernote")}async import(t){let{files:e}=this;if(e.length===0){new ii.Notice("Please pick at least one file to import.");return}let r=await this.getOutputFolder();if(!r){new ii.Notice("Please select a location to export to.");return}let{app:i}=this,o=i.vault.adapter;if(!(o instanceof ii.FileSystemAdapter))return;let a={...Co,enexSources:e,outputDir:H.join(o.getBasePath(),r.path)};await Im(a,t)}};var Le=require("obsidian");var So=class extends ce{init(){this.addFileChooserSetting("HTML",["htm","html"],!0),this.addAttachmentSizeLimit(0),this.addMinimumImageSize(65),this.addOutputLocationSetting("HTML import")}addAttachmentSizeLimit(t){this.attachmentSizeLimit=t*10**6,new Le.Setting(this.modal.contentEl).setName("Attachment size limit (MB)").setDesc("Set 0 to disable.").addText(e=>e.then(({inputEl:r})=>{r.type="number",r.step="0.1"}).setValue(t.toString()).onChange(r=>{let i=["+","-"].includes(r)?0:Number(r);if(Number.isNaN(i)||i<0){e.setValue((this.attachmentSizeLimit/10**6).toString());return}this.attachmentSizeLimit=i*10**6}))}addMinimumImageSize(t){this.minimumImageSize=t,new Le.Setting(this.modal.contentEl).setName("Minimum image size (px)").setDesc("Set 0 to disable.").addText(e=>e.then(({inputEl:r})=>r.type="number").setValue(t.toString()).onChange(r=>{let i=["+","-"].includes(r)?0:Number(r);if(!Number.isInteger(i)||i<0){e.setValue(this.minimumImageSize.toString());return}this.minimumImageSize=i}))}async import(t){let{files:e}=this;if(e.length===0){new Le.Notice("Please pick at least one file to import.");return}let r=await this.getOutputFolder();if(!r){new Le.Notice("Please select a location to export to.");return}let i=new Map;t.reportProgress(0,e.length);for(let s=0;s<e.length;s++){if(t.isCancelled())return;let c=e[s],p=await this.processFile(t,r,c);p&&i.set(c instanceof Ke?Lr.pathToFileURL(c.filepath).href:c.name,{file:c,tFile:p}),t.reportProgress(s+1,e.length)}let{metadataCache:o}=this.app,a,l=new Promise(s=>{a=s});o.onCleanCache(async()=>{for(let[s,{file:c,tFile:p}]of i){if(t.isCancelled())break;try{let u=await this.app.vault.cachedRead(p),f=o.computeMetadataAsync?await o.computeMetadataAsync(Ja(u)):o.getFileCache(p);if(!f)continue;let h=[];if(f.links)for(let{link:b,position:d,displayText:m}of f.links){let{path:y,subpath:T}=(0,Le.parseLinktext)(b),k;if(Lr){let A=new URL(encodeURI(y),s);A.hash="",A.search="",k=decodeURIComponent(A.href)}else k=ee(y.replace(/#/gu,"%23")).name;let _=i.get(k);if(_){let A=this.app.fileManager.generateMarkdownLink(_.tFile,p.path,T,m);h.push({from:d.start.offset,to:d.end.offset,text:A})}}h.sort((b,d)=>d.from-b.from);for(let b of h)u=u.substring(0,b.from)+b.text+u.substring(b.to);await this.vault.modify(p,u)}catch(u){t.reportFailed(c.fullpath,u)}}a()}),await l}async processFile(t,e,r){t.status("Processing "+r.name);try{let i=await r.readText(),o=St(i);lw(o);let a=r instanceof Ke?Lr.pathToFileURL(r.filepath):void 0,l=new Map,s=new Map;for(let u of o.findAll("img, audio, video")){if(t.isCancelled())return;let f=u.getAttribute("src");if(f)try{let h=new URL(f.startsWith("//")?`https:${f}`:f,a),b=h.href,d=l.get(b);l.has(b)||(t.status("Downloading attachment for "+r.name),d=await this.downloadAttachment(e,u,h),l.set(b,d),d?(s.set(d.path,d),t.reportAttachmentSuccess(d.name)):t.reportSkipped(f)),d&&(u.setAttribute("src",d.path.replace(/ /g,"%20")),u instanceof HTMLImageElement||u.replaceWith(createEl("img",{attr:{src:d.path.replace(/ /g,"%20"),alt:u.getAttr("alt")}})))}catch(h){t.reportFailed(f,h)}}let c=(0,Le.htmlToMarkdown)(o),p=await this.saveAsMarkdownFile(e,r.basename,c);if(!Object.isEmpty(l)){let{metadataCache:u}=this.app,f;u.computeMetadataAsync?f=await u.computeMetadataAsync(Ja(c)):f=await new Promise(b=>{let d=u.getFileCache(p);if(d)return b(d);let m=u.on("changed",(y,T,k)=>{y===p&&(u.offref(m),b(k))})});let h=[];if(f.embeds){for(let{link:b,position:d}of f.embeds)if(s.has(b)){let m=this.app.fileManager.generateMarkdownLink(s.get(b),p.path);h.push({from:d.start.offset,to:d.end.offset,text:m})}}h.sort((b,d)=>d.from-b.from);for(let b of h)c=c.substring(0,b.from)+b.text+c.substring(b.to);await this.vault.modify(p,c)}return t.reportNoteSuccess(r.fullpath),p}catch(i){t.reportFailed(r.fullpath,i)}return null}async downloadAttachment(t,e,r){let i="",o="",a;switch(r.protocol){case"file:":let c=Lr.fileURLToPath(r.href);({basename:i,extension:o}=ee(c)),a=Ui(await Ze.readFile(c));break;case"https:":case"http:":let p=await pw(r),u=cw(r);i=u.basename,a=p.data,o=ir(p.mime)||u.extension;break;default:throw new Error(r.href)}if(!this.filterAttachmentSize(a)||e instanceof HTMLImageElement&&!await this.filterImageSize(a))return null;if(!o)if(e instanceof HTMLImageElement)o="png";else if(e instanceof HTMLAudioElement)o="mp3";else if(e instanceof HTMLVideoElement)o="mp4";else return null;let l=await this.createFolders((0,Le.normalizePath)(t.path+"/Attachments")),s=await this.vault.getAvailablePath(l.getParentPrefix()+i,o);return await this.vault.createBinary(s,a)}filterAttachmentSize(t){let{byteLength:e}=t;return!this.attachmentSizeLimit||e<=this.attachmentSizeLimit}async filterImageSize(t){if(!this.minimumImageSize)return!0;let e;try{e=await uw(t)}catch(o){return!0}let{height:r,width:i}=e;return i>=this.minimumImageSize&&r>=this.minimumImageSize}};function Dm(n,t){let e=n.getAttribute(t);e!==null&&n.setAttribute(t,e.replace(/ /gu,"%20"))}function lw(n){n.findAll("a").forEach(t=>Dm(t,"href")),n.findAll("audio, img, video").forEach(t=>Dm(t,"src"))}function cw(n){return ee((0,Le.normalizePath)(decodeURIComponent(n.pathname)))}async function pw(n){var e,r;try{let i=await fetch(n,{mode:"cors",referrerPolicy:"no-referrer"});if(i.ok)return{data:await i.arrayBuffer(),mime:(e=i.headers.get("Content-Type"))!=null?e:""}}catch(i){}let t=await(0,Le.requestUrl)(n.href);return{data:t.arrayBuffer,mime:(r=t.headers["Content-Type"])!=null?r:""}}async function uw(n){let t=new Image,e=URL.createObjectURL(new Blob([n]));try{return await new Promise((r,i)=>{t.addEventListener("error",({error:o})=>i(o),{once:!0,passive:!0}),t.addEventListener("load",()=>r({height:t.naturalHeight,width:t.naturalWidth}),{once:!0,passive:!0}),t.src=e})}finally{URL.revokeObjectURL(e)}}var pr=require("obsidian");var dw=/(#[^ ^#]*)/g,fw=/[\\:*?<>\"|!@#$%^&()+=\`\'~;,.]/g;function gl(n){let t=n.replace(fw,"");return t=t.split(" ").join("-"),isNaN(t[0])||(t="_"+t),t}function yl(n){return n.replace(dw,t=>"#"+gl(t))}function Om(n){return n.charAt(0).toUpperCase()+n.slice(1).toLowerCase()}var mw=["zip"],hw=["json"],gw=["html","txt"],Ro=class extends ce{constructor(){super(...arguments);this.importArchived=!1;this.importTrashed=!1}init(){this.addFileChooserSetting("Notes & attachments",[...mw,...hw,...ur],!0),this.importArchivedSetting=new pr.Setting(this.modal.contentEl).setName("Import archived notes").setDesc("If imported, files archived in Google Keep will be tagged as archived.").addToggle(e=>{e.setValue(this.importArchived),e.onChange(async r=>{this.importArchived=r})}),this.importTrashedSetting=new pr.Setting(this.modal.contentEl).setName("Import deleted notes").setDesc("If imported, files deleted in Google Keep will be tagged as deleted. Deleted notes will only exist in your Google export if deleted recently.").addToggle(e=>{e.setValue(this.importTrashed),e.onChange(async r=>{this.importTrashed=r})}),this.addOutputLocationSetting("Google Keep")}async import(e){let{files:r}=this;if(r.length===0){new pr.Notice("Please pick at least one file to import.");return}let i=await this.getOutputFolder();if(!i){new pr.Notice("Please select a location to import your files to.");return}let o=`${i.path}/Assets`;for(let a of r){if(e.isCancelled())return;await this.handleFile(a,i,o,e)}}async handleFile(e,r,i,o){let{fullpath:a,name:l,extension:s}=e;o.status("Processing "+l);try{s==="zip"?await this.readZipEntries(e,r,i,o):s==="json"?await this.importKeepNote(e,r,o):ur.contains(s)?(o.status("Importing attachment "+l),await this.copyFile(e,i),o.reportAttachmentSuccess(a)):!(e instanceof Kr)&&!gw.contains(s)&&o.reportSkipped(a)}catch(c){o.reportFailed(a,c)}}async readZipEntries(e,r,i,o){await Ot(e,async(a,l)=>{for(let s of l){if(o.isCancelled())return;await this.handleFile(s,r,i,o)}})}async importKeepNote(e,r,i){let{fullpath:o,basename:a}=e;i.status("Importing note "+a);let l=await e.readText(),s=JSON.parse(l);if(!s||!s.userEditedTimestampUsec||!s.createdTimestampUsec){i.reportFailed(o,"Invalid Google Keep JSON");return}if(s.isArchived&&!this.importArchived){i.reportSkipped(o,"Archived note");return}if(s.isTrashed&&!this.importTrashed){i.reportSkipped(o,"Deleted note");return}await this.convertKeepJson(s,r,a),i.reportNoteSuccess(o)}async copyFile(e,r){let i=await this.createFolders(r),o=await e.read();await this.vault.createBinary(`${i.path}/${e.name}`,o)}async convertKeepJson(e,r,i){let o=[],a={};if(e.title){let c=e.title.split(`
`).filter(p=>p!==i);c.length>0&&(a.aliases=c)}let l=[];if(e.color&&e.color!=="DEFAULT"){let c=e.color.toLowerCase();c=Om(c),l.push(`Keep/Color/${c}`)}if(e.isPinned&&l.push("Keep/Pinned"),e.attachments&&l.push("Keep/Attachment"),e.isArchived&&l.push("Keep/Archived"),e.isTrashed&&l.push("Keep/Deleted"),e.labels)for(let c of e.labels)l.push(`Keep/Label/${c.name}`);if(l.length>0&&(a.tags=l.map(c=>gl(c))),o.push(Gn(a)),e.textContent&&(o.push(`
`),o.push(yl(e.textContent))),e.listContent){let c=[];for(let p of e.listContent){if(!p.text)continue;let u=`- [${p.isChecked?"X":" "}] ${p.text}`;c.push(yl(u))}o.push(`

`),o.push(c.join(`
`))}if(e.attachments){o.push(`

`);for(let c of e.attachments)o.push(`![[${c.filePath}]]`)}let s=await this.saveAsMarkdownFile(r,i,o.join(""));await this.vault.append(s,"",{ctime:e.createdTimestampUsec/1e3,mtime:e.userEditedTimestampUsec/1e3})}};var Mt=require("obsidian");var bl=require("obsidian");function Fm({info:n,vault:t,targetFolderPath:e,parentsInSubfolders:r}){let i=t.getAllLoadedFiles(),o=new Set,a=new Set(i.map(l=>l.name));r&&bw(n),yw({info:n,pathDuplicateChecks:o,titleDuplicateChecks:a}),vw({info:n,loadedFiles:i,titleDuplicateChecks:a,targetFolderPath:e})}function yw({info:n,pathDuplicateChecks:t,titleDuplicateChecks:e}){for(let r of Object.values(n.idsToFileInfo)){let i=n.getPathForFile(r);if(t.has(`${i}${r.title}`)){let o=2;for(r.title=r.title+" "+o;t.has(`${i}${r.title}`);)o++,r.title=`${r.title.replace(/ \d+$/,"")} ${o}`}e.has(r.title+".md")&&(r.fullLinkPathNeeded=!0),t.add(`${i}${r.title}`),e.add(r.title+".md")}}function bw(n){let t=new Set(Object.values(n.idsToFileInfo).map(e=>e.parentIds).concat(Object.values(n.pathsToAttachmentInfo).map(e=>e.parentIds)).map(e=>e.length>0?e[e.length-1]:""));for(let e of Object.keys(n.idsToFileInfo))t.has(e)&&n.idsToFileInfo[e].parentIds.push(e)}function vw({info:n,loadedFiles:t,titleDuplicateChecks:e,targetFolderPath:r}){var s;let i=new Set(t.filter(c=>!c.path.endsWith(".md")).map(c=>c.path)),o=n.attachmentPath,a=/^\.\//.test(o),l=(s=o.match(/\.\/(.*)/))==null?void 0:s[1];for(let c of Object.values(n.pathsToAttachmentInfo)){e.has(c.nameWithExtension)&&(c.fullLinkPathNeeded=!0);let p="";if(a?p=(0,bl.normalizePath)(`${r}${n.getPathForFile(c)}${l!=null?l:""}`):p=(0,bl.normalizePath)(o+"/"),p.endsWith("/")||(p+="/"),i.has(p+c.nameWithExtension)){let u=2,{basename:f,extension:h}=ee(c.path);for(;i.has(`${p}${f} ${u}.${h}`);)u++;c.nameWithExtension=`${f} ${u}.${h}`}c.targetParentFolder=p,i.add(p+c.nameWithExtension),e.add(c.nameWithExtension)}}var dr=require("obsidian");var Lm=n=>n.replace(/-/g,"").replace(/[ -]?[a-z0-9]{32}(\.|$)/,"$1"),$t=n=>{var t;return(t=n.replace(/-/g,"").match(/([a-z0-9]{32})(\?|\.|$)/))==null?void 0:t[1]},vl=n=>{let{parent:t}=ee(n);return t.split("/").map(e=>$t(e)).filter(e=>e)};function wl(n){return n.hour()===0&&n.minute()===0?n.format("YYYY-MM-DD"):n.format("YYYY-MM-DDTHH:mm")}function $m(n){return n.replace(/^(\.\.\/)+/,"")}function Mm(n){let t=/#\d*?(?:[-_/a-z]|[^\x00-\x7F])/gi;if(!t.test(n))return n;let e=n.split(`
`);for(let r=0;r<e.length;r++){let i=e[r].match(t);if(!i)continue;let o=e[r];for(let a of i)new RegExp(`\\[\\[[^\\]]*${a}(?:.*[^\\]])?\\]\\]|\\[[^\\]]*${a}[^\\]]*\\]\\([^\\)]*\\)|\\[[^\\]]*\\]\\([^\\)]*${a}[^\\)]*\\)|\\\\${a}|\`[^\`]*${a}[^\`]*\``).test(o)||(o=o.replace(a,"\\"+a));e[r]=o}return n=e.join(`
`),n}function xl(n){n.replaceWith(...Array.from(n.childNodes))}async function Gm(n,t){var p;let e=await t.readText(),r=St(e),i=r.find("div[class=page-body]");if(i===null)throw new Error("page body was not found");let o=jm(n,i);Vm(n,o,!0);let a={},l=r.find("table[class=properties] > tbody");if(l){let u=jm(n,l);Vm(n,u,!1),jw(l);for(let f of Array.from(l.rows)){let h=ww(f);h&&(h.title=="Tags"&&(h.title="tags",typeof h.content=="string"?h.content=h.content.replace(/ /g,"-"):h.content instanceof Array&&(h.content=h.content.map(b=>b.replace(/ /g,"-")))),a[h.title]=h.content)}}Sw(i,["strong","em","mark","del"]),Pw(i),Tw(i),Lw(i),kw(i),Fw(i),Xm(i),zm(i,"div.indented"),zm(i,"details"),$w(i),Ym(i,"ul"),Ym(i,"ol"),Mw(i),Bw(i),Ow(i),Cw(i);let s=(0,dr.htmlToMarkdown)(i.innerHTML);n.singleLineBreaks&&(s=s.replace(/\n\n(?!>)/g,`
`)),s=Mm(s),s=xw(s);let c=(p=r.find("p[class*=page-description]"))==null?void 0:p.textContent;return c&&(s=c+`

`+s),Gn(a)+s}var Bm={checkbox:["checkbox"],date:["created_time","last_edited_time","date"],list:["file","multi_select","relation"],number:["number","auto_increment_id"],text:["email","person","phone_number","text","url","status","select","formula","rollup","last_edited_by","created_by"]};function ww(n){var a,l,s,c,p,u;let t=(a=n.className.match(/property-row-(.*)/))==null?void 0:a[1];if(!t)throw new Error("property type not found for: "+n);let e=(0,dr.htmlToMarkdown)((l=n.cells[0].textContent)!=null?l:""),r=n.cells[1],i=Object.keys(Bm).find(f=>Bm[f].includes(t));if(!i)throw new Error("type not found for: "+r);let o="";switch(i){case"checkbox":o=r.innerHTML.includes("checkbox-on");break;case"number":if(o=Number(r.textContent),isNaN(o))return;break;case"date":Xm(r);let f=r.getElementsByTagName("time");if(f.length===0)o="";else if(f.length===1)o=wl((0,dr.moment)((s=f.item(0))==null?void 0:s.textContent));else{let d=[];for(let m=0;m<f.length;m++)d.push(wl((0,dr.moment)((c=f.item(m))==null?void 0:c.textContent)));o=d.join(" - ")}if(o.length===0)return;break;case"list":let h=r.children,b=[];for(let d=0;d<h.length;d++){let m=(p=h.item(d))==null?void 0:p.textContent;m&&b.push(m)}if(o=b,o.length===0)return;break;case"text":if(o=(u=r.textContent)!=null?u:"",o.length===0)return;break}return{title:e,content:o}}function jm(n,t){var r,i;let e=[];for(let o of t.findAll("a")){let a=$m(decodeURI((r=o.getAttribute("href"))!=null?r:"")),l=$t(a),s=Object.keys(n.pathsToAttachmentInfo).find(c=>c.includes(a));l&&a.endsWith(".html")?e.push({type:"relation",a:o,id:l}):s?e.push({type:"attachment",a:o,path:s}):l&&a.startsWith("#")&&((i=o.parentElement)!=null&&i.classList.contains("table_of_contents-item"))&&e.push({type:"toc-item",a:o,id:l})}return e}function xw(n){let t=/\[\[[^\]]*(\\\\)\|[^\]]*\]\]/,e=n.match(new RegExp(t,"g"));return e==null||e.forEach(r=>{n=n.replace(r,r.replace(/\\\\\|/g,"\\|"))}),n}function Tw(n){Nw(n,"style"),Zm(n,"span.notion-text-equation-token");let t=n.ownerDocument,e=n.findAll("figure.equation");for(let i of e){let o=i.find("annotation");if(!o)continue;let a=t.createElement("div");a.className="annotation",a.appendText(`$$${Um(o.textContent)}$$`),i.replaceWith(a)}let r=n.findAll("span.notion-text-equation-token");for(let i of r){let o=i.find("annotation");o&&i.replaceWith(`$${Um(o.textContent,!0)}$`)}}function Um(n,t=!1){var r;let e=new RegExp(/^(?:\s|\\\\|\\\s)*(.*?)[\s\\]*$/,"s");return(r=n==null?void 0:n.replace(e,"$1").replace(/[\r\n]+/g,t?" ":`
`))!=null?r:""}function _w(n){var e;let t=(e=n.match(/^[^\.\?\!\n]*[\.\?\!]?/))==null?void 0:e[0];return t!=null?t:""}function Ew(n){var t;return!!/callout|bookmark/.test((t=n.getAttribute("class"))!=null?t:"")}function kw(n){var e;let t=n.ownerDocument;for(let r of n.findAll("figure.callout")){let i=(e=r.lastElementChild)==null?void 0:e.childNodes;if(!i)continue;let o=t.createElement("blockquote");o.append(...Array.from(i)),Aw(o),r.replaceWith(o)}}function Aw(n){var o,a,l;let t=n.firstChild,e=(o=t==null?void 0:t.nodeName)!=null?o:"",r=n.ownerDocument.createElement("p"),i="";e=="#text"?i=(a=t==null?void 0:t.textContent)!=null?a:"":e=="P"?i=t.innerHTML:["EM","STRONG","DEL","MARK"].includes(e)?i=t.outerHTML:n.prepend(r),i=i.replace(/<br>/g,"&lt;br&gt;"),r.innerHTML=`[!important] ${i}`,(l=n.firstChild)==null||l.replaceWith(r)}function Pw(n){var t,e,r;for(let i of n.findAll("a.bookmark.source")){let o=i.getAttribute("href"),a=(t=i.find("div.bookmark-title"))==null?void 0:t.textContent,l=_w((r=(e=i.find("div.bookmark-description"))==null?void 0:e.textContent)!=null?r:""),s=`> [!info] ${a}
> ${l}
> [${o}](${o})
`;i.nextElementSibling&&Ew(i.nextElementSibling)&&(s+=`
`),i.replaceWith(s)}}function Cw(n){var t,e,r;for(let i of n.findAll("span[class=user]"))i.innerText=(t=i.textContent)!=null?t:"";for(let i of n.findAll("td div[class*=checkbox]")){let o=createSpan();o.setText(i.hasClass("checkbox-on")?"X":""),i.replaceWith(o)}for(let i of n.findAll("table span[class*=selected-value]"))((e=i.parentElement)==null?void 0:e.lastElementChild)!==i&&i.setText(i.textContent+", ");for(let i of n.findAll("a[href]"))if(!/^(https?:\/\/|www\.)/.test(i.href)){let o=createSpan();o.setText((r=i.textContent)!=null?r:""),i.replaceWith(o)}}function Nw(n,t){for(let e of n.findAll(t))e.remove()}function Sw(n,t){for(let e of t)Rw(n,e);for(let e of t)Iw(n,e);for(let e of t)Zm(n,e);for(let e of t)Dw(n,e)}function Rw(n,t){for(let e of n.findAll(t)){if(!e.parentElement||e.parentElement.tagName===t.toUpperCase())continue;let r=e.find(t);for(;r;)xl(r),r=e.find(t)}}function Iw(n,t){let e=n.findAll(t);if(!e)return;let r=new RegExp(`</${t}>( *)<${t}>`,"g");for(let i of e){if(!i||!i.parentElement)continue;let o=i.parentElement,a=o==null?void 0:o.innerHTML;o.innerHTML=a==null?void 0:a.replace(r,"$1")}}function Zm(n,t){let e=n.findAll(t);if(e)for(let r of e){let i=r.previousSibling;(i==null?void 0:i.nodeName)=="BR"&&(i==null||i.remove())}}function Dw(n,t){let e=n.innerHTML,r=e.match(new RegExp(`<${t}>.*?</${t}>`,"sg"));if(r){for(let i of r.filter(o=>o.includes("<br>")))e=e.replace(i,i.split("<br>").join(`</${t}><br><${t}>`));n.innerHTML=e}}function qm(n){var t;return Number((t=n==null?void 0:n.classList[1].slice(-1))!=null?t:-1)}function Km(n,t){let e=qm(n),r=qm(t);if(e>r&&t.childElementCount==1){let i=createEl("ul");i.append(n),t.append(i)}else if(e>r&&t.childElementCount==2){let i=t.lastElementChild;i==null||i.append(n)}else if(e==r){let i=t.parentElement;i==null||i.append(n)}else e<r&&(t=t.parentElement.parentElement,Km(n,t))}function Hm(n){var e;let t=createEl("li");return t.className=n.className,t.append((e=n.firstElementChild)!=null?e:""),t}function Ow(n){let t=n.find(".table_of_contents"),e=t==null?void 0:t.children;if(!t||e.length==0)return;let r=createEl("ul"),i=Hm(e[0]);r.append(i);let o=i;for(let a=1;a<e.length;a++)i=Hm(e[a]),Km(i,o),o=i;t.replaceWith(r)}function Fw(n){n.innerHTML=n.innerHTML.replace(/(?:\n|<br ?\/>)/g,"<br>");for(let t of n.findAll("code"))for(let e of t.findAll("br"))e.replaceWith(`
`)}function Lw(n){var t;for(let e of n.findAll("link"))e.innerText=(t=e.textContent)!=null?t:""}function Xm(n){var t,e;for(let r of n.findAll("time"))r.textContent=(e=(t=r.textContent)==null?void 0:t.replace(/@/g,""))!=null?e:""}var Wm={"1.875em":"h1","1.5em":"h2","1.25em":"h3"};function $w(n){var e;let t=n.findAll("summary");for(let r of t){let i=r.getAttribute("style");if(i){for(let o of Object.keys(Wm))if(i.includes(o)){r.replaceWith(createEl(Wm[o],{text:(e=r.textContent)!=null?e:""}));break}}}}function zm(n,t){let e=n.findAll(t);for(let r of e)xl(r)}function Mw(n){for(let t of n.findAll(".language-Mermaid"))t.removeClass("language-Mermaid"),t.addClass("language-mermaid")}function Ym(n,t){for(let e of n.findAll(t)){let r=[],i=[],o=e;for(;o.tagName===t.toUpperCase();){r.push(o);for(let l=0;l<o.children.length;l++)i.push(o.children[l]);if(!o.nextElementSibling||o.getAttribute("class")!==o.nextElementSibling.getAttribute("class"))break;o=o.nextElementSibling}let a=n.createEl(t);for(let l of i)a.appendChild(l);r[0].replaceWith(a),r.slice(1).forEach(l=>l.remove())}}function Bw(n){for(let t of n.findAll(".checkbox.checkbox-on"))t.replaceWith("[x] ");for(let t of n.findAll(".checkbox.checkbox-off"))t.replaceWith("[ ] ")}function jw(n){var e;let t=n.findAll("a");if(t.length===0)return n;for(let r of t){let i=createSpan();i.setText((e=r.getAttribute("href"))!=null?e:""),r.replaceWith(i)}}function Vm(n,t,e){var r,i,o;for(let a of t){let l=createSpan(),s="";switch(a.type){case"relation":let c=n.idsToFileInfo[a.id];if(c){let f=a.a.closest("table");s=`[[${c.fullLinkPathNeeded?`${n.getPathForFile(c)}${c.title}${f?"\\":""}|${c.title}`:c.title}]]`}else{console.warn("missing relation data for id: "+a.id);let{basename:f}=ee(decodeURI((r=a.a.getAttribute("href"))!=null?r:""));s=`[[${Lm(f)}]]`}break;case"attachment":let p=n.pathsToAttachmentInfo[a.path];if(!p){console.warn("missing attachment data for: "+a.path);continue}s=`${e?"!":""}[[${p.fullLinkPathNeeded?p.targetParentFolder+p.nameWithExtension+"|"+p.nameWithExtension:p.nameWithExtension}]]`;break;case"toc-item":s=(i=a.a.textContent)!=null?i:"";let u=(o=s.endsWith("]"))!=null?o:!1;s=`[[#${s+(u?" ":"")}]]`}l.setText(s),a.a.replaceWith(l)}}var Io=class{constructor(t,e){this.idsToFileInfo={};this.pathsToAttachmentInfo={};this.attachmentPath=t,this.singleLineBreaks=e}getPathForFile(t){let{idsToFileInfo:e}=this,r=t.path.split("/");return t.parentIds.map(i=>{var o,a,l;return(l=(o=e[i])==null?void 0:o.title)!=null?l:(a=r.find(s=>s.contains(i)))==null?void 0:a.replace(` ${i}`,"")}).filter(i=>i).map(i=>i.replace(/[\. ]+$/,"")).join("/")+"/"}};async function Qm(n,t){var r,i;let{filepath:e}=t;if(t.extension==="html"){let o=await t.readText(),a=St(o),s=a.find("body").children,c;for(let b=0;b<s.length&&(c=$t((r=s[b].getAttr("id"))!=null?r:""),!c);b++);if(!c)throw new Error("no id found for: "+e);let p=Jm(a,"property-row-created_time"),u=Jm(a,"property-row-last_edited_time"),f=((i=a.find("title"))==null?void 0:i.textContent)||"Untitled",h=Uw(de(f.replace(/\n/g," ").replace(/[:\/]/g,"-").replace(/#/g,"").trim()));n.idsToFileInfo[c]={path:e,parentIds:vl(e),ctime:p,mtime:u,title:h,fullLinkPathNeeded:!1}}else n.pathsToAttachmentInfo[e]={path:e,parentIds:vl(e),nameWithExtension:de(decodeURIComponent(t.name)),targetParentFolder:"",fullLinkPathNeeded:!1}}function Uw(n){if(n.length<200)return n;let t=n.split(" "),e=[],r=0,i=0,o=!1;for(;r<200;){if(!t[i]){o=!0;break}e.push(t[i]),r+=t[i].length+1,i++}let a=e.join(" ");return o||(a+="..."),a}function qw(n){let t=n.startsWith("@")?n.substr(1).trim():n.trim(),e=new Date(t);return isNaN(e.getTime())?null:e}function Jm(n,t){let e=n.querySelector(`tr.${t}`);if(e){let r=e.querySelector("time");return r&&r.textContent?qw(r.textContent):null}return null}var Do=class extends ce{init(){this.parentsInSubfolders=!0,this.addFileChooserSetting("Exported Notion",["zip"]),this.addOutputLocationSetting("Notion"),new Mt.Setting(this.modal.contentEl).setName("Save parent pages in subfolders").setDesc("Places the parent database pages in the same folder as the nested content.").addToggle(t=>t.setValue(this.parentsInSubfolders).onChange(e=>this.parentsInSubfolders=e)),new Mt.Setting(this.modal.contentEl).setName("Single line breaks").setDesc("Separate Notion blocks with only one line break (default is 2).").addToggle(t=>t.setValue(this.singleLineBreaks).onChange(e=>{this.singleLineBreaks=e}))}async import(t){var f;let{vault:e,parentsInSubfolders:r,files:i}=this;if(i.length===0){new Mt.Notice("Please pick at least one file to import.");return}let o=await this.getOutputFolder();if(!o){new Mt.Notice("Please select a location to export to.");return}let a=o.path;a=(0,Mt.normalizePath)(a),a!=null&&a.endsWith("/")||(a+="/");let l=new Io((f=e.getConfig("attachmentFolderPath"))!=null?f:"",this.singleLineBreaks);t.status("Looking for files to import");let s=0;if(await Tl(t,i,async h=>{try{await Qm(l,h),s=Object.keys(l.idsToFileInfo).length+Object.keys(l.pathsToAttachmentInfo).length,t.reportProgress(0,s)}catch(b){t.reportSkipped(h.fullpath)}}),t.isCancelled())return;t.status("Resolving links and de-duplicating files"),Fm({vault:e,info:l,targetFolderPath:a,parentsInSubfolders:r});let c=new Set([a]),p=Object.values(l.idsToFileInfo).map(h=>a+l.getPathForFile(h)).concat(Object.values(l.pathsToAttachmentInfo).map(h=>h.targetParentFolder));for(let h of p)c.add(h);for(let h of c){if(t.isCancelled())return;await this.createFolders(h)}let u=0;t.status("Starting import"),await Tl(t,i,async h=>{u++,t.reportProgress(u,s);try{if(h.extension==="html"){let b=$t(h.name);if(!b)throw new Error("ids not found for "+h.filepath);let d=l.idsToFileInfo[b];if(!d)throw new Error("file info not found for "+h.filepath);t.status(`Importing note ${d.title}`);let m=await Gm(l,h),y={};d.ctime&&(y.ctime=d.ctime.getTime(),y.mtime=d.ctime.getTime()),d.mtime&&(y.mtime=d.mtime.getTime());let T=`${a}${l.getPathForFile(d)}${d.title}.md`;await e.create(T,m,y),t.reportNoteSuccess(h.fullpath)}else{let b=l.pathsToAttachmentInfo[h.filepath];if(!b)throw new Error("attachment info not found for "+h.filepath);t.status(`Importing attachment ${h.name}`);let d=await h.read();await e.createBinary(`${b.targetParentFolder}${b.nameWithExtension}`,d),t.reportAttachmentSuccess(h.fullpath)}}catch(b){if(b.message==="page body was not found"){t.reportSkipped(h.fullpath,"page body was not found");return}t.reportFailed(h.fullpath,b)}})}};async function Tl(n,t,e){for(let r of t){if(n.isCancelled())return;try{await Ot(r,async(i,o)=>{for(let a of o){if(n.isCancelled())return;if(a.extension==="md"&&$t(a.name))throw new Mt.Notice("Notion Markdown export detected. Please export Notion data to HTML instead."),n.cancel(),new Error("Notion importer uses only HTML exports. Please use the correct format.");if(!(a.extension==="csv"&&$t(a.name))&&a.name!=="index.html")if(a.extension==="zip"&&a.parent==="")try{await Tl(n,[a],e)}catch(l){n.reportFailed(a.fullpath)}else await e(a)}})}catch(i){n.reportFailed(r.fullpath)}}}var Z=require("obsidian");var _h=gi(dh());function kt(n,t){return`[[${n}:${t}]]`}function li(n,t){let e=[],r=new RegExp(`\\[\\[${t}:([a-f0-9-]+)\\]\\]`,"g"),i;for(;(i=r.exec(n))!==null;)e.push(i[1]);return e}var mh={if:{type:"global"},now:{type:"global"},today:{type:"global"},toNumber:{type:"global",obsidianName:"number"},length:{type:"property",obsidianName:"length",argCount:1},format:{type:"method",obsidianName:"toString",argCount:1},contains:{type:"method",obsidianName:"contains",argCount:2},lower:{type:"method",obsidianName:"lower",argCount:1},upper:{type:"method",obsidianName:"upper",argCount:1},replace:{type:"method",obsidianName:"replace",argCount:3},substring:{type:"method",obsidianName:"slice",argCount:3},reverse:{type:"method",obsidianName:"reverse",argCount:1},sort:{type:"method",obsidianName:"sort",argCount:1},unique:{type:"method",obsidianName:"unique",argCount:1},flat:{type:"method",obsidianName:"flat",argCount:1},join:{type:"method",obsidianName:"join",argCount:2},includes:{type:"method",obsidianName:"contains",argCount:2},slice:{type:"method",obsidianName:"slice",argCount:3},map:{type:"method",obsidianName:"map",argCount:2},filter:{type:"method",obsidianName:"filter",argCount:2},abs:{type:"method",obsidianName:"abs",argCount:1},ceil:{type:"method",obsidianName:"ceil",argCount:1},floor:{type:"method",obsidianName:"floor",argCount:1},round:{type:"method",obsidianName:"round",argCount:1},formatDate:{type:"method",obsidianName:"format",argCount:2},parseDate:{type:"global",obsidianName:"date"},date:{type:"property",obsidianName:"day",argCount:1},year:{type:"property",obsidianName:"year",argCount:1},month:{type:"property",obsidianName:"month",argCount:1},hour:{type:"property",obsidianName:"hour",argCount:1},minute:{type:"property",obsidianName:"minute",argCount:1},at:{type:"operator",argCount:2},first:{type:"operator",argCount:1},last:{type:"operator",argCount:1},add:{type:"operator",argCount:2},subtract:{type:"operator",argCount:2},multiply:{type:"operator",argCount:2},divide:{type:"operator",argCount:2},mod:{type:"operator",argCount:2},equal:{type:"operator",argCount:2},unequal:{type:"operator",argCount:2}};function pi(n){if(!n||typeof n!="string")return!1;let t=["sqrt","exp","ln","log10","log2","sign","cbrt","pi","e","pow","replaceAll","match","repeat","split","trim","style","unstyle","empty","ifs","dateBetween","dateRange","dateStart","dateEnd","timestamp","fromTimestamp","day","week","name","email","find","findIndex","some","every","let","lets","id","link"],e=/([a-zA-Z_][a-zA-Z0-9_]*)\s*\(/g,r=n.matchAll(e);for(let i of r){let o=i[1];if(o!=="prop"&&!(o==="sum"||o==="mean"||o==="median"||o==="max"||o==="min")&&!mh[o])return t.includes(o),!1}return!0}function hh(n,t){let e=n;if(t&&(e=e.replace(/\{\{notion:block_property:([^:]+):[^}]+\}\}/g,(l,s)=>{for(let[,c]of Object.entries(t))if(c.id===s)return`prop("${c.name}")`;return l})),!pi(e))return null;e=e.replace(/prop\s*\(\s*"([^"]+)"\s*\)/g,(l,s)=>`note["${s}"]`),e=e.replace(/\.length\s*\(\s*\)/g,".length");let r=[];e=e.replace(/parseDate\s*\(([^()]*)\)/g,(l,s)=>{let c=r.length;return r.push(s),`__PARSEDATE_${c}__`});let i=!0,o=20,a=0;for(;i&&a<o;){i=!1,a++;let l=/(?<![.\w])([a-zA-Z_][a-zA-Z0-9_]*)\s*\(/g,s,c=!1;for(;(s=l.exec(e))!==null&&!c;){let p=s[1],u=s.index,f=s.index+s[0].length-1,h=gx(e,f);if(h===-1)continue;let b=h+1,d=e.substring(f+1,h);if(p.startsWith("__PARSEDATE_"))continue;let m=null;if(p==="test"){let y=ci(d);if(y.length===2){let T=y[0],_=y[1].trim();(_.startsWith('"')&&_.endsWith('"')||_.startsWith("'")&&_.endsWith("'"))&&(_=_.slice(1,-1)),m=`/${_}/.matches(${T})`}}if(p==="sum"||p==="mean"||p==="median"||p==="max"||p==="min"){let y=ci(d);y.length>0&&(m=`[${y.join(", ")}].flat().${p}()`)}if(p==="dateAdd"){let y=fh(d,"+");y&&(m=y)}else if(p==="dateSubtract"){let y=fh(d,"-");y&&(m=y)}else if(p!=="fromTimestamp"){let y=mh[p];if(y)if(y.type==="global"){if(y.obsidianName){let T=ci(d);m=`${y.obsidianName}(${T.join(", ")})`}}else{let T=ci(d);if(y.type==="property")T.length===1&&(m=`(${T[0]}).${y.obsidianName}`);else if(y.type==="method"){if(T.length>=1){let k=T[0],_=T.slice(1);(p==="map"||p==="filter")&&(_=_.map(A=>A.replace(/\bcurrent\b/g,"value"))),_.length>0?m=`(${k}).${y.obsidianName}(${_.join(", ")})`:m=`(${k}).${y.obsidianName}()`}}else if(y.type==="operator"){if(p==="at"&&T.length===2)m=`(${T[0]})[${T[1]}]`;else if(p==="first"&&T.length===1)m=`(${T[0]})[0]`;else if(p==="last"&&T.length===1)m=`(${T[0]})[-1]`;else if(T.length===2){let _={add:"+",subtract:"-",multiply:"*",divide:"/",mod:"%",equal:"==",unequal:"!="}[p];_&&(m=`(${T[0]} ${_} ${T[1]})`)}}}}if(m!==null){i=!0,c=!0,e=e.substring(0,u)+m+e.substring(b);break}}}for(let l=0;l<r.length;l++)e=e.replace(new RegExp(`__PARSEDATE_${l}__`,"g"),`date(${r[l]})`);return e}function ci(n){if(!n.trim())return[];let t=[],e="",r=0,i=!1,o="";for(let a=0;a<n.length;a++){let l=n[a];i?(e+=l,l===o&&n[a-1]!=="\\"&&(i=!1)):l==='"'||l==="'"?(i=!0,o=l,e+=l):l==="("||l==="["?(r++,e+=l):l===")"||l==="]"?(r--,e+=l):l===","&&r===0?(t.push(e.trim()),e=""):e+=l}return e.trim()&&t.push(e.trim()),t}function fh(n,t){let e=ci(n);if(e.length!==3)return null;let r=e[0],i=e[1],a=e[2].trim();(a.startsWith('"')&&a.endsWith('"')||a.startsWith("'")&&a.endsWith("'"))&&(a=a.slice(1,-1));let s={years:"y",quarters:"q",months:"M",weeks:"w",days:"d",hours:"h",minutes:"m"}[a]||a;return`(${r}) ${t} '${i}${s}'`}function gx(n,t){let e=1,r=!1,i="";for(let o=t+1;o<n.length;o++){let a=n[o],l=o>0?n[o-1]:"";if(r)a===i&&l!=="\\"&&(r=!1);else if(a==='"'||a==="'")r=!0,i=a;else if(a==="(")e++;else if(a===")"&&(e--,e===0))return o}return-1}function Ko(n){return!n||typeof n!="object"?null:n.expression||null}var Pl=3;async function Xo(n,t,e,r){let i=r==null?void 0:r.get(n);return i||(i=await Cl(t,n,e),r&&r.set(n,i)),i}async function Jo(n){let{block:t,client:e,ctx:r,blocksCache:i,processor:o,errorContext:a}=n;if(t.has_children)try{let l=await Xo(t.id,e,r,i);return l.length===0?void 0:await o(l)}catch(l){let s=a||"block",c=l instanceof Error?l.message:String(l);console.error(`Failed to fetch children for ${s} ${t.id}:`,l),r.reportFailed(`Fetch children for ${s} ${t.id}`,c);return}}async function rt(n,t,e=0){try{return await n()}catch(r){if(r.code==="rate_limited"||r.status===429){if(e>=Pl)throw new Error(`Rate limit exceeded after ${Pl} retries`);let i=1;r.headers&&r.headers["retry-after"]?i=parseInt(r.headers["retry-after"],10):i=Math.pow(2,e);let o=t.statusMessage;return t.status(`Rate limited. Waiting ${i} seconds before retry (${e+1}/${Pl})...`),await new Promise(a=>setTimeout(a,i*1e3)),t.status(o),rt(n,t,e+1)}throw r}}async function Cl(n,t,e){var o;let r=[],i;do{let a=await rt(()=>n.blocks.children.list({block_id:t,start_cursor:i,page_size:100}),e),l=a.results.filter(s=>"type"in s);r.push(...l),i=a.has_more&&(o=a.next_cursor)!=null?o:void 0}while(i);return r}async function Nl(n,t,e,r){for(let i of t){if(i.type==="child_page")return!0;if(i.type==="child_database")try{let o=await rt(()=>n.databases.retrieve({database_id:i.id}),e);if(o.data_sources&&o.data_sources.length>0)return!0}catch(o){let a=o instanceof Error?o.message:String(o);console.warn(`[hasChildPagesOrDatabases] Failed to check database ${i.id}, skipping:`,a)}if(i.has_children)try{let o=await Xo(i.id,n,e,r);if(o.length>0&&await Nl(n,o,e,r))return!0}catch(o){let a=o instanceof Error?o.message:String(o);console.error(`Failed to fetch children for block ${i.id}:`,o),e.reportFailed(`Fetch children for block ${i.id}`,a)}}return!1}function yh(n){let t=n.properties;for(let e in t){let r=t[e];if(r.type==="title"&&r.title.length>0)return r.title.map(i=>i.plain_text).join("")}return"Untitled"}async function bh(n){let{page:t,formulaStrategy:e="hybrid",databaseProperties:r,client:i,ctx:o}=n,a={"notion-id":t.id};t.cover&&(a.cover=yx(t.cover));let l=t.properties;for(let s in l){let c=l[s];if(c.type==="title")continue;if(c.type==="formula"){if(bx(s,r,e)){let f=gh(c);f!=null&&(a[s]=f)}continue}if(c.type==="people"&&i&&o){let u=await vx(c,i,o);u!=null&&(a[s]=u);continue}let p=gh(c);p!=null&&(a[s]=p)}return a}function yx(n){var t,e;return n?n.type==="external"&&((t=n.external)!=null&&t.url)?n.external.url:n.type==="file"&&((e=n.file)!=null&&e.url)?n.file.url:null:null}function bx(n,t,e){if(e==="static")return!0;if(e==="function")return!1;if(t&&t[n]){let r=Ko(t[n].formula);if(r&&pi(r))return!1}return!0}async function vx(n,t,e){if(!n.people||!Array.isArray(n.people))return[];let r=[];for(let i of n.people)if(i.name)r.push(i.name);else if(i.object==="user"&&i.id)try{let o=await rt(()=>t.users.retrieve({user_id:i.id}),e);if(o&&"name"in o){let a=o.name||o.id;r.push(a)}else r.push(i.id)}catch(o){console.warn(`Failed to fetch user ${i.id}:`,o),r.push(i.id)}else r.push(i.id);return r}function gh(n){var t,e,r,i,o,a,l,s,c,p,u,f,h,b,d,m,y,T,k;switch(n.type){case"number":return n.number;case"checkbox":return n.checkbox;case"select":return((t=n.select)==null?void 0:t.name)||null;case"multi_select":return((e=n.multi_select)==null?void 0:e.map(A=>A.name))||[];case"status":return((r=n.status)==null?void 0:r.name)||null;case"date":return n.date?n.date.end?`${n.date.start} to ${n.date.end}`:n.date.start:null;case"email":return n.email;case"url":return n.url;case"phone_number":return n.phone_number;case"rich_text":return((i=n.rich_text)==null?void 0:i.map(A=>A.plain_text).join(""))||"";case"people":return((o=n.people)==null?void 0:o.map(A=>{var E;return A.type==="person"&&((E=A.person)!=null&&E.email)?A.person.email:A.name||A.id}))||[];case"files":return((a=n.files)==null?void 0:a.map(A=>{var E,P;return A.type==="file"?((E=A.file)==null?void 0:E.url)||"":A.type==="external"&&((P=A.external)==null?void 0:P.url)||""}).filter(A=>A))||[];case"formula":if(!n.formula)return null;let _=n.formula;switch(_.type){case"string":return _.string;case"number":return _.number;case"boolean":return _.boolean;case"date":return((l=_.date)==null?void 0:l.start)||null;default:return null}case"relation":return((s=n.relation)==null?void 0:s.map(A=>A.id))||[];case"rollup":return null;case"created_time":return n.created_time;case"created_by":return((c=n.created_by)==null?void 0:c.type)==="person"&&((p=n.created_by.person)!=null&&p.email)?n.created_by.person.email:((u=n.created_by)==null?void 0:u.name)||((f=n.created_by)==null?void 0:f.id)||null;case"last_edited_time":return n.last_edited_time;case"last_edited_by":return((h=n.last_edited_by)==null?void 0:h.type)==="person"&&((b=n.last_edited_by.person)!=null&&b.email)?n.last_edited_by.person.email:((d=n.last_edited_by)==null?void 0:d.name)||((m=n.last_edited_by)==null?void 0:m.id)||null;case"unique_id":return(y=n.unique_id)!=null&&y.prefix?`${n.unique_id.prefix}-${n.unique_id.number}`:((T=n.unique_id)==null?void 0:T.number)||null;case"verification":return((k=n.verification)==null?void 0:k.state)||null;default:return String(n[n.type]||"")}}var br=require("obsidian");var At=require("obsidian");async function Qo(n,t){let{vault:e,ctx:r,downloadExternalAttachments:i,currentPageTitle:o,incrementalImport:a}=t;if(!(n.type==="file"||n.type==="external"&&i))return{path:n.url,isLocal:!1};let s=n.name||wx(n.url)||o||"attachment";s=de(s);try{r.status(`Downloading attachment: ${s}...`);let c=await(0,At.requestUrl)({url:n.url,method:"GET",throw:!1});if(c.status!==200)return console.error(`Failed to download attachment "${s}": ${c.status}`),r.reportFailed(`Attachment: ${s}`,`HTTP ${c.status}`),{path:n.url,isLocal:!1};let[p,u]=Yn(s);if(!u){let y=c.headers["content-type"]||c.headers["Content-Type"];if(y){let T=ir(y);T&&(s=`${p}.${T}`)}}let f=t.currentFilePath||t.currentFolderPath,h=await t.app.fileManager.getAvailablePathForAttachment(s,f);if(console.log(`[ATTACHMENT] Incremental import enabled: ${a}, Original filename: ${s}`),console.log(`[ATTACHMENT] Available target path: ${h}`),a){let{parent:y,basename:T}=ee(h),k=T+(u?`.${u}`:"");if(console.log(`[ATTACHMENT] Target full filename: ${k}`),k!==s){console.log(`[ATTACHMENT] Filename changed (${s} \u2192 ${k}), original file exists`);let _=(0,At.normalizePath)(`${y}/${s}`);console.log(`[ATTACHMENT] Checking original file: ${_}`);let A=e.getAbstractFileByPath(_);if(A&&A instanceof At.TFile){let E=c.arrayBuffer.byteLength;if(console.log(`[ATTACHMENT] Downloaded size: ${E} bytes, Existing size: ${A.stat.size} bytes`),A.stat.size===E){console.log(`[ATTACHMENT] Skipping attachment (same size): ${s}`),r.reportSkipped(`Attachment: ${s}`,"already exists with same size (incremental import)");let{parent:P,basename:v}=ee(_);return{path:(0,At.normalizePath)(P?`${P}/${v}`:v),isLocal:!0,filename:s}}else console.log(`[ATTACHMENT] Sizes don't match, will save as new file: ${k}`)}}else console.log("[ATTACHMENT] Filename unchanged, original file doesn't exist")}await e.createBinary(h,c.arrayBuffer);let{parent:b,basename:d}=ee(h);return{path:(0,At.normalizePath)(b?`${b}/${d}`:d),isLocal:!0,filename:s}}catch(c){let p=c instanceof Error?c.message:String(c);return console.error(`Failed to download attachment "${s}":`,c),r.reportFailed(`Attachment: ${s}`,p),{path:n.url,isLocal:!1}}}function wx(n){try{let r=new URL(n).pathname.split("/"),i=r[r.length-1];return decodeURIComponent(i)||"attachment"}catch(t){return"attachment"}}function vh(n){let t=n.type,e=null;if(t==="image")e=n.image;else if(t==="video")e=n.video;else if(t==="file")e=n.file;else if(t==="pdf")e=n.pdf;else return null;return e?e.type==="file"&&e.file?{type:"file",url:e.file.url,name:e.name}:e.type==="external"&&e.external?{type:"external",url:e.external.url,name:e.name}:null:null}function ui(n){let t=n.type,e=[];return t==="image"&&n.image.caption?e=n.image.caption:t==="video"&&n.video.caption?e=n.video.caption:t==="file"&&n.file.caption?e=n.file.caption:t==="pdf"&&n.pdf.caption?e=n.pdf.caption:t==="bookmark"&&n.bookmark.caption?e=n.bookmark.caption:t==="link_preview"&&n.link_preview.caption?e=n.link_preview.caption:t==="embed"&&n.embed.caption&&(e=n.embed.caption),e.map(r=>r.plain_text).join("")||""}function wh(n){var f;let{result:t,vault:e,app:r,sourceFilePath:i,caption:o="",isEmbed:a=!1}=n;if(!t.isLocal)return a?`![${o}](${t.path})`:`[${o||"Link"}](${t.path})`;let[,l]=Yn(t.filename||""),s=l?`${t.path}.${l}`:t.path,c=e.getAbstractFileByPath((0,At.normalizePath)(s));if(!c||!(c instanceof At.TFile)){let h=(f=e.getConfig("useWikiLinks"))!=null?f:!0,b=a?"!":"";if(h)return o?`${b}[[${s}|${o}]]`:`${b}[[${s}]]`;{let d=o||s;return a?`![${d}](${s})`:`[${d}](${s})`}}let p=r.fileManager.generateMarkdownLink(c,i),u=a?"!":"";if(o){if(p.startsWith("[["))return`${u}${p.slice(0,-2)}|${o}]]`;{let h=p.slice(p.indexOf("](")+1);return`${u}[${o}]${h}`}}return`${u}${p}`}var gr=require("obsidian");function ea(n,t,e){let i=(0,gr.normalizePath)(`${t}/${e}`),o=1;for(;n.getAbstractFileByPath(i);)i=(0,gr.normalizePath)(`${t}/${e} ${o}`),o++;return i}function yr(n,t,e){let r=(0,gr.normalizePath)(`${t}/${e}`),i=r,o=1;for(console.log(`[GET UNIQUE FILE] Checking: ${r}`);n.getAbstractFileByPath(i);){let a=e.lastIndexOf(".");if(a>0){let l=e.substring(0,a),s=e.substring(a);i=(0,gr.normalizePath)(`${t}/${l} ${o}${s}`)}else i=(0,gr.normalizePath)(`${t}/${e} ${o}`);console.log(`[GET UNIQUE FILE] Path exists, trying: ${i}`),o++}return console.log(`[GET UNIQUE FILE] Final path: ${i}`),i}var ta={image:{type:"image",isEmbed:!0,fallbackText:"Image"},video:{type:"video",isEmbed:!0,fallbackText:"Video"},file:{type:"file",isEmbed:!1,fallbackText:"File"},pdf:{type:"pdf",isEmbed:!0,fallbackText:"PDF"}};async function vr(n,t,e,r){return await Jo({block:n,client:t.client,ctx:t.ctx,blocksCache:t.blocksCache,processor:async i=>{let o=e!==void 0?{...t,indentLevel:e}:t;return await na(i,o)},errorContext:r})}function xx(n){return!n||n.type!=="paragraph"?!1:n.paragraph.rich_text.length===0}function Tx(n,t,e){let r=(e==null?void 0:e.indentLevel)||0,i=["bulleted_list_item","numbered_list_item","to_do"],o=i.includes(n),a=i.includes(t);if(r>0){let l=["callout","toggle"];return!!(l.includes(n)||l.includes(t)||n==="table"||t==="table")}return!(o&&a)}async function na(n,t){let e=[];for(let r=0;r<n.length&&!t.ctx.isCancelled();r++){let i=n[r];if(i.type!=="numbered_list_item"&&t.listCounters){let a=t.indentLevel||0,l=[];t.listCounters.forEach((s,c)=>{c>a&&l.push(c)}),l.forEach(s=>t.listCounters.delete(s))}let o=await _x(i,t);if(o===""&&i.type==="paragraph")e.push("");else if(o&&(e.push(o),r<n.length-1)){let a=n[r+1],l=xx(a);Tx(i.type,a.type,t)&&!l&&e.push("")}}return e.join(`
`)}async function _x(n,t){var i;let e=n.type,r="";switch(e){case"paragraph":r=Ex(n,t);break;case"heading_1":case"heading_2":case"heading_3":r=kx(n,t);break;case"bulleted_list_item":r=await Ax(n,t);break;case"to_do":r=await Px(n,t);break;case"column_list":r=await Cx(n,t);break;case"toggle":r=await Ix(n,t);break;case"synced_block":r=await Rx(n,t);break;case"table":r=await Dx(n,t);break;case"numbered_list_item":r=await Ox(n,t);break;case"quote":r=Fx(n,t);break;case"callout":r=await Lx(n,t);break;case"divider":r=$x(n);break;case"equation":r=Mx(n);break;case"code":r=Bx(n,t);break;case"image":r=await jx(n,t);break;case"video":r=await qx(n,t);break;case"file":r=await Hx(n,t);break;case"pdf":r=await Wx(n,t);break;case"bookmark":r=Yx(n);break;case"embed":r=Vx(n);break;case"link_preview":r=Gx(n);break;case"child_database":let o=t.isProcessingSyncedBlock||!1,a=t.indentLevel||0,l=o?"SYNCED_CHILD_DATABASE":"DATABASE_PLACEHOLDER",s=kt(l,n.id);a>0?r="    ".repeat(a)+s:r=s;break;case"child_page":let c=t.isProcessingSyncedBlock||!1,p=t.indentLevel||0;if(c){let u=n.id,f=kt("SYNCED_CHILD_PAGE",u);p>0?r="    ".repeat(p)+f:r=f}else if(t.importPageCallback){let u=((i=n.child_page)==null?void 0:i.title)||"Untitled";try{await t.importPageCallback(n.id,t.currentFolderPath);let f=(0,br.normalizePath)(`${t.currentFolderPath}/${de(u)}.md`),h=t.vault.getAbstractFileByPath(f),b;if(h&&h instanceof br.TFile){let d=t.currentFilePath||t.currentFolderPath;b=t.app.fileManager.generateMarkdownLink(h,d)}else b=`[[${u}]]`;p>0?r="    ".repeat(p)+b:r=b}catch(f){let h=f instanceof Error?f.message:String(f);console.error(`Failed to import child page "${u}":`,f),t.ctx.reportFailed(`Child page: ${u}`,h),r=`<!-- Failed to import child page: ${h} -->`}}else console.warn(`child_page block ${n.id} skipped: no import callback provided`),r="";break;default:console.log(`Unsupported block type: ${e}`),r=""}return r}function Ex(n,t){return n.type!=="paragraph"?"":dt(n.paragraph.rich_text,t)}function kx(n,t){let e=(t==null?void 0:t.indentLevel)||0,r="    ".repeat(e),i="";return n.type==="heading_1"?i="# "+dt(n.heading_1.rich_text,t):n.type==="heading_2"?i="## "+dt(n.heading_2.rich_text,t):n.type==="heading_3"&&(i="### "+dt(n.heading_3.rich_text,t)),r+i}async function Ax(n,t){if(n.type!=="bulleted_list_item")return"";let e=t.indentLevel||0,i="    ".repeat(e)+"- "+dt(n.bulleted_list_item.rich_text,t),o=await vr(n,t,e+1,"bulleted list item");return o&&(i+=`
`+o),i}async function Px(n,t){if(n.type!=="to_do")return"";let e=t.indentLevel||0,r="    ".repeat(e),i=n.to_do.checked?"[x]":"[ ]",o=r+"- "+i+" "+dt(n.to_do.rich_text,t),a=await vr(n,t,e+1,"to-do item");return a&&(o+=`
`+a),o}async function Cx(n,t){return n.type!=="column_list"?"":await Jo({block:n,client:t.client,ctx:t.ctx,blocksCache:t.blocksCache,processor:async r=>{let i="";for(let o=0;o<r.length;o++){let a=r[o];if(a.type!=="column"){console.warn(`Expected column block, got ${a.type}`);continue}i+=`<!-- Column ${o+1} -->
`;let l=await Nx(a,t);l&&(i+=l),o<r.length-1&&(i+=`

`)}return i},errorContext:"column_list"})||""}async function Nx(n,t){return n.type!=="column"?"":await vr(n,t,void 0,"column")||""}async function Sx(n,t){let{client:e,ctx:r,vault:i,currentFolderPath:o,currentPageTitle:a}=t;if(!o)throw new Error("currentFolderPath is required for synced blocks");let s=`${a||"Page"} synced block`;try{let c=await e.blocks.retrieve({block_id:n});if(!("type"in c))throw new Error(`Retrieved block ${n} is partial, cannot process synced block`);let u=c.has_children?await Xo(n,e,r,t.blocksCache):[],f=yr(i,o,`${s}.md`),h={...t,currentFilePath:f,isProcessingSyncedBlock:!0},b=await na(u,h),d=li(b,"SYNCED_CHILD_PAGE");if(t.syncedChildPagePlaceholders&&d.length>0){let y=t.syncedChildPagePlaceholders.get(f)||new Set;d.forEach(T=>y.add(T)),t.syncedChildPagePlaceholders.set(f,y)}let m=li(b,"SYNCED_CHILD_DATABASE");if(t.syncedChildDatabasePlaceholders&&m.length>0){let y=t.syncedChildDatabasePlaceholders.get(f)||new Set;m.forEach(T=>y.add(T)),t.syncedChildDatabasePlaceholders.set(f,y)}return await i.create(f,b),console.log(`Created synced block file: ${f}`),f}catch(c){let p=c instanceof Error?c.message:String(c);throw console.error(`Failed to create synced block file "${s}":`,c),t.ctx.reportFailed(`Synced block: ${s}`,p),c}}async function Rx(n,t){if(n.type!=="synced_block")return"";let e=n.synced_block;if(!e)return"";let{syncedBlocksMap:r}=t;if(!r)return console.error("syncedBlocksMap is required for synced blocks"),"";let o=e.synced_from===null?n.id:e.synced_from.block_id,a=r.get(o);if(!a)try{a=await Sx(o,t),r.set(o,a)}catch(s){let c=s instanceof Error?s.message:String(s);return console.error(`Failed to process synced block ${o}:`,s),`<!-- Failed to import synced block: ${c} -->`}let l=t.vault.getAbstractFileByPath((0,br.normalizePath)(a));if(l&&l instanceof br.TFile){let s=t.currentFilePath||t.currentFolderPath;return`!${t.app.fileManager.generateMarkdownLink(l,s)}`}else{let{basename:s}=ee(a);return`![[${s}]]`}}async function Ix(n,t){if(n.type!=="toggle")return"";let r=n.toggle,a=`> [!note]+ ${dt(r.rich_text,t)}
`,l=await vr(n,t,0,"toggle block");if(l){let s=l.split(`
`).map(c=>`> ${c}`).join(`
`);a+=s}return a}async function Dx(n,t){if(n.type!=="table")return"";let i=n.table.table_width||0,o=new Array(i).fill("left"),a=await Jo({block:n,client:t.client,ctx:t.ctx,blocksCache:t.blocksCache,processor:async l=>{let s=[];for(let c=0;c<l.length;c++){let p=l[c];if(p.type!=="table_row")continue;let f=p.table_row;if(!f.cells)continue;let h=f.cells,b=[];for(let d=0;d<h.length;d++){let m=h[d],y=dt(m,t);y=y.replace(/\n/g,"<br>"),y.trim()||(y=" "),b.push(y)}if(s.push("| "+b.join(" | ")+" |"),c===0){let d=o.map(m=>{switch(m){case"left":return"---";case"center":return":---:";case"right":return"---:";default:return"---"}});s.push("| "+d.join(" | ")+" |")}}return s},errorContext:"table"});return!a||a.length===0?"":a.join(`
`)}async function Ox(n,t){if(n.type!=="numbered_list_item")return"";let e=t.indentLevel||0;t.listCounters||(t.listCounters=new Map);let r=(t.listCounters.get(e)||0)+1;t.listCounters.set(e,r);let o="    ".repeat(e)+`${r}. `+dt(n.numbered_list_item.rich_text,t),a=await vr(n,t,e+1,"numbered list item");return a&&(o+=`
`+a),o}function Fx(n,t){return n.type!=="quote"?"":"> "+dt(n.quote.rich_text,t)}async function Lx(n,t){if(n.type!=="callout")return"";let r=n.callout,i=r.icon&&"emoji"in r.icon?r.icon.emoji:"\u{1F4CC}",o=dt(r.rich_text,t),a="note";i==="\u{1F4A1}"||i==="\u26A1"?a="tip":i==="\u26A0\uFE0F"||i==="\u2757"?a="warning":i==="\u274C"||i==="\u{1F6AB}"?a="danger":i==="\u2705"||i==="\u2714\uFE0F"?a="success":i==="\u2139\uFE0F"||i==="\u2139"?a="info":(i==="\u2753"||i==="\u{1F914}")&&(a="question");let l=`> [!${a}] ${i}
`;l+=`> ${o}`;let s=await vr(n,t,0,"callout block");if(s){let c=s.split(`
`).map(p=>`> ${p}`).join(`
`);l+=`
`+c}return l}function $x(n){return n.type!=="divider"?"":"---"}function Mx(n){if(n.type!=="equation")return"";let e=n.equation;return e.expression?`$$
${e.expression}
$$`:""}function Bx(n,t){if(n.type!=="code")return"";let r=n.code;if(!r)return"";let i=r.rich_text.map(a=>a.plain_text||"").join("");return`\`\`\`${r.language||""}
${i}
\`\`\``}async function ra(n,t,e){let{type:r,isEmbed:i,fallbackText:o,beforeDownload:a}=e,l=vh(n);if(!l)return"";let s=ui(n);if(a){let c=a(l,n);if(c!==null)return c}try{let c=await Qo(l,t);c.isLocal&&t.onAttachmentDownloaded&&t.onAttachmentDownloaded();let p=t.currentFilePath||t.currentFolderPath;return wh({result:c,vault:t.vault,app:t.app,sourceFilePath:p,caption:s,isEmbed:i})}catch(c){let p=c instanceof Error?c.message:String(c);console.error(`Failed to convert ${r} block:`,c),t.ctx.reportFailed(`${r.charAt(0).toUpperCase()+r.slice(1)} attachment`,p);let u=s||l.name||o;return`${i?"!":""}[${u}](${l.url})`}}async function jx(n,t){return n.type!=="image"?"":ra(n,t,ta.image)}function Ux(n){return n.includes("youtube.com")||n.includes("youtu.be")}async function qx(n,t){return n.type!=="video"?"":ra(n,t,{...ta.video,beforeDownload:(e,r)=>e.type==="external"&&Ux(e.url)?`![${ui(r)||""}](${e.url})`:null})}async function Hx(n,t){return n.type!=="file"?"":ra(n,t,ta.file)}async function Wx(n,t){return n.type!=="pdf"?"":ra(n,t,ta.pdf)}function zx(n){return n.includes("youtube.com")||n.includes("youtu.be")||n.includes("twitter.com")||n.includes("x.com")}function Yx(n){if(n.type!=="bookmark")return"";let r=n.bookmark.url||"",i=ui(n);return i?`[${i}](${r})`:`[${r}](${r})`}function Vx(n){if(n.type!=="embed")return"";let r=n.embed.url||"",i=ui(n);return zx(r)?`![${i||""}](${r})`:i?`[${i}](${r})`:`[${r}](${r})`}function Gx(n){if(n.type!=="link_preview")return"";let r=n.link_preview.url||"";return`[${r}](${r})`}function dt(n,t){return!n||n.length===0?"":n.map(e=>{var o;let r=e.type,i="";return r==="text"?i=e.plain_text||"":r==="mention"?i=Zx(e,t):r==="equation"&&(i=`$${(((o=e.equation)==null?void 0:o.expression)||"").trim()}$`),e.annotations&&r!=="equation"&&(e.annotations.bold&&(i=`**${i}**`),e.annotations.italic&&(i=`*${i}*`),e.annotations.code&&(i=`\`${i}\``),e.annotations.strikethrough&&(i=`~~${i}~~`),e.annotations.underline&&(i=`<u>${i}</u>`),e.annotations.color&&e.annotations.color.includes("background")&&(i=`==${i}==`)),e.href&&r!=="mention"&&(i=`[${i}](${e.href})`),i}).join("")}function Zx(n,t){var i,o,a;let e=n.mention;if(!e)return n.plain_text||"";switch(e.type){case"database":return t!=null&&t.mentionedIds&&t.mentionedIds.add(e.database.id),kt("NOTION_DB",e.database.id);case"page":return t!=null&&t.mentionedIds&&t.mentionedIds.add(e.page.id),kt("NOTION_PAGE",e.page.id);case"date":let l=e.date,s="";return l.start&&(s=l.start,l.end&&(s+=` \u2192 ${l.end}`)),` ${s} `;case"link_mention":let c=((i=e.link_mention)==null?void 0:i.href)||"";return`[${((o=e.link_mention)==null?void 0:o.title)||n.plain_text||c}](${c})`;case"user":let u=e.user;if(u){let b=u.name||n.plain_text||"";return u.type==="person"&&((a=u.person)!=null&&a.email)?` [${b}](mailto:${u.person.email}) `:` ${b} `}return` ${n.plain_text||""} `;default:return` ${n.plain_text||""} `}}var it=require("obsidian");var ft={CHECKBOX:"checkbox",DATE:"date",DATETIME:"datetime",LIST:"list",NUMBER:"number",TEXT:"text"};async function Kx(n,t){var i;if(n.type!=="child_database")return"";let e=n.id,r="Untitled Database";try{let o=await ia(e,t);r=o.sanitizedTitle;let a=t.vault.getAbstractFileByPath((0,it.normalizePath)(o.baseFilePath));if(a&&a instanceof it.TFile){let l=t.currentFilePath||t.currentPageFolderPath;return`!${t.app.fileManager.generateMarkdownLink(a,l)}`}else return`![[${o.sanitizedTitle}.base]]`}catch(o){let a=o instanceof Error?o.message:String(o);return a.includes("Linked database")||a.includes("not supported by Notion API")?(console.log(`Skipping linked database (block ID: ${e})`),"<!-- Linked database (not supported by Notion API) -->"):(a.includes("Could not find database with ID")||a.includes("APIResponseError"))&&((i=n.child_database)==null?void 0:i.title)==="Untitled"&&!n.has_children?(console.log(`Skipping linked database view (block ID: ${e}) - this is a reference to an existing database`),"<!-- Linked database view (skipped - references an existing database) -->"):(console.error(`Failed to convert database "${r}":`,o),t.ctx.reportFailed(`Database: ${r}`,a),`<!-- Failed to import database: ${a} -->`)}}async function Xx(n,t,e){var o;let r=[],i;do{let a=await rt(()=>n.dataSources.query({data_source_id:t,start_cursor:i,page_size:100}),e),l=a.results.filter(s=>s.object==="page");r.push(...l),i=a.has_more&&(o=a.next_cursor)!=null?o:void 0}while(i);return r}function Jx(n){return n.title&&n.title.length>0?n.title.map(t=>t.plain_text).join(""):"Untitled Database"}async function ia(n,t,e=!1){let{ctx:r,currentPageFolderPath:i,client:o,vault:a,formulaStrategy:l,processedDatabases:s,relationPlaceholders:c,importPageCallback:p,onPagesDiscovered:u,databasePropertyName:f="base"}=t,h,b="Untitled Database";if(e)h=n,r.status(`Processing database from data source: ${h}...`);else{let N=await rt(()=>o.databases.retrieve({database_id:n}),r),C=Jx(N);if(b=de(C||"Untitled Database"),r.status(`Processing database: ${b}...`),!N.data_sources||N.data_sources.length===0){let F="Linked database (not supported by Notion API)";throw console.warn(`Skipping linked database (ID: ${n}): ${F}`),new Error(F)}h=N.data_sources[0].id}let d={},m=await rt(()=>o.dataSources.retrieve({data_source_id:h}),r);if(d=m.properties||{},e){let N=m,C=N.name||(N.title&&Array.isArray(N.title)?N.title.map(F=>{var L;return((L=F.text)==null?void 0:L.content)||F.plain_text||""}).join("").trim():null)||"Untitled Database";b=de(C),r.status(`Processing database: ${b}...`)}let y=await Xx(o,h,r);r.status(`Found ${y.length} pages in database ${b}`);let T=[];try{T=(await rt(()=>o.dataSources.listTemplates({data_source_id:h}),r)).templates||[],T.length>0&&r.status(`Found ${T.length} template(s) in database ${b}`)}catch(N){console.warn(`Failed to fetch templates for database ${b}:`,N)}u&&u(y.length);let k=(0,it.normalizePath)(i?`${i}/${b}`:b),_=a.getAbstractFileByPath(k),A;_ instanceof it.TFolder?A=k:(A=ea(a,i,b),await a.createFolder((0,it.normalizePath)(A)));let E=await Qx({vault:a,databaseName:b,databaseFolderPath:A,dataSourceProperties:d,formulaStrategy:l,databasePropertyName:f}),{basename:P}=ee(E),v=`${P}.base`;for(let N of y){if(r.isCancelled())break;await p(N.id,A,v)}if(T.length>0)for(let N of T){if(r.isCancelled())break;r.status(`Importing template: ${N.name}...`);let C=`${b} ${N.name}`;await p(N.id,A,void 0,C)}let D={id:n,title:b,folderPath:A,baseFilePath:E,properties:d,dataSourceId:h};return s.set(n,D),await r1(y,d,c),{sanitizedTitle:b,baseFilePath:E,databasePages:y,dataSourceId:h,dataSourceProperties:d}}async function Qx(n){let{vault:t,databaseName:e,databaseFolderPath:r,dataSourceProperties:i,formulaStrategy:o="hybrid",databasePropertyName:a="base"}=n,l=e1({databaseName:e,dataSourceProperties:i,formulaStrategy:o,databasePropertyName:a}),s=(0,it.normalizePath)(`${r}/${e}.base`),c=t.getAbstractFileByPath(s);if(c instanceof it.TFile)return await t.modify(c,l),s;let p=yr(t,r,`${e}.base`);return await t.create(p,l),p}function e1(n){let{databaseName:t,dataSourceProperties:e,formulaStrategy:r="hybrid",databasePropertyName:i="base"}=n,{formulas:o,regularProperties:a,titlePropertyName:l}=t1(e,r),s=["file.name"];for(let p of a)s.push(p.key);for(let p of o)s.push(p.key);let c={filters:{and:[`note["${i}"] == link("${t}.base")`]}};if(o.length>0){c.formulas={};for(let p of o){let u=p.key.replace(/^formula\./,"");c.formulas[u]=p.config.formula}}if(a.length>0||l){c.properties={},l&&(c.properties["file.name"]={displayName:l});for(let p of a)c.properties[p.key]={displayName:p.config.displayName},p.config.type&&(c.properties[p.key].type=p.config.type)}return c.views=[{type:"table",name:"Table",order:s}],`# ${t}

${(0,it.stringifyYaml)(c)}`}function t1(n,t="hybrid"){let e={},r=null;for(let[a,l]of Object.entries(n)){let s=l.type,c=l.name||a;switch(s){case"checkbox":e[a]={displayName:c,type:ft.CHECKBOX};break;case"date":e[a]={displayName:c,type:ft.DATE};break;case"number":e[a]={displayName:c,type:ft.NUMBER};break;case"select":case"status":e[a]={displayName:c,type:ft.TEXT};break;case"multi_select":e[a]={displayName:c,type:ft.LIST};break;case"title":r=c;break;case"rich_text":case"url":case"email":case"phone_number":e[a]={displayName:c,type:ft.TEXT};break;case"formula":let p=Ko(l.formula);if(t==="static")e[a]={displayName:c,type:ft.TEXT};else if(t==="hybrid")if(p&&pi(p)){let f=hh(p,n);f&&(e[`formula.${a}`]={displayName:c,formula:f})}else console.warn(`\u26A0\uFE0F Formula "${c}" cannot be converted to Obsidian syntax, falling back to text property.`),console.warn(`   Original: ${p}`),console.warn("   Reason: Contains unsupported functions (e.g., substring, slice, split, format, etc.)"),e[a]={displayName:c,type:ft.TEXT};break;case"relation":e[a]={displayName:c,type:ft.LIST,isRelation:!0,relationConfig:l.relation};break;case"rollup":let u=n1(l.rollup);u?e[`formula.${a}`]={displayName:c,formula:u}:console.warn(`Failed to convert rollup property "${c}" to formula.`);break;case"people":case"files":case"created_time":case"created_by":case"last_edited_time":case"last_edited_by":e[a]={displayName:c,type:ft.TEXT};break;default:console.log(`Unsupported property type: ${s}, treating as text`),e[a]={displayName:c,type:ft.TEXT}}}let i=[],o=[];for(let[a,l]of Object.entries(e))l.formula?i.push({key:a,config:l}):o.push({key:a,config:l});return{formulas:i,regularProperties:o,titlePropertyName:r}}function n1(n){if(!n)return null;let t=n.relation_property_name||n.relation_property_key,e=n.rollup_property_name||n.rollup_property_key,r=n.function;if(!t||!r)return null;let i=t;switch(r){case"show_original":if(e){let o=e;return`note["${i}"].map(value.asFile().properties["${o}"])`}return`note["${i}"]`;case"show_unique":if(e){let o=e;return`note["${i}"].map(value.asFile().properties["${o}"]).flat().unique()`}return`note["${i}"].unique()`;case"count":return`note["${i}"].length`;case"count_values":if(e){let o=e;return`note["${i}"].map(value.asFile().properties["${o}"]).flat().length`}return`note["${i}"].length`;case"unique":if(e){let o=e;return`note["${i}"].map(value.asFile().properties["${o}"]).flat().unique().length`}return`note["${i}"].unique().length`;case"empty":if(e){let o=e;return`note["${i}"].filter(value.asFile().properties["${o}"] == null || value.asFile().properties["${o}"] == "" || (typeof value.asFile().properties["${o}"] == "object" && value.asFile().properties["${o}"].length == 0)).length`}return`if(note["${i}"].length == 0, 1, 0)`;case"not_empty":if(e){let o=e;return`note["${i}"].filter(value.asFile().properties["${o}"] != null && value.asFile().properties["${o}"] != "" && !(typeof value.asFile().properties["${o}"] == "object" && value.asFile().properties["${o}"].length == 0)).length`}return`if(note["${i}"].length > 0, 1, 0)`;case"percent_empty":if(e){let o=e,a=`note["${i}"].length`,l=`note["${i}"].filter(value.asFile().properties["${o}"] == null || value.asFile().properties["${o}"] == "" || (typeof value.asFile().properties["${o}"] == "object" && value.asFile().properties["${o}"].length == 0)).length`;return`if(${a} == 0, 0, (${l} / ${a}) * 100)`}return`if(note["${i}"].length == 0, 100, 0)`;case"percent_not_empty":if(e){let o=e,a=`note["${i}"].length`,l=`note["${i}"].filter(value.asFile().properties["${o}"] != null && value.asFile().properties["${o}"] != "" && !(typeof value.asFile().properties["${o}"] == "object" && value.asFile().properties["${o}"].length == 0)).length`;return`if(${a} == 0, 0, (${l} / ${a}) * 100)`}return`if(note["${i}"].length > 0, 100, 0)`;case"earliest_date":if(e){let o=e;return`${`note["${i}"].map(value.asFile().properties["${o}"]).filter(value != null).map(date(value)).sort()`}[0]`}return console.warn('\u26A0\uFE0F Rollup function "earliest_date" requires a target property.'),null;case"latest_date":if(e){let o=e;return`${`note["${i}"].map(value.asFile().properties["${o}"]).filter(value != null).map(date(value)).sort()`}[-1]`}return console.warn('\u26A0\uFE0F Rollup function "latest_date" requires a target property.'),null;case"date_range":if(e){let o=e,a=`note["${i}"].map(value.asFile().properties["${o}"]).filter(value != null).map(date(value)).sort()`,l=`${a}[0]`,s=`${a}[-1]`;return`(${l}).format("YYYY-MM-DD") + " \u2192 " + (${s}).format("YYYY-MM-DD")`}return console.warn('\u26A0\uFE0F Rollup function "date_range" requires a target property.'),null;default:return console.warn(`\u26A0\uFE0F Unsupported rollup function: "${r}"`),console.warn("   This rollup property will be skipped."),console.warn("   Please report this to the plugin developer if this is a valid Notion rollup function."),null}}async function r1(n,t,e){var i;let r={};for(let[o,a]of Object.entries(t))a.type==="relation"&&(r[o]=a);if(Object.keys(r).length!==0)for(let o of n){let a=o.properties;for(let[l,s]of Object.entries(r)){let c=a[l];if(c&&c.type==="relation"&&c.relation){let p=c.relation.map(u=>u.id);if(p.length>0){let u=s.type==="relation"&&"relation"in s&&((i=s.relation)==null?void 0:i.database_id)||"";e.push({pageId:o.id,propertyKey:l,relatedPageIds:p,targetDatabaseId:u})}}}}}async function Th(n,t,e){let r=li(n,"DATABASE_PLACEHOLDER");if(r.length===0)return n;let i=n;for(let o of r){let a=kt("DATABASE_PLACEHOLDER",o),l=t.find(s=>s.id===o&&s.type==="child_database");if(l)try{let s=await Kx(l,e);i=i.replace(a,s)}catch(s){let c=s instanceof Error?s.message:String(s);console.error(`Failed to process database ${o}:`,s),i=i.replace(a,`<!-- Failed to import database: ${c} -->`)}}return i}var oa=class extends ce{constructor(){super(...arguments);this.notionToken="";this.formulaStrategy="hybrid";this.downloadExternalAttachments=!1;this.coverPropertyName="cover";this.databasePropertyName="base";this.incrementalImport=!1;this.notionClient=null;this.processedPages=new Set;this.requestCount=0;this.totalNodesToImport=0;this.selectedNodeIds=new Set;this.pageTree=[];this.pageTreeContainer=null;this.listPagesButton=null;this.toggleSelectButton=null;this.outputRootPath="";this.processedDatabases=new Map;this.relationPlaceholders=[];this.processedPagesCount=0;this.attachmentsDownloaded=0;this.notionIdToPath=new Map;this.mentionPlaceholders=new Map;this.syncedBlocksMap=new Map;this.syncedChildPagePlaceholders=new Map;this.syncedChildDatabasePlaceholders=new Map}init(){this.addOutputLocationSetting("Notion"),new Z.Setting(this.modal.contentEl).setName("Notion API token").setDesc(this.createTokenDescription()).addText(l=>l.setPlaceholder("ntn_...").setValue(this.notionToken).onChange(s=>{this.notionToken=s.trim()}).then(s=>{s.inputEl.type="password"}));let e=new Z.Setting(this.modal.contentEl).setName("Select pages to import").setDesc('Click "Load" to see data you can import. If a page or database is missing, check that your Notion integration has access to it.'),r=null,i=null;e.addButton(l=>(r=l,l.setButtonText("Select all").onClick(()=>{this.toggleSelectButton=r,this.handleToggleSelectClick()}),l.buttonEl&&(l.buttonEl.addClass("notion-toggle-button"),l.buttonEl.style.display="none"),l)),e.addButton(l=>(i=l,l.setButtonText("Load").onClick(async()=>{try{this.listPagesButton=i,this.toggleSelectButton=r,await this.loadPageTree()}catch(s){console.error("[Notion Importer] Error in loadPageTree:",s),new Z.Notice(`Failed to load pages: ${s.message}`)}}),l.buttonEl&&(l.buttonEl.addClass("notion-load-button"),l.buttonEl.addClass("mod-cta")),l));let o=this.modal.contentEl.createDiv();o.addClass("file-tree","publish-section"),this.pageTreeContainer=o.createDiv("publish-change-list"),this.pageTreeContainer.style.maxHeight="200px",this.pageTreeContainer.style.overflowY="auto",this.pageTreeContainer.style.border="1px solid var(--background-modifier-border)",this.pageTreeContainer.style.borderRadius="var(--radius-s)",this.pageTreeContainer.style.backgroundColor="var(--background-primary-alt)",this.pageTreeContainer.style.padding="var(--size-4-2)";let a=this.pageTreeContainer.createDiv();a.style.color="var(--text-muted)",a.style.fontSize="var(--font-ui-small)",a.style.textAlign="center",a.style.padding="30px 10px",a.setText('Click "Load" to load your Notion pages and databases.'),new Z.Setting(this.modal.contentEl).setName("Incremental import").setDesc("Adds a notion-id property to pages so that future imports can skip pages that have already been imported.").addToggle(l=>l.setValue(!1).onChange(s=>{this.incrementalImport=s})),new Z.Setting(this.modal.contentEl).setName("Convert formulas").setDesc(this.createFormulaStrategyDescription()).addDropdown(l=>{l.addOption("hybrid","Obsidian syntax").addOption("static","Static values").setValue("hybrid").onChange(s=>{this.formulaStrategy=s})}),new Z.Setting(this.modal.contentEl).setName("Download external attachments").setDesc(this.createAttachmentDescription()).addToggle(l=>{l.setValue(!1).onChange(s=>{this.downloadExternalAttachments=s})}),new Z.Setting(this.modal.contentEl).setName("Cover property name").setDesc(this.createCoverPropertyDescription()).addText(l=>l.setPlaceholder("cover").setValue("cover").onChange(s=>{this.coverPropertyName=s.trim()||"cover"})),new Z.Setting(this.modal.contentEl).setName("Database property name").setDesc('Property name in page frontmatter to link pages to their database .base file (default: "base")').addText(l=>l.setPlaceholder("base").setValue("base").onChange(s=>{this.databasePropertyName=s.trim()||"base"}))}createTokenDescription(){let e=document.createDocumentFragment();return e.appendText("To get an API token create an integration in Notion and give it access to pages in your workspace. "),e.createEl("a",{text:"Get API token.",href:"https://www.notion.so/profile/integrations"}),e}createFormulaStrategyDescription(){let e=document.createDocumentFragment();return e.appendText("By default Notion formulas are converted to Obsidian syntax. If any Notion syntax is not supported the static values will be saved instead. Alternatively you can import all formulas as static values."),e}createAttachmentDescription(){let e=document.createDocumentFragment();return e.appendText("Download external attachments (external URLs) to local files. Notion-hosted files are always downloaded. "),e.createEl("br"),e.appendText("Attachments will be saved according to your vault's attachment folder settings."),e}createCoverPropertyDescription(){let e=document.createDocumentFragment();return e.appendText("Property name for page cover image in YAML frontmatter. "),e.createEl("br"),e.appendText(`Leave as "cover" if you don't have conflicts with existing properties.`),e}initializeNotionClient(){this.notionClient=new _h.Client({auth:this.notionToken,notionVersion:"2025-09-03",fetch:async(e,r)=>{let i=e.toString();try{let o=await(0,Z.requestUrl)({url:i,method:(r==null?void 0:r.method)||"GET",headers:r==null?void 0:r.headers,body:r==null?void 0:r.body,throw:!1});return new Response(o.arrayBuffer,{status:o.status,statusText:o.status.toString(),headers:new Headers(o.headers)})}catch(o){throw console.error("Request failed:",o),o}}})}async loadPageTree(){if(!this.notionToken){new Z.Notice("Please enter your Notion API token first.");return}if(this.listPagesButton){this.listPagesButton.setDisabled(!0),this.listPagesButton.setButtonText("Loading...");try{this.initializeNotionClient();let e={status:a=>{this.listPagesButton&&this.listPagesButton.setButtonText(a)},isCancelled:()=>!1,reportFailed:(a,l)=>{console.error(`Failed: ${a}`,l)},statusMessage:""},r=[],i,o=0;do{o++,e.status(`Loading... (${r.length} items, page ${o})`);let a=await rt(()=>this.notionClient.search({start_cursor:i,page_size:100}),e);for(let l of a.results)if(!(l.parent&&l.parent.type==="block_id")&&(l.object==="page"||l.object==="data_source")){let s=l.object==="data_source",c=this.extractItemTitle(l,s?"Untitled Database":"Untitled"),p=s?l.database_parent:l.parent,u=this.extractParentId(p,s?"database":"page");r.push({id:l.id,title:c,type:s?"database":"page",parentId:u})}i=a.has_more?a.next_cursor:void 0}while(i);this.pageTree=this.buildTree(r),this.renderPageTree(),this.toggleSelectButton&&this.toggleSelectButton.buttonEl&&(this.toggleSelectButton.buttonEl.style.display=""),new Z.Notice(`Found ${r.length} pages and databases.`)}catch(e){console.error("[Notion Importer] Failed to load pages:",e),new Z.Notice(`Failed to load pages: ${e.message||"Unknown error"}`)}finally{this.listPagesButton&&(this.listPagesButton.setDisabled(!1),this.listPagesButton.setButtonText("Refresh"))}}}extractItemTitle(e,r="Untitled"){let i;if(e.title)i=e.title;else if(e.properties)for(let a in e.properties){let l=e.properties[a];if(l.type==="title"&&l.title){i=l.title;break}}return!i||!Array.isArray(i)?r:i.map(a=>{var l;return((l=a.text)==null?void 0:l.content)||a.plain_text||""}).join("").trim()||r}extractParentId(e,r){if(!e)return null;switch(e.type){case"page_id":return e.page_id;case"data_source_id":return e.data_source_id;case"database_id":return e.database_id;case"workspace":return null;case"block_id":return console.warn("[Notion Importer] block_id parent should be filtered before calling extractParentId"),null;default:let i=e;return console.warn(`[Notion Importer] Unexpected parent type for ${r}:`,i),null}}findNodeById(e,r){for(let i of e){if(i.id===r)return i;if(i.children.length>0){let o=this.findNodeById(i.children,r);if(o)return o}}return null}buildTree(e){let r=new Map,i=[];for(let a of e)r.set(a.id,{id:a.id,title:a.title,type:a.type,parentId:a.parentId,children:[],selected:!1,disabled:!1,collapsed:!0});for(let a of r.values())a.parentId&&r.has(a.parentId)?r.get(a.parentId).children.push(a):i.push(a);let o=a=>{a.sort((l,s)=>l.title.localeCompare(s.title));for(let l of a)o(l.children)};return o(i),i}renderPageTree(){if(this.pageTreeContainer||(this.pageTreeContainer=this.modal.contentEl.querySelector(".publish-change-list")),!this.pageTreeContainer){console.error("[Notion Importer] Container not found!");return}if(this.pageTreeContainer.empty(),this.pageTree.length===0){this.pageTreeContainer.createEl("div",{text:"No pages or databases found. Make sure your integration has access to the pages you want to import.",cls:"notion-tree-empty"});return}for(let e of this.pageTree)this.renderTreeNode(this.pageTreeContainer,e,0);this.toggleSelectButton&&this.updateToggleButtonText()}renderTreeNode(e,r,i){let o=e.createDiv("tree-item"),a=o.createDiv("tree-item-self");if(a.addClass("is-clickable"),r.children.length>0?(a.addClass("mod-collapsible"),a.addClass("mod-folder")):a.addClass("mod-file"),r.disabled&&(a.addClass("is-disabled"),a.style.opacity="0.5",a.style.pointerEvents="none"),r.children.length>0){let f=a.createDiv("tree-item-icon collapse-icon");(0,Z.setIcon)(f,"right-triangle"),r.collapsed&&(f.addClass("is-collapsed"),o.addClass("is-collapsed")),r.disabled&&(f.style.pointerEvents="auto");let h=o,b,d;f.addEventListener("click",m=>{m.stopPropagation(),r.collapsed=!r.collapsed,b||(b=h.querySelector(".tree-item-children")),d||(d=h.querySelector(".file-tree-item-icon")),r.collapsed?(f.addClass("is-collapsed"),h.addClass("is-collapsed"),b&&(b.style.display="none"),r.type!=="database"&&d&&(d.empty(),(0,Z.setIcon)(d,"folder"))):(f.removeClass("is-collapsed"),h.removeClass("is-collapsed"),b&&(b.style.display=""),r.type!=="database"&&d&&(d.empty(),(0,Z.setIcon)(d,"folder-open")))})}let l=a.createDiv("tree-item-inner file-tree-item"),s=l.createEl("input",{type:"checkbox",cls:"file-tree-item-checkbox"});s.checked=r.selected,s.disabled=r.disabled,r.disabled||s.addEventListener("change",()=>{this.toggleNodeSelection(r,s.checked),this.renderPageTree()});let c=l.createDiv("file-tree-item-icon");r.type==="database"?(0,Z.setIcon)(c,"database"):r.children.length>0?(0,Z.setIcon)(c,r.collapsed?"folder":"folder-open"):(0,Z.setIcon)(c,"file"),l.createDiv("file-tree-item-title").setText(r.title);let u=o.createDiv("tree-item-children");if(r.collapsed&&(u.style.display="none"),r.children.length>0)for(let f of r.children)this.renderTreeNode(u,f,i+1)}toggleNodeSelection(e,r){e.selected=r,r?this.selectAllChildren(e,!0):this.enableAllChildren(e)}selectAllNodes(e){let r=i=>{i.disabled||(i.selected=e,e?this.selectAllChildren(i,!0):this.enableAllChildren(i));for(let o of i.children)r(o)};for(let i of this.pageTree)r(i)}selectAllChildren(e,r){for(let i of e.children)i.selected=r,i.disabled=r,this.selectAllChildren(i,r)}enableAllChildren(e){for(let r of e.children)r.disabled=!1,r.selected=!1,this.enableAllChildren(r)}areAllNodesSelected(){let e=r=>{for(let i of r)if(!i.selected||!e(i.children))return!1;return!0};return e(this.pageTree)}handleToggleSelectClick(){if(this.pageTree.length===0){new Z.Notice("Please list importable pages first.");return}this.areAllNodesSelected()?this.selectAllNodes(!1):this.selectAllNodes(!0),this.renderPageTree()}updateToggleButtonText(){if(!this.toggleSelectButton)return;let e=this.areAllNodesSelected();this.toggleSelectButton.setButtonText(e?"Deselect all":"Select all")}getSelectedNodeIds(){let e=[],r=0;this.selectedNodeIds.clear();let i=o=>{for(let a of o)a.selected&&(a.type==="page"&&(r++,this.selectedNodeIds.add(a.id)),a.disabled||e.push(a.id)),i(a.children)};return i(this.pageTree),this.totalNodesToImport=r,e}async import(e){if(!this.notionToken){new Z.Notice("Please enter your Notion API token.");return}let r=this.getSelectedNodeIds();if(r.length===0){new Z.Notice("Please select at least one page or database to import.");return}let i=await this.getOutputFolder();if(!i){new Z.Notice("Please select a location to export to.");return}e.status("Connecting to Notion API...");try{this.initializeNotionClient(),e.status("Fetching page content from Notion..."),this.processedPages.clear(),this.processedDatabases.clear(),this.relationPlaceholders=[],this.processedPagesCount=0,this.attachmentsDownloaded=0,e.status(`Preparing to import ${this.totalNodesToImport} item(s)...`),e.reportProgress(0,this.totalNodesToImport),this.outputRootPath=i.path,e.status(`Importing ${r.length} item(s)...`);for(let o=0;o<r.length&&!e.isCancelled();o++){let a=r[o];e.status(`Importing item ${o+1}/${r.length}...`);try{let l=this.findNodeById(this.pageTree,a);if(!l){console.warn(`Could not find node with ID: ${a}`),e.reportFailed(`Import item ${a}`,"Item not found in tree");continue}l.type==="database"?await this.importTopLevelDatabase(e,a,i.path,{isDataSourceId:!0}):l.type==="page"?await this.fetchAndImportPage({ctx:e,pageId:a,parentPath:i.path}):(console.warn(`Unknown node type: ${l.type} (ID: ${a})`),e.reportFailed(`Import item ${a}`,`Unknown type: ${l.type}`))}catch(l){console.error(`Failed to import item ${a}:`,l),e.reportFailed(`Import item ${a}`,l)}}e.status("Processing relation links..."),await this.replaceRelationPlaceholders(e),e.status("Processing mention links..."),await this.replaceMentionPlaceholdersInAllFiles(e),e.status("Processing synced block child references..."),await this.replaceSyncedChildPlaceholders(e),this.incrementalImport||(e.status("Cleaning up notion-id attributes..."),await this.cleanupNotionIds(e)),e.status("Import completed successfully!")}catch(o){console.error("Notion API import error:",o),e.reportFailed("Notion API import",o),new Z.Notice(`Import failed: ${o.message}`)}}async importTopLevelDatabase(e,r,i,o={}){if(e.isCancelled())return;let{isDataSourceId:a=!1}=o;try{await ia(r,{ctx:e,currentPageFolderPath:i,currentFilePath:void 0,client:this.notionClient,vault:this.vault,app:this.app,outputRootPath:this.outputRootPath,formulaStrategy:this.formulaStrategy,processedDatabases:this.processedDatabases,relationPlaceholders:this.relationPlaceholders,databasePropertyName:this.databasePropertyName,importPageCallback:async(l,s,c,p)=>{await this.fetchAndImportPage({ctx:e,pageId:l,parentPath:s,databaseTag:c,customFileName:p})},onPagesDiscovered:l=>{}},a)}catch(l){throw console.error(`Failed to import database ${r}:`,l),l}}async fetchAndImportPage(e){let{ctx:r,pageId:i,parentPath:o,databaseTag:a,customFileName:l}=e;if(!r.isCancelled()&&!this.processedPages.has(i)){this.processedPages.add(i);try{let s=await rt(()=>this.notionClient.pages.retrieve({page_id:i}),r),c=yh(s),p=l?de(l):de(c||"Untitled");r.status(`Importing: ${p}`);let u=new Map,f=await Cl(this.notionClient,i,r);u.set(i,f);let h=await Nl(this.notionClient,f,r,u),b,d,m=!1;if(h){let E=(0,Z.normalizePath)(o?`${o}/${p}`:p);this.vault.getAbstractFileByPath(E)instanceof Z.TFolder?b=E:(b=ea(this.vault,o,p),await this.createFolders(b));let v=`${p}.md`,D=(0,Z.normalizePath)(`${b}/${v}`);m=await this.shouldSkipExistingFile(D,i,r),d=D}else{b=o;let E=await this.getUniqueFilePathWithIncrementalCheck(o,`${p}.md`,i,r);if(!E){this.selectedNodeIds.has(i)&&(this.processedPagesCount++,r.reportProgress(this.processedPagesCount,this.totalNodesToImport));return}d=E}let{parent:y}=ee(d),T=new Set,k=await na(f,{ctx:r,currentFolderPath:y,currentFilePath:d,client:this.notionClient,vault:this.vault,app:this.app,downloadExternalAttachments:this.downloadExternalAttachments,incrementalImport:this.incrementalImport,indentLevel:0,blocksCache:u,mentionedIds:T,syncedBlocksMap:this.syncedBlocksMap,outputRootPath:this.outputRootPath,syncedChildPagePlaceholders:this.syncedChildPagePlaceholders,syncedChildDatabasePlaceholders:this.syncedChildDatabasePlaceholders,currentPageTitle:p,importPageCallback:async(E,P)=>{await this.fetchAndImportPage({ctx:r,pageId:E,parentPath:P})},onAttachmentDownloaded:()=>{this.attachmentsDownloaded++,r.attachments=this.attachmentsDownloaded,r.attachmentCountEl.setText(this.attachmentsDownloaded.toString())}});k=await Th(k,f,{ctx:r,currentPageFolderPath:b,currentFilePath:d,client:this.notionClient,vault:this.vault,app:this.app,outputRootPath:this.outputRootPath,formulaStrategy:this.formulaStrategy,processedDatabases:this.processedDatabases,relationPlaceholders:this.relationPlaceholders,databasePropertyName:this.databasePropertyName,importPageCallback:async(E,P,v,D)=>{await this.fetchAndImportPage({ctx:r,pageId:E,parentPath:P,databaseTag:v,customFileName:D})},onPagesDiscovered:E=>{}}),u.clear();let _={"notion-id":s.id};a&&(_[this.databasePropertyName]=`[[${a}]]`);let A=await bh({page:s,formulaStrategy:this.formulaStrategy,client:this.notionClient,ctx:r});for(let E in A)E!=="notion-id"&&(_[E]=A[E]);if(_.cover&&typeof _.cover=="string")try{let E=_.cover,P=!E.includes("secure.notion-static.com"),v=await Qo({type:P?"external":"file",url:E,name:p},{ctx:r,currentFolderPath:y,currentFilePath:d,client:this.notionClient,vault:this.vault,app:this.app,downloadExternalAttachments:!0,incrementalImport:this.incrementalImport,currentPageTitle:p});if(v.isLocal&&v.filename){this.attachmentsDownloaded++,r.attachments=this.attachmentsDownloaded,r.attachmentCountEl.setText(this.attachmentsDownloaded.toString());let D=v.filename.substring(v.filename.lastIndexOf(".")),C=`[[${v.path+D}]]`;this.coverPropertyName!=="cover"?(delete _.cover,_[this.coverPropertyName]=C):_.cover=C}else if(console.warn(`Failed to download cover image, keeping original URL: ${v.path}`),this.coverPropertyName!=="cover"){let D=_.cover;delete _.cover,_[this.coverPropertyName]=D}}catch(E){console.error("Failed to download cover image:",E)}if(!m){let E=Gn(_)+k;console.log(`[CREATE FILE] About to create file: ${d}, Page ID: ${i}, Page Title: ${p}`),console.log(`[CREATE FILE] File exists check: ${this.vault.getAbstractFileByPath((0,Z.normalizePath)(d))?"YES":"NO"}`);try{await this.vault.create((0,Z.normalizePath)(d),E),console.log(`[CREATE FILE] Successfully created: ${d}`)}catch(v){throw console.error(`[CREATE FILE] Failed to create file: ${d}`),console.error(`[CREATE FILE] Page ID: ${i}, Page Title: ${p}`),console.error("[CREATE FILE] Error:",v),v}let P=d.replace(/\.md$/,"");this.notionIdToPath.set(i,P),T.size>0&&this.mentionPlaceholders.set(d,T)}this.selectedNodeIds.has(i)&&(this.processedPagesCount++,r.reportProgress(this.processedPagesCount,this.totalNodesToImport))}catch(s){console.error(`Failed to import page ${i}:`,s);let c=`Page ${i.substring(0,8)}...`,p=s instanceof Error?s.message:String(s);console.error(`Error details - Page ID: ${i}, Error: ${p}`),s instanceof Error&&s.stack&&console.error("Stack trace:",s.stack),r.reportFailed(c,p),this.selectedNodeIds.has(i)&&(this.processedPagesCount++,r.reportProgress(this.processedPagesCount,this.totalNodesToImport))}}}async replaceRelationPlaceholders(e){if(this.relationPlaceholders.length===0)return;e.status(`Replacing ${this.relationPlaceholders.length} relation placeholders...`);let r=1,i=0,o=10;for(;r<=o;){let a=this.relationPlaceholders.length;if(r>1&&a===i){e.status("No new relations discovered. Relation processing complete.");break}e.status(`Round ${r}: Processing ${a} relation placeholders...`),i=a;let l=new Set,s=new Set;for(let c of this.relationPlaceholders)for(let p of c.relatedPageIds)this.notionIdToPath.get(p)||(l.add(p),c.targetDatabaseId&&s.add(c.targetDatabaseId));if(s.size>0){e.status(`Round ${r}: Found ${s.size} unimported databases with relations. Importing...`);let c=this.outputRootPath,p=0;for(let u of s){if(e.isCancelled())break;if(!this.processedDatabases.has(u))try{await this.importUnimportedDatabase(e,u,c),p++}catch(f){console.error(`Failed to import unimported database ${u}:`,f)}}if(e.status(`Round ${r}: Imported ${p} databases.`),p>0){r++;continue}}break}r>o&&console.warn(`\u26A0\uFE0F Reached maximum rounds (${o}) for relation processing. Some relations may not be resolved.`),e.status("Replacing relation placeholders with wiki links...");for(let a of this.relationPlaceholders){if(e.isCancelled())break;try{let l=this.notionIdToPath.get(a.pageId);if(!l){console.warn(`Could not find file path for page: ${a.pageId}`);continue}let s=this.vault.getAbstractFileByPath(l+".md");if(!s||!(s instanceof Z.TFile)){console.warn(`Could not find page file: ${l}`);continue}let c=await this.vault.read(s),p=/^---\n([\s\S]*?)\n---/;if(!c.match(p)){console.warn(`No frontmatter found in file: ${s.path}`);continue}let f=c;for(let h of a.relatedPageIds){let b=this.notionIdToPath.get(h);if(b){let d=this.vault.getAbstractFileByPath(b+".md");if(d instanceof Z.TFile){let m=d.basename,y=`"[[${b}|${m}]]"`;f=f.replace(new RegExp(`${h}`,"g"),y)}else console.warn(`Could not find related page file: ${b}`)}else console.warn(`Could not find related page: ${h}`)}f!==c&&await this.vault.modify(s,f)}catch(l){let s=l instanceof Error?l.message:String(l);console.error(`Failed to replace relation placeholder for page ${a.pageId}:`,l),e.reportFailed(`Relation page ${a.pageId}`,s)}}}async importUnimportedDatabase(e,r,i){let o="Untitled Database";try{e.status(`Importing unimported database ${r}...`);let a={ctx:e,currentPageFolderPath:i,currentFilePath:void 0,client:this.notionClient,vault:this.vault,app:this.app,outputRootPath:this.outputRootPath,formulaStrategy:this.formulaStrategy,processedDatabases:this.processedDatabases,relationPlaceholders:this.relationPlaceholders,importPageCallback:async(s,c,p,u)=>{await this.fetchAndImportPage({ctx:e,pageId:s,parentPath:c,databaseTag:p,customFileName:u})},databasePropertyName:this.databasePropertyName};o=(await ia(r,a)).sanitizedTitle}catch(a){let l=a instanceof Error?a.message:String(a);console.error(`Failed to import unimported database "${o}":`,a),e.reportFailed(`Database: ${o}`,l)}}async replaceMentionPlaceholdersInAllFiles(e){if(this.mentionPlaceholders.size===0)return;e.status("Replacing mention placeholders...");let r=0,i=0;for(let[o,a]of this.mentionPlaceholders){if(e.isCancelled())break;try{let l=this.vault.getAbstractFileByPath((0,Z.normalizePath)(o));if(!l||!(l instanceof Z.TFile)){console.warn(`Could not find source file: ${o}`);continue}let s=await this.vault.read(l),c=s;for(let p of a){let u;if(u=this.notionIdToPath.get(p),!u){let h=this.processedDatabases.get(p);h&&(u=h.baseFilePath.replace(/\.base$/,""))}if(!u){console.warn(`No mapping found for mention: ${p}`);continue}let f=this.vault.getAbstractFileByPath(u+".md");if(f||(f=this.vault.getAbstractFileByPath(u+".base")),f instanceof Z.TFile){let h=this.app.fileManager.generateMarkdownLink(f,l.path),b=new RegExp(`\\[\\[NOTION_(PAGE|DB):${p}\\]\\]`,"g"),d=s.match(b);d&&(s=s.replace(b,h),r+=d.length)}else console.warn(`Target file not found: ${u}`)}s!==c&&(await this.vault.modify(l,s),i++)}catch(l){let s=l instanceof Error?l.message:String(l);console.error(`Failed to process mentions in file ${o}:`,l),e.reportFailed(`Mention file ${o}`,s)}}e.status(`Replaced ${r} mention links in ${i} files.`)}async replaceSyncedChildPlaceholders(e){if(this.syncedChildPagePlaceholders.size===0&&this.syncedChildDatabasePlaceholders.size===0)return;e.status("Replacing synced block child references...");let r=0,i=0,o=0;for(let[a,l]of this.syncedChildPagePlaceholders){if(e.isCancelled())break;try{let s=this.vault.getAbstractFileByPath((0,Z.normalizePath)(a));if(!s||!(s instanceof Z.TFile)){console.warn(`Could not find synced block file: ${a}`);continue}let c=await this.vault.read(s),p=c;for(let u of l){let f=kt("SYNCED_CHILD_PAGE",u);if(c.includes(f)){let h=this.notionIdToPath.get(u);if(!h)try{await this.fetchAndImportPage({ctx:e,pageId:u,parentPath:this.outputRootPath}),o++}catch(b){console.warn(`Failed to import synced child page ${u}:`,b),c=c.replace(f,"**Page** _(no access)_");continue}if(h=this.notionIdToPath.get(u),h){let b=this.vault.getAbstractFileByPath(h+".md");if(b&&b instanceof Z.TFile){let d=this.app.fileManager.generateMarkdownLink(b,s.path);c=c.replace(f,d),r++}}}}c!==p&&(await this.vault.modify(s,c),i++)}catch(s){let c=s instanceof Error?s.message:String(s);console.error(`Failed to process synced child page placeholders in file ${a}:`,s),e.reportFailed(`Synced block file ${a}`,c)}}for(let[a,l]of this.syncedChildDatabasePlaceholders){if(e.isCancelled())break;try{let s=this.vault.getAbstractFileByPath((0,Z.normalizePath)(a));if(!s||!(s instanceof Z.TFile)){console.warn(`Could not find synced block file: ${a}`);continue}let c=await this.vault.read(s),p=c;for(let u of l){let f=kt("SYNCED_CHILD_DATABASE",u);if(c.includes(f)){let h=this.processedDatabases.get(u);if(!h)try{await this.importTopLevelDatabase(e,u,this.outputRootPath),o++}catch(b){console.warn(`Failed to import synced child database ${u}:`,b),c=c.replace(f,"**Database** _(no access)_");continue}if(h=this.processedDatabases.get(u),h){let b=h.baseFilePath.replace(/\.base$/,""),d=this.vault.getAbstractFileByPath(b+".base");if(d&&d instanceof Z.TFile){let m=this.app.fileManager.generateMarkdownLink(d,s.path);c=c.replace(f,m),r++}}}}c!==p&&(await this.vault.modify(s,c),i++)}catch(s){let c=s instanceof Error?s.message:String(s);console.error(`Failed to process synced child database placeholders in file ${a}:`,s),e.reportFailed(`Synced block file ${a}`,c)}}e.status(`Replaced ${r} synced child references in ${i} files (imported ${o} new items).`)}async shouldSkipExistingFile(e,r,i){let o=this.vault.getAbstractFileByPath((0,Z.normalizePath)(e));if(!o||!(o instanceof Z.TFile))return!1;try{let a=await this.vault.read(o),l=a.match(/^notion-id:\s*(.+)$/m);if(l&&l[1].trim()===r){let{basename:c}=ee(e);i.reportSkipped(c,"already exists with same notion-id");let p=e.replace(/\.md$/,"");return this.notionIdToPath.set(r,p),await this.collectUnresolvedPlaceholders(a,r,e),!0}return!1}catch(a){return console.error(`Failed to read file ${e} for duplicate check:`,a),!1}}async collectUnresolvedPlaceholders(e,r,i){let o=/^---\n([\s\S]*?)\n---/,a=e.match(o);if(a){let d=a[1],m=/[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}/gi,y=d.match(m);if(y&&y.length>0){let T=d.split(`
`),k=null,_=new Map;for(let A of T){let E=A.match(/^([a-zA-Z0-9_-]+):\s*$/);if(E){k=E[1];continue}if(k){let P=A.match(m);if(P)for(let v of P)A.includes(`[[${v}`)||(_.has(k)||_.set(k,[]),_.get(k).push(v))}}for(let[A,E]of _.entries())E.length>0&&this.relationPlaceholders.push({pageId:r,propertyKey:A,relatedPageIds:E,targetDatabaseId:""});_.size>0&&console.log(`[Incremental Import] Collected ${_.size} unresolved relation(s) from skipped file: ${r}`)}}let l=/\[\[NOTION_PAGE:([a-f0-9-]+)\]\]/g,s=/\[\[NOTION_DB:([a-f0-9-]+)\]\]/g,c=new Set,p;for(;(p=l.exec(e))!==null;)c.add(p[1]);for(;(p=s.exec(e))!==null;)c.add(p[1]);c.size>0&&(this.mentionPlaceholders.set(i,c),console.log(`[Incremental Import] Collected ${c.size} unresolved mention(s) from skipped file: ${i}`));let u=/\[\[SYNCED_CHILD_PAGE:([a-f0-9-]+)\]\]/g,f=/\[\[SYNCED_CHILD_DATABASE:([a-f0-9-]+)\]\]/g,h=new Set,b=new Set;for(;(p=u.exec(e))!==null;)h.add(p[1]);for(;(p=f.exec(e))!==null;)b.add(p[1]);h.size>0&&(this.syncedChildPagePlaceholders.set(i,h),console.log(`[Incremental Import] Collected ${h.size} unresolved synced child page(s) from skipped file: ${i}`)),b.size>0&&(this.syncedChildDatabasePlaceholders.set(i,b),console.log(`[Incremental Import] Collected ${b.size} unresolved synced child database(s) from skipped file: ${i}`))}async getUniqueFilePathWithIncrementalCheck(e,r,i,o){let a=e?`${e}/${r}`:r;return await this.shouldSkipExistingFile(a,i,o)?null:this.vault.getAbstractFileByPath((0,Z.normalizePath)(a))?yr(this.vault,e,r):a}async cleanupNotionIds(e){if(this.notionIdToPath.size===0)return;let r=0,i=0;for(let o of this.notionIdToPath.values()){if(e.isCancelled())break;try{let a=this.vault.getAbstractFileByPath(o+".md");if(!a||!(a instanceof Z.TFile))continue;let l=await this.vault.read(a),s=/^---\n([\s\S]*?)\n---/,c=l.match(s);if(!c)continue;let p=c[1];if(!/^notion-id:\s*.+$/m.test(p))continue;let f=p.split(`
`).filter(b=>!b.match(/^notion-id:\s*.+$/)).join(`
`),h=l.replace(s,`---
${f}
---`);await this.vault.modify(a,h),r++}catch(a){console.error(`Failed to clean notion-id from file: ${o}`,a),i++}}r>0&&console.log(`\u2713 Cleaned notion-id from ${r} file(s)`),i>0&&console.warn(`\u26A0\uFE0F Failed to clean notion-id from ${i} file(s)`)}};var Pe=require("obsidian");function di(n){return n instanceof HTMLElement?n.style.fontFamily.includes("Consolas"):!1}function Sl(n){return n!=null&&n instanceof HTMLParagraphElement&&Array.from(n.childNodes).every(t=>di(t)||fi(t))}function Rl(n){var t;return di(n)&&n.nodeName==="SPAN"&&Il(n).length===0&&Array.from(n.childNodes).every(e=>e.nodeType===Node.TEXT_NODE)&&!((t=n.textContent)!=null&&t.trim().includes(`
`))}function Eh(n){return di(n)&&!Rl(n)}function fi(n){return n instanceof HTMLBRElement}function Il(n){let t=[],e=n.nextSibling;for(;di(e)||fi(e);)t.push(e),e=e.nextSibling;let r=t.findLastIndex(di);return r===-1?[]:(t.length=r+1,t)}var Dl="onenote-importer-refresh-token",kh="66553851-08fa-44f2-8bb1-1436f121a73d",Ah=["user.read","notes.read"],i1=/<(object|iframe)([^>]*)\/>/g,Ph=/(<\/p>)\s*(<p[^>]*>)|\n  \n/g,o1=5,a1=new RegExp(/^data:[\w\d]+\/[\w\d]+;base64,/);function s1(n){throw new Error("Didn't expect to get here")}function l1(n){if(n==null)throw new Error("response is nullish");if(typeof n!="object")throw new Error("response is not an object type");if("@odata.nextLink"in n){let t=n["@odata.nextLink"];if(typeof t!="string")throw new Error(`Link of unknown type: ${typeof t}`)}if(!("value"in n))throw new Error("Expected response to have a 'value' property");if(!Array.isArray(n.value))throw new Error("Expected response to have an error in 'value' property")}function c1(n){return n instanceof HTMLElement}var aa=class extends ce{constructor(){super(...arguments);this.importPreviouslyImported=!1;this.importIncompatibleAttachments=!1;this.selectedIds=[];this.notebooks=[];this.graphData={state:Vn(32),accessToken:""};this.attachmentDownloadPauseCounter=0;this.rememberMe=!1;this.lastSuccessfulFetchTime=performance.now()}async init(){this.addOutputLocationSetting("OneNote"),new Pe.Setting(this.modal.contentEl).setName("Import incompatible attachments").setDesc("Imports incompatible attachments which cannot be embedded in Obsidian, such as .exe files.").addToggle(i=>i.setValue(!1).onChange(o=>this.importIncompatibleAttachments=o)),new Pe.Setting(this.modal.contentEl).setName("Skip previously imported").setDesc("If enabled, notes imported previously by this plugin will be skipped.").addToggle(i=>i.setValue(!0).onChange(o=>this.importPreviouslyImported=!o));let e=!1;if(this.retrieveRefreshToken())try{await this.updateAccessToken(),e=!0}catch(i){}this.microsoftAccountSetting=new Pe.Setting(this.modal.contentEl).setName("Sign in with your Microsoft account").setDesc("You need to sign in to import your OneNote data.").addButton(i=>i.setCta().setButtonText("Sign in").onClick(()=>{this.registerAuthCallback(this.authenticateUser.bind(this));let o=new URLSearchParams({client_id:kh,scope:"offline_access "+Ah.join(" "),response_type:"code",redirect_uri:sa,response_mode:"query",state:this.graphData.state});window.open(`https://login.microsoftonline.com/common/oauth2/v2.0/authorize?${o.toString()}`)})),this.microsoftAccountSetting.settingEl.toggle(!e);let r=new Pe.Setting(this.modal.contentEl).setName("Remember me").setDesc("If checked, you will be automatically logged in for subsequent imports.").addToggle(i=>{i.onChange(o=>{this.rememberMe=o,o&&this.refreshToken?this.storeRefreshToken(this.refreshToken):this.clearStoredRefreshToken()})});r.settingEl.toggle(!e),this.switchUserSetting=new Pe.Setting(this.modal.contentEl).addButton(i=>i.setCta().setButtonText("Switch user").onClick(()=>{this.microsoftAccountSetting.settingEl.show(),r.settingEl.show(),this.clearStoredRefreshToken(),this.switchUserSetting.settingEl.hide(),this.contentArea.empty()})),this.loadingArea=this.modal.contentEl.createDiv({text:"Loading notebooks..."}),this.loadingArea.hide(),this.contentArea=this.modal.contentEl.createDiv(),this.contentArea.hide(),e?(await this.setSwitchUser(),await this.showSectionPickerUI()):this.switchUserSetting.settingEl.hide()}async authenticateUser(e){try{if(e.state!==this.graphData.state)throw new Error(`An incorrect state was returned.
Expected state: ${this.graphData.state}
Returned state: ${e.state}`);await this.updateAccessToken(e.code),await this.setSwitchUser(),await this.showSectionPickerUI()}catch(r){console.error("An error occurred while we were trying to sign you in. Error details: ",r),this.modal.contentEl.createEl("div",{text:"An error occurred while trying to sign you in."}).createEl("details",{text:r}).createEl("summary",{text:"Click here to show error details"})}}async setSwitchUser(){let e=await this.fetchResource("https://graph.microsoft.com/v1.0/me","json");this.switchUserSetting.setDesc(`Signed in as ${e.displayName} (${e.mail}). If that's not the correct account, sign in again.`),this.switchUserSetting.settingEl.show(),this.microsoftAccountSetting.settingEl.hide()}async updateAccessToken(e){let r=new URLSearchParams({client_id:kh,scope:"offline_access "+Ah.join(" "),redirect_uri:sa});if(e)r.set("code",e),r.set("grant_type","authorization_code");else{let o=this.retrieveRefreshToken();if(!o)throw new Error("Missing token required for authentication. Please try logging in again.");r.set("refresh_token",o),r.set("grant_type","refresh_token")}let i=await(0,Pe.requestUrl)({method:"POST",url:"https://login.microsoftonline.com/common/oauth2/v2.0/token",contentType:"application/x-www-form-urlencoded",body:r.toString()}).json;if(!i.access_token)throw new Error(`Unexpected data was returned instead of an access token. Error details: ${i}`);i.refresh_token&&this.storeRefreshToken(i.refresh_token),this.graphData.accessToken=i.access_token}storeRefreshToken(e){this.refreshToken=e,this.rememberMe&&localStorage.setItem(Dl,e)}retrieveRefreshToken(){return this.refreshToken?this.refreshToken:localStorage.getItem(Dl)}clearStoredRefreshToken(){localStorage.removeItem(Dl)}async showSectionPickerUI(){var o,a;this.loadingArea.show(),this.selectedIds=[];let e="https://graph.microsoft.com/v1.0/me/onenote/notebooks",r=new URLSearchParams({$expand:"sections($select=id,displayName),sectionGroups($expand=sections,sectionGroups)",$select:"id,displayName,lastModifiedDateTime",$orderby:"lastModifiedDateTime DESC"}),i=`${e}?${r.toString()}`;try{this.notebooks=(await this.fetchResource(i,"json-wrapped")).value,this.contentArea.empty(),this.contentArea.createEl("h4",{text:"Choose data to import"});for(let l of this.notebooks){if(((o=l.sectionGroups)==null?void 0:o.length)!==0)for(let c of l.sectionGroups)await this.fetchNestedSectionGroups(c);let s=this.contentArea.createDiv();new Pe.Setting(s).setName(l.displayName).setDesc(`Last edited on: ${Pe.moment.utc(l.lastModifiedDateTime).format("Do MMMM YYYY")}. Contains ${(a=l.sections)==null?void 0:a.length} sections.`).addButton(c=>c.setCta().setButtonText("Select all").onClick(()=>{s.querySelectorAll('input[type="checkbox"]:not(:checked)').forEach(p=>p.click())})),this.renderHierarchy(l,s)}}catch(l){this.showContentAreaErrorMessage()}this.loadingArea.hide(),this.contentArea.show()}async fetchNestedSectionGroups(e){if(e.sectionGroups=(await this.fetchResource(e.sectionGroupsUrl+"?$expand=sectionGroups($expand=sections),sections","json-wrapped")).value,e.sectionGroups)for(let r=0;r<e.sectionGroups.length;r++)await this.fetchNestedSectionGroups(e.sectionGroups[r])}renderHierarchy(e,r){if(e.sectionGroups)for(let i of e.sectionGroups){let o=r.createDiv({attr:{style:"padding-inline-start: 1em; padding-top: 8px"}});o.createEl("strong",{text:i.displayName}),this.renderHierarchy(i,o)}if(e.sections){let i=r.createEl("ul",{attr:{style:"padding-inline-start: 1em;"}});for(let o of e.sections){let l=i.createEl("li",{cls:"task-list-item"}).createEl("label"),s=l.createEl("input");s.type="checkbox",l.appendChild(document.createTextNode(o.displayName)),l.createEl("br"),s.addEventListener("change",()=>{if(s.checked)this.selectedIds.push(o.id);else{let c=this.selectedIds.findIndex(p=>p===o.id);c!==-1&&this.selectedIds.splice(c,1)}})}}}showContentAreaErrorMessage(){this.contentArea.empty(),this.contentArea.createEl("p",{text:"Microsoft OneNote has limited how fast notes can be imported. Please try again in 1 hour to continue importing."}),this.contentArea.show(),this.loadingArea.hide()}async import(e){var c;let r=new Set,i=await this.modal.plugin.loadData();i.importers.onenote||(i.importers.onenote={previouslyImportedIDs:[]});for(let p of i.importers.onenote.previouslyImportedIDs)r.add(p);if(!await this.getOutputFolder()){new Pe.Notice("Please select a location to export to.");return}if(!this.graphData.accessToken){new Pe.Notice("Please sign in to your Microsoft Account.");return}e.status("Starting OneNote import");let a=0,l=0,s=0;for(let p of this.selectedIds){let u=`https://graph.microsoft.com/v1.0/me/onenote/sections/${p}/pages`,f=new URLSearchParams({$select:"id,title,createdDateTime,lastModifiedDateTime,level,order,contentUrl",$orderby:"order",pagelevel:"true"}),h=`${u}?${f.toString()}`,b=null;try{b=(await this.fetchResource(h,"json-wrapped",e)).value}catch(d){console.error(`Failed to fetch pages for section ${p}, skipping to next section.`,d),e.status("Failed to fetch pages for a section, skipping to next section.");return}if(b){a+=b.length,this.insertPagesToSection(b,p),e.reportProgress(l,a);for(let d=0;d<b.length;d++){if(e.isCancelled())return;let m=b[d];if(m.title||(m.title=`Untitled-${(0,Pe.moment)().format("YYYYMMDDHHmmss")}`),!this.importPreviouslyImported&&m.id&&r.has(m.id)){e.reportSkipped(m.title,"it was previously imported");continue}try{e.status(`Importing note ${m.title}`),await this.processFile(e,await this.fetchResource(`https://graph.microsoft.com/v1.0/me/onenote/pages/${m.id}/content?includeInkML=true`,"text",e),m),m.id&&(r.add(m.id),i.importers.onenote.previouslyImportedIDs=Array.from(r),await this.modal.plugin.saveData(i)),s=0}catch(y){if(s++,e.reportFailed(m.title,y.toString()),s>5||this.modal.abortController.signal.aborted){let T=this.modal.abortController.signal.aborted?y.message:"Microsoft OneNote returned too many consecutive errors.";e.status(T);for(let k=d+1;k<b.length;k++){let _=b[k];e.reportSkipped((c=_.title)!=null?c:"<unknown>","import was canceled (after too many pages failed to load)")}e.reportProgress(a,a);return}}e.reportProgress(++l,a)}}}}insertPagesToSection(e,r,i){if(!i){for(let o of this.notebooks)this.insertPagesToSection(e,r,o);return}if(i.sectionGroups){let o=i.sectionGroups;for(let a of o)this.insertPagesToSection(e,r,a)}if(i.sections){let o=i;for(let a of o.sections)a.id===r&&(a.pages=e)}}async processFile(e,r,i){var o,a;try{let l=this.convertFormat(r),s=await this.getOutputFolder(),c=this.getEntityPathNoParent(i.id,s.name),p;await this.vault.adapter.exists(c)?p=this.vault.getAbstractFileByPath(c):p=await this.vault.createFolder(c);let u=this.convertTags(St(l.html)),f=await this.getAllAttachments(e,u.replace(Ph,"<br />"));this.combineCodeBlocksAsNecessary(f),this.styledElementToHTML(f),this.convertInternalLinks(f),this.convertDrawings(f),this.removeExtraListItemParagraphs(f),this.escapeTextNodes(f);let h=(0,Pe.htmlToMarkdown)(f).trim().replace(Ph," "),b=await this.saveAsMarkdownFile(p,i.title,h),d=i!=null&&i.lastModifiedDateTime?Date.parse(i.lastModifiedDateTime):null,m=i!=null&&i.createdDateTime?Date.parse(i.createdDateTime):null,y={ctime:(o=m!=null?m:d)!=null?o:Date.now(),mtime:(a=d!=null?d:m)!=null?a:Date.now()};await this.vault.append(b,"",y),e.reportNoteSuccess(i.title)}catch(l){e.reportFailed(i.title,l)}}escapeTextNodes(e){if(e.nodeType===Node.TEXT_NODE&&e.textContent)e.textContent=e.textContent.replace(/([<>])/g,"\\$1");else for(let r=0;r<e.childNodes.length;r++)this.escapeTextNodes(e.childNodes[r])}convertFormat(e){let r={html:"",inkml:""},i=e.split(`
`,1)[0];e.slice(0,-2);let o=e.split(i);if(o.shift(),o.length===2)for(let a of o){let s=a.split(`
`).find(p=>p.includes("Content-Type")).split(";")[0].split(":")[1].trim(),c=a.split(`
`).slice(2).join(`
`).trim();s==="text/html"?r.html=c:s==="application/inkml+xml"&&(r.inkml=c)}else throw new Error("The input string is incorrect and may be missing data. Inputted string: "+e);return r}convertTags(e){var i,o;let r=Array.from(e.querySelectorAll("[data-tag]"));for(let a of r)if((i=a.getAttribute("data-tag"))!=null&&i.contains("to-do")){let s=a.getAttribute("data-tag")==="to-do:completed"?"[x]":"[ ]";a.innerHTML=`- ${s} ${a.innerHTML}`}else{let l=(o=a.getAttribute("data-tag"))==null?void 0:o.split(",");l==null||l.forEach(s=>{a.innerHTML=a.innerHTML+` #${s.replace(":","-")} `})}return e.outerHTML}convertInternalLinks(e){let r=e.findAll("a");for(let i of r)if(i.href.startsWith("onenote:")){let o=i.href.indexOf("#")+1,a=i.href.indexOf("&",o);i.href=i.href.slice(o,a)}}getEntityPathNoParent(e,r){for(let i of this.notebooks){let o=this.getEntityPath(e,`${r}/${i.displayName}`,i);if(o)return o}return null}getEntityPath(e,r,i){let o=null;if("sectionGroups"in i&&i.sectionGroups){let a=this.searchSectionGroups(e,r,i.sectionGroups);a!==null&&(o=a)}if("sections"in i&&i.sections){let a=this.searchSectionGroups(e,r,i.sections);a!==null&&(o=a)}if("pages"in i&&i.pages){let a=this.searchPages(e,r,i);a!==null&&(o=a)}return o&&(o=this.sanitizeFilePath(o)),o}searchPages(e,r,i){var a;let o=null;for(let l=0;l<i.pages.length;l++){let s=i.pages[l],c=(a=s.contentUrl.split("page-id=")[1])==null?void 0:a.split("}")[0];if(s.id===e||c===e){if(s.level===0)i.pages[l+1]&&i.pages[l+1].level!==0?o=`${r}/${s.title}`:o=r;else{o=r;for(let p=i.pages.indexOf(s)-1;p>=0;p--)if(i.pages[p].level===s.level-1){o+="/"+i.pages[p].title;break}}break}}return o}searchSectionGroups(e,r,i){let o=null;for(let a of i)if(a.id===e)o=`${r}/${a.displayName}`;else{let l=this.getEntityPath(e,`${r}/${a.displayName}`,a);if(l){o=l;break}}return o}sanitizeOCRText(e){return e=e.replace(/[^\w\d\s]/g,""),e=e.replace(/\s+/g," ").trim(),e.length>50&&(e=e.substring(0,50)+"..."),e}async getAllAttachments(e,r){var s,c,p,u;let i=St(r.replace(i1,"<$1$2></$1>")),o=i.findAll("object"),a=i.findAll("img"),l=i.findAll("iframe");for(let f of o){for(;f.firstChild;)(s=f.parentNode)==null||s.insertBefore(f.firstChild,f.nextSibling);let h=f.getAttribute("data-attachment").split("."),b=h[h.length-1];if(!(!ur.contains(b)&&!this.importIncompatibleAttachments)){let d=f.getAttribute("data-attachment"),m=f.getAttribute("data"),y=await this.fetchAttachment(e,d,m),T=document.createElement("p");T.innerText=`![[${y}]]`,(c=f.parentNode)==null||c.replaceChild(T,f)}}for(let f=0;f<a.length;f++){let h=a[f],d=h.getAttribute("data-fullres-src-type").split("/")[1],y=`Exported image ${(0,Pe.moment)().format("YYYYMMDDHHmmss")}-${f}.${d}`,T=h.getAttribute("data-fullres-src"),k=await this.fetchAttachment(e,y,T);k&&(h.src=encodeURI(k),!h.alt||a1.test(h.alt)?h.alt="Exported image":h.alt=this.sanitizeOCRText(h.alt)||"Exported image")}for(let f of l)if(f.src.contains("youtube.com")||f.src.contains("youtu.be")){let h=document.createTextNode(`![Embedded YouTube video](${f.src})`);(p=f.parentNode)==null||p.replaceChild(h,f)}else{let h=document.createElement("a");h.href=f.src,(u=f.parentNode)==null||u.replaceChild(h,f)}return i}async fetchAttachment(e,r,i){this.attachmentDownloadPauseCounter===7&&await new Promise(o=>{e.status("Pausing attachment download to avoid rate limiting."),this.attachmentDownloadPauseCounter=0,setTimeout(o,3e3)}),this.attachmentDownloadPauseCounter++,e.status("Downloading attachment "+r);try{let o=await this.getAvailablePathForAttachment(r,[]),a=await this.fetchResource(i,"file",e);return await this.app.vault.createBinary(o,a),e.reportAttachmentSuccess(r),o}catch(o){e.reportFailed(r),console.error(o)}}combineCodeBlocksAsNecessary(e){let r=e.querySelectorAll("p:has(+ br + p)");Array.from(r).reverse().forEach(i=>{let o=i,a=i.nextElementSibling;if(!fi(a))throw new Error(`Expected a <br> element after the paragraph, but found: ${a==null?void 0:a.nodeName}`);let l=a.nextElementSibling;Sl(o)&&Sl(l)&&(o.appendChild(a),o.appendChild(a.cloneNode()),o.insertAdjacentHTML("beforeend",l.innerHTML),l.remove())})}styledElementToHTML(e){let r={"font-weight:bold":"b","font-style:italic":"i","text-decoration:underline":"u","text-decoration:line-through":"s","background-color":"mark"};e.findAll("cite").forEach(a=>a.innerHTML="> "+a.innerHTML+"<br>"),e.querySelectorAll("*").forEach(a=>{if(e.contains(a))if(Rl(a)){let l=document.createElement("code");l.innerHTML=a.innerHTML,a.replaceWith(l)}else if(Eh(a)){let l=[a.innerHTML];Il(a).forEach(c=>{l.push(fi(c)?`
`:c.innerHTML),c.remove()});let s=document.createElement("pre");s.innerHTML="```\n"+l.join("")+"\n```",a.replaceWith(s)}else if(a.nodeName==="TD"){a.removeAttribute("style");return}else{let l=a.getAttribute("style")||"",s=Object.keys(r).find(c=>l.includes(c));if(s){let c=r[s],p=document.createElement(c);p.innerHTML=a.innerHTML,a.replaceWith(p)}}})}convertDrawings(e){var o;let r=document.createTreeWalker(e,NodeFilter.SHOW_COMMENT),i=!1;for(;r.nextNode();)((o=r.currentNode.nodeValue)==null?void 0:o.trim())==="InkNode is not supported"&&(i=!0);if(i){let a=document.createTextNode("> [!caution] This page contained a drawing which was not converted.");e.insertBefore(a,e.firstChild)}else for(let a=0;a<e.children.length;a++){let l=e.children[a];l instanceof HTMLElement&&this.convertDrawings(l)}}removeExtraListItemParagraphs(e){e.querySelectorAll("li > p:first-child").forEach(r=>{c1(r)&&r.style.marginBottom==="0pt"&&r.style.marginTop==="0pt"&&r.replaceWith(...Array.from(r.childNodes))})}async fetchResource(e,r,i,o=0){var s;if(o>=o1)throw new Error("Exceeded maximum retry attempts");let a=performance.now()-this.lastSuccessfulFetchTime,l=1e3*60*90;if(a>l&&this.modal.abortController.abort("stalled for >90 minutes"),this.modal.abortController.signal.aborted){let c=(s=this.modal.abortController.signal.reason)!=null?s:"no reason given";throw new Error(`The import was aborted (${c})`)}try{o>0&&console.log(`Retry attempt #${o} for ${e}`);let c=await fetch(e,{headers:{Authorization:`Bearer ${this.graphData.accessToken}`},signal:this.modal.abortController.signal});if(c.ok){let p;switch(r){case"text":p=await c.text();break;case"file":p=await c.arrayBuffer();break;case"json":p=await c.json();break;case"json-wrapped":p=await c.json(),l1(p),"@odata.nextLink"in p&&p.value.push(...(await this.fetchResource(p["@odata.nextLink"],"json-wrapped",i)).value);break;default:s1(r)}return this.lastSuccessfulFetchTime=performance.now(),p}else{let p=null,u=await c.json();if(u.hasOwnProperty("error")&&(p=u.error),console.log("An error has occurred while fetching an resource:",p||u),(p==null?void 0:p.code)==="40001"||(p==null?void 0:p.code)==="InvalidAuthenticationToken"||c.status===401)return await this.updateAccessToken(),this.fetchResource(e,r,i,o+1);if((p==null?void 0:p.code)==="20166"||c.status===429){let h=c.headers.get("Retry-After"),b=h?+h*1:60;return console.log(`Rate limit exceeded, waiting for: ${b} seconds`),await this.pause(b,"OneNote API is rate-limiting us",i),this.fetchResource(e,r,i,o)}return this.fetchResource(e,r,i,o+1)}}catch(c){return console.error(`An internal error occurred while trying to fetch '${e}'. Error details: `,c),this.fetchResource(e,r,i,o+1)}}};var un=require("obsidian");var Ch=require("obsidian"),p1=/[\?<>\\:\*\|"]/g,u1=/[\x00-\x1f\x80-\x9f]/g,d1=/^\.+$/,f1=/^(con|prn|aux|nul|com[0-9]|lpt[0-9])(\..*)?$/i,m1=/[\. ]+$/,h1=/^\./,g1=/\[/g,y1=/\]/g;function la(n){return n.replace(p1,"").replace(u1,"").replace(d1,"").replace(f1,"").replace(m1,"").replace(g1,"").replace(y1,"").replace(h1,"")}function ca(n,t){let e="MMMM Do, YYYY",r=(0,Ch.moment)(n,e);return r.format(e)!==n?n:r.isValid()?r.format(t):n}var pa=require("obsidian"),b1=["POMO","word-count","date","slider","encrypt","TaoOfRoam","orphans","count","character-count","comment-button","query","streak","attr-table","mentions","search","roam/render","calc"],v1=new RegExp(`\\{\\{(\\[\\[)?(${b1.join("|")})(\\]\\])?.*?\\}\\}(\\})?`,"g"),w1=/{{pdf:|{{\[\[pdf|{{\[\[audio|{{audio:|{{video:|{{\[\[video/,Nh=/https:\/\/firebasestorage(.*?)\?alt(.*?)\)/,x1=/https:\/\/firebasestorage(.*?)\?alt(.*?)/,T1=/(?<=\(\()\b(.*?)\b(?=\)\))/g,ua=class extends ce{constructor(){super(...arguments);this.downloadAttachments=!1;this.fileDateYAML=!1;this.titleYAML=!1;this.newestTimestamp=0;this.oldestTimestamp=0}init(){this.addFileChooserSetting("Roam (.json)",["json"]),this.addOutputLocationSetting("Roam"),this.userDNPFormat=this.getUserDNPFormat(),new un.Setting(this.modal.contentEl).setName("Import settings").setHeading(),new un.Setting(this.modal.contentEl).setName("Download all attachments").setDesc("If enabled, all attachments uploaded to Roam will be downloaded to your attachments folder.").addToggle(e=>{e.setValue(this.downloadAttachments),e.onChange(async r=>{this.downloadAttachments=r})}),new un.Setting(this.modal.contentEl).setName("Add YAML created/update date").setDesc("If enabled, notes will have the create-time and edit-time from Roam added as properties.").addToggle(e=>{e.setValue(this.fileDateYAML),e.onChange(async r=>{this.fileDateYAML=r})}),new un.Setting(this.modal.contentEl).setName("Add YAML title").setDesc("If enabled, notes will have the full title added as a property (regardless of illegal file name characters).").addToggle(e=>{e.setValue(this.titleYAML),e.onChange(async r=>{this.titleYAML=r})})}async import(e){this.progress=e;let{files:r}=this;if(r.length===0){new un.Notice("Please pick at least one file to import.");return}let i=await this.getOutputFolder();if(!i){new un.Notice("Please select a location to export to.");return}for(let o of r){if(e.isCancelled())return;let a=de(o.basename),l=`${i.path}/${a}`,s=`${i.path}/${a}/Attachments`;await this.createFolders(l),await this.createFolders(s);let c=await o.readText(),p=JSON.parse(c),[u,f]=this.preprocess(p),h=new Map;for(let y in p){let T=p[y],k=ca(la(T.title),this.userDNPFormat).trim();if(k===""){e.reportFailed(T.uid,"Title is empty"),console.error("Cannot import data with an empty title",T);continue}let _=`${l}/${k}.md`,A=this.titleYAML?T.title:"",E=0,P=0;if(this.fileDateYAML){let D=T["create-time"],N=T["edit-time"];typeof D=="number"&&(E=D),typeof N=="number"&&(P=N)}let v=await this.jsonToMarkdown(l,s,T,"",!1,A,E,P);h.set(_,v)}for(let y of f.values()){let T=await this.roamMarkupScrubber(l,s,y.blockString,!0),k=await this.extractAndProcessBlockReferences(h,u,l,T),_=`${l}/${y.pageName}.md`,A=h.get(_);if(A){let E=A.split(`
`),P=E.findIndex(v=>v.contains("* "+T));P!==-1&&(E[P]=E[P].replace(T,k)),h.set(_,E.join(`
`))}}let{vault:b}=this,d=h.size,m=1;for(let[y,T]of h.entries()){if(e.isCancelled())return;try{let{parent:k}=ee(y);await this.createFolders(k);let _=b.getAbstractFileByPath(y);_?await b.modify(_,T):await b.create(y,T),e.reportNoteSuccess(y),e.reportProgress(m,d)}catch(k){console.error("Error saving Markdown to file:",y,k),e.reportFailed(y)}m++}}}getUserDNPFormat(){let e=this.app.internalPlugins.getPluginById("daily-notes").instance;return e?e.options.format||"YYYY-MM-DD":(console.log('Daily note plugin is not enabled. Roam import defaulting to "YYYY-MM-DD" format.'),"YYYY-MM-DD")}preprocess(e){let r=new Map,i=new Map,o=this.userDNPFormat;function a(l,s){if(s.uid){let c=new Date(l.uid);if(!isNaN(c.getTime())){let f=ca(l.title,o);l.title=f}let p={pageName:la(l.title),blockString:s.string};/.*?(\(\(.*?\)\)).*?/g.test(s.string)&&i.set(s.uid,p),r.set(s.uid,p)}if(s.children)for(let c of s.children)a(l,c)}for(let l of e)if(l.children)for(let s of l.children)a(l,s);return[r,i]}async roamMarkupScrubber(e,r,i,o=!1){return i=i.replace(v1,""),i.substring(0,8)==":hiccup "&&i.includes(":hr")?"---":(i=i.replace(/\[\[(.*?)\]\]/g,(a,l)=>`[[${ca(la(l),this.userDNPFormat)}]]`),i=i.replace(/\[\[(.*\/.*)\]\]/g,(a,l)=>`[[${e}/${l}|${l}]]`),i=i.replace(/\[.+?\]\((\(.+?\)\))\)/g,"$1"),i=i.replace(/\[(.+?)\]\(\[\[(.+?)\]\]\)/g,"[[$2|$1]]"),i=i.replace(/\[\[>\]\]/g,">"),i=i.replace(/{{TODO}}|{{\[\[TODO\]\]}}/g,"[ ]"),i=i.replace(/{{DONE}}|{{\[\[DONE\]\]}}/g,"[x]"),i=i.replace("::",":"),i=i.replace(/{{.*?\bvideo\b.*?(\bhttp.*?\byoutu.*?)}}/g,"![]($1)"),i=i.replace(/(https?:\/\/twitter\.com\/(?:#!\/)?\w+\/status\/\d+(?:\?[\w=&-]+)?)/g,"![]($1)"),i=i.replace(/\_\_(.+?)\_\_/g,"*$1*"),i=i.replace(/\^\^(.+?)\^\^/g,"==$1=="),i=i.replace(/{{\[{0,2}embed.*?(\(\(.*?\)\)).*?}}/g,"$1"),i=i.replace(/{{\[{0,2}embed.*?(\[\[.*?\]\]).*?}}/g,"$1"),this.downloadAttachments&&!o&&i.includes("firebasestorage")&&(i=await this.downloadFirebaseFile(i,r)),i)}async jsonToMarkdown(e,r,i,o="",a=!1,l,s,c){let p=[],u=[],f=i["edit-time"],h=i["create-time"];if(this.newestTimestamp<this.oldestTimestamp&&(this.oldestTimestamp=this.newestTimestamp),this.newestTimestamp=!f||c>f?c:f,h!==void 0?s>10?this.oldestTimestamp=Math.min(s,h):this.oldestTimestamp=h:this.oldestTimestamp=s,"string"in i&&i.string){let b=i.heading?"#".repeat(i.heading)+" ":"",d=await this.roamMarkupScrubber(e,r,i.string);p.push(`${a?o+"* ":o}${b}${d}`)}if(i.children)for(let b of i.children)p.push(await this.jsonToMarkdown(e,r,b,o+"  ",!0,"",this.oldestTimestamp,this.newestTimestamp));if((this.fileDateYAML||this.titleYAML)&&!a){let b=this.oldestTimestamp;if(u.push("---"),this.titleYAML&&u.push(`title: "${l}"`),this.fileDateYAML){let d="YYYY-MM-DD HH:mm:ss",m=this.newestTimestamp?(0,pa.moment)(this.newestTimestamp).format(d):(0,pa.moment)(new Date).format(d),y=b?(0,pa.moment)(b).format(d):m;u.push("created: "+y),u.push("updated: "+m)}u.push("---"),p.unshift(u.join(`
`))}return p.join(`
`)}async modifySourceBlockString(e,r,i,o){if(!r.blockString.endsWith("^"+o)){let a=`${i}/${r.pageName}.md`,l=e.get(a);if(l){let s=l.split(`
`),c=s.findIndex(p=>p.contains("* "+r.blockString));if(c!==-1){let p=r.blockString+" ^"+o;s[c]=s[c].replace(r.blockString,p),r.blockString=r.blockString+" ^"+o}e.set(a,s.join(`
`))}}}async extractAndProcessBlockReferences(e,r,i,o){let a=o.match(T1);if(!a)return o;let l=[];for(let p of a)try{let u=r.get(p);if(!u){l.push(p);continue}let f=u.blockString.replace(/\[\[|\]\]/g,""),h=`[[${i}/${u.pageName}#^${p}|${f}]]`;await this.modifySourceBlockString(e,u,i,p),l.push(h)}catch(u){l.push(p)}let s=0;return o.replace(/\(\(\b.*?\b\)\)/g,()=>l[s++])}async downloadFirebaseFile(e,r){let{progress:i,vault:o}=this,a="";try{let l,s;if(w1.test(e)?(l=e.match(/https:\/\/firebasestorage(.*?)\?alt(.*?)\}/),s=e.match(/{{.*https:\/\/firebasestorage.*?alt=media&.*?(?=\s|$)/)):Nh.test(e)?(l=e.match(Nh),s=e.match(/!\[.*https:\/\/firebasestorage.*?alt=media&.*?(?=\s|$)/)):(l=e.match(x1),s=e.match(/https:\/\/firebasestorage.*?alt=media&.*?(?=\s|$)/)),l&&s){let c="https://firebasestorage"+l[1],p=decodeURIComponent(c.split("/").last()||"");if(p){let d=p.split("/");d.length>1&&(d.splice(-1,1),this.createFolders(`${r}/${d.join("/")}`))}else{let d=Math.floor(Date.now()/1e3),m=c.slice(-5).match(/(.*?)\.(.+)/);if(!m)return i.reportSkipped(l[1],"Unexpected file extension"),e;p=`${d}.${m[2]}`}let u=`${r}/${p}`;if(o.getAbstractFileByPath(u))return i.reportSkipped(l[1],"File already exists"),e;a=l[0].slice(0,-1);let b=await(await fetch(a,{})).arrayBuffer();return await o.createBinary(u,b),i.reportAttachmentSuccess(a),e.replace(s[0],`![[${u}]]`)}}catch(l){console.error(l),i.reportFailed(a,l)}return e}};var dn=require("obsidian");var Sh=/!\[\]\(assets\/([^)]*)\)/g,da=class extends ce{init(){dn.Platform.isMacOS||this.modal.contentEl.createEl("p",{text:"Due to platform limitations, only textpack and zip files can be imported from this device. Open your vault on a Mac to import textbundle files."});let t=dn.Platform.isMacOS?["textbundle","textpack","zip"]:["textpack","zip"];this.addFileChooserSetting("Textbundle",t,!0),this.addOutputLocationSetting("Textbundle")}async import(t){let{files:e}=this;if(e.length===0){new dn.Notice("Please pick at least one file to import.");return}let r=await this.getOutputFolder();if(!r){new dn.Notice("Please select a location to export to.");return}this.attachmentsFolderPath=await this.createFolders(`${r.path}/assets`);for(let i of e)if(i.extension==="textpack")await Ot(i,async(o,a)=>{await this.process(t,i.name,a)});else if(i.extension==="zip")await Ot(i,async(o,a)=>{let l=this.groupFilesByTextbundle(i.name,a);for(let s of l)await this.process(t,i.name,s)});else{let a=await new _n(`${i.toString()}/`).list();await this.process(t,i.name,a)}}groupFilesByTextbundle(t,e){let r={},i=t+"/",o=".textbundle";for(let a of e){if(!a.fullpath.startsWith(i)){console.log("Skipping",a.fullpath);continue}let l=a.fullpath.slice(i.length);if(l.startsWith("._")||l.startsWith("__MACOSX")){console.log("Skipping",a.fullpath);continue}let s=l.indexOf(o);if(s===-1){console.log("Skipping",a.fullpath);continue}let c=l.slice(0,s)+".textbundle";if(l.slice(s+o.length+1).startsWith("._")){console.log("Skipping",a.fullpath);continue}c in r?r[c].push(a):r[c]=[a]}return Object.values(r)}async process(t,e,r){let i=r.find(o=>o.name==="info.json");if(i){let o=await i.readText(),a=JSON.parse(o);if(a.hasOwnProperty("type")&&a.type!=="net.daringfireball.markdown"){t.reportSkipped(e,"The textbundle does not contain markdown");return}}for(let o of r)if(!o.name.startsWith("._"))try{if(o.type==="file"&&(o.extension==="md"||o.extension==="markdown")){let a="parent"in o?o.parent:e;a=a.replace(/.textbundle$/,"");let l=await o.readText();l.match(Sh)&&(l=l.replace(Sh,`![[${this.attachmentsFolderPath.path}/$1]]`));let s=(0,dn.normalizePath)(a),c=await this.getOutputFolder();await this.saveAsMarkdownFile(c,s,l),t.reportNoteSuccess(a)}else if(o.type==="file"&&o.fullpath.contains("assets/"))await this.importAsset(t,o);else if(o.type==="folder"){let{basename:a}=ee(o.toString());if(a!=="assets")continue;let s=await new _n(`${o.toString()}/`).list();for(let c of s)await this.importAsset(t,c)}else o.name!=="info.json"&&t.reportSkipped(o.name,"the file is not a media or markdown file.")}catch(a){t.reportFailed(o.name,a)}}async importAsset(t,e){if(e.type==="folder"){t.reportSkipped(e.name);return}let r=`${this.attachmentsFolderPath.path}/${e.name}`;this.vault.getAbstractFileByPath(r)&&t.reportSkipped(e.name,"the file already exists.");let o=await e.read();await this.vault.createBinary(r,o),t.reportAttachmentSuccess(e.name)}};var He=require("obsidian");var fa=class{constructor(){this.activeFormatStack=[];this.todoEnabled=!0;this.currentTodoHeading=null;this.keepTitleMode="automatic"}setTodoEnabled(t){this.todoEnabled=t}setKeepTitleMode(t){this.keepTitleMode=t}isFullyStrikethrough(t){return t.every(e=>e.xmlPath.includes("strikethrough"))}isTodoTitle(t){return/to ?do/i.test(t)}updateTodoContext(t,e){if(!this.currentTodoHeading||t<=this.currentTodoHeading.level){let r=this.isTodoTitle(e);this.currentTodoHeading=r?{level:t}:null}}isTodoMode(){return this.todoEnabled&&this.currentTodoHeading!==null}parseTomboyDate(t){if(!t)return;let e=t.replace(",",".");return new Date(e)}parseTomboyXML(t){var h,b,d;let r=new DOMParser().parseFromString(t,"text/xml"),i=((h=r.querySelector("title"))==null?void 0:h.textContent)||"Untitled",o=r.querySelector("text"),a=[];o&&(a=this.parseContentStructure(o));let l=r.querySelector("tags"),s=l!=null&&l.textContent?l.textContent.split(",").map(m=>m.trim()):[],c=r.querySelector("create-date"),p=r.querySelector("last-change-date"),u=this.parseTomboyDate((b=c==null?void 0:c.textContent)!=null?b:void 0),f=this.parseTomboyDate((d=p==null?void 0:p.textContent)!=null?d:void 0);return{title:i,content:a,tags:s,createDate:u,lastChangeDate:f}}parseContentStructure(t){let e=t.querySelector("note-content");if(!e)return[];let r=this.extractContentSections(e,"");return this.splitAndGroupSectionsIntoLines(r)}splitAndGroupSectionsIntoLines(t){let e=[];t.forEach(o=>{let a=o.text.split(`
`);a.forEach((l,s)=>{l&&e.push({text:l,xmlPath:o.xmlPath}),s<a.length-1&&e.push({text:`
`,xmlPath:"newline"})})});let r=[],i=[];return e.forEach(o=>{o.xmlPath==="newline"?(r.push({contentSections:i}),i=[]):i.push(o)}),i.length>0&&r.push({contentSections:i}),r}extractContentSections(t,e){let r=[];return t.childNodes.forEach(i=>{if(i.nodeType===Node.TEXT_NODE){let o=i.textContent||"";o.length>0&&r.push({text:o,xmlPath:e})}else if(i.nodeType===Node.ELEMENT_NODE){let o=i,a=o.tagName,l=e?`${e}/${a}`:a;o.textContent?!Array.from(o.childNodes).some(c=>c.nodeType===Node.TEXT_NODE&&c.textContent&&c.textContent.length>0)&&o.children.length===0?r.push({text:o.textContent,xmlPath:l}):r.push(...this.extractContentSections(o,l)):r.push(...this.extractContentSections(o,l))}}),r}convertToMarkdown(t){this.updateTodoContext(1,t.title);let e=this.convertStructuredContent(t.content),r=de(t.title),i=t.title!==r,o=!1;switch(this.keepTitleMode){case"yes":o=!0;break;case"no":o=!1;break;case"automatic":default:o=i;break}let a=e.split(`
`),l=this.escapeMarkdownSpecialChars(t.title);if(a.length>0&&a[0].trim()===l.trim())if(o)a[0]=`# ${t.title}`,e=a.join(`
`);else{let h=1;for(;h<a.length&&a[h].trim()==="";)h++;e=a.slice(h).join(`
`)}let s=["---"];if(t.createDate){let h=t.createDate.toISOString().split(".")[0];s.push(`created: ${h}`)}if(t.lastChangeDate){let h=t.lastChangeDate.toISOString().split(".")[0];s.push(`changed: ${h}`)}let c="system:notebook:",p=t.tags.filter(h=>h.startsWith(c)).map(h=>h.substring(c.length));t.tags.contains("system:template")&&p.push("template"),p.length>0&&s.push(`tags: [${p.map(h=>`"${h}"`).join(", ")}]`);let f="";return s.length>1&&(s.push("---"),f=s.join(`
`)+`

`),f+e}escapeMarkdownSpecialChars(t){return t.replace(/([\\`*_\[\]#])/g,"\\$1")}formatLineStream(t,e,r=!1){let i="",o=new Set,a="";for(t.forEach((l,s)=>{let c=l.text,p=l.xmlPath.includes("link:internal"),{coreText:u,leadingWhitespace:f,trailingWhitespace:h}=this.extractWhitespaceFromText(c),b=p?de(u):this.escapeMarkdownSpecialChars(u),d={strikethrough:!r&&l.xmlPath.includes("strikethrough"),highlight:l.xmlPath.includes("highlight"),bold:!e&&l.xmlPath.includes("bold"),italic:l.xmlPath.includes("italic"),monospace:l.xmlPath.includes("monospace")},m=this.calculateFormattingChanges(o,d);i+=m.closeTags,i+=a+f,i+=m.openTags,m.openingSpans&&m.openingSpans.forEach(y=>this.activeFormatStack.push(y)),p&&(i+="[["),i+=b,p&&(i+="]]"),o=new Set(Object.keys(d).filter(y=>d[y])),a=h});this.activeFormatStack.length>0;)i+=this.activeFormatStack.pop().closeTag;return i}calculateFormattingChanges(t,e){let r=[];for(;this.activeFormatStack.length>0;){let o=this.activeFormatStack[this.activeFormatStack.length-1],a=o.format;if(!e[a])r.push(o.closeTag),this.activeFormatStack.pop();else break}let i=[];return Object.keys(e).forEach(o=>{if(e[o]&&!t.has(o)){let a=this.getMarkdownTag(o),l={format:o,openTag:a.open,closeTag:a.close};i.push(l)}}),{closeTags:r.join(""),openTags:i.map(o=>o.openTag).join(""),openingSpans:i}}getMarkdownTag(t){switch(t){case"bold":return{open:"**",close:"**"};case"italic":return{open:"*",close:"*"};case"strikethrough":return{open:"~~",close:"~~"};case"monospace":return{open:"`",close:"`"};case"highlight":return{open:"==",close:"=="};default:return{open:"",close:""}}}extractWhitespaceFromText(t){let e=t.match(/^\s*/)[0],r=t.match(/\s*$/)[0];return e.length===t.length?{coreText:"",leadingWhitespace:t,trailingWhitespace:""}:{coreText:t.substring(e.length,t.length-r.length),leadingWhitespace:e,trailingWhitespace:r}}convertStructuredContent(t){let e="";return t.forEach((r,i)=>{let o="",a=r.contentSections[0],l="",s=this.isTodoMode(),c=!1;if(a&&a.xmlPath.includes("list-item")){let f=(a.xmlPath.match(/\/list\//g)||[]).length,h="    ".repeat(f);if(s){c=this.isFullyStrikethrough(r.contentSections);let b=c?"[x]":"[ ]";l=h+"- "+b+" "}else l=h+"- "}let p="",u=!1;if(r.contentSections.length>0&&l===""){let f=r.contentSections.map(m=>m.xmlPath),h=f.every(m=>m.includes("bold")),b=f.every(m=>m.includes("size:huge")),d=f.every(m=>m.includes("size:large"));if(h||b||d){let m=6;b?m-=4:d&&(m-=2),h&&(m-=1,u=!0),p="#".repeat(m)+" ";let T=r.contentSections.map(k=>k.text).join("").trim();this.updateTodoContext(m,T)}}o=this.formatLineStream(r.contentSections,u,c),p?e+=p+o.trim():e+=l+o,i<t.length-1&&(e+=`
`)}),e}};var ma=class extends ce{getDefaultTomboyPath(){if(!He.Platform.isDesktopApp||!ot||!H)return"";try{if(He.Platform.isMacOS)return H.join(ot.homedir(),"Library","Application Support","Tomboy");if(He.Platform.isWin)return H.join(process.env.APPDATA||"","Roaming","Tomboy");if(He.Platform.isLinux){let t=ot.homedir();return H.join(t,".local","share","tomboy")}}catch(t){console.warn("Error detecting default Tomboy path:",t)}return""}getOSSpecificDescription(){return He.Platform.isMacOS?"Tomboy notes are typically found in: ~/Library/Application Support/Tomboy":He.Platform.isWin?"Tomboy notes are typically found in: %APPDATA%\\Tomboy":He.Platform.isLinux?"Tomboy notes are typically found in: ~/.local/share/tomboy - or GNote: ~/.local/share/gnote":"Pick the files that you want to import."}init(){this.todoEnabled=!0,this.coreConverter=new fa,this.keepTitleMode="automatic",this.addFileChooserSetting("Tomboy/Gnote",["note"],!0,this.getOSSpecificDescription(),this.getDefaultTomboyPath()),this.addOutputLocationSetting("Tomboy"),new He.Setting(this.modal.contentEl).setName("Convert TODO lists to checkboxes").setDesc('When enabled, lists in notes with "TODO" in the title will be converted to task lists with checkboxes. Strikethrough items will be marked as completed.').addToggle(t=>{t.setValue(this.todoEnabled).onChange(e=>this.todoEnabled=e)}),new He.Setting(this.modal.contentEl).setName("Keep title in Markdown").setDesc('Choose whether to keep the note title in the Markdown content. "Automatic" keeps titles only when special characters are lost in filename conversion.').addDropdown(t=>{t.addOption("automatic","Automatic").addOption("yes","Keep titles").addOption("no","Filename only").setValue(this.keepTitleMode).onChange(e=>this.keepTitleMode=e)})}async import(t){let{files:e}=this;if(e.length===0){new He.Notice("Please pick at least one file to import.");return}let r=await this.getOutputFolder();if(!r){new He.Notice("Please select a location to export to.");return}this.coreConverter.setTodoEnabled(this.todoEnabled),this.coreConverter.setKeepTitleMode(this.keepTitleMode),t.reportProgress(0,e.length);for(let i=0;i<e.length;i++){if(t.isCancelled())return;let o=e[i];t.status("Processing "+o.name);try{await this.processFile(t,r,o),t.reportNoteSuccess(o.fullpath)}catch(a){t.reportFailed(o.fullpath,a)}t.reportProgress(i+1,e.length)}}async processFile(t,e,r){let i=await r.readText(),o=this.coreConverter.parseTomboyXML(i),a=this.coreConverter.convertToMarkdown(o);await this.saveAsMarkdownFile(e,o.title,a)}};var sa="obsidian://importer-auth/",ur=["png","webp","jpg","jpeg","gif","bmp","svg","mpg","m4a","webm","wav","ogv","3gp","mov","mp4","mkv","pdf"],ha=class{constructor(t){this.notes=0;this.attachments=0;this.skipped=[];this.failed=[];this.maxFileNameLength=100;this.statusMessage="";this.cancelled=!1;this.el=t,this.createProgressUI(t)}createProgressUI(t){t.empty(),this.el=t,this.statusEl=t.createDiv("importer-status"),this.progressBarEl=t.createDiv("importer-progress-bar",e=>{this.progressBarInnerEl=e.createDiv("importer-progress-bar-inner")}),t.createDiv("importer-stats-container",e=>{e.createDiv("importer-stat mod-imported",r=>{this.importedCountEl=r.createDiv({cls:"importer-stat-count",text:this.notes.toString()}),r.createDiv({cls:"importer-stat-name",text:"imported"})}),e.createDiv("importer-stat mod-attachments",r=>{this.attachmentCountEl=r.createDiv({cls:"importer-stat-count",text:this.attachments.toString()}),r.createDiv({cls:"importer-stat-name",text:"attachments"})}),e.createDiv("importer-stat mod-remaining",r=>{this.remainingCountEl=r.createDiv({cls:"importer-stat-count",text:"0"}),r.createDiv({cls:"importer-stat-name",text:"remaining"})}),e.createDiv("importer-stat mod-skipped",r=>{this.skippedCountEl=r.createDiv({cls:"importer-stat-count",text:this.skipped.length.toString()}),r.createDiv({cls:"importer-stat-name",text:"skipped"})}),e.createDiv("importer-stat mod-failed",r=>{this.failedCountEl=r.createDiv({cls:"importer-stat-count",text:this.failed.length.toString()}),r.createDiv({cls:"importer-stat-name",text:"failed"})})}),this.importLogEl=t.createDiv("importer-log"),this.importLogEl.hide()}status(t){this.statusMessage=t,this.statusEl.setText(t.trim()+"...")}reportNoteSuccess(t){this.notes++,this.importedCountEl.setText(this.notes.toString())}reportAttachmentSuccess(t){this.attachments++,this.attachmentCountEl.setText(this.attachments.toString())}reportSkipped(t,e){let{importLogEl:r}=this;this.skipped.push(t),this.skippedCountEl.setText(this.skipped.length.toString()),console.log("Import skipped",t,e),this.importLogEl.createDiv("list-item",i=>{i.createSpan({cls:"importer-error",text:"Skipped: "}),i.createSpan({text:`"${$r(t,this.maxFileNameLength)}"`+(e?` because ${$r(String(e),this.maxFileNameLength)}`:"")})}),r.scrollTop=r.scrollHeight,r.show()}reportFailed(t,e){let{importLogEl:r}=this;this.failed.push(t),this.failedCountEl.setText(this.failed.length.toString()),console.log("Import failed",t,e),this.importLogEl.createDiv("list-item",i=>{i.createSpan({cls:"importer-error",text:"Failed: "}),i.createSpan({text:`"${$r(t,this.maxFileNameLength)}"`+(e?` because ${$r(String(e),this.maxFileNameLength)}`:"")})}),r.scrollTop=r.scrollHeight,r.show()}reportProgress(t,e){e<=0||(console.log("Current progress:",(100*t/e).toFixed(1)+"%"),this.remainingCountEl.setText((e-t).toString()),this.importedCountEl.setText(t.toString()),this.progressBarInnerEl.style.width=(100*t/e).toFixed(1)+"%")}cancel(){this.cancelled=!0,this.progressBarEl.hide(),this.statusEl.hide()}hideStatus(){this.progressBarEl.hide(),this.statusEl.hide()}isCancelled(){return this.cancelled}},_1={importers:{onenote:{previouslyImportedIDs:[]}}},ga=class extends fn.Plugin{async onload(){this.importers={"apple-notes":{name:"Apple Notes",optionText:"Apple Notes",importer:mo,helpPermalink:"import/apple-notes"},bear:{name:"Bear",optionText:"Bear (.bear2bk)",importer:ho,helpPermalink:"import/bear"},csv:{name:"CSV",optionText:"CSV (.csv)",importer:yo,helpPermalink:"import/csv"},evernote:{name:"Evernote",optionText:"Evernote (.enex)",importer:No,helpPermalink:"import/evernote"},keep:{name:"Google Keep",optionText:"Google Keep (.zip/.json)",importer:Ro,helpPermalink:"import/google-keep"},html:{name:"HTML files",optionText:"HTML (.html)",importer:So,helpPermalink:"import/html"},onenote:{name:"Microsoft OneNote",optionText:"Microsoft OneNote",importer:aa,helpPermalink:"import/onenote"},"notion-api":{name:"Notion (API)",optionText:"Notion (API)",importer:oa,helpPermalink:"import/notion"},notion:{name:"Notion",optionText:"Notion (.zip)",importer:Do,helpPermalink:"import/notion",formatDescription:"Export your Notion workspace to HTML format."},"roam-json":{name:"Roam Research",optionText:"Roam Research (.json)",importer:ua,helpPermalink:"import/roam",formatDescription:"Export your Roam Research workspace to JSON format."},textbundle:{name:"Textbundle files",optionText:"Textbundle (.textbundle, .textpack)",importer:da,helpPermalink:"import/textbundle"},tomboy:{name:"Tomboy/Gnote",optionText:"Tomboy/Gnote (.note)",importer:ma}},this.addRibbonIcon("lucide-import","Open Importer",()=>{new mi(this.app,this).open()}),this.addCommand({id:"open-modal",name:"Open importer",callback:()=>{new mi(this.app,this).open()}}),this.registerObsidianProtocolHandler("importer-auth",t=>{if(this.authCallback){this.authCallback(t),this.authCallback=void 0;return}new fn.Notice("Unexpected auth event. Please restart the auth process.")})}onunload(){}async loadData(){return Object.assign({},_1,await super.loadData())}async saveData(t){await super.saveData(t)}registerAuthCallback(t){this.authCallback=t}},mi=class extends fn.Modal{constructor(e,r){super(e);this.current=null;this.plugin=r,this.titleEl.setText("Import data into Obsidian"),this.modalEl.addClass("mod-importer"),this.abortController=new AbortController;let i=Object.keys(r.importers);i.length>0&&(this.selectedId=i[0],this.updateContent())}updateContent(){let{contentEl:e,selectedId:r}=this,i=this.plugin.importers,o=i[r];e.empty();let a=new DocumentFragment;if(a.createSpan({text:"The format to be imported."}),o.formatDescription&&(a.createEl("br"),a.createSpan({text:o.formatDescription})),o.helpPermalink&&(a.createEl("br"),a.createEl("a",{text:`Learn more about importing from ${o.name}.`,href:`https://help.obsidian.md/${o.helpPermalink}`})),new fn.Setting(e).setName("File format").setDesc(a).addDropdown(l=>{for(let s in i)i.hasOwnProperty(s)&&l.addOption(s,i[s].optionText);l.onChange(s=>{i.hasOwnProperty(s)&&(this.selectedId=s,this.updateContent())}),l.setValue(this.selectedId)}),r&&i.hasOwnProperty(r)){let l=this.importer=new o.importer(this.app,this);if(l.notAvailable)return;e.createDiv("modal-button-container",s=>{s.createEl("button",{cls:"mod-cta",text:"Import"},c=>{c.addEventListener("click",async()=>{this.current&&this.current.cancel(),e.empty();let p=e.createDiv(),u=this.current=new ha(p);if(await l.showTemplateConfiguration(u,p)===!1){this.current=null,this.updateContent();return}e.empty();let h=e.createDiv();u.createProgressUI(h);let b=e.createDiv("modal-button-container"),d=b.createEl("button",{cls:"mod-danger",text:"Stop"},m=>{m.addEventListener("click",()=>{u.cancel(),d.detach()})});try{await l.import(u)}finally{this.current===u&&(this.current=null),b.empty(),b.createEl("button",{text:"Import more"},m=>{m.addEventListener("click",()=>this.updateContent())}),b.createEl("button",{cls:"mod-cta",text:"Done"},m=>{m.addEventListener("click",()=>this.close())}),u.hideStatus()}})})})}}onClose(){let{contentEl:e,current:r}=this;e.empty(),this.abortController.abort("import was canceled by user"),r&&r.cancel()}};
/*! Bundled license information:

sax/lib/sax.js:
  (*! http://mths.be/fromcodepoint v0.1.0 by @mathias *)
*/

/* nosourcemap */