---
title: Jot
tags:
  - jot
date: 2025-11-12
status: Done
priority: High
---

Vault Payload:
```json
{
    "description": "vault-inc-backup",
    "displayName": "VAULT-inc",
    "freeformTags": {
        "uniqueid": "testCluster"
    },
    "highCapacitySizeInGBs": 50,
    "compartmentId": "ocid1.compartment.region1..aaaaaaaaeb475qf5q7pvazc44kthsd6zd57beomsyayo2o6bau3c4a4jk6kq",
    "infrastructureDetails": {
	    "infrastructureType": "CLOUD",
	    "availabilityDomain": "OaIn:SEA-AD-2",
	    "faultDomain": "FAULT-DOMAIN-2",
	    "infrastructureId": "ocid1.exascaleinfrastructure.region1.sea.anzwkljsrxtizqyaqkwjxs2gearnhsjsqvxosmu6wsra7dcvbbap7swp37na",
	    "fabricName": "sea200052qfab",
	    "siteGroup": null
    }
}
```

Volume Payload:
```json
{
    "compartmentId": "ocid1.compartment.region1..aaaaaaaaeb475qf5q7pvazc44kthsd6zd57beomsyayo2o6bau3c4a4jk6kq",
    "description": "sample-inc-volume",
    "displayName": "VOLUME-inc",
    "freeformTags": {
        "uniqueid": "testCluster"
    },
    "sizeInGBs": 50,
    "storageType": "HIGH_CAPACITY",
    "vaultId": "ocid1.exascalevault.region1.sea.anzwkljsz4erjkyaa4bk7zzcxhk3u2lx52p7qcsrjkk7agohlbktltztwyta"
}
```

Volume Backup Payload:
```json
{
    "compartmentId": "ocid1.compartment.region1..aaaaaaaaeb475qf5q7pvazc44kthsd6zd57beomsyayo2o6bau3c4a4jk6kq",
    "description": "sample-inc-volume-backup",
    "displayName": "VOLUME-inc-BACKUP",
    "freeformTags": {
        "uniqueid": "test-inc-backup"
    },
    "volumeId": "ocid1.exascalevolume.region1.sea.anzwkljsz4erjkyaxyubaopklfbdkpbb6erzl2y2ns4qdigzl3wgazekzllq",
    "backupType":"INCREMENTAL"
}
```

Volume Attachment Payload
```json
{
  "displayName": "vol-backup-inc-attachment",
  "compartmentId": "ocid1.compartment.region1..aaaaaaaaeb475qf5q7pvazc44kthsd6zd57beomsyayo2o6bau3c4a4jk6kq",
  "volumeId": "ocid1.exascalevolume.region1.sea.anzwkljsz4erjkyaxyubaopklfbdkpbb6erzl2y2ns4qdigzl3wgazekzllq",
  "type": "EDV",
  "deviceName": "incrementEdvDeviceofZxVXP",
  "vmClusterId": "ocid1.exascalevmcluster.region1.sea.anzwkljsz4erjkyaoblautmuaxtgv5uccw5ejjm7exrpjoe2bzpdcrbmvy2a",
  "initiator": null
}
```

ReadOnlyVolumePayload
```json
{
  "displayName": "readonly-from-restore-5",
  "description": "Increment-ReadOnly-Volume",
  "compartmentId": "ocid1.compartment.region1..aaaaaaaaeb475qf5q7pvazc44kthsd6zd57beomsyayo2o6bau3c4a4jk6kq",
  "isReadOnly": "true",
  "sourceDetails": {
    "type": "VOLUME",
    "id": "ocid1.exascalevolume.region1.sea.anzwkljsz4erjkya6xm7r2afrzrmxzjuvdmc7i75wt5wurf2kdolrfgesqqq"
  },
  "freeformTags": {
    "uniqueid": "testCluster"
  }
}
```

# Backup & Restore Test Scenarios Report

## Test Environment Setup
- **Vault**: Vault1
- **Source Volume**: Volume1
- **VM Cluster**: VmCluster1

---

## 1. Empty Backup Scenarios

### Test Case 1.1: Empty Backup Type Change
**Objective**: Verify backup type transitions when empty backups are deleted

**Steps Performed**:
1. Created empty full backup `efB`
2. Created empty incremental backup `eiB1`
3. Deleted `efB` (the full backup)

**Result**: 
- ✅ `eiB1` automatically changed from type `Incremental` → `Full`
- This confirms the system correctly promotes incremental backups to full when the parent is deleted

**Cleanup**:
- Deleted `eiB1`

### Diagram: Empty Backup Type Transition
```
Initial State:
┌─────────────┐     ┌─────────────┐
│    efB      │────▶│    eiB1     │
│  (Full)     │     │(Incremental)│
└─────────────┘     └─────────────┘

After Deleting efB:
                    ┌─────────────┐
                    │    eiB1     │
                    │   (Full)    │  ← Type Changed
                    └─────────────┘
```

---

## 2. Loaded Backup Scenarios

### Test Case 2.1: Incremental Backup Chain with Deletions
**Objective**: Verify backup size consolidation when backups in the chain are deleted

### Setup Phase
1. Created EDV attachment for Volume1 with VmCluster1
2. Mounted ACFS filesystem
3. Wrote **10 GB** initial data

### Backup Chain Creation

| Backup Name | Type        | Action Before Backup | Backup Size |
|-------------|-------------|---------------------|-------------|
| LFB         | Full        | Initial 10 GB data  | 10 GB       |
| LIB1        | Incremental | Added 10 GB data    | 10 GB       |
| LIB2        | Incremental | Added 2 GB data     | 2 GB        |

**Initial State**:
```
LFB (Full) ──▶ LIB1 (Incremental) ──▶ LIB2 (Incremental)
10 GB           10 GB                   2 GB
```

### Deletion Tests

#### Test 2.1.1: Delete Middle Backup (LIB1)
**Action**: Deleted `LIB1`

**Expected Behavior**: `LIB2` should consolidate data from `LIB1`

**Result**:
- ✅ `LIB2` size increased: `2 GB` → `12 GB`
- Confirms incremental data was merged into the next backup in chain

```
After Deleting LIB1:
LFB (Full) ──▶ LIB2 (Incremental)
10 GB           12 GB (consolidated)
```

#### Test 2.1.2: Delete Full Backup (LFB)
**Action**: Deleted `LFB`

**Expected Behavior**: `LIB2` should become full backup and consolidate all data

**Result**:
- ✅ `LIB2` size increased: `12 GB` → `22 GB`
- ✅ `LIB2` type changed: `Incremental` → `Full`
- Confirms complete chain consolidation

```
After Deleting LFB:
LIB2 (Full)
22 GB (all data consolidated)
```

### Cleanup
- Deleted `LIB2`
- Deleted attachment, vault, and source volume

---

## 3. Restore Scenarios

### Test Case 3.1: Multi-Point Restore Verification
**Objective**: Verify point-in-time restore functionality across multiple incremental backups

### Setup Phase
1. Created fresh Vault1 and Volume1
2. Created attachment `attch1` for Volume2
3. Wrote **10 GB** data

### Backup Chain with Specific Files

| Backup Name | Type        | Data Written       | File Created | Cumulative Files           |
|-------------|-------------|--------------------|--------------|----------------------------|
| LFB1        | Full        | 10 GB initial data | (base data)  | (base data)                |
| LIB1        | Incremental | 10 GB              | file1.txt    | (base) + file1.txt         |
| LIB2        | Incremental | 2 GB               | file2.txt    | (base) + file1-2.txt       |
| LIB3        | Incremental | 2 GB               | file3.txt    | (base) + file1-3.txt       |

### Restore Test Matrix

#### Test 3.1.1: Restore LIB2
**Action**: Restored volume from `LIB2` backup

**Verification Steps**:
1. Created new attachment
2. Mounted volume
3. Checked file presence

**Result**:
- ✅ Verified files present: `file.txt`, `file1.txt`, `file2.txt`
- ✅ `file3.txt` correctly **not present** (added after LIB2)

#### Test 3.1.2: Restore LIB3 After Deleting LIB2
**Action**: 
1. Deleted `LIB2` backup
2. Restored volume from `LIB3` backup

**Verification Steps**:
1. Created new attachment
2. Mounted volume
3. Checked file presence

**Result**:
- ✅ Verified files present: `file.txt`, `file1.txt`, `file2.txt`, `file3.txt`
- ✅ All files up to LIB3 correctly restored despite LIB2 deletion

### Diagram: Restore Timeline
```
Backup Chain:
LFB1 ──▶ LIB1 ──▶ LIB2 ──▶ LIB3
│        │        │        │
│        │        │        └─ + file3.txt
│        │        └─────────── + file2.txt
│        └────────────────────── + file1.txt
└─────────────────────────────── base data

Restore LIB2:
└─ Contains: base, file1.txt, file2.txt

Restore LIB3:
└─ Contains: base, file1.txt, file2.txt, file3.txt
```

---

## 4. Read-Only Volume Scenarios

### Test Case 4.1: Read-Only Volume Backup Limitations
**Objective**: Verify backup behavior with read-only volumes

### Setup Phase
1. Used restored volume from `LIB3`
2. Converted volume to **read-only** mode

### Backup Tests

#### Test 4.1.1: Full Backup from Read-Only Volume
**Action**: Created backup from read-only volume

**Result**:
- ✅ Full backup created successfully

#### Test 4.1.2: Incremental Backup from Read-Only Volume
**Action**: Attempted to create incremental backup from read-only volume

**Result**:
- ❌ Incremental backup **failed**
- This is expected behavior as incremental backups require write access to track changes

### Read-Only Limitations Summary
```
Read-Only Volume
│
├─ Full Backup ────────────▶ ✅ Success
│
└─ Incremental Backup ─────▶ ❌ Failed (Expected)
```

---

## Test Results Summary

| Test Scenario                        | Status | Notes                                |
| ------------------------------------ | ------ | ------------------------------------ |
| Empty backup type change             | ✅ Pass | Incremental promoted to Full         |
| Incremental deletion consolidation   | ✅ Pass | Sizes consolidated correctly         |
| Full backup deletion consolidation   | ✅ Pass | Type change + size consolidation     |
| Point-in-time restore (LIB2)         | ✅ Pass | Correct file set restored            |
| Restore after backup deletion (LIB3) | ✅ Pass | Data integrity maintained            |
| Read-only full backup                | ✅ Pass | Successfully created                 |
| Read-only incremental backup         | ✅ Pass | Correctly failed (expected behavior) |






